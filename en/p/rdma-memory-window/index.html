<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="This article is reprinted from Zhihu Column: 14. RDMA Memory Window, Author: Savir. To more flexibly and conveniently control memory access permissions, the IB protocol designed MW. This article mainly introduces the function of MW, its relationship with MR, interfaces, and classification. Additionally, compared to the article on MR, it provides a more in-depth introduction to L_Key and R_Key."><title>RDMA: Memory Window</title>
<link rel=canonical href=https://cuterwrite.top/en/p/rdma-memory-window/><link rel=stylesheet href=/scss/style.min.e82b84120b43b340665e4b3c6b625144c63ea87ec3a8572acc62bbd314e4204b.css><meta property='og:title' content="RDMA: Memory Window"><meta property='og:description' content="This article is reprinted from Zhihu Column: 14. RDMA Memory Window, Author: Savir. To more flexibly and conveniently control memory access permissions, the IB protocol designed MW. This article mainly introduces the function of MW, its relationship with MR, interfaces, and classification. Additionally, compared to the article on MR, it provides a more in-depth introduction to L_Key and R_Key."><meta property='og:url' content='https://cuterwrite.top/en/p/rdma-memory-window/'><meta property='og:site_name' content="Cuterwrite's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='RDMA'><meta property='article:tag' content='计算机网络'><meta property='article:tag' content='转载'><meta property='article:published_time' content='2024-06-26T23:55:00+00:00'><meta property='article:modified_time' content='2024-06-26T23:55:00+00:00'><meta property='og:image' content='https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116373724_p0_master1200.webp'><meta name=twitter:title content="RDMA: Memory Window"><meta name=twitter:description content="This article is reprinted from Zhihu Column: 14. RDMA Memory Window, Author: Savir. To more flexibly and conveniently control memory access permissions, the IB protocol designed MW. This article mainly introduces the function of MW, its relationship with MR, interfaces, and classification. Additionally, compared to the article on MR, it provides a more in-depth introduction to L_Key and R_Key."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116373724_p0_master1200.webp'><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><script async src=https://analytics.cuterwrite.top/uma.js data-website-id=b13594a2-4d15-4a4e-a020-5e3cc1d88c12 data-domains=cuterwrite.top></script><link rel=manifest href=/manifest.json></head><body class="article-page
line-numbers"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/en/><img src=/img/avatar_hu7627246953874065940.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>😉</span></figure><div class=site-meta><h1 class=site-name><a href=/en>Cuterwrite's Blog</a></h1><h2 class=site-description>Cuterwrite's tech blog, focusing on in-depth exploration and experience sharing in areas such as high-performance computing, operating systems, full-stack development, and artificial intelligence.</h2></div></header><ol class=menu-social><li><a href=https://analytics.cuterwrite.top/share/Ji0gm9OaLDk8gco7 target=_blank title=Analytics rel=me><svg width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 5H7A2 2 0 005 7v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="2"/><path d="M9 17v-5"/><path d="M12 17v-1"/><path d="M15 17v-3"/></svg></a></li><li><a href=https://stats.uptimerobot.com/6NVhRHkSAQ target=_blank title=Uptime rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-chart-line"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 19h16"/><path d="M4 15l4-6 4 2 4-5 4 4"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://github.com/PKUcoldkeyboard target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.zhihu.com/people/kong-tiao-cheng-tai-lang-30-57 target=_blank title=zhihu rel=me><svg t="1705591931290" class="icon" viewBox="0 0 1280 1024" p-id="21048" width="32" height="32"><path d="M341.08 296.26v435.08l46.86.02 15.42 52.74 84.02-52.74h99.06V296.26H341.08zm195.5 387.86H480.7l-55.8 35.02-10.16-34.94-23.8-.08V343.5h145.64v340.62zM299.66 495.34H195c3.48-54.2 4.4-103.18 4.4-146.92h102.32s3.94-45.12-17.16-44.62h-177c6.98-26.24 15.74-53.32 26.24-81.34.0.0-48.14.0-64.54 43.14-6.78 17.8-26.42 86.28-61.4 156.24 11.78-1.28 50.74-2.36 73.68-44.42 4.22-11.78 5.02-13.32 10.28-29.06h57.74c0 21-2.4 133.76-3.36 146.88H41.66c-23.48.0-31.12 47.24-31.12 47.24H141.7C132.9 642.2 85.66 726.24.0 792.68c40.98 11.7 81.82-1.86 102-19.8.0.0 45.96-41.8 71.18-138.5L281.1 764.26s15.82-53.78-2.48-79.98c-15.16-17.84-56.12-66.12-73.58-83.62L175.8 623.9c8.72-27.96 13.98-55.1 15.74-81.34h123.3s-.18-47.24-15.18-47.24v.02zm824.04-3.2c41.66-51.28 89.96-117.14 89.96-117.14s-37.3-29.6-54.76-8.12c-12 16.3-73.66 96.4-73.66 96.4l38.46 28.86zM823.52 373.96c-18.02-16.5-51.82 4.26-51.82 4.26s79.04 110.08 82.24 114.9l38.92-27.46s-51.34-75.22-69.32-91.72h-.02zM1280 516.7c-39.56.0-261.82 1.86-262.12 1.86v-202c9.62.0 24.84-.8 45.7-2.4 81.76-4.82 140.26-8 175.54-9.62.0.0 24.44-54.38-1.18-66.88-6.14-2.36-46.34 9.16-46.34 9.16s-330.44 32.98-464.72 36.1c3.2 17.64 15.24 34.16 31.56 39.1 26.62 6.96 45.38 3.4 98.3 1.78 49.66-3.2 87.36-4.86 113.02-4.86v199.62H702.82s5.64 44.62 51.02 45.7h215.88V706.1c0 27.94-22.38 43.98-48.96 42.24-28.16.22-52.16-2.3-83.38-3.62 3.98 7.94 12.66 28.78 38.62 43.68 19.76 9.62 32.34 13.14 52.04 13.14 59.12.0 91.34-34.56 89.78-90.62V564.28h244.72c19.36.0 17.4-47.56 17.4-47.56l.06-.02z" fill="#707070" p-id="21049"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/en/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页 | Home</span></a></li><li><a href=/en/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于 | About</span></a></li><li><a href=/en/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档 | Archives</span></a></li><li><a href=/en/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索 | Search</span></a></li><li><a href=https://cuterwrite.top/image-hosting target=_blank><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-album"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M12 4v7l2-2 2 2V4"/></svg>
<span>图册 | Gallery</span></a></li><li><a href=https://draw.cuterwrite.top target=_blank><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-artboard"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 8m0 1a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H9a1 1 0 01-1-1z"/><path d="M3 8h1"/><path d="M3 16h1"/><path d="M8 3v1"/><path d="M16 3v1"/><path d="M20 8h1"/><path d="M20 16h1"/><path d="M8 20v1"/><path d="M16 20v1"/></svg>
<span>画板 | Canvas</span></a></li><li><a href=https://it-tools.tech target=_blank><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-tools"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 21h4L20 8a1.5 1.5.0 00-4-4L3 17v4"/><path d="M14.5 5.5l4 4"/><path d="M12 8 7 3 3 7l5 5"/><path d="M7 8 5.5 9.5"/><path d="M16 12l5 5-4 4-5-5"/><path d="M16 17l-1.5 1.5"/></svg>
<span>工具 | Tools</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://cuterwrite.top/>中文</option><option value=https://cuterwrite.top/en/ selected>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#what-is-memory-window>What is Memory Window</a></li><li><a href=#memory-access-permission-control>Memory access permission control</a><ul><li><a href=#mrmw-permissions-configuration>MR/MW permissions configuration</a></li><li><a href=#memory-key>Memory Key</a><ul><li><a href=#l_key>L_Key</a></li><li><a href=#r_key>R_Key</a></li></ul></li></ul></li><li><a href=#why-have-mw>Why have MW</a></li><li><a href=#the-relationship-between-mw-and-mr-permissions>The relationship between MW and MR permissions</a></li><li><a href=#user-interface>User Interface</a><ul><li><a href=#control-path>Control path</a><ul><li><a href=#create---allocate-mw>Create - Allocate MW</a></li><li><a href=#delete---deallocate-mw>Delete - Deallocate MW</a></li><li><a href=#query---query-mw>Query - Query MW</a></li></ul></li><li><a href=#data-path>Data path</a><ul><li><a href=#bind>Bind</a></li><li><a href=#invalidation>Invalidation</a></li></ul></li></ul></li><li><a href=#type-of-mw>Type of MW</a><ul><li><a href=#type-1>Type 1</a></li><li><a href=#type-2>Type 2</a><ul><li><a href=#type-2a>Type 2A</a></li><li><a href=#type-2b>Type 2B</a></li></ul></li></ul></li><li><a href=#ib-specification-related-chapters>IB specification related chapters</a></li><li><a href=#reference-document>Reference document</a></li></ul></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/en/p/rdma-memory-window/><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116373724_p0_master1200.webp loading=lazy alt="Featured image of post RDMA: Memory Window"></a></div><div class=article-details><header class=article-category><a href=/en/categories/hpc/ style=background-color:#ffb900;color:#fff>High Performance Computing</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/en/p/rdma-memory-window/>RDMA: Memory Window</a></h2><h3 class=article-subtitle>This article is reprinted from Zhihu Column: 14. RDMA Memory Window, Author: Savir. To more flexibly and conveniently control memory access permissions, the IB protocol designed MW. This article mainly introduces the function of MW, its relationship with MR, interfaces, and classification. Additionally, compared to the article on MR, it provides a more in-depth introduction to L_Key and R_Key.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024-06-26</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>7 minute read</time></div><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-keyboard"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M2 6m0 2a2 2 0 012-2h16a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2z"/><path d="M6 10v.01"/><path d="M10 10v.01"/><path d="M14 10v.01"/><path d="M18 10v.01"/><path d="M6 14v.01"/><path d="M18 14v.01"/><path d="M10 14l4 .01"/></svg>
<time class=article-time--wordcount>3373 words</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://cuterwrite.top/p/rdma-memory-window/ class=link>中文</a></div></footer></div></header><section class=article-content><h1 id=memory-window-of-rdma><a href=#memory-window-of-rdma class=header-anchor>#</a>
Memory Window of RDMA</h1><p><strong>This article welcomes non-commercial reprints, please indicate the source when reprinting.</strong></p><blockquote><p>Statement: For collection only, for easier reading.</p><span class=cite><span>― </span><span>Savir, </span><a href=https://zhuanlan.zhihu.com/p/353590347><cite>Zhihu Column: 14. RDMA Memory Window</cite></a></span></blockquote><p><strong>This article is the 14th in the &ldquo;RDMA Talk&rdquo; column. Welcome to repost, please indicate the source when reposting.</strong></p><p>In the article <a class=link href=/en/p/rdma-mr/>【RDMA Memory Region】
</a>, we introduced Memory Region, which is a special memory area registered by the user: on one hand, its contents will not be swapped to the hard disk, and on the other hand, the RDMA network card records its address translation relationship, allowing the hardware to find the corresponding physical address after obtaining the virtual address specified by the user in the WR.</p><p>In this article, we will explain the concept of Memory Window, which is a more flexible memory management unit based on Memory Region. Besides the concept of MW, this article will also provide a more detailed introduction to some memory-related concepts in the RDMA field, such as L_Key/R_Key, etc. It is recommended to read this article in conjunction with <a class=link href=/en/p/rdma-mr/>【RDMA Memory Region】
</a>for better understanding, and it is suggested that readers review it first.</p><h2 id=what-is-memory-window><a href=#what-is-memory-window class=header-anchor>#</a>
What is Memory Window</h2><p>Memory Window, abbreviated as MW, can be translated into Chinese as 内存窗口. It is an RDMA resource requested by the user to allow a remote node to access the local memory area. Each MW is bound (referred to as bind) to an already registered MR, but compared to MR, it can provide more flexible permission control. MW can be roughly understood as a subset of MR, and many MWs can be divided from one MR, each MW can set its own permissions. The relationship between MW and MR is shown in the following diagram:</p><figure><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-28_12_1.webp alt=2024-06-28_12_1 width=30% loading=lazy><figcaption><h4>The relationship between MR and MW</h4></figcaption></figure><h2 id=memory-access-permission-control><a href=#memory-access-permission-control class=header-anchor>#</a>
Memory access permission control</h2><p>To explain why MW is designed, let&rsquo;s first discuss the access control involved in both MR and MW.</p><h3 id=mrmw-permissions-configuration><a href=#mrmw-permissions-configuration class=header-anchor>#</a>
MR/MW permissions configuration</h3><p>The permissions here refer to the local/remote node, for the read/write permissions of the local memory, they form four combinations:</p><div class=table-wrapper><table><thead><tr><th style=text-align:left></th><th style=text-align:left>Local End</th><th style=text-align:left>Remote End</th></tr></thead><tbody><tr><td style=text-align:left>Read</td><td style=text-align:left>Local Read</td><td style=text-align:left>Remote Read</td></tr><tr><td style=text-align:left>Write</td><td style=text-align:left>Local Write</td><td style=text-align:left>Remote Write</td></tr></tbody></table></div><p>Apart from these four types of permissions, there are also Atomic permissions, etc., which are not within the scope of this article.</p><p>Among the four types of permissions in the table, the lowest is Local Read, which is a permission that users must grant to MR/MW because if a piece of memory is inaccessible to local users, it loses its meaning. Additionally, there is a restriction: if an MR needs to be configured with Remote Write or the not-yet-introduced Remote Atomic permissions, it must also be configured with Local Write permissions. Under this constraint, each MR or MW can configure permissions as needed. For example, if an MR we registered needs to allow remote nodes to write data but not read, we enable the Remote Write permission and disable the Remote Read permission. In this way, when the HCA (network card) receives a WRITE request initiated by the peer for a certain address within the range of this MR, it can allow it; however, when the HCA receives a READ operation from the peer on this MR, it will reject the request and return an error message to the peer.</p><h3 id=memory-key><a href=#memory-key class=header-anchor>#</a>
Memory Key</h3><p>The above access permission configuration cannot prevent malicious users from accessing local or remote memory. For example, if a node grants Remote Write permission to a memory region, wouldn&rsquo;t any remote node (process) be able to write to this region as long as it provides the correct address information? Therefore, the IB specification designed the Memory Key, which can be simply understood as a key mechanism for accessing MR. Only with the correct key can one open the door to MR/MW.</p><p>Key is a string of numbers, consisting of two parts: a 24-bit Index and an 8-bit Key:</p><figure><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-28_12_2.webp alt=2024-06-28_12_2 width=60% loading=lazy><figcaption><h4>Composition of L_Key/R_Key</h4></figcaption></figure><p>Among them, Index is used by HCA for quick indexing to local virtual-to-physical address translation tables and other MR-related information, while Key is used to verify the legality of the entire field to prevent unauthorized users from arbitrarily passing the Index.</p><p>Memory Key is divided into two types according to their usage, Local Key and Remote Key:</p><h4 id=l_key><a href=#l_key class=header-anchor>#</a>
L_Key</h4><p>Local Key, associated with an MR, is used for HCA to access local memory. When a process on the local side attempts to use memory of an already registered MR, the HCA will verify the L_Key it passes. It uses the index in the L_Key to look up the address translation table, translates the virtual address into a physical address, and then accesses the memory.</p><p>In the article <a class=link href=/en/p/rdma-shared-receive-queue/>【RDMA Shared Receive Queue】
</a>, we described sge, which consists of a starting address, length, and key. When users fill out a WR, if they need the HCA to access the local memory, they need to describe the memory block through a linked list of sge (sgl). Here, the key in the sge is filled with L_Key, which are key1 and key3 in the diagram below, representing the L_Key of MR1 and MR2, respectively. Without L_Key, any local user process could direct the hardware to access the contents of other locally registered MRs, and the hardware would find it difficult to efficiently translate virtual addresses to physical addresses.</p><figure><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-28_12_3.webp alt=2024-06-28_12_3 width=50% loading=lazy><figcaption><h4>The function of L_Key</h4></figcaption></figure><h4 id=r_key><a href=#r_key class=header-anchor>#</a>
R_Key</h4><p>Remote Key, associated with an MR or MW, is used for a remote node to access local memory. When a remote node attempts to access local memory, on one hand, the local HCA will verify whether the R_Key is valid, and on the other hand, it will use the index in the R_Key to check the address translation table, translating the virtual address into a physical address and then accessing the memory.</p><p>For any RDMA operation (i.e., Write/Read/Atomic), the user must carry the remote memory region&rsquo;s R_Key in the WR.</p><figure><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-28_12_4.webp alt=2024-06-28_12_4 width=70% loading=lazy><figcaption><h4>The Function of R_Key</h4></figcaption></figure><p>The IB specification ensures that MR can be accessed correctly and safely according to the user&rsquo;s expectations through the two mechanisms mentioned above. We use a metaphor to summarize the content related to MR/MW permission control:</p><p>A equipped their room (MR) with two keys (Memory Key), one for personal use (L_Key), and the other key (R_Key) was sent to B (can be via any communication method). B can open the door when A is not home (the local CPU does not perceive the remote node&rsquo;s RDMA operations on local memory) using the key (R_Key). After opening the door, B might only be able to view the room&rsquo;s arrangement through glass (A only granted remote read permission for this MR), or enter the room and find it completely dark, unable to see anything, but can place items in the room (A only granted remote write permission for this MR), and of course, it is also possible that there&rsquo;s no glass and the lights are on (remote read and write permissions were granted simultaneously).</p><h2 id=why-have-mw><a href=#why-have-mw class=header-anchor>#</a>
Why have MW</h2><p>In short, the purpose of designing MW is to control remote memory access permissions more flexibly.</p><p>In the article <a class=link href=/en/p/rdma-mr/>【RDMA 之 Memory Region】
</a>, we introduced the process of user registering MR, which requires transitioning from user mode to kernel mode, calling the function provided by the kernel to pin the memory (to prevent paging), and then creating a virtual-physical address mapping table and issuing it to the hardware.</p><p>Because MR is managed by the kernel, if a user wants to modify the information of an existing MR, for example, if I want to revoke the remote write permission of a certain MR, leaving only the remote read permission; or if I want to invalidate an R_Key that was previously authorized to a remote node, the user needs to use the Reregister MR interface to make modifications. This interface is equivalent to first Deregister MR and then Register MR. <strong>The above process requires transitioning to kernel mode to complete, and this process is time-consuming.</strong></p><p>Unlike MR, which requires permission modification through the control path, <strong>MW can be dynamically bound to an already registered MR through the data path (i.e., directly issuing WR to the hardware from user space) after creation, and simultaneously set or change its access permissions. This process is much faster than re-registering MR</strong>.</p><p>In order for a piece of memory to be capable of RDMA WRITE/READ operations by a remote node, we have two methods: registering an MR and registering an MW and then binding it to an already registered MR. Both will generate an R_Key to provide to the remote node. The first method has simpler preparation steps but is less flexible, and once registered, modifications are relatively troublesome. The second method involves additional steps of registering an MW and binding the MW to an MR compared to the first method, but it allows for convenient and quick control over remote access permissions.</p><h2 id=the-relationship-between-mw-and-mr-permissions><a href=#the-relationship-between-mw-and-mr-permissions class=header-anchor>#</a>
The relationship between MW and MR permissions</h2><p>Perhaps some readers might think, when configuring their permissions during MR application, and when MW is bound to MR, their permissions are also configured, what is the relationship between these two permissions? The IB specification has a dedicated section on this in 10.6.7.2.2:</p><blockquote><p>When binding a Memory Window, a Consumer can request any combination of remote access rights for the Window. However, if the associated Region does not have local write access enabled and the Consumer requests remote write or remote atomic access for the Window, the Channel Interface must return an error either at bind time or access time.</p></blockquote><p>In summary, <strong>if you want to configure remote write or remote atomic operation (Atomic) permissions for MW, then the MR it is bound to must have local write permissions. In other cases, the permissions of the two do not interfere with each other</strong>: remote users using MW must follow the permission configuration of MW; remote users using MR must follow the permission configuration of MR.</p><h2 id=user-interface><a href=#user-interface class=header-anchor>#</a>
User Interface</h2><p>As usual, when it comes to user interfaces, we classify them according to control paths and data paths:</p><h3 id=control-path><a href=#control-path class=header-anchor>#</a>
Control path</h3><p>MW supports addition, deletion, and search, but cannot be directly modified:</p><h4 id=create---allocate-mw><a href=#create---allocate-mw class=header-anchor>#</a>
Create - Allocate MW</h4><p>Apply for MW, mainly to create the software structure related to MW and prepare the hardware. The user needs to specify the type of MW introduced later in the text. This interface will generate a handle for the Memory Window, which the user can use to refer to this MW in the future.</p><p>Note that at this time MW is not bound to MR and is in a state that cannot be accessed remotely.</p><h4 id=delete---deallocate-mw><a href=#delete---deallocate-mw class=header-anchor>#</a>
Delete - Deallocate MW</h4><p>Unregister MW. It&rsquo;s easy to understand, just destroy the related resources.</p><h4 id=query---query-mw><a href=#query---query-mw class=header-anchor>#</a>
Query - Query MW</h4><p>Query MW information, including R_Key and its status, MW type, and PD, etc.</p><p>It needs to be emphasized again that although this Verbs is described in the IB specification, the related API has not been implemented in the RDMA software stack. There are quite a few Verbs interfaces in similar situations. The RDMA software stack is based on practicality, and interfaces without user demand are generally not implemented.</p><h3 id=data-path><a href=#data-path class=header-anchor>#</a>
Data path</h3><p>MW has a unique set of interfaces in the data path, divided into Bind and Invalidate categories:</p><h4 id=bind><a href=#bind class=header-anchor>#</a>
Bind</h4><p>Bind(ing) means &ldquo;binding,&rdquo; which refers to associating an MW with a specified range of an already registered MR and configuring certain read and write permissions. The result of binding will generate an R_key, which the user can pass to a remote node for remote access. Note that an MW can be bound multiple times, and multiple MWs can be bound to a single MR. If an MR still has bound MWs, then this MR cannot be deregistered.</p><figure><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-28_12_5.webp alt=2024-06-28_12_5 width=90% loading=lazy><figcaption><h4>Bind's Software and Hardware Interaction</h4></figcaption></figure><p>There are two ways to bind: one is to call the Post Send interface to issue a Bind MW WR, and the other is to call the Bind MW interface.</p><ul><li>Post Send Bind MW WR</li></ul><p>In the previous text, we discussed that compared to MR, the biggest advantage of MW is the ability to quickly configure permissions from the data path. Post Send Bind MW WR operation refers to the user issuing a WR to the SQ through the post send interface (such as ibv_post_send()), where the operation type of this WR (such as SEND/RDMA WRITE/RDMA READ) is specified as BIND MW. Additionally, the WR carries information about the permissions and the range of the MR to be bound. Unlike other WRs, after issuing a Bind MW WR, the hardware does not send any packets but instead binds the MW to the specified MR.</p><p>This method is only applicable to Type 2 MW introduced later.</p><ul><li>Bind MW</li></ul><p>Although this is an independent interface, it is actually an additional layer encapsulated outside Post Send Bind MW WR. The user provides the relevant information for MW binding, including permissions and the information of the MR to be bound. The driver is responsible for assembling and issuing the WR to the hardware. After the interface succeeds, the newly generated R_Key will be returned to the user.</p><p>This method is only applicable to Type 1 MW introduced later.</p><p>The relationship between the above two operations is as follows:</p><figure><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-28_12_6.webp alt=2024-06-28_12_6 width=auto loading=lazy><figcaption><h4>The relationship between two types of Bind operations</h4></figcaption></figure><h4 id=invalidation><a href=#invalidation class=header-anchor>#</a>
Invalidation</h4><p>Invalidate means invalidation, referring to the operation where a user sends a WR with an Invalidate opcode to the hardware to invalidate an R_Key.</p><p><strong>It is important to emphasize that the object of the Invalidate operation is the R_Key, not the MW itself. The effect after Invalidate is that the remote user can no longer use this R_Key to access the corresponding MW, but the MW resource still exists, and new R_Keys can still be generated for remote use in the future.</strong></p><p>The Invalidate operation can only be used for Type 2 MW introduced below.</p><p>According to the different initiators of the Invalidate operation, it can be further divided into two types:</p><ul><li>Local Invalidate</li></ul><p>Invalid local operation. If a higher-level user wants to revoke the R_Key permissions of a certain remote user without reclaiming MW resources, they can issue a Local Invalidate operation to the SQ. After the hardware receives it, it will modify the configuration of the corresponding MR. After successful execution, if the remote user holding this R_Key attempts to perform RDMA operations on the MW, the local hardware will reject it and return an error.</p><p>Because it is a local operation, the hardware will not send a message to the link after receiving this WR.</p><figure><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-28_12_7.webp alt=2024-06-28_12_7 width=60% loading=lazy><figcaption><h4>Software and Hardware Interaction of Local Invalidate Operation</h4></figcaption></figure><ul><li>Remote Invalidate</li></ul><p>Remote invalid operation. When a remote user no longer uses an R_Key, they can proactively send a message to allow the local end to reclaim this R_Key. The remote user issues a WR with this operation code to the SQ, and once the hardware receives it, it will assemble a message and send it to the local end. After the local hardware receives the remote&rsquo;s Remote Invalidate operation, it will set the corresponding R_Key to an unusable state. Just like Local Invalidate, thereafter the remote end will not be able to use this R_Key to perform RDMA operations on the corresponding MW.</p><figure><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-28_12_8.webp alt=2024-06-28_12_8 width=90% loading=lazy><figcaption><h4>Remote Invalidate operation's software and hardware interaction</h4></figcaption></figure><h2 id=type-of-mw><a href=#type-of-mw class=header-anchor>#</a>
Type of MW</h2><p>According to different implementations and application scenarios, the IB specification classifies MW:</p><h3 id=type-1><a href=#type-1 class=header-anchor>#</a>
Type 1</h3><p>Type 1 MW is associated with a PD and a QP, and it is not bound to a QP, so it will not affect the destruction of a QP under the same PD.</p><p>The key field of the R_Key for Type 1 MW is controlled by the driver and hardware. Here, &ldquo;controlled&rdquo; means that the key is allocated by the driver and hardware, not by the upper-level user. This is also the reason mentioned earlier that Type 1 MW cannot perform the Invalidate operation. If a user of Type 1 MW wants to invalidate an R_Key, they can bind this MW again through the Bind MW interface. The hardware or driver will automatically allocate a new key field for the R_Key, and the original R_Key will become invalid.</p><p>In addition, if a user temporarily wants to unbind an MW from any MR but still wants to retain the related resources instead of destroying this MW, they can achieve this by calling the Bind MW interface and setting the MW length to 0.</p><p>The IB specification allows multiple Type 1 MWs to be bound to the same MR, and their ranges can overlap.</p><h3 id=type-2><a href=#type-2 class=header-anchor>#</a>
Type 2</h3><p>Type 2 MW grants users greater freedom, with the key field segment of the R_Key controlled by the user, allowing them to allocate it as they wish. As mentioned earlier, users perform binding through the Post Send Bind MW WR operation, and this process does not return an R_Key. Users must remember the index from the Allocate MW operation and combine it with their chosen 8-bit key to form the R_Key and send it to the peer.</p><p>The user can invalidate an R_Key through the Invalidate operation introduced earlier. If you want to assign a new R_Key to the MW, you must first invalidate the previous R_Key through the Invalidate operation.</p><p>Unlike Type 1, Type 2&rsquo;s MW does not support 0-length binding.</p><p>The IB specification also allows multiple Type 2s to be bound to the same MR, and the ranges can overlap.</p><p>In addition, based on different binding relationships, Type 2 can be further divided into two implementation methods, with their differences lying solely in the binding relationship with QP.</p><h4 id=type-2a><a href=#type-2a class=header-anchor>#</a>
Type 2A</h4><p>Associated with a QP through QPN, meaning that when remote access occurs within this MW range, in addition to the R_Key, the correct QPN must also be specified. If a QP has a bound Type 2A MW, then this QP cannot be destroyed.</p><h4 id=type-2b><a href=#type-2b class=header-anchor>#</a>
Type 2B</h4><p>By associating a QP with QPN and PD, there is an additional PD verification compared to Type 2A. When the remote end accesses the memory of the MW through RDMA operations, besides the QPN needing to be correct, the PD specified for the local QP must also be the same as the PD bound to this MW. Additionally, unlike Type 2A, a QP can be destroyed even if there is still a Type 2B MW binding relationship.</p><p>The introduction in the original IB specification is relatively scattered, so let&rsquo;s briefly summarize the similarities and differences of several MWs:</p><div class=table-wrapper><table><thead><tr><th style=text-align:left></th><th style=text-align:left>Type 1</th><th style=text-align:left>Type 2A</th><th style=text-align:left>Type 2B</th></tr></thead><tbody><tr><td style=text-align:left>Correlation</td><td style=text-align:left>PD</td><td style=text-align:left>QP</td><td style=text-align:left>PD + QP</td></tr><tr><td style=text-align:left>R_Key&rsquo;s key field ownership</td><td style=text-align:left>Driver + Hardware</td><td style=text-align:left>User</td><td style=text-align:left>User</td></tr><tr><td style=text-align:left>Binding Method</td><td style=text-align:left>Bind MW After binding, the previous R_Key automatically becomes invalid</td><td style=text-align:left>Post Send Bind MWWR Before binding, the previous R_Key needs to be invalidated</td><td style=text-align:left>Post Send Bind MWWR Before binding, the previous R_Key needs to be invalidated</td></tr><tr><td style=text-align:left>Is zero length supported</td><td style=text-align:left>Yes</td><td style=text-align:left>No</td><td style=text-align:left>No</td></tr><tr><td style=text-align:left>Supports Invalidate</td><td style=text-align:left>No</td><td style=text-align:left>Yes</td><td style=text-align:left>Yes</td></tr><tr><td style=text-align:left>Can the associated QP be destroyed</td><td style=text-align:left>-</td><td style=text-align:left>No</td><td style=text-align:left>Yes</td></tr></tbody></table></div><p>In addition, the IB specification also provides the following descriptions for the above types: HCA must implement Type 1 MW, and can optionally choose to implement either Type 2A or 2B. Type 1 and Type 2 MW can be simultaneously associated with the same MR. Since I have not encountered many applications using MW, I cannot clearly explain in which scenarios each type of MW should be used. If readers have insights on this topic, they are welcome to share and discuss.</p><p>Alright, MW will be discussed up to here, and this concludes the introduction of common resources in RDMA technology.</p><p>Given that devices generally supporting RDMA are quite expensive, in the next article I will introduce how to conduct some programming experiments through software-simulated devices—namely Soft-RoCE.</p><h2 id=ib-specification-related-chapters><a href=#ib-specification-related-chapters class=header-anchor>#</a>
IB specification related chapters</h2><ul><li><p>3.5.3 Memory Keys Introduction</p></li><li><p>9.4.1.1 Invalidate Operation</p></li><li><p>10.6.7 Permission Management</p></li><li><p>11.2.10.9~12 Related Verbs Introduction</p></li></ul><h2 id=reference-document><a href=#reference-document class=header-anchor>#</a>
Reference document</h2><p>[1] IB Specification Vol 1-Release-1.4</p><p>[2] Linux Kernel Networking - Implementation and Theory. Chapter 13</p></section><footer class=article-footer><section class=article-tags><a href=/en/tags/rdma/>RDMA</a>
<a href=/en/tags/computer-network/>Computer Networks</a>
<a href=/en/tags/repost/>Reprint</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><script type=text/javascript src=/js/prism.js async></script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/en/p/rdma-shared-receive-queue/><div class=article-image><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116373922_p0_master1200.webp loading=lazy data-key=rdma-shared-receive-queue data-hash=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116373922_p0_master1200.webp></div><div class=article-details><h2 class=article-title>RDMA: Shared Receive Queue</h2></div></a></article><article class=has-image><a href=/en/p/rdma-completion-queue/><div class=article-image><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116903369_p0_master1200.webp loading=lazy data-key=rdma-completion-queue data-hash=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116903369_p0_master1200.webp></div><div class=article-details><h2 class=article-title>RDMA: Completion Queue</h2></div></a></article><article class=has-image><a href=/en/p/rdma-queue-pair/><div class=article-image><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116342820_p0_master1200.webp loading=lazy data-key=rdma-queue-pair data-hash=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116342820_p0_master1200.webp></div><div class=article-details><h2 class=article-title>RDMA: Queue Pair</h2></div></a></article><article class=has-image><a href=/en/p/rdma-address-handle/><div class=article-image><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116373922_p9_master1200.webp loading=lazy data-key=rdma-address-handle data-hash=https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116373922_p9_master1200.webp></div><div class=article-details><h2 class=article-title>RDMA: Address Handle</h2></div></a></article><article class=has-image><a href=/en/p/rdma-protection-domain/><div class=article-image><img src=https://cuterwrite-1302252842.file.myqcloud.com/img/d31a474af07682028ca085f871bc5d07195413-2024-04-19.webp loading=lazy data-key=rdma-protection-domain data-hash=https://cuterwrite-1302252842.file.myqcloud.com/img/d31a474af07682028ca085f871bc5d07195413-2024-04-19.webp></div><div class=article-details><h2 class=article-title>RDMA: Protection Domain</h2></div></a></article></div></div></aside><script src=https://unpkg.com/twikoo@1.6.39/dist/twikoo.all.min.js></script><div id=tcomment></div><style>.twikoo{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}:root[data-scheme=dark]{--twikoo-body-text-color-main:rgba(255, 255, 255, 0.9);--twikoo-body-text-color:rgba(255, 255, 255, 0.7)}.twikoo .el-input-group__prepend,.twikoo .tk-action-icon,.twikoo .tk-time,.twikoo .tk-comments-count{color:var(--twikoo-body-text-color)}.twikoo .el-input__inner,.twikoo .el-textarea__inner,.twikoo .tk-preview-container,.twikoo .tk-content,.twikoo .tk-nick,.twikoo .tk-send{color:var(--twikoo-body-text-color-main)}.twikoo .el-button{color:var(--twikoo-body-text-color)!important}.OwO .OwO-body{background-color:var(--body-background)!important;color:var(--body-text-color)!important}</style><script>twikoo.init({envId:"https://comment.cuterwrite.top",el:"#tcomment",lang:"zh-CN"})</script><footer class=site-footer><section class=copyright>&copy;
2021 -
2024 cuterwrite</section><section class=running-time>本博客已稳定运行
<span id=runningdays class=running-days></span><br>总访客数：
<span id=busuanzi_value_site_uv class=running-days>Loading</span><br>总访问量：
<span id=busuanzi_value_site_pv class=running-days>Loading</span></section><section class=totalcount>发表了
<span class=running-days>25</span> 篇文章 ·
总计
<span class=running-days>60.67k</span> 字</section><section class=powerby><hr>Built with <b><a style=color:#9e8f9f href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a></b><br>Theme <b><a style=color:#9e8f9f href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a><br><span>基于 <a href=https://github.com/CaiJimmy/hugo-theme-stack/tree/v3.27.0 target=_blank rel=noopener><b style=color:#9e8f9f>v3.27.0</b></a> 分支版本修改</span><br></section></footer><script>let s1="2021-4-17";s1=new Date(s1.replace(/-/g,"/"));let s2=new Date,timeDifference=s2.getTime()-s1.getTime(),days=Math.floor(timeDifference/(1e3*60*60*24)),hours=Math.floor(timeDifference%(1e3*60*60*24)/(1e3*60*60)),minutes=Math.floor(timeDifference%(1e3*60*60)/(1e3*60)),result=days+"天"+hours+"小时"+minutes+"分钟";document.getElementById("runningdays").innerHTML=result</script><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://libs.jshub.com/photoswipe/4.1.3/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://libs.jshub.com/photoswipe/4.1.3/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://libs.jshub.com/photoswipe/4.1.3/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://libs.jshub.com/photoswipe/4.1.3/photoswipe.min.css crossorigin=anonymous></main></div><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.font.im/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><meta name=apple-mobile-web-app-capable content="yes"><meta name=theme-color content="#ffffff"><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service worker registered with scope: ",e.scope)},e=>{console.log("Service worker registration failed: ",e)})})</script><script defer src=https://cn.vercount.one/js></script></body></html>