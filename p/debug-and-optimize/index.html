<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å‡ ç§å¸¸ç”¨çš„ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·ï¼Œå¦‚å¼ºå¤§çš„è°ƒè¯•å™¨ gdbï¼Œå¯ç”¨äºè·Ÿè¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ã€æ£€æµ‹å†…å­˜é”™è¯¯ï¼›Valgrindï¼Œèƒ½å‘ç°å†…å­˜æ³„æ¼ç­‰é—®é¢˜ï¼›è¿˜æœ‰æ€§èƒ½åˆ†æå·¥å…· gprofï¼Œå¯æµ‹é‡å„å‡½æ•°æ‰§è¡Œæ—¶é—´ï¼Œä»¥åŠ perf å’Œ Vtune ç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯å¼€å‘äººå‘˜çš„å¾—åŠ›åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å®šä½å’Œè§£å†³ç¨‹åºä¸­çš„é—®é¢˜ï¼Œå¹¶æå¤§åœ°ä¼˜åŒ–ä»£ç æ€§èƒ½ï¼Œæé«˜è½¯ä»¶è´¨é‡å’Œæ€§èƒ½ã€‚'>
<title>ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·</title>

<link rel='canonical' href='https://cuterwrite.top/p/debug-and-optimize/'>

<link rel="stylesheet" href="/scss/style.min.4c90a59d3894c018e0fa2b5730906c36216007e37cf53710f6be1db187096820.css"><meta property='og:title' content='ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·'>
<meta property='og:description' content='æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å‡ ç§å¸¸ç”¨çš„ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·ï¼Œå¦‚å¼ºå¤§çš„è°ƒè¯•å™¨ gdbï¼Œå¯ç”¨äºè·Ÿè¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ã€æ£€æµ‹å†…å­˜é”™è¯¯ï¼›Valgrindï¼Œèƒ½å‘ç°å†…å­˜æ³„æ¼ç­‰é—®é¢˜ï¼›è¿˜æœ‰æ€§èƒ½åˆ†æå·¥å…· gprofï¼Œå¯æµ‹é‡å„å‡½æ•°æ‰§è¡Œæ—¶é—´ï¼Œä»¥åŠ perf å’Œ Vtune ç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯å¼€å‘äººå‘˜çš„å¾—åŠ›åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å®šä½å’Œè§£å†³ç¨‹åºä¸­çš„é—®é¢˜ï¼Œå¹¶æå¤§åœ°ä¼˜åŒ–ä»£ç æ€§èƒ½ï¼Œæé«˜è½¯ä»¶è´¨é‡å’Œæ€§èƒ½ã€‚'>
<meta property='og:url' content='https://cuterwrite.top/p/debug-and-optimize/'>
<meta property='og:site_name' content='cuterwrite'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='debug' /><meta property='article:tag' content='optimization' /><meta property='article:published_time' content='2023-08-02T01:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-08-02T01:00:00&#43;00:00'/><meta property='og:image' content='https://cuterwrite-1302252842.file.myqcloud.com/blog/1c86d46879544786889dcdbaa1cf158f1fb36107.jpg@1256w_1774h_!web-article-pic.webp' />
<meta name="twitter:title" content="ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·">
<meta name="twitter:description" content="æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å‡ ç§å¸¸ç”¨çš„ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·ï¼Œå¦‚å¼ºå¤§çš„è°ƒè¯•å™¨ gdbï¼Œå¯ç”¨äºè·Ÿè¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ã€æ£€æµ‹å†…å­˜é”™è¯¯ï¼›Valgrindï¼Œèƒ½å‘ç°å†…å­˜æ³„æ¼ç­‰é—®é¢˜ï¼›è¿˜æœ‰æ€§èƒ½åˆ†æå·¥å…· gprofï¼Œå¯æµ‹é‡å„å‡½æ•°æ‰§è¡Œæ—¶é—´ï¼Œä»¥åŠ perf å’Œ Vtune ç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯å¼€å‘äººå‘˜çš„å¾—åŠ›åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å®šä½å’Œè§£å†³ç¨‹åºä¸­çš„é—®é¢˜ï¼Œå¹¶æå¤§åœ°ä¼˜åŒ–ä»£ç æ€§èƒ½ï¼Œæé«˜è½¯ä»¶è´¨é‡å’Œæ€§èƒ½ã€‚"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://cuterwrite-1302252842.file.myqcloud.com/blog/1c86d46879544786889dcdbaa1cf158f1fb36107.jpg@1256w_1774h_!web-article-pic.webp' />
    <link rel="shortcut icon" href="/favicon.ico" />

        
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-W5PMS226XS"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-W5PMS226XS');
        </script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hue4d14694a57c01a222a16c47db12c89c_369633_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜‰</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">cuterwrite</a></h1>
            <h2 class="site-description">æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢ã€‚æˆ‘æ˜¯cuterwriteï¼Œä¸€ä¸ªçƒ­çˆ±ç”Ÿæ´»ã€ä¸æ–­æ¢ç´¢çš„äººã€‚åœ¨è¿™é‡Œï¼Œæˆ‘åˆ†äº«æˆ‘çš„æƒ³æ³•ã€ç»éªŒå’Œå­¦ä¹ ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°ä½ ï¼Œä¹Ÿæ¬¢è¿ä½ ä¸æˆ‘åˆ†äº«ä½ çš„çœ‹æ³•ã€‚</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/PKUcoldkeyboard'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.zhihu.com/people/kong-tiao-cheng-tai-lang-30-57'
                        target="_blank"
                        title="zhihu"
                        rel="me"
                    >
                        
                        
                            <svg t="1705591931290" class="icon" viewBox="0 0 1280 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="21048" width="32" height="32">
    <path d="M341.08 296.26v435.08l46.86 0.02 15.42 52.74 84.02-52.74h99.06V296.26H341.08z m195.5 387.86h-55.88l-55.8 35.02-10.16-34.94-23.8-0.08V343.5h145.64v340.62z m-236.92-188.78H195c3.48-54.2 4.4-103.18 4.4-146.92h102.32s3.94-45.12-17.16-44.62h-177c6.98-26.24 15.74-53.32 26.24-81.34 0 0-48.14 0-64.54 43.14-6.78 17.8-26.42 86.28-61.4 156.24 11.78-1.28 50.74-2.36 73.68-44.42 4.22-11.78 5.02-13.32 10.28-29.06h57.74c0 21-2.4 133.76-3.36 146.88H41.66c-23.48 0-31.12 47.24-31.12 47.24h131.16C132.9 642.2 85.66 726.24 0 792.68c40.98 11.7 81.82-1.86 102-19.8 0 0 45.96-41.8 71.18-138.5l107.92 129.88s15.82-53.78-2.48-79.98c-15.16-17.84-56.12-66.12-73.58-83.62L175.8 623.9c8.72-27.96 13.98-55.1 15.74-81.34h123.3s-0.18-47.24-15.18-47.24v0.02z m824.04-3.2c41.66-51.28 89.96-117.14 89.96-117.14s-37.3-29.6-54.76-8.12c-12 16.3-73.66 96.4-73.66 96.4l38.46 28.86z m-300.18-118.18c-18.02-16.5-51.82 4.26-51.82 4.26s79.04 110.08 82.24 114.9l38.92-27.46s-51.34-75.22-69.32-91.72h-0.02zM1280 516.7c-39.56 0-261.82 1.86-262.12 1.86v-202c9.62 0 24.84-0.8 45.7-2.4 81.76-4.82 140.26-8 175.54-9.62 0 0 24.44-54.38-1.18-66.88-6.14-2.36-46.34 9.16-46.34 9.16s-330.44 32.98-464.72 36.1c3.2 17.64 15.24 34.16 31.56 39.1 26.62 6.96 45.38 3.4 98.3 1.78 49.66-3.2 87.36-4.86 113.02-4.86v199.62H702.82s5.64 44.62 51.02 45.7h215.88v141.84c0 27.94-22.38 43.98-48.96 42.24-28.16 0.22-52.16-2.3-83.38-3.62 3.98 7.94 12.66 28.78 38.62 43.68 19.76 9.62 32.34 13.14 52.04 13.14 59.12 0 91.34-34.56 89.78-90.62v-146.64h244.72c19.36 0 17.4-47.56 17.4-47.56l0.06-0.02z" fill="#707070" p-id="21049"></path>
</svg>

                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>é¦–é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ä¸ªäºº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>æ–‡ç« </span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



                
                <span>æ ‡ç­¾</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€æ¦‚è¿°">ä¸€ã€æ¦‚è¿°</a></li>
    <li><a href="#äºŒç¨‹åºè°ƒè¯•åˆ†æå·¥å…·ç®€ä»‹">äºŒã€ç¨‹åºè°ƒè¯•åˆ†æå·¥å…·ç®€ä»‹</a>
      <ul>
        <li><a href="#1-gdb">1. gdb</a></li>
        <li><a href="#2-valgrind">2. Valgrind</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰ç¨‹åºä¼˜åŒ–åˆ†æå·¥å…·ç®€ä»‹">ä¸‰ã€ç¨‹åºä¼˜åŒ–åˆ†æå·¥å…·ç®€ä»‹</a>
      <ul>
        <li><a href="#1-gprof">1. gprof</a></li>
        <li><a href="#2-perf">2. perf</a></li>
        <li><a href="#3-vtune">3. Vtune</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
    <li><a href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/debug-and-optimize/">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/1c86d46879544786889dcdbaa1cf158f1fb36107.jpg@1256w_1774h_!web-article-pic.webp" loading="lazy" alt="Featured image of post ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E7%BB%BC%E5%90%88%E6%8A%80%E6%9C%AF%E6%A0%88/" style="background-color: #376795; color: #fff;">
                ç»¼åˆæŠ€æœ¯æ ˆ
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/debug-and-optimize/">ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å‡ ç§å¸¸ç”¨çš„ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·ï¼Œå¦‚å¼ºå¤§çš„è°ƒè¯•å™¨ gdbï¼Œå¯ç”¨äºè·Ÿè¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ã€æ£€æµ‹å†…å­˜é”™è¯¯ï¼›Valgrindï¼Œèƒ½å‘ç°å†…å­˜æ³„æ¼ç­‰é—®é¢˜ï¼›è¿˜æœ‰æ€§èƒ½åˆ†æå·¥å…· gprofï¼Œå¯æµ‹é‡å„å‡½æ•°æ‰§è¡Œæ—¶é—´ï¼Œä»¥åŠ perf å’Œ Vtune ç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯å¼€å‘äººå‘˜çš„å¾—åŠ›åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å®šä½å’Œè§£å†³ç¨‹åºä¸­çš„é—®é¢˜ï¼Œå¹¶æå¤§åœ°ä¼˜åŒ–ä»£ç æ€§èƒ½ï¼Œæé«˜è½¯ä»¶è´¨é‡å’Œæ€§èƒ½ã€‚
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2023-08-02</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 19 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·">ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·</h1>
<h2 id="ä¸€æ¦‚è¿°">ä¸€ã€æ¦‚è¿°</h2>
<ul>
<li>
<p>åœ¨ç¼–ç¨‹ä¸­æˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>ç¨‹åºè¿è¡Œæ…¢ï¼Œæ•ˆç‡ä½</li>
<li>æ¶ˆè€—äº†å¤§é‡çš„å†…å­˜</li>
<li>segmentation fault</li>
<li>ç¨‹åºå´©æºƒ</li>
<li>ç¨‹åºè¿è¡Œç»“æœä¸æ­£ç¡®&hellip;&hellip;</li>
</ol>
</li>
<li>
<p>éšç€å¤„ç†å™¨å¤æ‚åº¦çš„å¢åŠ </p>
<ul>
<li>æˆ‘ä»¬ä¸å†èƒ½å¤Ÿè½»æ¾åœ°è·Ÿè¸ªä»£ç æ®µçš„æ‰§è¡Œ
<ul>
<li>é™æ€/åŠ¨æ€åˆ†æ”¯é¢„æµ‹ã€é¢„å–ã€é¡ºåºè°ƒåº¦&hellip;&hellip;</li>
</ul>
</li>
<li>ä»…ä½¿ç”¨å¢™é’Ÿæ—¶é—´æ¥è¡¡é‡ä»£ç æ€§èƒ½æ˜¯ä¸å¤Ÿçš„ã€‚</li>
<li>æˆ‘ä»¬è¿˜éœ€è¦äº†è§£åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ</li>
</ul>
</li>
<li>
<p>å¯¹äºæ€§èƒ½è¯„ä¼°ï¼Œæœ‰ç›´æ¥å’Œé—´æ¥ä¸¤ç§æ–¹æ³•</p>
<ul>
<li>ç›´æ¥æ–¹æ³•ï¼šéœ€è¦æŸäº›å½¢å¼çš„æ˜¾ç¤ºæ’è£…
<ul>
<li>è¿½è¸ª
<ul>
<li>ä¸ºæ¯ä¸ªæµ‹é‡äº‹ä»¶ç”Ÿæˆè®°å½•</li>
<li>åªæœ‰åœ¨äº§ç”Ÿå¤§é‡æ•°æ®æƒ…å†µä¸‹ï¼Œå‡ºç°çš„æ€§èƒ½å¼‚å¸¸æ•°æ®æ‰æœ‰ç”¨</li>
</ul>
</li>
<li>èšåˆ
<ul>
<li>å‡å°‘æ•°æ®åœ¨è¿è¡Œæ—¶å¹³å‡/æœ€å°/æœ€å¤§æµ‹é‡</li>
<li>é€‚ç”¨äºåº”ç”¨ç¨‹åºå’Œä½“ç³»ç»“æ„å’Œæè¿°å’Œä¼˜åŒ–</li>
</ul>
</li>
</ul>
</li>
<li>é—´æ¥æ–¹æ³•ï¼šä¸éœ€è¦æ’è£…ï¼Œå¯ä¸ä¿®æ”¹åº”ç”¨ç¨‹åº</li>
<li>äº‹å®ä¸Šï¼Œç›´æ¥å’Œé—´æ¥æ–¹æ³•çš„ç•Œé™æœ‰äº›æ¨¡ç³Š
<ul>
<li>èšåˆï¼šå¦‚ gprofï¼Œå¯ä»¥ä¸ä¿®æ”¹ç¨‹åºï¼Œä½†æ˜¯éœ€è¦é‡æ–°ç¼–è¯‘é“¾æ¥</li>
</ul>
</li>
</ul>
</li>
<li>
<p>å®é™…ç¼–ç¨‹ä¸­ï¼Œå¸¸è§çš„åˆ†æå·¥å…·å¦‚ä¸‹ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:center">ç±»å‹</th>
<th style="text-align:center">å·¥å…·</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ç¨‹åºè°ƒè¯•</td>
<td style="text-align:center">gdb</td>
</tr>
<tr>
<td style="text-align:center">ç¨‹åºè°ƒè¯•</td>
<td style="text-align:center">valgrind</td>
</tr>
<tr>
<td style="text-align:center">ç¨‹åºä¼˜åŒ–</td>
<td style="text-align:center">gprof</td>
</tr>
<tr>
<td style="text-align:center">ç¨‹åºä¼˜åŒ–</td>
<td style="text-align:center">perf</td>
</tr>
<tr>
<td style="text-align:center">ç¨‹åºä¼˜åŒ–</td>
<td style="text-align:center">Intel VTune Amplifier</td>
</tr>
</tbody>
</table></div>
</li>
</ul>
<h2 id="äºŒç¨‹åºè°ƒè¯•åˆ†æå·¥å…·ç®€ä»‹">äºŒã€ç¨‹åºè°ƒè¯•åˆ†æå·¥å…·ç®€ä»‹</h2>
<ul>
<li>ç¨‹åºä¸­çš„é”™è¯¯æŒ‰å…¶æ€§è´¨å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š
<ul>
<li><strong>ç¼–è¯‘é”™è¯¯</strong> ï¼šå³è¯­æ³•é”™è¯¯ï¼Œä¸»è¦æ˜¯ç¨‹åºä»£ç ä¸­æœ‰ä¸ç¬¦åˆæ‰€ç”¨ç¼–ç¨‹è¯­è¨€è¯­æ³•è§„åˆ™çš„é”™è¯¯ã€‚</li>
<li><strong>è¿è¡Œæ—¶é”™è¯¯</strong> ï¼šå¦‚å¯¹è´Ÿæ•°å¼€å¹³æ–¹ã€é™¤æ•°ä¸º 0ã€å¾ªç¯ç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸èƒ½è¾¾åˆ°ç­‰ã€‚</li>
<li><strong>é€»è¾‘é”™è¯¯</strong> ï¼šè¿™ç±»é”™è¯¯å¾€å¾€æ˜¯ç¼–ç¨‹å‰å¯¹æ±‚è§£çš„é—®é¢˜ç†è§£ä¸æ­£ç¡®æˆ–ç®—æ³•ä¸æ­£ç¡®å¼•èµ·çš„ï¼Œå®ƒä»¬å¾ˆéš¾æŸ¥æ‰¾ï¼ˆæ•°ç»„è¶Šç•Œã€ç©ºæŒ‡é’ˆï¼‰</li>
</ul>
</li>
<li>ç¨‹åºè°ƒè¯•å°±æ˜¯æŸ¥æ‰¾ç¨‹åºä¸­çš„é”™è¯¯ï¼Œè¯Šæ–­å…¶å‡†ç¡®ä½ç½®ï¼Œå¹¶äºˆä»¥æ”¹æ­£ã€‚</li>
</ul>
<h3 id="1-gdb">1. gdb</h3>
<ul>
<li>GDB æ˜¯ GNU å¼€æºç»„ç»‡å‘å¸ƒçš„ä¸€ä¸ªå¼ºå¤§çš„ UNIX ä¸‹çš„ç¨‹åºè°ƒè¯•å·¥å…·</li>
<li>GDB å…·å¤‡å¦‚ä¸‹ 4 ä¸ªæ–¹é¢çš„åŠŸèƒ½ï¼š
<ul>
<li>å¯åŠ¨ç¨‹åºï¼Œå¯ä»¥æŒ‰ç”¨æˆ·è¦æ±‚å½±å“ç¨‹åºçš„è¿è¡Œè¡Œä¸º</li>
<li>å¯ä»¥è®©è¢«è°ƒè¯•çš„ç¨‹åºåœ¨ç”¨æˆ·æ‰€æŒ‡å®šçš„æ–­ç‚¹å¤„æš‚åœï¼ˆæ–­ç‚¹å¯ä»¥æ˜¯æ¡ä»¶è¡¨è¾¾å¼ï¼‰</li>
<li>å½“ç¨‹åºè¢«æš‚åœæ—¶ï¼Œå¯ä»¥æ£€æŸ¥æ­¤æ—¶ç”¨æˆ·ç¨‹åºä¸­æ‰€å‘ç”Ÿçš„äº‹æƒ…</li>
<li>åŠ¨æ€æ”¹å˜ç”¨æˆ·ç¨‹åºçš„æ‰§è¡Œç¯å¢ƒï¼Œè¿™æ ·å°±å¯ä»¥å…ˆçº æ­£ä¸€ä¸ªé”™è¯¯çš„å½±å“ï¼Œç„¶åå†çº æ­£å…¶ä»–é”™è¯¯</li>
</ul>
</li>
<li>ä¸ºäº†å‘æŒ¥ GDB çš„å…¨éƒ¨åŠŸèƒ½ï¼Œéœ€è¦åœ¨ç¼–è¯‘æºç¨‹åºæ—¶ä½¿ç”¨<code>-g</code> é€‰é¡¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -g test.c -o proc
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å¯åŠ¨ GDBï¼Œä»¥å‚æ•°å½¢å¼å°†å¯æ‰§è¡Œç¨‹åºä¼ é€’ç»™ GDB</p>
<ul>
<li>gdb program</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gdb ./proc
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>gdb -p pid</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gdb -p <span class="sb">`</span>pidof proc<span class="sb">`</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>gdb program core</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gdb ./proc core.xxx
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>gdb attach pid</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gdb attach <span class="m">2313</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å¯åŠ¨ gdb åå°±æ˜¾ç¤ºå…¶æç¤ºç¬¦ï¼šï¼ˆgdbï¼‰ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥ç›¸åº”çš„å†…éƒ¨å‘½ä»¤</p>
<ul>
<li>è®¾ç½®æ–­ç‚¹ã€è®¾ç½®è¿è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡ã€è·Ÿè¸ªè°ƒè¯•å‘½ä»¤ã€æŸ¥çœ‹æ ˆä¿¡æ¯â€¦â€¦</li>
</ul>
</li>
<li>
<p>ç”¨æˆ·å¯ä»¥åˆ©ç”¨å‘½ä»¤ quit ç»ˆæ­¢å…¶æ‰§è¡Œï¼Œé€€å‡º gdb ç¯å¢ƒ</p>
</li>
<li>
<p>gdb å¸¸ç”¨å‘½ä»¤åˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è§£é‡Š</th>
<th>ç®€å†™</th>
</tr>
</thead>
<tbody>
<tr>
<td>file</td>
<td>è£…å…¥æƒ³è¦è°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶</td>
<td>æ— </td>
</tr>
<tr>
<td>list</td>
<td>åˆ—å‡ºäº§ç”Ÿæ‰§è¡Œæ–‡ä»¶æºä»£ç çš„ä¸€éƒ¨åˆ†</td>
<td>l</td>
</tr>
<tr>
<td>next</td>
<td>æ‰§è¡Œä¸€è¡Œæºä»£ç ä½†ä¸è¿›å…¥å‡½æ•°å†…éƒ¨</td>
<td>n</td>
</tr>
<tr>
<td>step</td>
<td>æ‰§è¡Œä¸€è¡Œæºä»£ç è€Œä¸”è¿›å…¥å‡½æ•°å†…éƒ¨</td>
<td>s</td>
</tr>
<tr>
<td>run</td>
<td>æ‰§è¡Œå½“å‰è¢«è°ƒè¯•çš„ç¨‹åº</td>
<td>r</td>
</tr>
<tr>
<td>continue</td>
<td>ç»§ç»­æ‰§è¡Œç¨‹åº</td>
<td>c</td>
</tr>
<tr>
<td>quit</td>
<td>ç»ˆæ­¢ GDB</td>
<td>q</td>
</tr>
<tr>
<td>print</td>
<td>è¾“å‡ºå½“å‰æŒ‡å®šå˜é‡çš„å€¼</td>
<td>p</td>
</tr>
<tr>
<td>break</td>
<td>åœ¨ä»£ç é‡Œè®¾ç½®æ–­ç‚¹</td>
<td>b</td>
</tr>
<tr>
<td>info break</td>
<td>æŸ¥çœ‹è®¾ç½®æ–­ç‚¹çš„ä¿¡æ¯</td>
<td>ib</td>
</tr>
<tr>
<td>delete</td>
<td>åˆ é™¤è®¾ç½®çš„æ–­ç‚¹</td>
<td>d</td>
</tr>
<tr>
<td>watch</td>
<td>ç›‘è§†ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œä¸€æ—¦å€¼æœ‰å˜åŒ–ï¼Œç¨‹åºåœä½</td>
<td>wa</td>
</tr>
<tr>
<td>help</td>
<td>GDB ä¸­çš„å¸®åŠ©å‘½ä»¤</td>
<td>h</td>
</tr>
</tbody>
</table></div>
</li>
<li>
<p>è®¾ç½®æ–­ç‚¹ï¼š</p>
<ul>
<li>ç¼–è¯‘æºç¨‹åºæ—¶éœ€è¦ä½¿ç”¨<code>-g</code> é€‰é¡¹</li>
<li>åœ¨ GDB ä¸­ç”¨ break å‘½ä»¤ï¼ˆå…¶ç¼©å†™å½¢å¼ä¸º bï¼‰è®¾ç½®æ–­ç‚¹ï¼š
<ul>
<li>break linenum åœ¨å½“å‰æ–‡ä»¶æŒ‡å®šè¡Œ linenum å¤„è®¾ç½®æ–­ç‚¹ï¼Œåœåœ¨è¯¥è¡Œå¼€å¤´</li>
<li>break linenum if condition åœ¨å½“å‰æ–‡ä»¶æŒ‡å®šè¡Œ linenum å¤„è®¾ç½®æ–­ç‚¹ï¼Œä½†ä»…åœ¨æ¡ä»¶è¡¨è¾¾å¼ condition æˆç«‹æ—¶æ‰åœæ­¢ç¨‹åºæ‰§è¡Œ</li>
<li>break function åœ¨å½“å‰æ–‡ä»¶å‡½æ•° function çš„å…¥å£å¤„è®¾ç½®æ–­ç‚¹</li>
<li>break file:linenum åœ¨æºæ–‡ä»¶ file çš„ linenum è¡Œä¸Šè®¾ç½®æ–­ç‚¹</li>
<li>break file:function åœ¨æºæ–‡ä»¶ file çš„å‡½æ•° function çš„å…¥å£å¤„è®¾ç½®æ–­ç‚¹</li>
<li>break *address è¿è¡Œç¨‹åºåœ¨æŒ‡å®šçš„å†…å­˜åœ°å€ address å¤„åœæ­¢</li>
<li>break ä¸å¸¦ä»»ä½•å‚æ•°ï¼Œåˆ™è¡¨ç¤ºåœ¨ä¸‹ä¸€æ¡æŒ‡ä»¤å¤„åœæ­¢</li>
</ul>
</li>
<li>æ–­ç‚¹åº”è®¾ç½®åœ¨å¯æ‰§è¡Œçš„è¡Œä¸Šï¼Œä¸åº”æ˜¯å˜é‡å®šä¹‰ä¹‹ç±»çš„è¯­å¥</li>
</ul>
</li>
<li>
<p>åˆ é™¤æ–­ç‚¹ï¼š</p>
<ul>
<li>delete [bkptnums]</li>
</ul>
</li>
<li>
<p>æ˜¾ç¤ºæ–­ç‚¹ï¼š</p>
<ul>
<li>info breakpoints [num]</li>
<li>info break [num]</li>
</ul>
</li>
<li>
<p>è¿è¡Œç¨‹åºï¼š</p>
<ul>
<li>run [args]</li>
</ul>
</li>
<li>
<p>ç¨‹åºçš„å•æ­¥è·Ÿè¸ªå’Œ</p>
<ul>
<li>step [N] å‚æ•° N è¡¨ç¤ºæ¯æ­¥æ‰§è¡Œçš„è¯­å¥è¡Œæ•°ï¼Œè¿›å…¥è¢«è°ƒç”¨å‡½æ•°å†…éƒ¨æ‰§è¡Œ</li>
<li>next [N] å‚æ•° N è¡¨ç¤ºæ¯æ­¥æ‰§è¡Œçš„è¯­å¥è¡Œæ•°ï¼Œè¢«è°ƒç”¨å‡½æ•°è¢«å½“åšä¸€æ¡æŒ‡ä»¤æ‰§è¡Œ</li>
<li>stepiï¼ˆç¼©å†™ä¸º siï¼‰æˆ– nextiï¼ˆç¼©å†™ä¸º niï¼‰å‘½ä»¤ä¸€æ¡ä¸€æ¡åœ°æ‰§è¡Œæœºå™¨æŒ‡ä»¤</li>
</ul>
</li>
<li>
<p>ç¨‹åºçš„è¿ç»­æ‰§è¡Œ</p>
<ul>
<li>åˆ©ç”¨ continueï¼Œc æˆ– fg å‘½ä»¤è¿ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹</li>
</ul>
</li>
<li>
<p>æ˜¾ç¤ºæºæ–‡ä»¶å‘½ä»¤ list ï¼ˆlï¼‰</p>
<ul>
<li>listï¼šæ²¡æœ‰å‚æ•°ï¼Œæ˜¾ç¤ºå½“å‰è¡Œä¹‹åæˆ–å‘¨å›´çš„ 10 å¤šè¡Œ</li>
<li>list -ï¼šæ˜¾ç¤ºä¹‹å‰çš„ 10 è¡Œ</li>
<li>list [file]:numï¼šæ˜¾ç¤ºæºæ–‡ä»¶ file ä¸­ç»™å®šè¡Œå· num å‘¨å›´çš„ 10 è¡Œã€‚å¦‚æœç¼ºå°‘ fileï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œlist 100</li>
<li>list start, endï¼šæ˜¾ç¤ºä»è¡Œå· start è‡³ end ä¹‹é—´çš„ä»£ç è¡Œã€‚ä¾‹å¦‚ï¼Œlist 20,38</li>
<li>list [file:]funï¼šæ˜¾ç¤ºæºæ–‡ä»¶ file ä¸­æŒ‡å®šå‡½æ•° function çš„ä»£ç è¡Œã€‚å¦‚æœç¼ºå°‘ fileï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œlist meng1.c:square</li>
<li>set listsize linenum : å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤è®¾ç½®ä¸€æ¬¡æ˜¾ç¤ºçš„è¡Œæ•°</li>
</ul>
</li>
<li>
<p>æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®å‘½ä»¤ print ï¼ˆpï¼‰</p>
<ul>
<li>å½“è¢«è°ƒè¯•çš„ç¨‹åºåœæ­¢æ—¶ï¼Œå¯ä»¥ç”¨ print å‘½ä»¤æˆ–åŒä¹‰å‘½ä»¤ inspect æ¥æŸ¥çœ‹å½“å‰ç¨‹åºä¸­è¿è¡Œçš„æ•°æ®</li>
<li>print å‘½ä»¤çš„ä¸€èˆ¬ä½¿ç”¨æ ¼å¼ï¼šprint [/fmt] exp
<ul>
<li>print i ï¼ˆæˆ– p iï¼‰ æ˜¾ç¤ºå½“å‰å˜é‡ i çš„å€¼</li>
<li>print i*j (æˆ– p i*j) å°†æ ¹æ®ç¨‹åºå½“å‰è¿è¡Œçš„å®é™…æƒ…å†µæ˜¾ç¤ºå‡º i*j çš„å€¼</li>
</ul>
</li>
<li>print æ‰€æ”¯æŒçš„è¿ç®—ç¬¦ï¼š
<ul>
<li>å–åœ°å€&amp;ç¬¦å·</li>
<li>@ æ˜¯ä¸€ä¸ªä¸æ•°ç»„æœ‰å…³çš„åŒç›®è¿ç®—ç¬¦ï¼Œä½¿ç”¨å½¢å¼å¦‚
<ul>
<li>print array@10 æ‰“å°ä» arrayï¼ˆæ•°ç»„åï¼Œå³æ•°ç»„çš„åŸºåœ°å€ï¼‰å¼€å§‹çš„ 10 ä¸ªå€¼</li>
<li>print array[3]@5 æ‰“å°ä» array ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹çš„ 5 ä¸ªæ•°ç»„å…ƒç´ çš„æ•°å€¼</li>
</ul>
</li>
<li>file::i æˆ– function ::i è¡¨ç¤ºæ–‡ä»¶æˆ–è€…å‡½æ•°ä¸­ i çš„å€¼</li>
</ul>
</li>
</ul>
</li>
</ul>



<div class="notice notice-note" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256a248 248 0 11-496 0 248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>GDB ä½¿ç”¨ç¤ºä¾‹</p></div>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// test.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sum</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;result[1-50]=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;result[1-100]=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">sum</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sum</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">sum</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘å¸¦è°ƒè¯•ä¿¡æ¯çš„å¯æ‰§è¡Œæ–‡ä»¶</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -g test.c -o <span class="nb">test</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯åŠ¨ GDB</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gdb <span class="nb">test</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è°ƒè¯•ç»“æœ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">GNU gdb <span class="o">(</span>Ubuntu 9.2-0ubuntu1~20.04.1<span class="o">)</span> 9.2
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2020</span> Free Software Foundation, Inc.
</span></span><span class="line"><span class="cl">License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span></span><span class="line"><span class="cl">This is free software: you are free to change and redistribute it.
</span></span><span class="line"><span class="cl">There is NO WARRANTY, to the extent permitted by law.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;show copying&#34;</span> and <span class="s2">&#34;show warranty&#34;</span> <span class="k">for</span> details.
</span></span><span class="line"><span class="cl">This GDB was configured as <span class="s2">&#34;x86_64-linux-gnu&#34;</span>.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;show configuration&#34;</span> <span class="k">for</span> configuration details.
</span></span><span class="line"><span class="cl">For bug reporting instructions, please see:
</span></span><span class="line"><span class="cl">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
</span></span><span class="line"><span class="cl">Find the GDB manual and other documentation resources online at:
</span></span><span class="line"><span class="cl">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">For help, <span class="nb">type</span> <span class="s2">&#34;help&#34;</span>.
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;apropos word&#34;</span> to search <span class="k">for</span> commands related to <span class="s2">&#34;word&#34;</span>...
</span></span><span class="line"><span class="cl">Reading symbols from test...
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> list
</span></span><span class="line"><span class="cl"><span class="m">1</span>       <span class="c1">#include &lt;stdio.h&gt;</span>
</span></span><span class="line"><span class="cl"><span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="m">3</span>       int sum<span class="o">(</span>int n<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="m">5</span>       int main<span class="o">(</span>int argc, char **argv<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">6</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="m">7</span>           int i, <span class="nv">result</span> <span class="o">=</span> 0<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">8</span>           <span class="k">for</span> <span class="o">(</span><span class="nv">i</span> <span class="o">=</span> 1<span class="p">;</span> i &lt;<span class="o">=</span> 50<span class="p">;</span> i++<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">9</span>           <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span>              <span class="nv">result</span> <span class="o">+=</span> i<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">11</span>          <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="m">12</span>          printf<span class="o">(</span><span class="s2">&#34;result[1-50]=%d\n&#34;</span>, result<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">13</span>          printf<span class="o">(</span><span class="s2">&#34;result[1-100]=%d\n&#34;</span>, sum<span class="o">(</span>100<span class="o">))</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">14</span>      <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="m">15</span>
</span></span><span class="line"><span class="cl"><span class="m">16</span>      int sum<span class="o">(</span>int n<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">17</span>      <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="m">18</span>          int i, sum<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">19</span>          <span class="k">for</span> <span class="o">(</span><span class="nv">i</span> <span class="o">=</span> 1<span class="p">;</span> i &lt;<span class="o">=</span> n<span class="p">;</span> i++<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">20</span>          <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">21</span>              <span class="nv">sum</span> <span class="o">+=</span> i<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">22</span>          <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="m">23</span>          <span class="k">return</span> sum<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="m">24</span>      <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> b <span class="m">8</span>
</span></span><span class="line"><span class="cl">Breakpoint <span class="m">1</span> at 0x1163: file test.c, line 8.
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> info b
</span></span><span class="line"><span class="cl">Num     Type           Disp Enb Address            What
</span></span><span class="line"><span class="cl"><span class="m">1</span>       breakpoint     keep y   0x0000000000001163 in main at test.c:8
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> r
</span></span><span class="line"><span class="cl">Starting program: /root/workspace/test
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Breakpoint 1, main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0x7fffffffe2d8<span class="o">)</span> at test.c:8
</span></span><span class="line"><span class="cl"><span class="m">8</span>           <span class="k">for</span> <span class="o">(</span><span class="nv">i</span> <span class="o">=</span> 1<span class="p">;</span> i &lt;<span class="o">=</span> 50<span class="p">;</span> i++<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p i
</span></span><span class="line"><span class="cl"><span class="nv">$1</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p result
</span></span><span class="line"><span class="cl"><span class="nv">$2</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl"><span class="m">10</span>              <span class="nv">result</span> <span class="o">+=</span> i<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> n
</span></span><span class="line"><span class="cl"><span class="m">8</span>           <span class="k">for</span> <span class="o">(</span><span class="nv">i</span> <span class="o">=</span> 1<span class="p">;</span> i &lt;<span class="o">=</span> 50<span class="p">;</span> i++<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p i
</span></span><span class="line"><span class="cl"><span class="nv">$3</span> <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p result
</span></span><span class="line"><span class="cl"><span class="nv">$4</span> <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> d <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> info b
</span></span><span class="line"><span class="cl">No breakpoints or watchpoints.
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> c
</span></span><span class="line"><span class="cl">Continuing.
</span></span><span class="line"><span class="cl">result<span class="o">[</span>1-50<span class="o">]=</span><span class="m">1275</span>
</span></span><span class="line"><span class="cl">result<span class="o">[</span>1-100<span class="o">]=</span><span class="m">26895</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>Inferior <span class="m">1</span> <span class="o">(</span>process 286758<span class="o">)</span> exited normally<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> q
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ€»çš„æ¥è¯´ï¼ŒGDB è°ƒè¯•çš„è¿‡ç¨‹ä¸ºï¼š
<ul>
<li>ç¼–è¯‘å¸¦è°ƒè¯•ä¿¡æ¯çš„å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>å¯åŠ¨ GDBï¼Œå¼€å§‹è°ƒè¯•</li>
<li>GDB ä¸­æŸ¥çœ‹æ–‡ä»¶</li>
<li>è®¾ç½®æ–­ç‚¹</li>
<li>æŸ¥çœ‹æ–­ç‚¹æƒ…å†µ</li>
<li>è¿è¡Œä»£ç </li>
<li>è·Ÿè¸ªå˜é‡å€¼</li>
<li>åˆ é™¤æ‰€è®¾æ–­ç‚¹</li>
<li>æ¢å¤ç¨‹åºè¿è¡Œ</li>
<li>é€€å‡º GDB</li>
</ul>
</li>
</ul>
<h3 id="2-valgrind">2. Valgrind</h3>
<ul>
<li>Valgrind æ˜¯ä¸€ä¸ª Linux ä¸‹çµæ´»çš„è°ƒè¯•å’Œå‰–æå·¥å…·</li>
<li>æ”¶é›†å„ç§æœ‰ç”¨çš„è¿è¡Œæ—¶ä¿¡æ¯ï¼Œå¯ä»¥å¸®åŠ©æ‰¾åˆ°ç¨‹åºä¸­æ½œåœ¨çš„ bug å’Œæ€§èƒ½ç“¶é¢ˆ</li>
<li>Valgrind åŒ…å«å¤šä¸ªå·¥å…·ï¼š</li>
</ul>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>Memcheck</td>
<td>è¿™æ˜¯ valgrind åº”ç”¨æœ€å¹¿æ³›çš„å·¥å…·ï¼Œä¸€ä¸ªé‡é‡çº§çš„å†…å­˜æ£€æŸ¥å™¨ï¼Œèƒ½å¤Ÿå‘ç°å¼€å‘ä¸­ç»å¤§å¤šæ•°å†…å­˜é”™è¯¯ä½¿ç”¨æƒ…å†µï¼Œæ¯”å¦‚ï¼šä½¿ç”¨æœªåˆå§‹åŒ–çš„å†…å­˜ã€ä½¿ç”¨å·²ç»é‡Šæ”¾äº†çš„å†…å­˜ã€å†…å­˜è®¿é—®è¶Šç•Œç­‰</td>
</tr>
<tr>
<td>Callgrind</td>
<td>ä¸»è¦ç”¨æ¥æ£€æŸ¥ç¨‹åºä¸­å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜</td>
</tr>
<tr>
<td>Cachegrind</td>
<td>ä¸»è¦ç”¨æ¥æ£€æŸ¥ç¨‹åºä¸­ç¼“å­˜ä½¿ç”¨å‡ºç°çš„é—®é¢˜</td>
</tr>
<tr>
<td>Helgrind</td>
<td>ä¸»è¦ç”¨æ¥æ£€æŸ¥å¤šçº¿ç¨‹ç¨‹åºä¸­å‡ºç°çš„ç«äº‰é—®é¢˜</td>
</tr>
<tr>
<td>Massif</td>
<td>ä¸»è¦ç”¨æ¥æ£€æŸ¥ç¨‹åºä¸­å †æ ˆä½¿ç”¨ä¸­å‡ºç°çš„é—®é¢˜</td>
</tr>
<tr>
<td>Extensio</td>
<td>å¯ä»¥åˆ©ç”¨ core æä¾›çš„åŠŸèƒ½ï¼Œè‡ªå·±ç¼–å†™ç‰¹å®šçš„å†…å­˜è°ƒè¯•å·¥å…·</td>
</tr>
</tbody>
</table></div>
<ul>
<li>Valgrind ä½¿ç”¨éœ€è¦å…ˆè¿›è¡Œå®‰è£…ï¼Œåœ¨ ubuntu ä¸‹å¯ä»¥ä½¿ç”¨ apt-get è¿›è¡Œå®‰è£…</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install valgrind
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¸ºäº†ä½¿ Valgrind å‘ç°çš„é”™è¯¯æ›´ç²¾ç¡®ï¼Œå»ºè®®åœ¨ç¼–è¯‘æ—¶åŠ ä¸Š<code>-g</code> å‚æ•°ï¼Œç¼–è¯‘ä¼˜åŒ–é€‰æ‹©<code>O0</code>ï¼Œå³ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -g -O0 test.c -o <span class="nb">test</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>valgrind å‘½ä»¤æ ¼å¼ä¸º: <code>valgrind [options] prog-and-args [options]</code></p>
<ul>
<li>[options]: å¸¸ç”¨é€‰é¡¹ï¼Œé€‚ç”¨äºæ‰€æœ‰ Valgrind å·¥å…·</li>
<li>&ndash;tool=&lt;name&gt;ï¼š æœ€å¸¸ç”¨çš„é€‰é¡¹ï¼Œè¿è¡Œ valgrind ä¸­åä¸º toolname çš„å·¥å…·ï¼Œé»˜è®¤ memcheck</li>
<li>-h|&ndash;helpï¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</li>
<li>&ndash;versionï¼šæ˜¾ç¤º valgrind å†…æ ¸çš„ç‰ˆæœ¬ï¼Œæ¯ä¸ªå·¥å…·éƒ½æœ‰å„è‡ªçš„ç‰ˆæœ¬</li>
<li>-q|&ndash;quietï¼šå®‰é™åœ°è¿è¡Œï¼Œåªæ‰“å°é”™è¯¯ä¿¡æ¯</li>
<li>-v|&ndash;verboseï¼šæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¢åŠ é”™è¯¯æ•°ç»Ÿè®¡</li>
<li>&hellip;&hellip;</li>
</ul>
</li>
<li>
<p>Memcheck å†…å­˜é”™è¯¯æ£€æŸ¥ï¼š</p>
<ul>
<li>å¯ä»¥æ£€æŸ¥å‡ºä¸‹åˆ—å‡ ç§é”™è¯¯
<ul>
<li>ä½¿ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜</li>
<li>å†…å­˜å—è¶Šç•Œ</li>
<li>ä½¿ç”¨æœªåˆå§‹åŒ–çš„å˜é‡</li>
<li>å†…å­˜æ³„æ¼</li>
<li>åŒä¸€ä¸ªå†…å­˜å—é‡Šæ”¾å¤šæ¬¡</li>
</ul>
</li>
<li>Memcheck å‘½ä»¤è¡Œé€‰é¡¹ï¼š
<ul>
<li>&ndash;leak-check=&lt;no|summary|yes|full&gt; [default: summary]
<ul>
<li>summary æ˜¯ç»™å‡ºæœ€å leak çš„æ±‡æ€»ï¼Œyes æˆ–è€… full å°†ä¼šç»™å‡ºæ¯”è¾ƒè¯¦ç»†çš„ leak ä¿¡æ¯</li>
</ul>
</li>
<li>&ndash;leak-resolution=&lt;low|med|high&gt; [default: high]
<ul>
<li>ç”¨äºåˆå¹¶ leak ä¿¡æ¯æ¥æºçš„ backtracesï¼Œlow æ˜¯æœ‰ä¸¤å±‚åŒ¹é…çš„æ—¶å€™å°±å¯ä»¥åˆå¹¶ï¼Œmed æ˜¯å››å±‚ï¼Œhigh å¿…é¡»å®Œå…¨æ¯”é…ã€‚è¯¥é€‰é¡¹ä¸å½±å“æŸ¥æ‰¾ leak çš„èƒ½åŠ›ï¼Œåªå½±å“ç»“æœçš„æ˜¾ç¤ºæ–¹å¼</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Cachegrind ç¼“å­˜æ£€æŸ¥</p>
<ul>
<li>é€šè¿‡æ¨¡æ‹Ÿ cpu çš„ 1,3 çº§ç¼“å­˜ï¼Œæ”¶é›†åº”ç”¨ç¨‹åºè¿è¡Œæ—¶å…³äº cpu çš„ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œæœ€ååœ¨å°†æ˜ç»†æ•°æ®å’Œæ±‡æ€»ä¿¡æ¯æ‰“å°å‡ºæ¥</li>
<li>æ‰§è¡Œæ–¹å¼ï¼š
<ul>
<li>$ valgrind &ndash;tool=cachegrind your_application
<ul>
<li>cachegrind çš„ç»“æœä¹Ÿä¼šä»¥è¾“å‡ºæ–‡ä»¶çš„æ–¹å¼è¾“å‡ºæ›´å¤šçš„ç»†èŠ‚ï¼Œè¾“å‡ºæ–‡ä»¶çš„ç¼ºçœæ–‡ä»¶åæ˜¯ cachegrind.out.<!-- raw HTML omitted -->ï¼Œå…¶ä¸­<!-- raw HTML omitted -->æ˜¯å½“å‰è¿›ç¨‹çš„ pidã€‚è¯¥æ–‡ä»¶åå¯ä»¥é€šè¿‡&ndash;cachegrind-out-file é€‰æ‹©æŒ‡å®šæ›´å¯è¯»çš„æ–‡ä»¶åï¼Œè¿™ä¸ªæ–‡ä»¶å°†ä¼šæˆä¸º cg_annotate çš„è¾“å…¥</li>
</ul>
</li>
</ul>
</li>
<li>Cachegrind å‘½ä»¤è¡Œé€‰é¡¹ï¼š
<ul>
<li>&ndash;cache-sim=no|yes [yes]
<ul>
<li>æŒ‡å®šæ˜¯å¦æ”¶é›† cache accesses å’Œ miss counts</li>
</ul>
</li>
<li>&ndash;branch-sim=no|yes [no]
<ul>
<li>æŒ‡å®šæ˜¯å¦æ”¶é›† branch instruction å’Œ misprediction counts</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Callgrind å‡½æ•°è°ƒç”¨åˆ†æ</p>
<ul>
<li>Callgrind æ”¶é›†ç¨‹åºè¿è¡Œæ—¶çš„ä¸€äº›æ•°æ®ï¼Œå»ºç«‹å‡½æ•°è°ƒç”¨å…³ç³»å›¾ï¼Œè¿˜å¯ä»¥æœ‰é€‰æ‹©åœ°è¿›è¡Œ cache æ¨¡æ‹Ÿã€‚è¢«åˆ†æçš„ç¨‹åºç¼–è¯‘æ—¶è¦åŠ <code>-g</code>ï¼Œç¼–è¯‘ä¼˜åŒ–é€‰é¡¹å»ºè®®é€‰æ‹©<code>-O2</code></li>
<li>æ‰§è¡Œæ–¹å¼ï¼š
<ul>
<li>$ valgrind &ndash;tool=callgrind your_application
<ul>
<li>è¾“å‡ºæ–‡ä»¶çš„ç¼ºçœæ–‡ä»¶åæ˜¯ callgrind.out.<!-- raw HTML omitted --> ï¼Œå…¶ä¸­<!-- raw HTML omitted -->æ˜¯å½“å‰è¿›ç¨‹çš„ pid</li>
</ul>
</li>
</ul>
</li>
<li>Cachegrind å‘½ä»¤è¡Œé€‰é¡¹ï¼š
<ul>
<li>&ndash;callgrind-out-file=<!-- raw HTML omitted -->
<ul>
<li>æŒ‡å®š profile data çš„è¾“å‡ºæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç¼ºçœå‘½åè§„åˆ™ç”Ÿæˆçš„æ–‡ä»¶</li>
</ul>
</li>
<li>&ndash;dump-line=&lt;no|yes&gt; [default: yes]
<ul>
<li>äº‹ä»¶è®¡æ•°å°†ä»¥ source line ä½œä¸ºç»Ÿè®¡çš„ç²’åº¦ï¼Œä½†æ˜¯æºç¨‹åºåœ¨ç¼–è¯‘çš„æ—¶å€™åŠ å…¥<code>-g</code> é€‰é¡¹</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Helgrind å¤šçº¿ç¨‹åˆ†æå™¨</p>
<ul>
<li>ä¸»è¦ç”¨æ¥æ£€æŸ¥å¤šçº¿ç¨‹ç¨‹åºä¸­å‡ºç°çš„ç«äº‰é—®é¢˜</li>
<li>æ‰§è¡Œæ–¹å¼ï¼š
<ul>
<li>$ valgrind &ndash;tool=helgrind your_application</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Massif å †æ ˆåˆ†æ</p>
<ul>
<li>å †æ ˆåˆ†æå™¨ï¼Œå®ƒèƒ½æµ‹é‡ç¨‹åºåœ¨å †æ ˆä¸­ä½¿ç”¨äº†å¤šå°‘å†…å­˜ï¼Œå‘Šè¯‰æˆ‘ä»¬å †å—ï¼Œå †ç®¡ç†å—å’Œæ ˆçš„å¤§å°ã€‚Massif èƒ½å¸®åŠ©æˆ‘ä»¬å‡å°‘å†…å­˜çš„ä½¿ç”¨</li>
<li>æ‰§è¡Œæ–¹å¼ï¼š
<ul>
<li>$ valgrind &ndash;tool=massif your_application
<ul>
<li>è¾“å‡ºæ–‡ä»¶ï¼šmassif.<!-- raw HTML omitted -->.ps massif. <!-- raw HTML omitted -->.txtï¼Œå…¶ä¸­<!-- raw HTML omitted -->æ˜¯å½“å‰è¿›ç¨‹çš„ pid</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>



<div class="notice notice-note" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256a248 248 0 11-496 0 248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>Valgrind ä½¿ç”¨ç¤ºä¾‹ 1ï¼šå†…å­˜æ£€æŸ¥</p></div>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// test.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span><span class="o">*</span> <span class="n">x</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// é—®é¢˜ 1ï¼šæ•°ç»„ä¸‹æ ‡è¶Šç•Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// é—®é¢˜ 2ï¼šå†…å­˜æ³„æ¼ï¼Œæ²¡æœ‰ free(x)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">f</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘å¹¶è¿è¡Œï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -g -O0 test.c -o <span class="nb">test</span>
</span></span><span class="line"><span class="cl">valgrind --tool<span class="o">=</span>memcheck --leak-check<span class="o">=</span>full ./test
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¾“å‡ºç»“æœï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">==292701== Memcheck, a memory error detector
</span></span><span class="line"><span class="cl">==292701== Copyright (C) 2002-2017, and GNU GPL&#39;d, by Julian Seward et al.
</span></span><span class="line"><span class="cl">==292701== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
</span></span><span class="line"><span class="cl">==292701== Command: ./test
</span></span><span class="line"><span class="cl">==292701==
</span></span><span class="line"><span class="cl">==292701== Invalid write of size 4
</span></span><span class="line"><span class="cl">==292701==    at 0x10916B: f (test.c:6)
</span></span><span class="line"><span class="cl">==292701==    by 0x10918B: main (test.c:12)
</span></span><span class="line"><span class="cl">==292701==  Address 0x4a4b068 is 0 bytes after a block of size 40 alloc&#39;d
</span></span><span class="line"><span class="cl">==292701==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
</span></span><span class="line"><span class="cl">==292701==    by 0x10915E: f (test.c:5)
</span></span><span class="line"><span class="cl">==292701==    by 0x10918B: main (test.c:12)
</span></span><span class="line"><span class="cl">==292701==
</span></span><span class="line"><span class="cl">==292701==
</span></span><span class="line"><span class="cl">==292701== HEAP SUMMARY:
</span></span><span class="line"><span class="cl">==292701==     in use at exit: 40 bytes in 1 blocks
</span></span><span class="line"><span class="cl">==292701==   total heap usage: 1 allocs, 0 frees, 40 bytes allocated
</span></span><span class="line"><span class="cl">==292701==
</span></span><span class="line"><span class="cl">==292701== 40 bytes in 1 blocks are definitely lost in loss record 1 of 1
</span></span><span class="line"><span class="cl">==292701==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
</span></span><span class="line"><span class="cl">==292701==    by 0x10915E: f (test.c:5)
</span></span><span class="line"><span class="cl">==292701==    by 0x10918B: main (test.c:12)
</span></span><span class="line"><span class="cl">==292701==
</span></span><span class="line"><span class="cl">==292701== LEAK SUMMARY:
</span></span><span class="line"><span class="cl">==292701==    definitely lost: 40 bytes in 1 blocks
</span></span><span class="line"><span class="cl">==292701==    indirectly lost: 0 bytes in 0 blocks
</span></span><span class="line"><span class="cl">==292701==      possibly lost: 0 bytes in 0 blocks
</span></span><span class="line"><span class="cl">==292701==    still reachable: 0 bytes in 0 blocks
</span></span><span class="line"><span class="cl">==292701==         suppressed: 0 bytes in 0 blocks
</span></span><span class="line"><span class="cl">==292701==
</span></span><span class="line"><span class="cl">==292701== For lists of detected and suppressed errors, rerun with: -s
</span></span><span class="line"><span class="cl">==292701== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 0 from 0)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯ä»¥çœ‹åˆ°ï¼švalgrind æ£€æµ‹åˆ°äº†ä¸¤ä¸ªé”™è¯¯ï¼Œä¸€ä¸ªæ˜¯å†…å­˜è¶Šç•Œï¼Œä¸€ä¸ªæ˜¯å†…å­˜æ³„æ¼
<ul>
<li>Invalid write of size 4ï¼šæç¤ºäº†å†…å­˜è¶Šç•Œçš„é”™è¯¯</li>
<li>40 bytes in 1 blocks are definitely lost in loss record 1 of 1ï¼šæç¤ºäº†å†…å­˜æ³„æ¼çš„é”™è¯¯</li>
</ul>
</li>
</ul>



<div class="notice notice-note" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256a248 248 0 11-496 0 248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>Valgrind ä½¿ç”¨ç¤ºä¾‹ 2ï¼šCachegrind ç¼“å­˜æ£€æŸ¥</p></div>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// test.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">arr</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="o">*</span><span class="n">arr2</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nf">strcpy</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="s">&#34;1234&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="n">arr2</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘å¹¶è¿è¡Œï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -g -O0 test.c -o <span class="nb">test</span>
</span></span><span class="line"><span class="cl">valgrind --tool<span class="o">=</span>cachegrind ./test
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª cachegrind.out.<!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå…¶ä¸­<!-- raw HTML omitted -->æ˜¯å½“å‰è¿›ç¨‹çš„ pidï¼Œä½¿ç”¨<code>ls</code> å‘½ä»¤æŸ¥çœ‹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ls
</span></span><span class="line"><span class="cl">cachegrind.out.293847  <span class="nb">test</span>  test.c
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½¿ç”¨<code>cg_annnotate</code> å‘½ä»¤æŸ¥çœ‹ cachegrind.out.<!-- raw HTML omitted -->æ–‡ä»¶çš„å†…å®¹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cg_annotate cachegrind.out.293847
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">I1 cache:         <span class="m">32768</span> B, <span class="m">64</span> B, 8-way associative
</span></span><span class="line"><span class="cl">D1 cache:         <span class="m">32768</span> B, <span class="m">64</span> B, 8-way associative
</span></span><span class="line"><span class="cl">LL cache:         <span class="m">31457280</span> B, <span class="m">64</span> B, 15-way associative
</span></span><span class="line"><span class="cl">Command:          ./test
</span></span><span class="line"><span class="cl">Data file:        cachegrind.out.293847
</span></span><span class="line"><span class="cl">Events recorded:  Ir I1mr ILmr Dr D1mr DLmr Dw D1mw DLmw
</span></span><span class="line"><span class="cl">Events shown:     Ir I1mr ILmr Dr D1mr DLmr Dw D1mw DLmw
</span></span><span class="line"><span class="cl">Event sort order: Ir I1mr ILmr Dr D1mr DLmr Dw D1mw DLmw
</span></span><span class="line"><span class="cl">Thresholds:       0.1 <span class="m">100</span> <span class="m">100</span> <span class="m">100</span> <span class="m">100</span> <span class="m">100</span> <span class="m">100</span> <span class="m">100</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl">Include dirs:
</span></span><span class="line"><span class="cl">User annotated:
</span></span><span class="line"><span class="cl">Auto-annotation:  off
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/* ä»¥ä¸‹å†…å®¹çœç•¥ */
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œcachegrind.out.<!-- raw HTML omitted -->æ–‡ä»¶ä¸­è®°å½•äº†ç¨‹åºè¿è¡Œæ—¶çš„ç¼“å­˜ä¿¡æ¯ï¼ŒåŒ…æ‹¬ I1 cacheï¼ŒD1 cacheï¼ŒLL cache ç­‰ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ†æç¨‹åºçš„ç¼“å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>cachegrind è¾“å‡ºçš„ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒå…³æ³¨çš„æ˜¯ï¼š
<ul>
<li>Ir: æŒ‡ä»¤è¯»å–æ¬¡æ•°</li>
<li>I1mrï¼šæŒ‡ä»¤è¯»å– miss æ¬¡æ•°</li>
<li>ILmrï¼šæŒ‡ä»¤è¯»å– miss æ¬¡æ•°</li>
<li>Drï¼šæ•°æ®è¯»å–æ¬¡æ•°</li>
<li>D1mrï¼šæ•°æ®è¯»å– miss æ¬¡æ•°</li>
<li>DLmrï¼šæ•°æ®è¯»å– miss æ¬¡æ•°</li>
<li>Dwï¼šæ•°æ®å†™å…¥æ¬¡æ•°</li>
<li>D1mwï¼šæ•°æ®å†™å…¥ miss æ¬¡æ•°</li>
<li>DLmwï¼šæ•°æ®å†™å…¥ miss æ¬¡æ•°</li>
</ul>
</li>
</ul>



<div class="notice notice-note" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256a248 248 0 11-496 0 248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>Valgrind ä½¿ç”¨ç¤ºä¾‹ 3ï¼šCallgrind è°ƒç”¨å›¾æ£€æŸ¥</p></div>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// test.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// é—®é¢˜ 1: æ•°ç»„ä¸‹æ ‡è¶Šç•Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>  <span class="c1">//é—®é¢˜ 2: å†…å­˜æ²¡æœ‰é‡Šæ”¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">f</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;i=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>  <span class="c1">// é—®é¢˜ 3ï¼šå˜é‡æ²¡æœ‰èµ‹åˆå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘å¹¶è¿è¡Œï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -g -O2 test.c -o <span class="nb">test</span>
</span></span><span class="line"><span class="cl">valgrind --tool<span class="o">=</span>callgrind ./test
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª callgrind.out.<!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå…¶ä¸­<!-- raw HTML omitted -->æ˜¯å½“å‰è¿›ç¨‹çš„ pidï¼Œä½¿ç”¨<code>ls</code> å‘½ä»¤æŸ¥çœ‹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ls
</span></span><span class="line"><span class="cl">callgrind.out.295036  <span class="nb">test</span>  test.c
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½¿ç”¨<code>callgrind_annotate</code> å‘½ä»¤æŸ¥çœ‹ callgrind.out.<!-- raw HTML omitted -->æ–‡ä»¶çš„å†…å®¹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ callgrind_annotate callgrind.out.295036
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">Profile data file <span class="s1">&#39;callgrind.out.295036&#39;</span> <span class="o">(</span>creator: callgrind-3.15.0<span class="o">)</span>
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">I1 cache:
</span></span><span class="line"><span class="cl">D1 cache:
</span></span><span class="line"><span class="cl">LL cache:
</span></span><span class="line"><span class="cl">Timerange: Basic block <span class="m">0</span> - <span class="m">43734</span>
</span></span><span class="line"><span class="cl">Trigger: Program termination
</span></span><span class="line"><span class="cl">Profiled target:  ./test <span class="o">(</span>PID 295036, part 1<span class="o">)</span>
</span></span><span class="line"><span class="cl">Events recorded:  Ir
</span></span><span class="line"><span class="cl">Events shown:     Ir
</span></span><span class="line"><span class="cl">Event sort order: Ir
</span></span><span class="line"><span class="cl">Thresholds:       <span class="m">99</span>
</span></span><span class="line"><span class="cl">Include dirs:
</span></span><span class="line"><span class="cl">User annotated:
</span></span><span class="line"><span class="cl">Auto-annotation:  off
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">Ir
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">193,311  PROGRAM TOTALS
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">Ir      file:function
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">71,545  /build/glibc-SzIz7B/glibc-2.31/elf/dl-addr.c:_dl_addr <span class="o">[</span>/usr/lib/x86_64-linux-gnu/libc-2.31.so<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/* ä»¥ä¸‹å†…å®¹çœç•¥ */
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œcallgrind.out.<!-- raw HTML omitted -->æ–‡ä»¶ä¸­è®°å½•äº†ç¨‹åºè¿è¡Œæ—¶çš„è°ƒç”¨å›¾ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼Œå‡½æ•°è°ƒç”¨è·¯å¾„ç­‰ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ†æç¨‹åºçš„è°ƒç”¨å›¾ä½¿ç”¨æƒ…å†µ</li>
<li>callgrind è¾“å‡ºçš„ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒå…³æ³¨çš„æ˜¯ï¼š
<ul>
<li>Irï¼šæŒ‡ä»¤è¯»å–æ¬¡æ•°</li>
</ul>
</li>
</ul>
<h2 id="ä¸‰ç¨‹åºä¼˜åŒ–åˆ†æå·¥å…·ç®€ä»‹">ä¸‰ã€ç¨‹åºä¼˜åŒ–åˆ†æå·¥å…·ç®€ä»‹</h2>
<ul>
<li>è¿è¡Œç¼“æ…¢çš„ä»£ç å°†æ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´, å› æ­¤ï¼Œæˆ‘ä»¬å¿…éœ€è¯„ä¼°ä»£ç çš„è¿è¡Œæ•ˆç‡, åœ¨æ•´ä¸ªä»£ç çš„è®¾è®¡å’Œå®ç°å‘¨æœŸé‡Œéƒ½éœ€è€ƒè™‘æ€§èƒ½ã€‚</li>
<li>Amdahl å®šå¾‹ï¼šåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œå¦‚æœæŸéƒ¨åˆ†çš„æ‰§è¡Œæ—¶é—´å æ€»æ‰§è¡Œæ—¶é—´çš„æ¯”ä¾‹ä¸º pï¼Œé‚£ä¹ˆä¼˜åŒ–è¿™éƒ¨åˆ†çš„æ‰§è¡Œæ—¶é—´ï¼Œç³»ç»Ÿçš„æ•´ä½“æ‰§è¡Œæ—¶é—´è‡³å°‘é™ä½ p å€ã€‚</li>
</ul>
<p>$$
\begin{array}{c}T_{new} = T_{old} \times (1-p) + \frac{T_{old} \times p}{k} \ = T_{old} \times (1-p + \frac{p}{k})\end{array}
$$</p>
<ul>
<li>æ ¹æ® Amdahl å®šå¾‹ï¼Œå¯¹çƒ­ç‚¹éƒ¨åˆ†è¿›è¡Œæ€§èƒ½ä¼˜åŒ–èƒ½å¤Ÿè·å¾—æœ€å¤§æ”¶ç›Š</li>
<li>å¸¸è§çš„ç¨‹åºä¼˜åŒ–åˆ†æå·¥å…·æœ‰ï¼š
<ul>
<li>gprof</li>
<li>perf</li>
<li>Vtune</li>
<li>&hellip;&hellip;</li>
</ul>
</li>
</ul>
<h3 id="1-gprof">1. gprof</h3>
<ul>
<li>
<p>Gprofï¼Œåˆç§° GNU profilerï¼Œæ˜¯ Linux/Unix ç³»ç»Ÿä¸Šçš„æ€§èƒ½ profiling è½¯ä»¶ï¼Œå…¶åŠŸèƒ½æ˜¯è·å¾—ç¨‹åºå„ä¸ªå‡½æ•°è¿è¡Œæ—¶é—´ï¼Œå¸®åŠ©æ‰¾å‡ºè€—æ—¶æœ€å¤šçš„å‡½æ•°ï¼Œä»¥åŠæ˜¾ç¤ºå‡½æ•°è°ƒç”¨å…³ç³»ï¼ŒåŒ…æ‹¬è°ƒç”¨æ¬¡æ•°ï¼Œå¸®åŠ©åˆ†æç¨‹åºè¿è¡Œæµç¨‹ã€‚</p>
</li>
<li>
<p>åŸºæœ¬åŸç†ä¸ºï¼š</p>
<ul>
<li>ç¼–è¯‘é“¾æ¥ç¨‹åºæ—¶ï¼Œç¼–è¯‘å™¨åœ¨ç¨‹åºçš„æ¯ä¸ªå‡½æ•°ä¸­éƒ½åŠ å…¥äº†ä¸€ä¸ªå‡½æ•°ï¼Œç¨‹åºé‡Œçš„æ¯ä¸€ä¸ªå‡½æ•°éƒ½ä¼šè°ƒç”¨è¯¥å‡½æ•°, è¯¥å‡½æ•° ä¼šåœ¨å†…å­˜ä¸­ä¿å­˜ä¸€å¼ å‡½æ•°è°ƒç”¨å›¾ï¼Œå¹¶é€šè¿‡å‡½æ•°è°ƒç”¨å †æ ˆçš„å½¢å¼æŸ¥æ‰¾å­å‡½æ•°å’Œçˆ¶å‡½æ•°çš„åœ°å€</li>
<li>è°ƒç”¨å›¾ä¹Ÿä¿å­˜äº†æ‰€æœ‰ä¸å‡½æ•°ç›¸å…³çš„è°ƒç”¨æ—¶é—´ï¼Œè°ƒç”¨æ¬¡æ•°ç­‰ä¿¡æ¯</li>
</ul>
</li>
<li>
<p>Gprof éœ€è¦å…ˆä½¿ç”¨<code>-pg</code> ç¼–è¯‘å’Œé“¾æ¥åº”ç”¨ç¨‹åº</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ifort -pg -O3 -o prog prog.f90
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ‰§è¡Œåº”ç”¨ç¨‹åºä½¿ä¹‹ç”Ÿæˆä¾› gprof åˆ†æçš„æ•°æ®ï¼Œç”Ÿæˆ gmon.out</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">./prog
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½¿ç”¨ gprof ç¨‹åºåˆ†æåº”ç”¨ç¨‹åºç”Ÿæˆçš„æ•°æ®</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gprof prog gmon.out &gt; gprof.out
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>gprof çš„è¾“å‡ºä¿¡æ¯åŒ…æ‹¬ï¼š</li>
</ul>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>åºå·</th>
<th>åˆ—å</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>time</td>
<td>å‡½æ•°æ‰§è¡Œæ—¶é—´å æ€»æ‰§è¡Œæ—¶é—´çš„ç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>2</td>
<td>cumulative seconds</td>
<td>å‡½æ•°å’Œä¸Šåˆ—å‡½æ•°ç´¯è®¡æ‰§è¡Œçš„æ—¶é—´</td>
</tr>
<tr>
<td>3</td>
<td>self seconds</td>
<td>å‡½æ•°æœ¬èº«æ‰€æ‰§è¡Œçš„æ—¶é—´</td>
</tr>
<tr>
<td>4</td>
<td>calls</td>
<td>å‡½æ•°è¢«è°ƒç”¨æ¬¡æ•°</td>
</tr>
<tr>
<td>5</td>
<td>self ms/call</td>
<td>æ¯ä¸€æ¬¡è°ƒç”¨èŠ±è´¹åœ¨å‡½æ•°çš„æ—¶é—´</td>
</tr>
<tr>
<td>6</td>
<td>total ms/call</td>
<td>æ¯ä¸€æ¬¡è°ƒç”¨ï¼ŒèŠ±è´¹åœ¨å‡½æ•°åŠå…¶è¡ç”Ÿå‡½æ•°çš„å¹³å‡æ—¶é—´</td>
</tr>
<tr>
<td>7</td>
<td>name</td>
<td>å‡½æ•°å</td>
</tr>
</tbody>
</table></div>
<ul>
<li>gprof å¸¸ç”¨çš„å‘½ä»¤é€‰é¡¹æœ‰ï¼š</li>
</ul>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>-b</td>
<td>ä¸å†è¾“å‡ºç»Ÿè®¡å›¾è¡¨ä¸­æ¯ä¸ªå­—æ®µçš„è¯¦ç»†æè¿°</td>
</tr>
<tr>
<td>-p</td>
<td>åªè¾“å‡ºå‡½æ•°çš„è°ƒç”¨å›¾</td>
</tr>
<tr>
<td>-q</td>
<td>åªè¾“å‡ºå‡½æ•°çš„æ—¶é—´æ¶ˆè€—åˆ—è¡¨</td>
</tr>
<tr>
<td>-e Name</td>
<td>ä¸å†è¾“å‡ºå‡½æ•° Name åŠå…¶å­å‡½æ•°çš„è°ƒç”¨å›¾</td>
</tr>
<tr>
<td>-E Name</td>
<td>ä¸å†è¾“å‡ºå‡½æ•° Name åŠå…¶å­å‡½æ•°çš„è°ƒç”¨å›¾ï¼Œåœ¨æ€»æ—¶é—´å’Œç™¾åˆ†æ¯”æ—¶é—´è®¡ç®—ä¸­æ’é™¤äº†ç”±å‡½æ•° Name åŠå…¶å­å‡½æ•°æ‰€ç”¨çš„æ—¶é—´</td>
</tr>
<tr>
<td>-f Name</td>
<td>è¾“å‡ºå‡½æ•° Name åŠå…¶å­å‡½æ•°çš„è°ƒç”¨å›¾</td>
</tr>
<tr>
<td>-F Name</td>
<td>è¾“å‡ºå‡½æ•° Name åŠå…¶å­å‡½æ•°çš„è°ƒç”¨å›¾ï¼Œç±»ä¼¼äº-fï¼Œä½†å®ƒåœ¨æ€»æ—¶é—´å’Œç™¾åˆ†æ¯”æ—¶é—´è®¡ç®—ä¸­ä»…ä½¿ç”¨æ‰€æ‰“å°çš„ä¾‹ç¨‹çš„æ—¶é—´</td>
</tr>
</tbody>
</table></div>
<ul>
<li>å¯¹äºç”±å¤šä¸ªæºæ–‡ä»¶ç»„æˆçš„ç¨‹åºï¼Œç¼–è¯‘æ—¶éœ€è¦åœ¨ç”Ÿæˆæ¯ä¸ª.o æ–‡ä»¶çš„æ—¶å€™åŠ ä¸Š<code>-pg</code> å‚æ•°ï¼ŒåŒæ—¶åœ¨é“¾æ¥çš„æ—¶å€™ä¹Ÿè¦åŠ ä¸Š<code>-pg</code> å‚æ•°</li>
<li><code>-pg</code> å‚æ•°åªèƒ½è®°å½•æºä»£ç ä¸­å„ä¸ªå‡½æ•°çš„è°ƒç”¨å…³ç³»ï¼Œè€Œä¸èƒ½è®°å½•åº“å‡½æ•°çš„è°ƒç”¨æƒ…å†µ</li>
<li>è¦æƒ³è®°å½•æ¯ä¸ªåº“å‡½æ•°ï¼ˆå¦‚ memcpyã€memsetã€sprintf ç­‰å‡½æ•°ï¼‰çš„è°ƒç”¨æƒ…å†µï¼Œé“¾æ¥çš„æ—¶å€™å¿…é¡»æŒ‡å®šåº“å‡½æ•°çš„åŠ¨æ€ï¼ˆæˆ–è€…é™æ€ï¼‰é“¾æ¥åº“ libc_p.aï¼Œå³åŠ ä¸Š-lc_pï¼Œè€Œä¸æ˜¯-lc
<ul>
<li>$ gcc example1.c â€“pg -lc_p -o example1</li>
</ul>
</li>
<li>è‹¥åªæœ‰éƒ¨åˆ†ä»£ç åœ¨ç¼–è¯‘æ—¶æŒ‡å®šäº†<code>-pg</code> å‚æ•°ï¼Œåˆ™ç”Ÿæˆçš„ gmon.out æ–‡ä»¶ä¸­å°†ç¼ºå°‘éƒ¨åˆ†å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰è¿™äº›å‡½æ•°çš„è°ƒç”¨å…³ç³»ï¼Œä½†æ˜¯å¹¶ä¸å½±å“ gprof å¯¹å…¶å®ƒå‡½æ•°è¿›è¡Œè®°å½•</li>
</ul>



<div class="notice notice-note" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256a248 248 0 11-496 0 248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>gprof ä½¿ç”¨ç¤ºä¾‹</p></div>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// test.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">fast_multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">slow_multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span> <span class="o">=</span> <span class="nf">fast_multiply</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span> <span class="o">=</span> <span class="nf">slow_multiply</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;x=%d, y=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘é“¾æ¥å¹¶è¿è¡Œç¨‹åº</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc -pg -o <span class="nb">test</span> test.c
</span></span><span class="line"><span class="cl">./test
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ gmon.out æ–‡ä»¶ï¼Œä½¿ç”¨ gprof åˆ†æ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gprof -b <span class="nb">test</span> gmon.out &gt; gprof.out
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>gprof.out æ–‡ä»¶å†…å®¹å¦‚ä¸‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Flat profile:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Each sample counts as 0.01 seconds.
</span></span><span class="line"><span class="cl"> no time accumulated
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  %   cumulative   self              self     total
</span></span><span class="line"><span class="cl"> time   seconds   seconds    calls  Ts/call  Ts/call  name
</span></span><span class="line"><span class="cl">  0.00      0.00     0.00     6000     0.00     0.00  fast_multiply
</span></span><span class="line"><span class="cl">  0.00      0.00     0.00     6000     0.00     0.00  slow_multiply
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        Call graph
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">granularity: each sample hit covers 2 byte(s) no time propagated
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">index % time    self  children    called     name
</span></span><span class="line"><span class="cl">                0.00    0.00    6000/6000        main [8]
</span></span><span class="line"><span class="cl">[1]      0.0    0.00    0.00    6000         fast_multiply [1]
</span></span><span class="line"><span class="cl">-----------------------------------------------
</span></span><span class="line"><span class="cl">                0.00    0.00    6000/6000        main [8]
</span></span><span class="line"><span class="cl">[2]      0.0    0.00    0.00    6000         slow_multiply [2]
</span></span><span class="line"><span class="cl">-----------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Index by function name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   [1] fast_multiply           [2] slow_multiply
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯ä»¥çœ‹åˆ°ï¼šç¨‹åºä¸­åªæœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œfast_multiply å’Œ slow_multiplyï¼Œgprof åˆ†æç»“æœä¸­ä¹Ÿåªæœ‰è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°éƒ½æ˜¯ 6000 æ¬¡ï¼Œè¿™æ˜¯å› ä¸º gprof é»˜è®¤çš„é‡‡æ ·å‘¨æœŸæ˜¯ 0.01 ç§’ï¼Œè€Œç¨‹åºè¿è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°éƒ½æ˜¯ 6000 æ¬¡ï¼Œå¦‚æœç¨‹åºè¿è¡Œæ—¶é—´æ›´é•¿ï¼Œé‚£ä¹ˆä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°å°±ä¼šä¸ä¸€æ ·äº†ã€‚</li>
</ul>
<h3 id="2-perf">2. perf</h3>
<ul>
<li>
<p>Perf æ˜¯å†…ç½®äº Linux å†…æ ¸æºç æ ‘ä¸­çš„æ€§èƒ½å‰–æ(profiling)å·¥å…·ï¼ŒåŸºäºäº‹ä»¶é‡‡æ ·åŸç†ï¼Œä»¥æ€§èƒ½äº‹ä»¶ä¸ºåŸºç¡€ï¼Œæ”¯æŒé’ˆå¯¹å¤„ç†å™¨ç›¸å…³æ€§èƒ½æŒ‡æ ‡ä¸æ“ä½œç³»ç»Ÿç›¸å…³æ€§èƒ½æŒ‡æ ‡çš„æ€§èƒ½å‰–æï¼Œå¸¸ç”¨äºæ€§èƒ½ç“¶é¢ˆçš„æŸ¥æ‰¾ä¸çƒ­ç‚¹ä»£ç çš„å®šä½ã€‚</p>
</li>
<li>
<p>Perf åŒ…å« 22 ç§å­å·¥å…·çš„å·¥å…·é›†ï¼Œä»¥ä¸‹æ˜¯æœ€å¸¸ç”¨çš„ 5 ç§ï¼š</p>
<ul>
<li>perf listï¼šåˆ—å‡ºå½“å‰ç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰æ€§èƒ½äº‹ä»¶ã€‚åŒ…æ‹¬ç¡¬ä»¶æ€§èƒ½äº‹ä»¶ã€è½¯ä»¶æ€§èƒ½äº‹ä»¶ä»¥åŠæ£€æŸ¥ç‚¹</li>
<li>perf topï¼šç±»ä¼¼äº Linux çš„ top å‘½ä»¤ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½è¿›è¡Œå®æ—¶åˆ†æ</li>
<li>perf statï¼šå‰–ææŸä¸ªç‰¹å®šè¿›ç¨‹çš„æ€§èƒ½æ¦‚å†µï¼ŒåŒ…æ‹¬ CPIã€Cache ä¸¢å¤±ç‡ç­‰</li>
<li>perf recordï¼šæ”¶é›†é‡‡æ ·ä¿¡æ¯ï¼Œå¹¶å°†å…¶è®°å½•åœ¨æ•°æ®æ–‡ä»¶ä¸­</li>
<li>perf reportï¼šè¯»å– perf record åˆ›å»ºçš„æ•°æ®æ–‡ä»¶ï¼Œå¹¶ç»™å‡ºçƒ­ç‚¹åˆ†æç»“æœ</li>
</ul>
</li>
<li>
<p>perf list</p>
<ul>
<li>æŸ¥çœ‹å½“å‰è½¯ç¡¬ä»¶å¹³å°æ”¯æŒçš„æ€§èƒ½äº‹ä»¶åˆ—è¡¨</li>
<li>äº‹ä»¶åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š
<ul>
<li><strong>Hardware Event</strong>: ç”± PMU ç¡¬ä»¶äº§ç”Ÿçš„äº‹ä»¶ï¼Œæ¯”å¦‚ cache å‘½ä¸­ï¼Œå½“è¦äº†è§£ç¨‹åºå¯¹ç¡¬ä»¶ç‰¹æ€§çš„ä½¿ç”¨æƒ…å†µæ—¶ï¼Œä¾¿éœ€è¦å¯¹è¿™äº›äº‹ä»¶è¿›è¡Œé‡‡æ ·</li>
<li><strong>Software Event</strong>: å†…æ ¸è½¯ä»¶äº§ç”Ÿçš„äº‹ä»¶ï¼Œæ¯”å¦‚è¿›ç¨‹åˆ‡æ¢ã€tick æ•°ç­‰</li>
<li><strong>Tracepoint event</strong>: å†…æ ¸ä¸­çš„é™æ€ tracepoint æ‰€è§¦å‘çš„äº‹ä»¶ï¼Œè¿™äº› tracepoint ç”¨æ¥åˆ¤æ–­ç¨‹åºè¿è¡ŒæœŸé—´å†…æ ¸çš„è¡Œä¸ºç»†èŠ‚ï¼Œæ¯”å¦‚ slab åˆ†é…å™¨çš„åˆ†é…æ¬¡æ•°ç­‰</li>
</ul>
</li>
<li>å‘½ä»¤æ ¼å¼ï¼š<code>perf list [hw | sw | cache | tracepoint]</code></li>
<li>perf list å·¥å…·ä»…åˆ—å‡ºäº†å…·æœ‰å­—ç¬¦æè¿°çš„ç¡¬ä»¶æ€§èƒ½äº‹ä»¶</li>
</ul>
</li>
<li>
<p>perf top</p>
<ul>
<li>ä¸»è¦ç”¨äºå®æ—¶åˆ†æå„ä¸ªå‡½æ•°åœ¨æŸä¸ªæ€§èƒ½äº‹ä»¶ä¸Šçš„çƒ­åº¦ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„å®šä½çƒ­ç‚¹å‡½æ•°ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºå‡½æ•°ã€æ¨¡å—å‡½æ•°ä¸å†…æ ¸å‡½æ•°ï¼Œç”šè‡³èƒ½å¤Ÿå®šä½åˆ°çƒ­ç‚¹æŒ‡ä»¤ï¼Œé»˜è®¤çš„æ€§èƒ½äº‹ä»¶ä¸º cpu cycles</li>
<li>å‘½ä»¤æ ¼å¼ï¼š <code>perf top [&lt;options&gt;]</code></li>
<li>å¸¸ç”¨å‘½ä»¤è¡Œå‚æ•°
<ul>
<li>-e <!-- raw HTML omitted -->ï¼šæŒ‡æ˜è¦åˆ†æçš„æ€§èƒ½äº‹ä»¶</li>
<li>-p <!-- raw HTML omitted -->ï¼šä»…åˆ†æç›®æ ‡è¿›ç¨‹åŠå…¶åˆ›å»ºçš„çº¿ç¨‹</li>
<li>-k <!-- raw HTML omitted -->ï¼šå¸¦ç¬¦å·è¡¨çš„å†…æ ¸æ˜ åƒæ‰€åœ¨çš„è·¯å¾„</li>
<li>-Kï¼šä¸æ˜¾ç¤ºå±äºå†…æ ¸æˆ–æ¨¡å—çš„ç¬¦å·</li>
<li>-Uï¼šä¸æ˜¾ç¤ºå±äºç”¨æˆ·æ€ç¨‹åºçš„ç¬¦å·</li>
<li>-d <!-- raw HTML omitted -->ï¼šç•Œé¢çš„åˆ·æ–°å‘¨æœŸï¼Œé»˜è®¤ä¸º 2s</li>
<li>-Gï¼šå¾—åˆ°å‡½æ•°çš„è°ƒç”¨å…³ç³»å›¾</li>
</ul>
</li>
</ul>
</li>
<li>
<p>perf stat</p>
<ul>
<li>ç”¨äºåˆ†ææŒ‡å®šç¨‹åºçš„æ€§èƒ½æ¦‚å†µ</li>
<li>å‘½ä»¤æ ¼å¼ï¼š<code>perf stat [&lt;options&gt;] [&lt;command&gt;]</code></li>
<li>å¸¸ç”¨å‘½ä»¤è¡Œå‚æ•°
<ul>
<li>-p <!-- raw HTML omitted -->ï¼šä»…åˆ†æç›®æ ‡è¿›ç¨‹åŠå…¶åˆ›å»ºçš„çº¿ç¨‹</li>
<li>-aï¼šä»æ‰€æœ‰ CPU ä¸Šæ”¶é›†æ€§èƒ½æ•°æ®</li>
<li>-r <!-- raw HTML omitted -->ï¼šé‡å¤æ‰§è¡Œå‘½ä»¤æ±‚å¹³å‡</li>
<li>-C <!-- raw HTML omitted -->ï¼šä»æŒ‡å®š CPU ä¸Šæ”¶é›†æ€§èƒ½æ•°æ®</li>
<li>-vï¼šæ˜¾ç¤ºæ›´å¤šæ€§èƒ½æ•°æ®</li>
<li>-nï¼šåªæ˜¾ç¤ºä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´</li>
<li>-x <!-- raw HTML omitted -->ï¼šæŒ‡å®šè¾“å‡ºåˆ—çš„åˆ†éš”ç¬¦</li>
<li>-o <!-- raw HTML omitted -->ï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶ã€‚&ndash;append æŒ‡å®šè¿½åŠ æ¨¡å¼ï¼Œ&ndash;pre <!-- raw HTML omitted -->æ‰§è¡Œç›®æ ‡ç¨‹åºå‰å…ˆæ‰§è¡Œçš„ç¨‹åºï¼Œ&ndash;post <!-- raw HTML omitted -->æ‰§è¡Œç›®æ ‡ç¨‹åºåå†æ‰§è¡Œçš„ç¨‹åº</li>
</ul>
</li>
</ul>
</li>
<li>
<p>perf record</p>
<ul>
<li>æ”¶é›†é‡‡æ ·ä¿¡æ¯ï¼Œå¹¶å°†å…¶è®°å½•åœ¨æ•°æ®æ–‡ä»¶ä¸­</li>
<li>éšåå¯ä»¥é€šè¿‡å…¶å®ƒå·¥å…·(perf report)å¯¹æ•°æ®æ–‡ä»¶è¿›è¡Œåˆ†æï¼Œç»“æœç±»ä¼¼äº perf top</li>
<li>å‘½ä»¤æ ¼å¼ï¼š<code>perf record [&lt;options&gt;] [&lt;command&gt;]</code></li>
</ul>
</li>
<li>
<p>perf report</p>
<ul>
<li>è¯»å– perf record åˆ›å»ºçš„æ•°æ®æ–‡ä»¶ï¼Œå¹¶ç»™å‡ºçƒ­ç‚¹åˆ†æç»“æœ</li>
<li>å‘½ä»¤æ ¼å¼ï¼š<code>perf report [&lt;options&gt;] [&lt;datafile&gt;]</code></li>
</ul>
</li>
</ul>



<div class="notice notice-note" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256a248 248 0 11-496 0 248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>perf ä½¿ç”¨ç¤ºä¾‹</p></div>

<ul>
<li>apt-get å®‰è£… perf</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install linux-tools-common linux-tools-generic linux-tools-<span class="sb">`</span>uname -r<span class="sb">`</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½¿ç”¨ perf list æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ”¯æŒçš„æ€§èƒ½äº‹ä»¶</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">perf list
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>perf list ç»“æœï¼š</li>
</ul>
<figure><img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/20230803181340.webp"
         alt="20230803181340" width="90%" loading="lazy"/>
</figure>

<ul>
<li>ä½¿ç”¨ perf top æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„çƒ­ç‚¹å‡½æ•°</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">perf top
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>perf top ç»“æœï¼š</li>
</ul>
<figure><img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/20230803181307.webp"
         alt="20230803181307" width="90%" loading="lazy"/>
</figure>

<ul>
<li>
<p>ä½¿ç”¨ perf stat æŸ¥çœ‹æµ‹è¯•ç¨‹åºçš„æ€§èƒ½æ¦‚å†µ</p>
</li>
<li>
<p>ä½¿ç”¨åœ¨ gprof æ—¶çš„ç¨‹åºä»£ç  test.c</p>
</li>
<li>
<p>æ‰§è¡Œ perf stat</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">perf stat ./test
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>perf stat ç»“æœï¼š</li>
</ul>
<figure><img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/20230803182003.webp"
         alt="20230803182003" width="90%" loading="lazy"/>
</figure>

<ul>
<li>ä½¿ç”¨ perf record å’Œ perf report æŸ¥çœ‹çƒ­ç‚¹å‡½æ•°</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">perf record ./test
</span></span><span class="line"><span class="cl">perf report
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>perf report ç»“æœï¼š</li>
</ul>
<figure><img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/20230803182110.webp"
         alt="20230803182110" width="90%" loading="lazy"/>
</figure>

<ul>
<li>
<p>è¿›é˜¶ï¼šç«ç‚¬å›¾ FlameGraphï¼šåŸºäº perf record å’Œ perf report çš„ç»“æœç»˜åˆ¶ç«ç‚¬å›¾</p>
<ul>
<li>
<p>ä¸‹è½½ FlameGraph å·¥å…·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git clone https://github.com/brendangregg/FlameGraph.git
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æ”¶é›†æ€§èƒ½æ•°æ®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">perf record -g ./test
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¯¹å¯æ‰§è¡Œæ–‡ä»¶ test è¿›è¡Œé‡‡æ ·ï¼Œæ¯ç§’ 99 æ¬¡ï¼Œé‡‡æ ·ç»“æœä¿å­˜åœ¨ perf.data æ–‡ä»¶ä¸­</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨ FlameGraph ç”Ÿæˆç«ç‚¬å›¾ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤ä½¿ç”¨ FlameGraph ç”Ÿæˆç«ç‚¬å›¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">perf script <span class="p">|</span> ./FlameGraph/stackcollapse-perf.pl &gt; out.perf-folded
</span></span><span class="line"><span class="cl">./FlameGraph/flamegraph.pl out.perf-folded &gt; perf.svg
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>FlameGrpah ç»˜åˆ¶ç»“æœï¼š</p>
</li>
</ul>
<figure><img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/20230803191123.webp"
         alt="20230803191123" width="90%" loading="lazy"/>
</figure>

<h3 id="3-vtune">3. Vtune</h3>
<ul>
<li>Intel VTune Amplifier XE æ˜¯ Intel é’ˆå¯¹å…¶å¤„ç†å™¨çš„æ€§èƒ½æµ‹è¯•åˆ†æå·¥å…·ï¼Œæ”¯æŒ Windows/Linuxï¼Œæä¾›å›¾å½¢ç”¨æˆ·ç•Œé¢å’Œå‘½ä»¤è¡Œæ¥å£ï¼Œæ”¯æŒ Cã€C++ã€Fortranã€C#ã€Javaã€.NET ç­‰å¤šç§è¯­è¨€ã€‚</li>
<li>Vtune åŸºäºç¡¬ä»¶æ€§èƒ½ç›‘è§†éƒ¨ä»¶(PMU)æ€§èƒ½æµ‹è¯•ï¼Œè·å¾—å¾®ä½“ç³»ç»“æ„çº§æ•°æ®
<ul>
<li>æŒ‡ä»¤ç±»å‹ä¸æ•°ç›®</li>
<li>å­˜å‚¨è®¿é—®äº‹ä»¶</li>
<li>æŒ‡ä»¤æµæ°´çº¿äº‹ä»¶</li>
</ul>
</li>
<li>Vtune æ€§èƒ½åˆ†æç²’åº¦åŒ…æ‹¬ï¼šè¿›ç¨‹ã€çº¿ç¨‹ã€å­ç¨‹åºã€ä»£ç è¡Œ</li>
<li>Vtune å¯ä»¥å¸®åŠ©ç”¨æˆ·åˆ†æç®—æ³•é€‰æ‹©ï¼Œæ ‡è¯†å‡ºåº”ç”¨ç¨‹åºæ€æ ·æ›´å¥½çš„åˆ©ç”¨å¯ç”¨çš„ç¡¬ä»¶èµ„æºï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å¦‚ä¸‹æ€§èƒ½æ–¹é¢é—®é¢˜ï¼š
<ul>
<li>ç¨‹åºä¸­æˆ–è€…æ•´ä¸ªç³»ç»Ÿä¸­æ—¶é—´æ¶ˆè€—æœ€å¤šçš„å‡½æ•°</li>
<li>æ²¡æœ‰æœ‰æ•ˆåˆ©ç”¨å¤„ç†å™¨æ—¶é—´çš„ä»£ç ç‰‡æ®µ</li>
<li>ä¼˜åŒ–ä¸²è¡Œå’Œçº¿ç¨‹åŒ–æ€§èƒ½çš„æœ€å¥½ä»£ç ç‰‡æ®µ</li>
<li>å½±å“ç¨‹åºæ€§èƒ½çš„åŒæ­¥å¯¹è±¡</li>
<li>ç¨‹åºçš„ I/O æ“ä½œæ˜¯å¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œä»¥åŠåœ¨å“ªé‡Œã€ä¸ºä»€ä¹ˆèŠ±è´¹æ—¶é—´</li>
<li>ä¸åŒçš„åŒæ­¥æ–¹æ³•ï¼Œä¸åŒçš„çº¿ç¨‹æ•°é‡æˆ–è€…ä¸åŒç®—æ³•å¯¹äºæ€§èƒ½çš„å½±å“</li>
<li>çº¿ç¨‹æ´»è·ƒæ€§å’Œå˜è¿</li>
<li>ä»£ç ä¸­ç¡¬ä»¶ç›¸å…³çš„ç“¶é¢ˆ</li>
</ul>
</li>
<li>Vtune è¿˜å¯ä»¥æä¾›å¯»æ‰¾çƒ­ç‚¹ã€åˆ†æé”å’Œç­‰å¾…ä»¥åŠæ ‡è¯†ç¡¬ä»¶é—®é¢˜ç­‰åŠŸèƒ½</li>
<li>Vtune å‘½ä»¤æ ¼å¼ä¸ºï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">amplxe-cl &lt;-action&gt; <span class="o">[</span>-action-option<span class="o">]</span> <span class="o">[</span>-global-option<span class="o">]</span> <span class="o">[[</span>--<span class="o">]</span> &lt;target&gt; <span class="o">[</span>target-options<span class="o">]]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>amplxe-clï¼šVTune Amplifier å‘½ä»¤è¡Œå·¥å…·åç§°</p>
</li>
<li>
<p>&lt;-action&gt; ï¼šè¦æ‰§è¡Œçš„æ“ä½œï¼Œå¦‚ collect æˆ– reportã€‚æ¯ä¸ªå‘½ä»¤å¿…é¡»åªæœ‰ä¸€ä¸ªæ“ä½œã€‚å¦‚ï¼Œä¸€ä¸ªå‘½ä»¤ä¸­ä¸èƒ½åŒæ—¶æœ‰æ”¶é›†æ•°æ®å’Œç”ŸæˆæŠ¥è¡¨</p>
</li>
<li>
<p>[-action-option] ï¼šæ“ä½œé€‰é¡¹ï¼Œç”¨äºä¿®æ”¹ç‰¹å®šæ“ä½œçš„è¡Œä¸ºã€‚æ¯ä¸ªæ“ä½œå¯ä»¥æœ‰å¤šä¸ªæ“ä½œé€‰é¡¹ï¼Œæ“ä½œé€‰é¡¹ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´ä½¿ç”¨é”™è¯¯</p>
</li>
<li>
<p>[-global-option] ï¼šå…¨å±€é€‰é¡¹ï¼Œç”¨äºä»¥ç›¸åŒçš„æ–¹å¼ä¿®æ”¹æ‰€æœ‰æ“ä½œçš„è¡Œä¸ºã€‚æ¯ä¸ªæ“ä½œå¯ä»¥æœ‰å¤šä¸ªå…¨å±€é€‰é¡¹</p>
</li>
<li>
<p>[&ndash;] <!-- raw HTML omitted --> ï¼šè¦åˆ†æçš„ç›®æ ‡ç¨‹åº</p>
</li>
<li>
<p>[target-options] ï¼šç›®æ ‡ç¨‹åºå‚æ•°é€‰é¡¹</p>
</li>
<li>
<p>Actionsï¼šamplxe-cl æ”¯æŒä¸åŒçš„å‘½ä»¤é€‰é¡¹</p>
<ul>
<li>collectï¼šè¿è¡ŒæŒ‡å®šçš„åˆ†æç±»å‹å¹¶å°†æ•°æ®æ”¶é›†åˆ°ç»“æœä¸­</li>
<li>collect-withï¼šè¿è¡Œç”¨æˆ·è®¾ç½®çš„åŸºäºäº‹ä»¶çš„ç¡¬ä»¶é‡‡æ ·æˆ–ç”¨æˆ·æ¨¡å¼é‡‡æ ·ï¼Œå¹¶è·Ÿè¸ªæ”¶é›†</li>
<li>commandï¼šå‘æ­£åœ¨è¿è¡Œçš„æ”¶é›†æ“ä½œå‘å‡ºå‘½ä»¤</li>
<li>finalizeï¼šæ‰§è¡Œç¬¦å·è§£æä»¥å®Œæˆæˆ–é‡æ–°è·å¾—ç»“æœ</li>
<li>helpï¼š æ˜¾ç¤ºå‘½ä»¤è¡Œå‚æ•°çš„ç®€çŸ­è§£é‡Š</li>
<li>importï¼šå¯¼å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ”¶é›†æ•°æ®æ–‡ä»¶/ç›®å½•</li>
<li>reportï¼šä»åˆ†æç»“æœä¸­ç”ŸæˆæŒ‡å®šç±»å‹çš„æŠ¥è¡¨</li>
<li>versionï¼šæ˜¾ç¤º amplxe-cl ç‰ˆæœ¬ä¿¡æ¯</li>
</ul>
</li>
<li>
<p>Action Options</p>
<ul>
<li>å®šä¹‰é€‚ç”¨äºæŒ‡å®šæ“ä½œçš„è¡Œä¸ºï¼Œå¦‚â€œ-result-dirâ€é€‰é¡¹æ˜¯æŒ‡å®šæ”¶é›†æ“ä½œç»“æœçš„ç›®å½•è·¯å¾„</li>
<li>è‹¥è¦è®¿é—®æ“ä½œçš„å¯ç”¨æ“ä½œé€‰é¡¹åˆ—è¡¨ï¼Œè¯·ä½¿ç”¨å‘½ä»¤â€œamplxe-cl â€“help<!-- raw HTML omitted -->â€ ï¼Œå…¶ä¸­ <!-- raw HTML omitted --> æ˜¯å¯ç”¨æ“ä½œä¹‹ä¸€ï¼›è¦æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ“ä½œ, è¯·ä½¿ç”¨å‘½ä»¤â€œamplxe-cl â€“helpâ€</li>
<li>å¦‚æœåœ¨åŒä¸€å‘½ä»¤è¡Œä¸Šä½¿ç”¨äº†ç›¸åçš„æ“ä½œé€‰é¡¹ï¼Œåˆ™å°†åº”ç”¨æœ€åçš„æ“ä½œé€‰é¡¹</li>
<li>å¿½ç•¥ä¸Šä¸‹æ–‡ä¸­å†—ä½™æˆ–æ²¡æœ‰æ„ä¹‰çš„æ“ä½œé€‰é¡¹</li>
<li>ä½¿ç”¨ä¸é€‚å½“çš„æ“ä½œé€‰é¡¹ï¼Œä¼šå¯¼è‡´æ„å¤–è¡Œä¸ºè¿”å›ä½¿ç”¨é”™è¯¯</li>
</ul>
</li>
<li>
<p>Global Options</p>
<ul>
<li>å®šä¹‰é€‚ç”¨äºæ‰€æœ‰æ“ä½œçš„è¡Œä¸ºï¼Œå¦‚â€œ-quietâ€é€‰é¡¹ä¼šå–æ¶ˆæ‰€æœ‰æ“ä½œçš„éå¿…éœ€æ¶ˆæ¯ã€‚æ¯ä¸ªå‘½ä»¤å¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…¨å±€é€‰é¡¹</li>
</ul>
</li>
</ul>



<div class="notice notice-note" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256a248 248 0 11-496 0 248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>Vtune ä½¿ç”¨ç¤ºä¾‹ï¼š</p></div>

<ul>
<li>
<p>åŒæ ·ä½¿ç”¨åœ¨ gprof æ—¶çš„ç¨‹åºä»£ç  test.cï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨ icc ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œå› ä¸º Vtune åªæ”¯æŒ icc ç¼–è¯‘å™¨ç¼–è¯‘çš„ç¨‹åº</p>
</li>
<li>
<p>å®‰è£… icc ç¼–è¯‘å™¨ï¼š<a class="link" href="https://software.intel.com/content/www/us/en/develop/tools/oneapi/components/dpc-compiler.html"  target="_blank" rel="noopener"
    >Intel C++ Compiler</a></p>
<ul>
<li>æ³¨ï¼šicc ç¼–è¯‘å™¨æ˜¯æ”¶è´¹çš„ï¼Œéœ€è¦è´­ä¹°æˆ–è€…ç”³è¯·å­¦ç”Ÿè®¸å¯</li>
</ul>
</li>
<li>
<p>å®‰è£… Vtuneï¼š<a class="link" href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/vtune-profiler-download.html?operatingsystem=linux&amp;distributions=online"  target="_blank" rel="noopener"
    >Intel Vtune</a></p>
</li>
<li>
<p>Ubuntu ä¸‹ apt å®‰è£… Vtune</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget -O- https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="p">|</span> gpg --dearmor <span class="p">|</span> sudo tee /usr/share/keyrings/oneapi-archive-keyring.gpg &gt; /dev/null
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/oneapi-archive-keyring.gpg] https://apt.repos.intel.com/oneapi all main&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/oneAPI.list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo apt update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo apt install intel-oneapi-vtune
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç¼–è¯‘ç¨‹åºï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">icc test.c -o <span class="nb">test</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ¿€æ´» vtune ç¯å¢ƒï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">source</span> /opt/intel/oneapi/vtune/latest/amplxe-vars.sh
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ”¶é›† hosspot æ•°æ®ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ampxel-cl -collect hotspots -result-dir res ./test
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†å‡ ç§å¸¸ç”¨çš„ç¨‹åºè°ƒè¯•ä¸ä¼˜åŒ–åˆ†æå·¥å…·ï¼Œè¿™äº›å·¥å…·åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­å‘æŒ¥ç€é‡è¦çš„ä½œç”¨ã€‚è°ƒè¯•å·¥å…·å¦‚ gdb å’Œ Valgrind å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½å’Œè§£å†³ç¨‹åºä¸­çš„é”™è¯¯å’Œé—®é¢˜ï¼Œä¿éšœäº†ä»£ç çš„è´¨é‡å’Œç¨³å®šæ€§ã€‚è€Œä¼˜åŒ–åˆ†æå·¥å…·ï¼Œå¦‚ gprofã€perf å’Œ Vtuneï¼Œåˆ™ä¸“æ³¨äºæå‡ç¨‹åºæ€§èƒ½ï¼Œå¸®åŠ©å¼€å‘äººå‘˜æ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´é«˜æ•ˆåœ°å¼€å‘å’Œç»´æŠ¤ä»£ç ï¼Œå‡å°‘è°ƒè¯•æ—¶é—´ï¼Œæé«˜è½¯ä»¶æ€§èƒ½ï¼Œå¹¶ä¸”ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ä½¿ç”¨ä½“éªŒã€‚åœ¨ä»Šåçš„è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œäº†è§£å’ŒæŒæ¡è¿™äº›å·¥å…·å°†æ˜¯æé«˜å¼€å‘æŠ€èƒ½å’Œæ°´å¹³çš„é‡è¦ä¸€æ­¥ã€‚åŒæ—¶ï¼Œä¸æ–­äº†è§£æ–°çš„è°ƒè¯•ä¸ä¼˜åŒ–å·¥å…·ä¹Ÿæ˜¯è·Ÿä¸ŠæŠ€æœ¯å‘å±•çš„å¿…è¦é€”å¾„ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<p>[1] <a class="link" href="https://www.gnu.org/software/gdb/"  target="_blank" rel="noopener"
    >gdb å®˜æ–¹ç½‘ç«™</a></p>
<p>[2] <a class="link" href="https://www.valgrind.org/"  target="_blank" rel="noopener"
    >valgrind å®˜æ–¹ç½‘ç«™</a></p>
<p>[3] <a class="link" href="https://sourceware.org/binutils/docs/gprof/"  target="_blank" rel="noopener"
    >gprof å®˜æ–¹æ–‡æ¡£</a></p>
<p>[4] <a class="link" href="https://perf.wiki.kernel.org/index.php/Main_Page"  target="_blank" rel="noopener"
    >perf æ–‡æ¡£</a></p>
<p>[5] <a class="link" href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/vtune-profiler.html"  target="_blank" rel="noopener"
    >Intel Vtune Profiler</a></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/debug/">debug</a>
        
            <a href="/tags/optimization/">optimization</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.15.6/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.15.6/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.15.6/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/processing-avif-heic-images-pillow-plugins/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/img/4674616682ccadfd81f2dc86c6241f23195413.jpg@1256w_704h_!web-article-pic-2023-12-22-2023-12-31.webp" loading="lazy" data-key="processing-avif-heic-images-pillow-plugins" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/img/4674616682ccadfd81f2dc86c6241f23195413.jpg@1256w_704h_!web-article-pic-2023-12-22-2023-12-31.webp"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">ä½¿ç”¨ Pillow &#43; Plugin å¤„ç† AVIF å’Œ HEIC å›¾ç‰‡</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/ring-buffer/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/9fd865ce11924381a127462463ae2234-2023-12-02.webp" loading="lazy" data-key="ring-buffer" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/blog/9fd865ce11924381a127462463ae2234-2023-12-02.webp"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Ring buffer è¯¦è§£</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/false-sharing/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/6c3f8961290e41f894f5a1cbb768aba9-2023-12-02.webp" loading="lazy" data-key="false-sharing" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/blog/6c3f8961290e41f894f5a1cbb768aba9-2023-12-02.webp"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">æ€§èƒ½åˆºå®¢ä¹‹ä¼ªå…±äº«</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/efficient-liburing/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/20230801145236.webp" loading="lazy" data-key="efficient-liburing" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/blog/20230801145236.webp"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">é«˜æ€§èƒ½å¼‚æ­¥ I/O æ¡†æ¶ï¼šio_uring</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/java-stream/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/blog/bridge-5621201_1920.6p53ez4buso0.webp" loading="lazy" data-key="java-stream" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/blog/bridge-5621201_1920.6p53ez4buso0.webp"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Java-Stream å¸¸è§ç”¨æ³•</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="PKUcoldkeyboard/pkucoldkeyboard.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzMzU4NzI5OTI="
    data-category="Comments"
    data-category-id="DIC_kwDOFAUD4M4CZV4F"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2021 - 
        
        2024 cuterwrite
    </section>
    
    <section class="powerby">
        
            æ¬¢è¿æ¥åˆ°Cuterwriteçš„åšå®¢ç½‘ç«™ <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.17.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.bootcdn.net/ajax/libs/photoswipe/4.1.3/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.bootcdn.net/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.bootcdn.net/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.bootcdn.net/ajax/libs/photoswipe/4.1.3/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
