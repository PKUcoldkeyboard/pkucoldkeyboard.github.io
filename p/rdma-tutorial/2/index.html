<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='æœ¬æ–‡æ˜¯å…³äºRDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•çš„æŒ‡å¯¼ã€‚æ–‡ç« ä¸»è¦ä»‹ç»äº†libibverbsçš„ç®€ä»‹å’ŒVerbs APIçš„è¯¦è§£ï¼ŒåŒ…æ‹¬Verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡å’Œä¸¤ä¸ªåŠ¨æ€åº“ã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº†Connection Managerçš„å»ºç«‹è¿‡ç¨‹å’ŒæŠ½è±¡ç±»å‹RDMACMã€‚æœ€åï¼Œæ–‡ç« é€šè¿‡è§£æè¢«åŠ¨æ–¹å’Œä¸»åŠ¨æ–¹çš„RDMACMç¨‹åºï¼Œä»¥åŠåŸºäºRDMAçš„client-serverç¨‹åºçš„å®æˆ˜ï¼Œæ¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨RDMAæŠ€æœ¯ã€‚'>
<title>RDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•ï¼ˆäºŒï¼‰ï¼šç¼–ç¨‹æŒ‡å¯¼</title>

<link rel='canonical' href='https://cuterwrite.top/p/rdma-tutorial/2/'>

<link rel="stylesheet" href="/scss/style.min.a396fcf458856ed828a39d8d042cb52899a22a1649ff05c03dc4308e6ddc184b.css"><meta property='og:title' content='RDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•ï¼ˆäºŒï¼‰ï¼šç¼–ç¨‹æŒ‡å¯¼'>
<meta property='og:description' content='æœ¬æ–‡æ˜¯å…³äºRDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•çš„æŒ‡å¯¼ã€‚æ–‡ç« ä¸»è¦ä»‹ç»äº†libibverbsçš„ç®€ä»‹å’ŒVerbs APIçš„è¯¦è§£ï¼ŒåŒ…æ‹¬Verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡å’Œä¸¤ä¸ªåŠ¨æ€åº“ã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº†Connection Managerçš„å»ºç«‹è¿‡ç¨‹å’ŒæŠ½è±¡ç±»å‹RDMACMã€‚æœ€åï¼Œæ–‡ç« é€šè¿‡è§£æè¢«åŠ¨æ–¹å’Œä¸»åŠ¨æ–¹çš„RDMACMç¨‹åºï¼Œä»¥åŠåŸºäºRDMAçš„client-serverç¨‹åºçš„å®æˆ˜ï¼Œæ¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨RDMAæŠ€æœ¯ã€‚'>
<meta property='og:url' content='https://cuterwrite.top/p/rdma-tutorial/2/'>
<meta property='og:site_name' content='cuterwrite'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='RDMA' /><meta property='article:tag' content='è®¡ç®—æœºç½‘ç»œ' /><meta property='article:published_time' content='2023-07-27T01:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-07-27T01:00:00&#43;00:00'/><meta property='og:image' content='https://cuterwrite-1302252842.file.myqcloud.com/img/20230725145210.png' />
<meta name="twitter:title" content="RDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•ï¼ˆäºŒï¼‰ï¼šç¼–ç¨‹æŒ‡å¯¼">
<meta name="twitter:description" content="æœ¬æ–‡æ˜¯å…³äºRDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•çš„æŒ‡å¯¼ã€‚æ–‡ç« ä¸»è¦ä»‹ç»äº†libibverbsçš„ç®€ä»‹å’ŒVerbs APIçš„è¯¦è§£ï¼ŒåŒ…æ‹¬Verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡å’Œä¸¤ä¸ªåŠ¨æ€åº“ã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº†Connection Managerçš„å»ºç«‹è¿‡ç¨‹å’ŒæŠ½è±¡ç±»å‹RDMACMã€‚æœ€åï¼Œæ–‡ç« é€šè¿‡è§£æè¢«åŠ¨æ–¹å’Œä¸»åŠ¨æ–¹çš„RDMACMç¨‹åºï¼Œä»¥åŠåŸºäºRDMAçš„client-serverç¨‹åºçš„å®æˆ˜ï¼Œæ¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨RDMAæŠ€æœ¯ã€‚"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://cuterwrite-1302252842.file.myqcloud.com/img/20230725145210.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

        
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-W5PMS226XS"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-W5PMS226XS');
        </script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hue4d14694a57c01a222a16c47db12c89c_369633_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜‰</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">cuterwrite</a></h1>
            <h2 class="site-description">æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢ã€‚æˆ‘æ˜¯cuterwriteï¼Œä¸€ä¸ªçƒ­çˆ±ç”Ÿæ´»ã€ä¸æ–­æ¢ç´¢çš„äººã€‚åœ¨è¿™é‡Œï¼Œæˆ‘åˆ†äº«æˆ‘çš„æƒ³æ³•ã€ç»éªŒå’Œå­¦ä¹ ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°ä½ ï¼Œä¹Ÿæ¬¢è¿ä½ ä¸æˆ‘åˆ†äº«ä½ çš„çœ‹æ³•ã€‚</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/PKUcoldkeyboard'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.zhihu.com/people/kong-tiao-cheng-tai-lang-30-57'
                        target="_blank"
                        title="zhihu"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1692033650071" class="icon" viewBox="0 0 1280 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11696" xmlns:xlink="http://www.w3.org/1999/xlink" width="250" height="200"><path d="M341.08 296.26v435.08l46.86 0.02 15.42 52.74 84.02-52.74h99.06V296.26H341.08z m195.5 387.86h-55.88l-55.8 35.02-10.16-34.94-23.8-0.08V343.5h145.64v340.62z m-236.92-188.78H195c3.48-54.2 4.4-103.18 4.4-146.92h102.32s3.94-45.12-17.16-44.62h-177c6.98-26.24 15.74-53.32 26.24-81.34 0 0-48.14 0-64.54 43.14-6.78 17.8-26.42 86.28-61.4 156.24 11.78-1.28 50.74-2.36 73.68-44.42 4.22-11.78 5.02-13.32 10.28-29.06h57.74c0 21-2.4 133.76-3.36 146.88H41.66c-23.48 0-31.12 47.24-31.12 47.24h131.16C132.9 642.2 85.66 726.24 0 792.68c40.98 11.7 81.82-1.86 102-19.8 0 0 45.96-41.8 71.18-138.5l107.92 129.88s15.82-53.78-2.48-79.98c-15.16-17.84-56.12-66.12-73.58-83.62L175.8 623.9c8.72-27.96 13.98-55.1 15.74-81.34h123.3s-0.18-47.24-15.18-47.24v0.02z m824.04-3.2c41.66-51.28 89.96-117.14 89.96-117.14s-37.3-29.6-54.76-8.12c-12 16.3-73.66 96.4-73.66 96.4l38.46 28.86z m-300.18-118.18c-18.02-16.5-51.82 4.26-51.82 4.26s79.04 110.08 82.24 114.9l38.92-27.46s-51.34-75.22-69.32-91.72h-0.02zM1280 516.7c-39.56 0-261.82 1.86-262.12 1.86v-202c9.62 0 24.84-0.8 45.7-2.4 81.76-4.82 140.26-8 175.54-9.62 0 0 24.44-54.38-1.18-66.88-6.14-2.36-46.34 9.16-46.34 9.16s-330.44 32.98-464.72 36.1c3.2 17.64 15.24 34.16 31.56 39.1 26.62 6.96 45.38 3.4 98.3 1.78 49.66-3.2 87.36-4.86 113.02-4.86v199.62H702.82s5.64 44.62 51.02 45.7h215.88v141.84c0 27.94-22.38 43.98-48.96 42.24-28.16 0.22-52.16-2.3-83.38-3.62 3.98 7.94 12.66 28.78 38.62 43.68 19.76 9.62 32.34 13.14 52.04 13.14 59.12 0 91.34-34.56 89.78-90.62v-146.64h244.72c19.36 0 17.4-47.56 17.4-47.56l0.06-0.02z" p-id="11697"></path></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>é¦–é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ä¸ªäºº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>æ–‡ç« </span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



                
                <span>æ ‡ç­¾</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€libibverbsç®€ä»‹">ä¸€ã€libibverbsç®€ä»‹</a></li>
    <li><a href="#äºŒverbs-apiè¯¦è§£">äºŒã€Verbs APIè¯¦è§£</a>
      <ul>
        <li><a href="#1-ç®€ä»‹">1. ç®€ä»‹</a></li>
        <li><a href="#2-verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡">2. Verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡</a></li>
        <li><a href="#3-ä¸¤ä¸ªåŠ¨æ€åº“">3. ä¸¤ä¸ªåŠ¨æ€åº“</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰connection-manager">ä¸‰ã€Connection Manager</a>
      <ul>
        <li><a href="#1-è¿æ¥çš„å»ºç«‹">1. è¿æ¥çš„å»ºç«‹</a></li>
        <li><a href="#2-cmçš„æŠ½è±¡ç±»å‹rdmacm">2. CMçš„æŠ½è±¡ç±»å‹ï¼ˆRDMACMï¼‰</a></li>
      </ul>
    </li>
    <li><a href="#å››-rdmacmç¨‹åºè§£æè¢«åŠ¨æ–¹">å››ã€ RDMACMç¨‹åºè§£æâ€”â€”è¢«åŠ¨æ–¹</a>
      <ul>
        <li><a href="#1-åˆ›å»ºäº‹ä»¶channel">1. åˆ›å»ºäº‹ä»¶channel</a></li>
        <li><a href="#2-åˆ›å»ºè¿æ¥id">2. åˆ›å»ºè¿æ¥ID</a></li>
        <li><a href="#3-ç»‘å®šåœ°å€">3. ç»‘å®šåœ°å€</a></li>
        <li><a href="#4-åˆ›å»ºlistenerè¿”å›ç«¯å£åœ°å€">4. åˆ›å»ºListenerï¼Œè¿”å›ç«¯å£/åœ°å€</a></li>
        <li><a href="#5-ç­‰å¾…è¿æ¥è¯·æ±‚">5. ç­‰å¾…è¿æ¥è¯·æ±‚</a></li>
        <li><a href="#6-åˆ›å»ºpdcqå’Œsend-receive-qp">6. åˆ›å»ºPDã€CQå’ŒSend-Receive QP</a></li>
        <li><a href="#7-æœ€åçš„æ“ä½œ">7. æœ€åçš„æ“ä½œ</a></li>
      </ul>
    </li>
    <li><a href="#äº”-rdmacmç¨‹åºè§£æä¸»åŠ¨æ–¹">äº”ã€ RDMACMç¨‹åºè§£æâ€”â€”ä¸»åŠ¨æ–¹</a>
      <ul>
        <li><a href="#1-åˆ›å»ºäº‹ä»¶channel-1">1. åˆ›å»ºäº‹ä»¶channel</a></li>
        <li><a href="#2-åˆ›å»ºè¿æ¥id-1">2. åˆ›å»ºè¿æ¥ID</a></li>
        <li><a href="#3-ç»‘å®šåœ°å€-1">3. ç»‘å®šåœ°å€</a></li>
        <li><a href="#4-åˆ›å»ºqp">4. åˆ›å»ºQP</a></li>
        <li><a href="#5-è§£æè·¯ç”±">5. è§£æè·¯ç”±</a></li>
        <li><a href="#6-å»ºç«‹è¿æ¥">6. å»ºç«‹è¿æ¥</a></li>
        <li><a href="#7-æœ€åçš„æ“ä½œ-1">7. æœ€åçš„æ“ä½œ</a></li>
      </ul>
    </li>
    <li><a href="#å…­å®æˆ˜åŸºäºrdmaçš„client-serverç¨‹åº">å…­ã€å®æˆ˜ï¼šåŸºäºRDMAçš„client-serverç¨‹åº</a>
      <ul>
        <li><a href="#1-serverç«¯">1. serverç«¯</a></li>
        <li><a href="#2-clientç«¯">2. clientç«¯</a></li>
        <li><a href="#3-é¡¹ç›®å®ç°">3. é¡¹ç›®å®ç°</a></li>
        <li><a href="#4-è¡¥å……rdmaåº”ç”¨ç¨‹åºæ ‡å‡†æµç¨‹">4. è¡¥å……ï¼šRDMAåº”ç”¨ç¨‹åºæ ‡å‡†æµç¨‹</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/rdma-tutorial/2/">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20230725145210.png" loading="lazy" alt="Featured image of post RDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•ï¼ˆäºŒï¼‰ï¼šç¼–ç¨‹æŒ‡å¯¼" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E8%AE%A1%E7%AE%97/" style="background-color: #FFD06F; color: #fff;">
                é«˜æ€§èƒ½è®¡ç®—
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/rdma-tutorial/2/">RDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•ï¼ˆäºŒï¼‰ï¼šç¼–ç¨‹æŒ‡å¯¼</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            æœ¬æ–‡æ˜¯å…³äºRDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•çš„æŒ‡å¯¼ã€‚æ–‡ç« ä¸»è¦ä»‹ç»äº†libibverbsçš„ç®€ä»‹å’ŒVerbs APIçš„è¯¦è§£ï¼ŒåŒ…æ‹¬Verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡å’Œä¸¤ä¸ªåŠ¨æ€åº“ã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº†Connection Managerçš„å»ºç«‹è¿‡ç¨‹å’ŒæŠ½è±¡ç±»å‹RDMACMã€‚æœ€åï¼Œæ–‡ç« é€šè¿‡è§£æè¢«åŠ¨æ–¹å’Œä¸»åŠ¨æ–¹çš„RDMACMç¨‹åºï¼Œä»¥åŠåŸºäºRDMAçš„client-serverç¨‹åºçš„å®æˆ˜ï¼Œæ¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨RDMAæŠ€æœ¯ã€‚
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2023-07-27</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 12 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><strong>Table of Contents</strong>  <em>generated with <a class="link" href="https://github.com/thlorenz/doctoc"  target="_blank" rel="noopener"
    >DocToc</a></em></p>
<ul>
<li><a class="link" href="#rdma%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E7%BC%96%E7%A8%8B%E6%96%B9%E6%B3%95%E4%BA%8C%E7%BC%96%E7%A8%8B%E6%8C%87%E5%AF%BC" >RDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•ï¼ˆäºŒï¼‰ï¼šç¼–ç¨‹æŒ‡å¯¼</a>
<ul>
<li><a class="link" href="#%E4%B8%80libibverbs%E7%AE%80%E4%BB%8B" >ä¸€ã€libibverbsç®€ä»‹</a></li>
<li><a class="link" href="#%E4%BA%8Cverbs-api%E8%AF%A6%E8%A7%A3" >äºŒã€Verbs APIè¯¦è§£</a>
<ul>
<li><a class="link" href="#1-%E7%AE%80%E4%BB%8B" >1. ç®€ä»‹</a></li>
<li><a class="link" href="#2-verbs%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E5%B1%82%E6%AC%A1" >2. Verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡</a></li>
<li><a class="link" href="#3-%E4%B8%A4%E4%B8%AA%E5%8A%A8%E6%80%81%E5%BA%93" >3. ä¸¤ä¸ªåŠ¨æ€åº“</a></li>
</ul>
</li>
<li><a class="link" href="#%E4%B8%89connection-manager" >ä¸‰ã€Connection Manager</a>
<ul>
<li><a class="link" href="#1-%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B" >1. è¿æ¥çš„å»ºç«‹</a></li>
<li><a class="link" href="#2-cm%E7%9A%84%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%9E%8Brdmacm" >2. CMçš„æŠ½è±¡ç±»å‹ï¼ˆRDMACMï¼‰</a></li>
</ul>
</li>
<li><a class="link" href="#%E5%9B%9B-rdmacm%E7%A8%8B%E5%BA%8F%E8%A7%A3%E6%9E%90%E8%A2%AB%E5%8A%A8%E6%96%B9" >å››ã€ RDMACMç¨‹åºè§£æâ€”â€”è¢«åŠ¨æ–¹</a>
<ul>
<li><a class="link" href="#1-%E5%88%9B%E5%BB%BA%E4%BA%8B%E4%BB%B6channel" >1. åˆ›å»ºäº‹ä»¶channel</a></li>
<li><a class="link" href="#2-%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5id" >2. åˆ›å»ºè¿æ¥ID</a></li>
<li><a class="link" href="#3-%E7%BB%91%E5%AE%9A%E5%9C%B0%E5%9D%80" >3. ç»‘å®šåœ°å€</a></li>
<li><a class="link" href="#4-%E5%88%9B%E5%BB%BAlistener%E8%BF%94%E5%9B%9E%E7%AB%AF%E5%8F%A3%E5%9C%B0%E5%9D%80" >4. åˆ›å»ºListenerï¼Œè¿”å›ç«¯å£/åœ°å€</a></li>
<li><a class="link" href="#5-%E7%AD%89%E5%BE%85%E8%BF%9E%E6%8E%A5%E8%AF%B7%E6%B1%82" >5. ç­‰å¾…è¿æ¥è¯·æ±‚</a></li>
<li><a class="link" href="#6-%E5%88%9B%E5%BB%BApdcq%E5%92%8Csend-receive-qp" >6. åˆ›å»ºPDã€CQå’ŒSend-Receive QP</a></li>
<li><a class="link" href="#7-%E6%9C%80%E5%90%8E%E7%9A%84%E6%93%8D%E4%BD%9C" >7. æœ€åçš„æ“ä½œ</a></li>
</ul>
</li>
<li><a class="link" href="#%E4%BA%94-rdmacm%E7%A8%8B%E5%BA%8F%E8%A7%A3%E6%9E%90%E4%B8%BB%E5%8A%A8%E6%96%B9" >äº”ã€ RDMACMç¨‹åºè§£æâ€”â€”ä¸»åŠ¨æ–¹</a>
<ul>
<li><a class="link" href="#1-%E5%88%9B%E5%BB%BA%E4%BA%8B%E4%BB%B6channel-1" >1. åˆ›å»ºäº‹ä»¶channel</a></li>
<li><a class="link" href="#2-%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5id-1" >2. åˆ›å»ºè¿æ¥ID</a></li>
<li><a class="link" href="#3-%E7%BB%91%E5%AE%9A%E5%9C%B0%E5%9D%80-1" >3. ç»‘å®šåœ°å€</a></li>
<li><a class="link" href="#4-%E5%88%9B%E5%BB%BAqp" >4. åˆ›å»ºQP</a></li>
<li><a class="link" href="#5-%E8%A7%A3%E6%9E%90%E8%B7%AF%E7%94%B1" >5. è§£æè·¯ç”±</a></li>
<li><a class="link" href="#6-%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5" >6. å»ºç«‹è¿æ¥</a></li>
<li><a class="link" href="#7-%E6%9C%80%E5%90%8E%E7%9A%84%E6%93%8D%E4%BD%9C-1" >7. æœ€åçš„æ“ä½œ</a></li>
</ul>
</li>
<li><a class="link" href="#%E5%85%AD%E5%AE%9E%E6%88%98%E5%9F%BA%E4%BA%8Erdma%E7%9A%84client-server%E7%A8%8B%E5%BA%8F" >å…­ã€å®æˆ˜ï¼šåŸºäºRDMAçš„client-serverç¨‹åº</a>
<ul>
<li><a class="link" href="#1-server%E7%AB%AF" >1. serverç«¯</a></li>
<li><a class="link" href="#2-client%E7%AB%AF" >2. clientç«¯</a></li>
<li><a class="link" href="#3-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0" >3. é¡¹ç›®å®ç°</a></li>
</ul>
</li>
<li><a class="link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE" >å‚è€ƒæ–‡çŒ®</a></li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<h1 id="rdmaæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•äºŒç¼–ç¨‹æŒ‡å¯¼">RDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•ï¼ˆäºŒï¼‰ï¼šç¼–ç¨‹æŒ‡å¯¼</h1>
<h2 id="ä¸€libibverbsç®€ä»‹">ä¸€ã€libibverbsç®€ä»‹</h2>
<ul>
<li>libibverbsç”±Roland Dreierè‡ª2006å¹´å¼€å§‹å¼€å‘å’Œç»´æŠ¤ï¼Œå®é™…ä¸Šæ˜¯*nixä¸­çš„Verbs APIæ ‡å‡†
<ul>
<li>å¼€æº</li>
<li>Verbsçš„æ ¸å¿ƒéƒ¨åˆ†è‡ª2005å¹´èµ·é›†æˆåˆ°Linuxå†…æ ¸ä¸­&ndash;å†…æ ¸2.6.11</li>
<li>Inbox in several *nix distributions</li>
<li>ç›®å‰æœ‰å¤šä¸ªç¡¬ä»¶ä¾›åº”å•†æä¾›çš„çº§åˆ«è¾ƒä½çš„åº“</li>
</ul>
</li>
<li>å¯¹æ‰€æœ‰å¯ç”¨RDMAçš„ä¼ è¾“åè®®ä½¿ç”¨ç›¸åŒçš„API
<ul>
<li><strong>InfiniBand</strong>ï¼š æ”¯æŒRDMAçš„ç½‘ç»œä½“ç³»ç»“æ„
<ul>
<li>éœ€è¦æ”¯æŒå®ƒçš„ç½‘å¡å’ŒInfiniBandäº¤æ¢æœºã€‚</li>
</ul>
</li>
<li><strong>RoCE</strong>ï¼šåŸºäºä»¥å¤ªç½‘/IPå¸§çš„RDMAæ•°æ®åŒ…å°è£…
<ul>
<li>éœ€è¦æ”¯æŒå®ƒçš„ç½‘å¡å’Œæ ‡å‡†ä»¥å¤ªç½‘äº¤æ¢æœº</li>
</ul>
</li>
<li><strong>iWARP</strong>ï¼šæä¾›åŸºäºæµæ§åˆ¶ä¼ è¾“åè®®(SCTP)å’Œä¼ è¾“æ§åˆ¶åè®®(TCP)çš„RDMA
<ul>
<li>éœ€è¦æ”¯æŒå®ƒçš„ç½‘å¡å’Œæ ‡å‡†ä»¥å¤ªç½‘äº¤æ¢æœº</li>
</ul>
</li>
</ul>
</li>
<li>libibverbsæ˜¯å®Œå…¨çº¿ç¨‹å®‰å…¨çš„
<ul>
<li>libibverbsæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
<li>ç”¨æˆ·æ€ç©ºé—´ä½çº§é©±åŠ¨ç¨‹åºåº“ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
<li>åº”ç”¨ç¨‹åºå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨RDMAèµ„æº</li>
</ul>
</li>
</ul>



<div class="notice notice-warning" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 576 512"><path d="M570 440c18 32-5 72-42 72H48c-37 0-60-40-42-72L246 24c19-32 65-32 84 0l240 416zm-282-86a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>é”€æ¯ä¸€ä¸ªçº¿ç¨‹ä¸­çš„èµ„æºå¹¶åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨å®ƒå°†å¯¼è‡´segmentation faultï¼Œè¿™ä¸ªé—®é¢˜åœ¨éå¤šçº¿ç¨‹ä»£ç ä¸­ä¹Ÿä¼šå‘ç”Ÿ</p></div>

<ul>
<li>ä½¿ç”¨libibverbsçš„åŸºæœ¬é¡»çŸ¥
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">tips</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å¤´æ–‡ä»¶å¼•å…¥</td>
<td style="text-align:left">#include&lt;infiniband/verbs.h&gt;</td>
</tr>
<tr>
<td style="text-align:left">ç¼–è¯‘æ—¶é“¾æ¥</td>
<td style="text-align:left">-libverbs</td>
</tr>
<tr>
<td style="text-align:left">æ‰€æœ‰çš„input structureséœ€è¦ä¸ºzeroed</td>
<td style="text-align:left">ä½¿ç”¨memset()æˆ–ç»“æ„åˆå§‹åŒ–ã€å¦‚æœè¯¥structureæœ‰æ‰©å……çš„éœ€æ±‚ï¼Œåˆ™é›¶å€¼å°†ä¿ç•™é—ç•™è¡Œä¸º</td>
</tr>
<tr>
<td style="text-align:left">å¤§å¤šæ•°èµ„æºå¥æŸ„éƒ½æ˜¯æŒ‡é’ˆï¼Œå› æ­¤ä½¿ç”¨é”™è¯¯çš„å¥æŸ„å¯èƒ½ä¼šå¯¼è‡´åˆ†æ®µé”™è¯¯</td>
<td style="text-align:left">ä½¿ç”¨NULLæ£€æŸ¥å¥æŸ„</td>
</tr>
<tr>
<td style="text-align:left">è¿”å›æŒ‡é’ˆçš„VerbsæˆåŠŸæ—¶è¿”å›æœ‰æ•ˆå€¼ï¼Œå¤±è´¥æ—¶è¿”å›NULL</td>
<td style="text-align:left">æ£€æŸ¥è¿”å›å€¼</td>
</tr>
<tr>
<td style="text-align:left">è¿”å›æ•´å½¢å˜é‡çš„Verbså¦‚æœæˆåŠŸåˆ™è¿”å›é›¶ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›-1æˆ–errno</td>
<td style="text-align:left">æ£€æŸ¥è¿”å›å€¼</td>
</tr>
</tbody>
</table></div>
</li>
</ul>
<h2 id="äºŒverbs-apiè¯¦è§£">äºŒã€Verbs APIè¯¦è§£</h2>
<h3 id="1-ç®€ä»‹">1. ç®€ä»‹</h3>
<ul>
<li>åœ¨å†…æ ¸å’Œç”¨æˆ·æ€ç©ºé—´å‡å¯ä½¿ç”¨</li>
<li>Verbsä¸­çš„ç±»
<ul>
<li>èµ„æºç®¡ç†ï¼šQpsã€CQsã€SRQsç­‰ç­‰</li>
<li>WRå¤„ç†ï¼špost send, è½®è¯¢CQç­‰ç­‰</li>
<li>å†…å­˜æ³¨å†Œ</li>
<li>åœ°å€å¥æŸ„</li>
</ul>
</li>
<li>Verbsä¸­çš„æ“ä½œ
<ul>
<li>Deviceæ“ä½œ</li>
<li>ä¸Šä¸‹æ–‡æ“ä½œ</li>
<li>PDæ“ä½œ</li>
<li>QP bringup</li>
<li>æ´»è·ƒQPæ“ä½œ</li>
</ul>
</li>
</ul>
<h3 id="2-verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡">2. Verbså¯¹è±¡åˆ›å»ºå±‚æ¬¡</h3>
<ol>
<li>è·å–devideåˆ—è¡¨</li>
<li>æ‰“å¼€è¯·æ±‚çš„device</li>
<li>æŸ¥è¯¢deviceåŠŸèƒ½</li>
<li>åˆ†é…PDå†…å­˜ç©ºé—´</li>
<li>æ³¨å†Œå†…å­˜åŸŸMR</li>
<li>å…³è”å¹¶åˆ›å»ºå®Œæˆé˜Ÿåˆ—CQ</li>
<li>åˆ›å»ºQP</li>
<li>Bring up a QP</li>
<li>Post WRå¹¶ä¸”è½®è¯¢CQ</li>
<li>æ¸…ç†èµ„æº
<img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20230724235009.png"
	
	
	
	loading="lazy"
	
		alt="20230724235009"
	
	
></li>
</ol>
<p><img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20230724235116.png"
	
	
	
	loading="lazy"
	
		alt="20230724235116"
	
	
></p>
<h3 id="3-ä¸¤ä¸ªåŠ¨æ€åº“">3. ä¸¤ä¸ªåŠ¨æ€åº“</h3>
<ul>
<li>libibverbs.so
<ul>
<li>ç”¨äºç›´æ¥é€šè¿‡ç”¨æˆ·æ€ç©ºé—´è®¿é—®InfiniBandç¡¬ä»¶çš„åº“</li>
<li>Infiniband(æ ¹æ®Infinibandè§„èŒƒ)å’ŒiWarp(iWARPåŠ¨è¯è§„èŒƒ)çš„RDMA Verbsçš„å®ç°</li>
<li>å®ƒå¤„ç†åˆ›å»ºã€ä¿®æ”¹ã€æŸ¥è¯¢å’Œé”€æ¯èµ„æºçš„æ§åˆ¶è·¯å¾„ï¼Œå¦‚ä¿æŠ¤åŸŸ(PD)ã€å®Œæˆé˜Ÿåˆ—(CQ)ã€é˜Ÿåˆ—å¯¹(QP)ã€å…±äº«æ¥æ”¶é˜Ÿåˆ—(SRQ)ã€åœ°å€å¥æŸ„(AH)ã€å†…å­˜åŒºåŸŸ(MR)</li>
<li>å®ƒè¿˜å¤„ç†å‘é€å’Œæ¥æ”¶å‘å¸ƒåˆ°QPSå’ŒSRQçš„æ•°æ®ï¼Œä½¿ç”¨è½®è¯¢å’Œå®Œæˆäº‹ä»¶ä»CQsè·å–å®Œæˆ</li>
</ul>
</li>
<li>librdmacm.so
<ul>
<li>ç”¨æˆ·æ€ç©ºé—´çš„RDMAè¿æ¥ç®¡ç†å™¨</li>
<li>ä½¿ç”¨Socketè¯­ä¹‰çš„RDMA(InfiniBandã€ROCEå’ŒiWARP)é€šä¿¡ç®¡ç†åº“</li>
</ul>
</li>
</ul>
<h2 id="ä¸‰connection-manager">ä¸‰ã€Connection Manager</h2>
<h3 id="1-è¿æ¥çš„å»ºç«‹">1. è¿æ¥çš„å»ºç«‹</h3>
<ul>
<li>
<p>åŸºäºInfinibandé€šä¿¡ç®¡ç†(CM)åè®®ï¼ˆåœ¨é€šç”¨æœåŠ¡æ¥å£(GSI)ä¸Šå®šä¹‰çš„åè®®QPï¼šQP1ï¼‰</p>
</li>
<li>
<p>æä¾›ä»¥ä¸‹æœåŠ¡</p>
<ul>
<li>åœ¨å¯¹ç­‰RCå’ŒQPä¹‹é—´äº¤æ¢å¿…è¦çš„å‚æ•°ï¼Œä½¿å®ƒä»¬ä¸ºé€šä¿¡åšå¥½å‡†å¤‡
<ul>
<li>åˆå§‹åŒ–å™¨è¯·æ±‚è¿æ¥åˆ°è¿œç¨‹ä¸Šçš„æœåŠ¡IDï¼ˆæœåŠ¡IDæ˜ å°„ï¼‰</li>
<li>ç±»TCPæ¡æ‰‹ï¼šè¯·æ±‚/å“åº”/å³ç”¨æ¶ˆæ¯</li>
</ul>
</li>
<li>æŸ¥æ‰¾ç»™å®šæœåŠ¡IDçš„è¿œç¨‹UDå’ŒQPåºå·
<ul>
<li>æœåŠ¡IDè¯·æ±‚/å“åº”æ¶ˆæ¯</li>
</ul>
</li>
<li>åŠ è½½å¤‡ç”¨è·¯å¾„</li>
</ul>
</li>
<li>
<p>è¿æ¥ç®¡ç†å™¨ï¼ˆConnection Managerï¼ŒCMï¼‰æ˜¯ä¸€ä¸ªç”¨æˆ·æ€ç©ºé—´çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé€šç”¨çš„æ¥å£ï¼Œç”¨äºåœ¨RDMAç½‘ç»œä¸­å»ºç«‹è¿æ¥ã€‚å®ƒå¯ä»¥ç”¨äºå»ºç«‹è¿æ¥ï¼Œä¹Ÿå¯ä»¥ç”¨äºæŸ¥æ‰¾è¿œç¨‹QPçš„åœ°å€ï¼Œä»¥ä¾¿åœ¨ä¸å»ºç«‹è¿æ¥çš„æƒ…å†µä¸‹å‘é€æ•°æ®ã€‚</p>
<ul>
<li>éœ€è¦åœ¨å¯¹ç­‰QPä¹‹é—´äº¤æ¢ä¿¡æ¯</li>
<li>è´Ÿè´£RCã€UCã€RDè¿æ¥çš„å»ºç«‹</li>
<li>åº”ç”¨ç¨‹åºä½¿ç”¨SAæ¥è·å–å…¶ä»–ä¿¡æ¯(ä¾‹å¦‚è·¯å¾„è®°å½•)</li>
<li>SIDRç”¨äºUD</li>
</ul>
</li>
</ul>
<h3 id="2-cmçš„æŠ½è±¡ç±»å‹rdmacm">2. CMçš„æŠ½è±¡ç±»å‹ï¼ˆRDMACMï¼‰</h3>
<ul>
<li>ç±»ä¼¼äºSocketè¿æ¥æ¨¡å¼çš„è¯­ä¹‰</li>
<li>å¯¹IBå’ŒROCEéƒ½ä½¿ç”¨åŸºäºIPçš„å¯»å€æ¨¡å¼</li>
</ul>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">ç±»</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>rdma_create/destroy_id</strong></td>
<td style="text-align:left">creates/destroys a connection identifier (equivalent to a socket)</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_create/destroy_qp</strong></td>
<td style="text-align:left">allocate/destroy a qp for communication</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_bind_addr</strong></td>
<td style="text-align:left">set local port to listen on</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_resolve_addr</strong></td>
<td style="text-align:left">obtain local RDMA device to reach remote address</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_resolve_route</strong></td>
<td style="text-align:left">determine route to remote address</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_get_src_port</strong></td>
<td style="text-align:left">query local port</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_get_local_addr</strong></td>
<td style="text-align:left">query local ip</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_get_peer_addr</strong></td>
<td style="text-align:left">query remote ip</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_connect/disconnect</strong></td>
<td style="text-align:left">connect/disconnect rc qps, or resolve service id to qp for ud qps</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_listen</strong></td>
<td style="text-align:left">listen for incoming connections</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_accept/reject</strong></td>
<td style="text-align:left">accept/reject incoming connection requests</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_create/destroy_event_channel</strong></td>
<td style="text-align:left">allocate/destroy an event channel</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_get_cm_event</strong></td>
<td style="text-align:left">get next event</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_ack_cm_event</strong></td>
<td style="text-align:left">acknowledge event(s) to rdmacm</td>
</tr>
<tr>
<td style="text-align:left"><strong>rdma_join/leave_multicast</strong></td>
<td style="text-align:left">join/leave multicast addresses</td>
</tr>
</tbody>
</table></div>
<ul>
<li>ä½¿ç”¨rdmacmçš„åŸºæœ¬é¡»çŸ¥
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">tips</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å¤´æ–‡ä»¶å¼•å…¥</td>
<td style="text-align:left">#include&lt;rdma/rdma_cma.h&gt;</td>
</tr>
<tr>
<td style="text-align:left">ç¼–è¯‘æ—¶é“¾æ¥</td>
<td style="text-align:left">-lrdmacm</td>
</tr>
</tbody>
</table></div>
</li>
</ul>
<h2 id="å››-rdmacmç¨‹åºè§£æè¢«åŠ¨æ–¹">å››ã€ RDMACMç¨‹åºè§£æâ€”â€”è¢«åŠ¨æ–¹</h2>
<p>æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºäº‹ä»¶channelï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ¥æ”¶rdmacmäº‹ä»¶ï¼Œå¦‚è¿æ¥è¯·æ±‚å’Œè¿æ¥å»ºç«‹é€šçŸ¥ã€‚</li>
<li>åˆ›å»ºè¿æ¥IDå¹¶ç»‘å®šåˆ°åœ°å€ã€‚</li>
<li>åˆ›å»ºListenerå¹¶è¿”å›ç«¯å£/åœ°å€ã€‚</li>
<li>ç­‰å¾…è¿æ¥è¯·æ±‚</li>
<li>åˆ›å»ºPDã€CQå’ŒSend-Receive QP</li>
<li>æ¥å—è¿æ¥è¯·æ±‚</li>
<li>ç­‰å¾…å»ºç«‹è¿æ¥</li>
<li>è§†æƒ…å†µå‘å¸ƒæ“ä½œ</li>
</ol>
<h3 id="1-åˆ›å»ºäº‹ä»¶channel">1. åˆ›å»ºäº‹ä»¶channel</h3>
<ul>
<li>æ‰“å¼€ç”¨äºæŠ¥å‘Šé€šä¿¡äº‹ä»¶çš„channelã€‚å¼‚æ­¥äº‹ä»¶å°†é€šè¿‡äº‹ä»¶channelæŠ¥å‘Šç»™ç”¨æˆ·ï¼Œå¯¹åº”æ–¹æ³•ä¸º<code>struct rdma_event_channel * rdma_create_event_channel(void)</code>ã€‚</li>
<li>äº‹ä»¶channelç”¨äºå®šå‘rdma_cm_idä¸Šçš„æ‰€æœ‰äº‹ä»¶ã€‚å¯¹äºè®¸å¤šå®¢æˆ·ç«¯æ¥è¯´ï¼Œå•ä¸ªäº‹ä»¶channelå¯èƒ½å°±è¶³å¤Ÿäº†ï¼Œç„¶è€Œï¼Œå½“ç®¡ç†å¤§é‡çš„è¿æ¥æˆ–cm_idæ—¶ï¼Œç”¨æˆ·å¯èƒ½ä¼šå‘ç°å°†ä¸åŒcm_idçš„äº‹ä»¶å®šå‘åˆ°ä¸åŒçš„channelè¿›è¡Œå¤„ç†æ˜¯æœ‰ç”¨çš„ã€‚</li>
<li>å¿…é¡»é€šè¿‡è°ƒç”¨<code>rdma_destroy_event_channel</code>é”€æ¯æ‰€æœ‰åˆ›å»ºçš„äº‹ä»¶channelã€‚ç”¨æˆ·åº”è¯¥è°ƒç”¨<code>rdma_get_cm_event</code>æ¥æ£€ç´¢äº‹ä»¶channelä¸Šçš„äº‹ä»¶ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">rdma_event_channel</span> <span class="o">*</span><span class="n">channel</span> <span class="o">=</span> <span class="nf">rdma_create_event_channel</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">channel</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;rdma_create_event_channel&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">rdma_cm_event</span><span class="o">*</span> <span class="n">event</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ­¤å¤„ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="nf">rdma_get_cm_event</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;rdma_get_cm_event&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸­é—´å¤„ç†ä»£ç ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">rdma_destroy_event_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ¯ä¸ªäº‹ä»¶channeléƒ½æ˜ å°„åˆ°ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å¯ä»¥åƒä½¿ç”¨å’Œæ“ä½œä»»ä½•å…¶ä»–FDä¸€æ ·ä½¿ç”¨å’Œæ“ä½œå…³è”çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥æ›´æ”¹å…¶è¡Œä¸ºã€‚</li>
</ul>
<h3 id="2-åˆ›å»ºè¿æ¥id">2. åˆ›å»ºè¿æ¥ID</h3>
<ul>
<li>åˆ›å»ºç”¨äºè·Ÿè¸ªé€šä¿¡ä¿¡æ¯çš„æ ‡è¯†ç¬¦ï¼Œå¯¹åº”æ–¹æ³•ä¸º<code>int rdma_create_id(struct rdma_event_channel *channel, struct rdma_cm_id **id, void *context, enum rdma_port_space ps)</code>ã€‚</li>
<li>è¾“å…¥å‚æ•°ï¼š
<ul>
<li>channelï¼šäº‹ä»¶channel</li>
<li>idï¼šæŒ‡å‘rdma_cm_idæŒ‡é’ˆçš„æŒ‡é’ˆï¼Œç”¨äºè¿”å›æ–°åˆ›å»ºçš„rdma_cm_id</li>
<li>contextï¼šç”¨æˆ·ä¸Šä¸‹æ–‡ï¼Œå°†åœ¨äº‹ä»¶ä¸­è¿”å›ç»™ç”¨æˆ·</li>
<li>psï¼šRDMAç«¯å£ç©ºé—´ï¼ŒæŒ‡å®šè¦ä½¿ç”¨çš„ç«¯å£ç©ºé—´</li>
</ul>
</li>
<li>rdma_cm_idåœ¨æ¦‚å¿µä¸Šç­‰åŒäºç”¨äºRDMAé€šä¿¡çš„å¥—æ¥å­—ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼ŒRDMAé€šä¿¡éœ€è¦æ˜¾å¼ç»‘å®šåˆ°æŒ‡å®šçš„RDMAè®¾å¤‡ï¼Œç„¶åæ‰èƒ½è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”å¤§å¤šæ•°æ“ä½œæœ¬è´¨ä¸Šæ˜¯å¼‚æ­¥çš„ã€‚</li>
<li>ç«¯å£ç©ºé—´
<ul>
<li>RDMA_PS_TCPï¼šæä¾›å¯é ã€é¢å‘è¿æ¥çš„QPé€šä¿¡ã€‚ä¸TCPä¸åŒï¼ŒRDMAç«¯å£ç©ºé—´æä¾›åŸºäºæ¶ˆæ¯çš„é€šä¿¡ï¼Œè€Œä¸æ˜¯åŸºäºæµçš„é€šä¿¡ã€‚</li>
<li>RDMA_PS_UDPï¼šæä¾›ä¸å¯é ã€æ— è¿æ¥çš„QPé€šä¿¡ã€‚æ”¯æŒæ•°æ®æŠ¥å’Œç»„æ’­é€šä¿¡ã€‚</li>
</ul>
</li>
<li>é”€æ¯ï¼šåœ¨è°ƒç”¨æ­¤å‡½æ•°å¹¶ç¡®è®¤ç›¸å…³äº‹ä»¶ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»é‡Šæ”¾ä»»ä½•ä¸rdma_cm_idç›¸å…³çš„QPã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">rdma_cm_id</span> <span class="o">*</span><span class="n">listen_id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="nf">rdma_create_id</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">listen_id</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">RDMA_PS_TCP</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;rdma_create_id&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸­é—´å¤„ç†ä»£ç ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">rdma_destroy_id</span><span class="p">(</span><span class="n">listen_id</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-ç»‘å®šåœ°å€">3. ç»‘å®šåœ°å€</h3>
<ul>
<li>å°†æºåœ°å€ä¸rdma_cm_idç›¸å…³è”ã€‚å¯¹åº”æ–¹æ³•ä¸º<code>int rdma_bind_addr(struct rdma_cm_id *id, struct sockaddr *addr)</code>ã€‚
<ul>
<li>åœ°å€ä¸­å¯ä»¥åŒ…å«é€šé…ç¬¦ã€‚</li>
<li>å¦‚æœç»‘å®šåˆ°ç‰¹å®šæœ¬åœ°åœ°å€ï¼Œåˆ™rdma_cm_idä¹Ÿå°†ç»‘å®šåˆ°æœ¬åœ°RDMAè®¾å¤‡ã€‚</li>
<li>é€šå¸¸ï¼Œåœ¨è°ƒç”¨<code>rdma_listen</code>ä»¥ç»‘å®šåˆ°ç‰¹å®šç«¯å£å·ä¹‹å‰è°ƒç”¨æ­¤å‡½æ•°ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨<code>rdma_resolve_addr</code>ä»¥ç»‘å®šåˆ°ç‰¹å®šåœ°å€ä¹‹å‰åœ¨ä¸»åŠ¨æ–¹è°ƒç”¨è¯¥å‡½æ•°ã€‚</li>
<li>å¦‚æœç”¨äºç»‘å®šåˆ°ç«¯å£0ï¼Œrdma_cmå°†é€‰æ‹©ä¸€ä¸ªå¯ç”¨ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨<code>rdma_get_src_port</code>æ£€ç´¢è¯¥ç«¯å£ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/*  sockaddr_inæ˜¯IPV4çš„åœ°å€ç»“æ„ä½“
</span></span></span><span class="line"><span class="cl"><span class="cm">*   AF_INETï¼šIPV4
</span></span></span><span class="line"><span class="cl"><span class="cm">*   htonsï¼šå°†ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼ˆå°ç«¯å­˜å‚¨ï¼‰, 20079æ˜¯ç«¯å£å·
</span></span></span><span class="line"><span class="cl"><span class="cm">*   INADDR_ANYï¼šè¡¨ç¤ºä»»æ„åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="nf">htons</span><span class="p">(</span><span class="mi">20079</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">sin_addr</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">INADDR_ANY</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">err</span> <span class="o">=</span> <span class="nf">rdma_bind_addr</span><span class="p">(</span><span class="n">listen_id</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;rdma_bind_addr&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-åˆ›å»ºlistenerè¿”å›ç«¯å£åœ°å€">4. åˆ›å»ºListenerï¼Œè¿”å›ç«¯å£/åœ°å€</h3>
<ul>
<li>åˆå§‹åŒ–ä¼ å…¥è¿æ¥è¯·æ±‚æˆ–æ•°æ®æŠ¥æœåŠ¡æŸ¥æ‰¾çš„Listenerã€‚å¯¹åº”æ–¹æ³•ä¸º<code>int rdma_listen(struct rdma_cm_id *id, int backlog)</code>ã€‚
<ul>
<li>ä¾¦å¬å°†è¢«é™åˆ¶ä¸ºæœ¬åœ°ç»‘å®šæºåœ°å€</li>
<li>åœ¨è°ƒç”¨æ­¤å‡½æ•°ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»å·²é€šè¿‡è°ƒç”¨<code>rdma_bind_addr</code>å°†<code>rdma_cm_id</code>ç»‘å®šåˆ°æœ¬åœ°åœ°å€ã€‚</li>
<li>å¦‚æœ<code>rdma_cm_id</code>ç»‘å®šåˆ°ç‰¹å®šçš„IPåœ°å€ï¼Œåˆ™ä¾¦å¬å°†ä»…é™äºè¯¥åœ°å€å’Œå…³è”çš„RDMAè®¾å¤‡ã€‚</li>
<li>å¦‚æœ<code>rdma_cm_id</code>ä»…ç»‘å®šåˆ°RDMAç«¯å£å·ï¼Œåˆ™å°†åœ¨æ‰€æœ‰RDMAè®¾å¤‡ä¸Šè¿›è¡Œä¾¦å¬ã€‚</li>
</ul>
</li>
<li>è¿”å›å·²ç»‘å®šåˆ°æœ¬åœ°åœ°å€çš„<code>rdma_cm_id</code>çš„æœ¬åœ°ç«¯å£å·ã€‚å¯¹åº”æ–¹æ³•ä¸º<code>uint16_t rdma_get_src_port(struct rdma_cm_id *id)</code>ã€‚</li>
<li>è¿”å›å·²ç»‘å®šåˆ°æœ¬åœ°è®¾å¤‡çš„<code>rdma_cm_id</code>çš„æœ¬åœ°IPåœ°å€ã€‚å¯¹åº”æ–¹æ³•ä¸º<code>struct sockaddr * rdma_get_local_addr(struct rdma_cm_id *id)</code>ã€‚</li>
<li>è§£æç›®çš„èŠ‚ç‚¹å’ŒæœåŠ¡åœ°å€ï¼Œå¹¶è¿”å›å»ºç«‹é€šä¿¡æ‰€éœ€çš„ä¿¡æ¯ã€‚æä¾›ä¸getaddrinfoç­‰æ•ˆçš„RDMAåŠŸèƒ½(é…åˆ<code>rdma_create_ep</code>ä½¿ç”¨)ã€‚å¯¹åº”æ–¹æ³•ä¸º<code>int rdma_getaddrinfo (char *node, char *service, struct rdma_addrinfo *hints, struct rdma_addrinfo **res)</code>ã€‚
<ul>
<li>node: å¯é€‰ï¼Œç›®çš„èŠ‚ç‚¹çš„ä¸»æœºåï¼Œæˆ–è€…ç‚¹åˆ†åè¿›åˆ¶çš„IPv4/IPv6åå…­è¿›åˆ¶åœ°å€</li>
<li>serviceï¼šåœ°å€çš„æœåŠ¡åç§°æˆ–ç«¯å£å·ã€‚</li>
<li>hintsï¼šä¸€ä¸ªåŒ…å«æœ‰å…³è°ƒç”¨æ–¹æ”¯æŒçš„æœåŠ¡ç±»å‹çš„æç¤ºçš„rdma_addrinfoç»“æ„çš„å¼•ç”¨ã€‚</li>
<li>resï¼šæŒ‡å‘åŒ…å«å“åº”ä¿¡æ¯çš„rdma_addrinfoç»“æ„çš„LinkedListçš„æŒ‡é’ˆã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// ç­‰å¾…è¿æ¥è¯·æ±‚çš„æœ€å¤§æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">backlog</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">err</span> <span class="o">=</span> <span class="nf">rdma_listen</span><span class="p">(</span><span class="n">listen_id</span><span class="p">,</span> <span class="n">backlog</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;rdma_listen&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">uint16_t</span> <span class="n">port</span> <span class="o">=</span> <span class="nf">rdma_get_src_port</span><span class="p">(</span><span class="n">listen_id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">port</span> <span class="o">=</span> <span class="nf">ntohs</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">printf</span><span class="p">(</span><span class="s">&#34;listening on port %u.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">port</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">local_addr</span> <span class="o">=</span> <span class="nf">rdma_get_local_addr</span><span class="p">(</span><span class="n">listen_id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">local_addr</span><span class="o">-&gt;</span><span class="n">sa_family</span> <span class="o">==</span> <span class="n">AF_INET</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="n">sin</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">)</span><span class="n">local_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">ip</span><span class="p">[</span><span class="n">INET_ADDRSTRLEN</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// éœ€è¦åŠ ä¸Šå¤´æ–‡ä»¶ #include &lt;arpa/inet.h&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">inet_ntop</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">sin</span><span class="o">-&gt;</span><span class="n">sin_addr</span><span class="p">),</span> <span class="n">ip</span><span class="p">,</span> <span class="n">INET_ADDRSTRLEN</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Local IP address is: %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ip</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Local port is: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">ntohs</span><span class="p">(</span><span class="n">sin</span><span class="o">-&gt;</span><span class="n">sin_port</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">rdma_addrinfo</span> <span class="n">hints</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nf">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hints</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">hints</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">hints</span><span class="p">.</span><span class="n">ai_flags</span> <span class="o">=</span> <span class="n">RAI_PASSIVE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">hints</span><span class="p">.</span><span class="n">ai_port_space</span> <span class="o">=</span> <span class="n">RDMA_PS_TCP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">rdma_addrinfo</span> <span class="o">*</span><span class="n">res</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">err</span> <span class="o">=</span> <span class="nf">rdma_getaddrinfo</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&#34;20079&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hints</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;rdma_getaddrinfo&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// do something with struct rdma_addrinfo *cur = res...
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-ç­‰å¾…è¿æ¥è¯·æ±‚">5. ç­‰å¾…è¿æ¥è¯·æ±‚</h3>
<ul>
<li>æ£€ç´¢é€šä¿¡äº‹ä»¶ã€‚å¦‚æœæ²¡æœ‰æŒ‚èµ·çš„äº‹ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒç”¨å°†é˜»å¡ï¼Œç›´åˆ°æ¥æ”¶åˆ°äº‹ä»¶ã€‚å¯¹åº”æ–¹æ³•ä¸º<code>int rdma_get_cm_event(struct rdma_event_channel *channel, struct rdma_cm_event **event)</code>ã€‚</li>
<li>é€šè¿‡ä¿®æ”¹ä¸ç»™å®šé€šé“ç›¸å…³è”çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥æ›´æ”¹æ­¤å‡½æ•°çš„é»˜è®¤åŒæ­¥è¡Œä¸ºã€‚</li>
<li>æ‰€æœ‰æŠ¥å‘Šçš„äº‹ä»¶éƒ½å¿…é¡»é€šè¿‡è°ƒç”¨<code>rdma_ack_cm_event</code>è¿›è¡Œç¡®è®¤ã€‚</li>
<li><code>rdma_cm_id</code> çš„é”€æ¯å°†è¢«é˜»å¡ï¼Œç›´åˆ°ç›¸å…³äº‹ä»¶è¢«ç¡®è®¤ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">rdma_cm_event</span><span class="o">*</span> <span class="n">event</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ­¤å¤„ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">err</span> <span class="o">=</span> <span class="nf">rdma_get_cm_event</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-åˆ›å»ºpdcqå’Œsend-receive-qp">6. åˆ›å»ºPDã€CQå’ŒSend-Receive QP</h3>
<ul>
<li>åˆ†é…ä¸æŒ‡å®šçš„<code>rdma_cm_id</code>ç›¸å…³è”çš„QPï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºç”¨äºå‘é€å’Œæ¥æ”¶ã€‚å¯¹åº”æ–¹æ³•ä¸º<code>int rdma_create_qp(struct rdma_cm_id *id, struct ibv_pd *pd, struct ibv_qp_init_attr *qp_init_attr)</code>ã€‚</li>
<li>åœ¨è°ƒç”¨æ­¤å‡½æ•°ä¹‹å‰ï¼Œ<code>rdma_cm_id</code>å¿…é¡»ç»‘å®šåˆ°æœ¬åœ°RDMAè®¾å¤‡ï¼Œä¸”ä¿æŠ¤åŸŸPDå¿…é¡»ç”¨äºåŒä¸€è®¾å¤‡ã€‚</li>
<li>è¢«åˆ†é…ç»™<code>rdma_cm_id</code>çš„QPä¼šç”± librdmacm è‡ªåŠ¨è½¬æ¢çŠ¶æ€.</li>
<li>åˆ†é…å®Œæ¯•åï¼ŒQP å°†å‡†å¤‡å°±ç»ªï¼Œå¤„ç†æ¥æ”¶ä¿¡æ¯çš„å‘å¸ƒã€‚å¦‚æœ QP æœªè¿æ¥ï¼Œå®ƒå°†å‡†å¤‡å¥½å‘å¸ƒå‘é€ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">pd</span> <span class="o">=</span> <span class="nf">ibv_alloc_pd</span><span class="p">(</span><span class="n">cm_client_id</span><span class="o">-&gt;</span><span class="n">verbs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Failed to allocate a protection domain&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io_completion_channel</span> <span class="o">=</span> <span class="nf">ibv_create_comp_channel</span><span class="p">(</span><span class="n">cm_client_id</span><span class="o">-&gt;</span><span class="n">verbs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io_completion_channel</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Failed to create an I/O completion event channel&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cq</span> <span class="o">=</span> <span class="nf">ibv_create_cq</span><span class="p">(</span><span class="n">cm_client_id</span><span class="o">-&gt;</span><span class="n">verbs</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">io_completion_channel</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cq</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Failed to create a completion queue&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="nf">ibv_req_notify_cq</span><span class="p">(</span><span class="n">cq</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Failed to request notifications&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">bzero</span><span class="p">(</span><span class="o">&amp;</span><span class="n">qp_init_attr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">qp_init_attr</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">qp_init_attr</span><span class="p">.</span><span class="n">qp_type</span> <span class="o">=</span> <span class="n">IBV_QPT_RC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">qp_init_attr</span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">max_send_wr</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">qp_init_attr</span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">max_recv_wr</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">qp_init_attr</span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">max_send_sge</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">qp_init_attr</span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">max_recv_sge</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">qp_init_attr</span><span class="p">.</span><span class="n">send_cq</span> <span class="o">=</span> <span class="n">cq</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">qp_init_attr</span><span class="p">.</span><span class="n">recv_cq</span> <span class="o">=</span> <span class="n">cq</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="nf">rdma_create_qp</span><span class="p">(</span><span class="n">cm_client_id</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qp_init_attr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Failed to create QP&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client_qp</span> <span class="o">=</span> <span class="n">cm_client_id</span><span class="o">-&gt;</span><span class="n">qp</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7-æœ€åçš„æ“ä½œ">7. æœ€åçš„æ“ä½œ</h3>
<ol>
<li>Acceptè¯·æ±‚è¿æ¥</li>
<li>ç­‰å¾…è¿æ¥å»ºç«‹</li>
<li>å‘å¸ƒæ“ä½œ</li>
</ol>
<p><img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20230725224928.png"
	
	
	
	loading="lazy"
	
		alt="20230725224928"
	
	
></p>
<h2 id="äº”-rdmacmç¨‹åºè§£æä¸»åŠ¨æ–¹">äº”ã€ RDMACMç¨‹åºè§£æâ€”â€”ä¸»åŠ¨æ–¹</h2>
<h3 id="1-åˆ›å»ºäº‹ä»¶channel-1">1. åˆ›å»ºäº‹ä»¶channel</h3>
<ul>
<li>ä¸è¢«åŠ¨æ–¹ç›¸åŒ</li>
</ul>
<h3 id="2-åˆ›å»ºè¿æ¥id-1">2. åˆ›å»ºè¿æ¥ID</h3>
<ul>
<li>ä¸è¢«åŠ¨æ–¹ç›¸åŒ</li>
</ul>
<h3 id="3-ç»‘å®šåœ°å€-1">3. ç»‘å®šåœ°å€</h3>
<ul>
<li>å°†ç›®çš„åœ°å€å’Œå¯é€‰æºåœ°å€ä»IPåœ°å€è§£æä¸ºRDMAåœ°å€ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™æŒ‡å®šçš„rdma_cm_idå°†ç»‘å®šåˆ°æœ¬åœ°è®¾å¤‡ã€‚å¯¹åº”æ–¹æ³•ä¸º<code>int rdma_resolve_addr (struct rdma_cm_id *id, struct sockaddr *src_addr, struct sockaddr *dst_addr, int timeout_ms)</code>ã€‚</li>
<li>æ­¤æ–¹æ³•ç”¨äºå°†ç»™å®šçš„ç›®æ ‡IPåœ°å€æ˜ å°„åˆ°å¯ç”¨çš„RDMAåœ°å€ã€‚</li>
<li>IPåˆ°RDMAåœ°å€çš„æ˜ å°„ä½¿ç”¨æœ¬åœ°è·¯ç”±è¡¨æˆ–é€šè¿‡ARPå®Œæˆã€‚</li>
<li>å¦‚æœç»™å®šæºåœ°å€ï¼Œåˆ™å°†<code>rdma_cm_id</code>ç»‘å®šåˆ°è¯¥åœ°å€ï¼Œå°±åƒè°ƒç”¨<code>rdma_ind_addr</code>ä¸€æ ·ã€‚</li>
<li>å¦‚æœæ²¡æœ‰ç»™å‡ºæºåœ°å€ï¼Œå¹¶ä¸”<code>rdma_cm_id</code>å°šæœªç»‘å®šåˆ°è®¾å¤‡ï¼Œåˆ™<code>rdma_cm_id</code>å°†æ ¹æ®æœ¬åœ°è·¯ç”±è¡¨ç»‘å®šåˆ°æºåœ°å€ã€‚</li>
<li>åœ¨æ­¤æ–¹æ³•è°ƒç”¨ä¹‹åï¼Œ<code>rdma_cm_id</code>å°†ç»‘å®šåˆ°RDMAè®¾å¤‡ã€‚</li>
<li>è¯¥æ–¹æ³•è°ƒç”¨é€šå¸¸åœ¨è°ƒç”¨ <code>rdma_resolve_route</code> å’Œ <code>rdma_connect</code> ä¹‹å‰åœ¨ä¸»åŠ¨æ–¹ä¸Šè¿›è¡Œã€‚</li>
</ul>



<div class="notice notice-note" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256a248 248 0 11-496 0 248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>InfiniBandç‰¹å®š</p></div>

<ul>
<li>æ­¤æ–¹æ³•è¿˜ä¼šå°†ç›®æ ‡IPåœ°å€å’ŒæºIPåœ°å€(å¦‚æœç»™å®š)æ˜ å°„åˆ°GIDã€‚</li>
<li>ä¸ºäº†æ‰§è¡Œæ˜ å°„ï¼ŒIPoIBå¿…é¡»åŒæ—¶åœ¨æœ¬åœ°å’Œè¿œç¨‹èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚</li>
</ul>
<h3 id="4-åˆ›å»ºqp">4. åˆ›å»ºQP</h3>
<ul>
<li>ä¸è¢«åŠ¨æ–¹ç›¸åŒ</li>
</ul>
<h3 id="5-è§£æè·¯ç”±">5. è§£æè·¯ç”±</h3>
<ul>
<li>è§£ææŒ‡å‘ç›®æ ‡åœ°å€çš„ RDMA è·¯ç”±ï¼Œä»¥å»ºç«‹è¿æ¥ã€‚ç›®æ ‡åœ°å€å¿…é¡»å·²é€šè¿‡è°ƒç”¨ rdma_resolve_addr è§£æã€‚å¯¹åº”æ–¹æ³•ä¸º<code>int rdma_resolve_route (struct rdma_cm_id *id, int timeout_ms);</code></li>
</ul>
<h3 id="6-å»ºç«‹è¿æ¥">6. å»ºç«‹è¿æ¥</h3>
<ul>
<li>
<p>å¯¹åº”æ–¹æ³•ä¸º<code>int rdma_connect (struct rdma_cm_id *id, struct rdma_conn_param *conn_param);</code></p>
<ul>
<li>idï¼šæŒ‡å‘rdma_cm_idçš„æŒ‡é’ˆ</li>
<li>conn_paramï¼šæŒ‡å‘rdma_conn_paramç»“æ„çš„æŒ‡é’ˆï¼ŒåŒ…å«è¿æ¥å‚æ•°</li>
</ul>
</li>
<li>
<p>å¯¹äº <code>RDMA_PS_TCP</code> ç±»å‹çš„ <code>rdma_cm_id</code>ï¼Œè¯¥è°ƒç”¨ä¼šå‘è¿œç¨‹ç›®çš„åœ°å‘èµ·è¿æ¥è¯·æ±‚</p>
</li>
<li>
<p>å¯¹äº <code>RDMA_PS_UDP</code> ç±»å‹çš„ <code>rdma_cm_id</code>ï¼Œå®ƒä¼šå¯åŠ¨å¯¹æä¾›æ•°æ®æŠ¥æœåŠ¡çš„è¿œç¨‹ QP çš„æŸ¥è¯¢</p>
</li>
</ul>
<h3 id="7-æœ€åçš„æ“ä½œ-1">7. æœ€åçš„æ“ä½œ</h3>
<ol>
<li>ç­‰å¾…è¿æ¥å»ºç«‹</li>
<li>å‘å¸ƒæ“ä½œ</li>
</ol>
<p><img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20230725225927.png"
	
	
	
	loading="lazy"
	
		alt="20230725225927"
	
	
></p>
<hr>
<p><img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20230725225943.png"
	
	
	
	loading="lazy"
	
		alt="20230725225943"
	
	
></p>
<h2 id="å…­å®æˆ˜åŸºäºrdmaçš„client-serverç¨‹åº">å…­ã€å®æˆ˜ï¼šåŸºäºRDMAçš„client-serverç¨‹åº</h2>
<h3 id="1-serverç«¯">1. serverç«¯</h3>
<ul>
<li>å·¥ä½œæµç¨‹ï¼š
<ol>
<li>åˆå§‹åŒ–RDMAèµ„æº</li>
<li>ç­‰å¾…clientè¿æ¥</li>
<li>åˆ†é…å¹¶å›ºå®šæœåŠ¡å™¨ç¼“å†²åŒºbuffer</li>
<li>æ¥å—å®¢æˆ·ç«¯è¿æ¥</li>
<li>å°†æœ‰å…³æœ¬åœ°æœåŠ¡å™¨ç¼“å†²åŒºçš„ä¿¡æ¯å‘é€åˆ°å®¢æˆ·ç«¯</li>
<li>ç­‰å¾…æ–­å¼€è¿æ¥</li>
</ol>
</li>
</ul>
<h3 id="2-clientç«¯">2. clientç«¯</h3>
<ul>
<li>å·¥ä½œæµç¨‹ï¼š
<ol>
<li>åˆå§‹åŒ–RDMAèµ„æº</li>
<li>è¿æ¥server</li>
<li>é€šè¿‡å‘é€/æ¥æ”¶exchangeæ¥æ”¶æœåŠ¡å™¨ç«¯ç¼“å†²åŒºä¿¡æ¯</li>
<li>ä»ï¼ˆç¬¬ä¸€ä¸ªï¼‰æœ¬åœ°ç¼“å†²åŒºå‘æœåŠ¡å™¨ç¼“å†²åŒºè¿›è¡Œ RDMA å†™å…¥ã€‚</li>
<li>è¿›è¡Œ RDMA è¯»å–ï¼Œå°†æœåŠ¡å™¨ç¼“å†²åŒºçš„å†…å®¹è¯»å…¥ç¬¬äºŒä¸ªæœ¬åœ°ç¼“å†²åŒºã€‚</li>
<li>æ¯”è¾ƒç¬¬ä¸€ç¼“å†²åŒºå’Œç¬¬äºŒç¼“å†²åŒºçš„å†…å®¹ï¼Œå¹¶è¿›è¡ŒåŒ¹é…</li>
<li>æ–­å¼€è¿æ¥</li>
</ol>
</li>
</ul>
<h3 id="3-é¡¹ç›®å®ç°">3. é¡¹ç›®å®ç°</h3>
<div class="github">
    <div class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 2.5C2 1.83696 2.26339 1.20107 2.73223 0.732233C3.20108 0.263392 3.83696 0 4.5 0L13.25 0C13.4489 0 13.6397 0.0790176 13.7803 0.21967C13.921 0.360322 14 0.551088 14 0.75V13.25C14 13.4489 13.921 13.6397 13.7803 13.7803C13.6397 13.921 13.4489 14 13.25 14H10.75C10.5511 14 10.3603 13.921 10.2197 13.7803C10.079 13.6397 10 13.4489 10 13.25C10 13.0511 10.079 12.8603 10.2197 12.7197C10.3603 12.579 10.5511 12.5 10.75 12.5H12.5V10.5H4.5C4.30308 10.5 4.11056 10.5582 3.94657 10.6672C3.78257 10.7762 3.65442 10.9312 3.57816 11.1128C3.50191 11.2943 3.48096 11.4943 3.51793 11.6878C3.5549 11.8812 3.64816 12.0594 3.786 12.2C3.92524 12.3422 4.0023 12.5338 4.00024 12.7328C3.99818 12.9318 3.91716 13.1218 3.775 13.261C3.63285 13.4002 3.4412 13.4773 3.24222 13.4752C3.04325 13.4732 2.85324 13.3922 2.714 13.25C2.25571 12.7829 1.99929 12.1544 2 11.5V2.5ZM12.5 1.5V9H4.5C4.144 9 3.806 9.074 3.5 9.208V2.5C3.5 2.23478 3.60536 1.98043 3.79289 1.79289C3.98043 1.60536 4.23478 1.5 4.5 1.5H12.5ZM5 12.25V15.5C5 15.5464 5.01293 15.5919 5.03734 15.6314C5.06175 15.6709 5.09667 15.7028 5.1382 15.7236C5.17972 15.7444 5.22621 15.7532 5.27245 15.749C5.31869 15.7448 5.36286 15.7279 5.4 15.7L6.85 14.613C6.89328 14.5805 6.94591 14.563 7 14.563C7.05409 14.563 7.10673 14.5805 7.15 14.613L8.6 15.7C8.63714 15.7279 8.68131 15.7448 8.72755 15.749C8.77379 15.7532 8.82028 15.7444 8.8618 15.7236C8.90333 15.7028 8.93826 15.6709 8.96266 15.6314C8.98707 15.5919 9 15.5464 9 15.5V12.25C9 12.1837 8.97366 12.1201 8.92678 12.0732C8.87989 12.0263 8.81631 12 8.75 12H5.25C5.1837 12 5.12011 12.0263 5.07322 12.0732C5.02634 12.1201 5 12.1837 5 12.25Z"/></svg>
        <a class="name" href=https://github.com/PKUcoldkeyboard/RDMA-examples target="_blank">RDMA-examples</a>
    </div>
    <div class="description">RDMA-examples: A repository of practical code examples showcasing the fundamental concepts and usage of RDMA (Remote Direct Memory Access) technology.</div> 
    <div class="language">
        <span class="language-color" style="background-color: #555555"></span>
        <span class="language-name">C</span>
    </div>
</div>
<h3 id="4-è¡¥å……rdmaåº”ç”¨ç¨‹åºæ ‡å‡†æµç¨‹">4. è¡¥å……ï¼šRDMAåº”ç”¨ç¨‹åºæ ‡å‡†æµç¨‹</h3>
<p><img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20230729185145.png"
	
	
	
	loading="lazy"
	
		alt="20230729185145"
	
	
></p>
<h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2>
<ul>
<li>Mellanox Technologies, Inc. (2017). RDMA Aware Networks Programming User Manual. Mellanox Technologies, Inc.</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/rdma/">RDMA</a>
        
            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">è®¡ç®—æœºç½‘ç»œ</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/rdma-tutorial/1/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20230722162905.png" loading="lazy" data-key="rdma-tutorial/1" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/img/20230722162905.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">RDMAæŠ€æœ¯åŠå…¶ç¼–ç¨‹æ–¹æ³•ï¼ˆä¸€ï¼‰ï¼šRDMAç®€ä»‹ä¸åŸç†</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/soft-roce/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/img/86.png" loading="lazy" data-key="soft-roce" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/img/86.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">RDMAï¼šSoft-RoCEç¯å¢ƒæ­å»ºå®éªŒ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/false-sharing/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/img/6c3f8961290e41f894f5a1cbb768aba9-2023-12-02.png" loading="lazy" data-key="false-sharing" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/img/6c3f8961290e41f894f5a1cbb768aba9-2023-12-02.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">æ€§èƒ½åˆºå®¢ä¹‹ä¼ªå…±äº«</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/nest-on-hpe-install/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/img/20231031002508-2023-10-31.png" loading="lazy" data-key="nest-on-hpe-install" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/img/20231031002508-2023-10-31.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">NEST on HPC å®‰è£…æ•™ç¨‹</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/cuda-base-memory-access-mode/">
        
        
            <div class="article-image">
                
                    <img src="https://cuterwrite-1302252842.file.myqcloud.com/img/14ce26d6f495200cea2cfa76fefadf88eaab94e5.jpg@1256w_754h_!web-article-pic-2023-09-04.webp" loading="lazy" data-key="cuda-base-memory-access-mode" data-hash="https://cuterwrite-1302252842.file.myqcloud.com/img/14ce26d6f495200cea2cfa76fefadf88eaab94e5.jpg@1256w_754h_!web-article-pic-2023-09-04.webp"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">CUDAåŸºç¡€ï¼šå†…å­˜è®¿é—®æ¨¡å¼</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="PKUcoldkeyboard/pkucoldkeyboard.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzMzU4NzI5OTI="
    data-category="Comments"
    data-category-id="DIC_kwDOFAUD4M4CZV4F"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2021 - 
        
        2023 cuterwrite
    </section>
    
    <section class="powerby">
        
            æ¬¢è¿æ¥åˆ°Cuterwriteçš„åšå®¢ç½‘ç«™ <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.17.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
