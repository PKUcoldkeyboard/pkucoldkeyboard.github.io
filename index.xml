<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cuterwrite's Blog</title><link>https://cuterwrite.top/</link><description>Recent content on Cuterwrite's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>cuterwrite</copyright><lastBuildDate>Wed, 26 Jun 2024 23:11:00 +0000</lastBuildDate><atom:link href="https://cuterwrite.top/index.xml" rel="self" type="application/rss+xml"/><item><title>RDMA ä¹‹ Completion Queue</title><link>https://cuterwrite.top/p/rdma-completion-queue/</link><pubDate>Wed, 26 Jun 2024 23:11:00 +0000</pubDate><guid>https://cuterwrite.top/p/rdma-completion-queue/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116903369_p0_master1200.webp" alt="Featured image of post RDMA ä¹‹ Completion Queue" />&lt;h1 id="rdma-ä¹‹-completion-queue">RDMA ä¹‹ Completion Queue&lt;/h1>
&lt;p>&lt;strong>æœ¬æ–‡æ¬¢è¿éå•†ä¸šè½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>å£°æ˜ï¼šä»…ç”¨äºæ”¶è—ï¼Œä¾¿äºé˜…è¯»&lt;/p>&lt;span class="cite">&lt;span>â€• &lt;/span>&lt;span>Savir, &lt;/span>&lt;a href="https://zhuanlan.zhihu.com/p/259650980">&lt;cite>çŸ¥ä¹ä¸“æ ï¼š10. RDMA ä¹‹ Completion Queue&lt;/cite>&lt;/a>&lt;/span>&lt;/blockquote>
&lt;p>æˆ‘ä»¬æ›¾ç»åœ¨å‰é¢çš„æ–‡ç« ä¸­ç®€å•ä»‹ç»è¿‡ CQï¼Œæœ¬æ–‡å°†æ›´æ·±å…¥çš„è®²è§£å…³äºå®ƒçš„ä¸€äº›ç»†èŠ‚ã€‚é˜…è¯»æœ¬æ–‡å‰ï¼Œè¯»è€…å¯ä»¥å…ˆæ¸©ä¹ ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š &lt;a class="link" href="https://cuterwrite.top/p/rdma-element/" >â€œ3. RDMA åŸºæœ¬å…ƒç´ â€
&lt;/a>
ã€‚&lt;/p>
&lt;h2 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ&lt;/h2>
&lt;p>æˆ‘ä»¬å…ˆå›é¡¾ä¸‹ CQ çš„ä½œç”¨ã€‚CQ æ„ä¸ºå®Œæˆé˜Ÿåˆ—ï¼Œå®ƒçš„ä½œç”¨å’Œ WQï¼ˆSQ å’Œ RQï¼‰ç›¸åï¼Œç¡¬ä»¶é€šè¿‡ CQ ä¸­çš„ CQE/WC æ¥å‘Šè¯‰è½¯ä»¶æŸä¸ª WQE/WR çš„å®Œæˆæƒ…å†µã€‚å†æ¬¡æé†’è¯»è€…ï¼Œå¯¹äºä¸Šå±‚ç”¨æˆ·æ¥è¯´ä¸€èˆ¬ç”¨ WCï¼Œå¯¹äºé©±åŠ¨ç¨‹åºæ¥è¯´ï¼Œä¸€èˆ¬ç§°ä¸º CQEï¼Œæœ¬æ–‡ä¸å¯¹ä¸¤è€…è¿›è¡ŒåŒºåˆ†ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_1.webp"
alt="2024-06-27_10_1" width="80%" loading="lazy">
&lt;/figure>
&lt;p>CQE å¯ä»¥çœ‹ä½œä¸€ä»½â€œæŠ¥å‘Šâ€ï¼Œå…¶ä¸­å†™æ˜äº†æŸä¸ªä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>æœ¬æ¬¡å®Œæˆäº†å“ªä¸ª QP çš„å“ªä¸€ä¸ª WQE æŒ‡å®šçš„ä»»åŠ¡ï¼ˆQP Number å’Œ WR IDï¼‰&lt;/li>
&lt;li>æœ¬æ¬¡ä»»åŠ¡æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œï¼ˆOpcode æ“ä½œç±»å‹ï¼‰&lt;/li>
&lt;li>æœ¬æ¬¡ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ/å¤±è´¥ï¼Œå¤±è´¥åŸå› æ˜¯ XXXï¼ˆStatus çŠ¶æ€å’Œé”™è¯¯ç ï¼‰&lt;/li>
&lt;li>&amp;hellip;&lt;/li>
&lt;/ul>
&lt;p>æ¯å½“ç¡¬ä»¶å¤„ç†å®Œä¸€ä¸ª WQE ä¹‹åï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª CQE æ”¾åœ¨ CQ é˜Ÿåˆ—ä¸­ã€‚å¦‚æœä¸€ä¸ª WQE å¯¹åº”çš„ CQE æ²¡æœ‰äº§ç”Ÿï¼Œé‚£ä¹ˆè¿™ä¸ª WQE å°±ä¼šä¸€ç›´è¢«è®¤ä¸ºè¿˜æœªå¤„ç†å®Œï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>æ¶‰åŠä»å†…å­˜ä¸­å–æ•°æ®çš„æ“ä½œï¼ˆSEND å’Œ WRITEï¼‰&lt;/li>
&lt;/ul>
&lt;p>åœ¨äº§ç”Ÿ CQE ä¹‹å‰ï¼Œç¡¬ä»¶å¯èƒ½è¿˜æœªå‘é€æ¶ˆæ¯ï¼Œå¯èƒ½æ­£åœ¨å‘é€æ¶ˆæ¯ï¼Œå¯èƒ½å¯¹ç«¯æœ‰æ¥æ”¶åˆ°æ­£ç¡®çš„æ¶ˆæ¯ã€‚ç”±äºå†…å­˜åŒºåŸŸæ˜¯åœ¨å‘é€å‰ç”³è¯·å¥½çš„ï¼Œæ‰€ä»¥ä¸Šå±‚è½¯ä»¶æ”¶åˆ°å¯¹åº”çš„ CQE ä¹‹å‰ï¼Œå…¶å¿…é¡»è®¤ä¸ºè¿™ç‰‡å†…å­˜åŒºåŸŸä»åœ¨ä½¿ç”¨ä¸­ï¼Œä¸èƒ½å°†æ‰€æœ‰ç›¸å…³çš„å†…å­˜èµ„æºè¿›è¡Œé‡Šæ”¾ã€‚&lt;/p>
&lt;ul>
&lt;li>æ¶‰åŠå‘å†…å­˜ä¸­å­˜æ”¾æ•°æ®çš„æ“ä½œï¼ˆRECV å’Œ READï¼‰&lt;/li>
&lt;/ul>
&lt;p>åœ¨äº§ç”Ÿ CQE ä¹‹å‰ï¼Œæœ‰å¯èƒ½ç¡¬ä»¶è¿˜æ²¡æœ‰å¼€å§‹å†™å…¥æ•°æ®ï¼Œæœ‰å¯èƒ½æ•°æ®æ‰å†™äº†ä¸€åŠï¼Œä¹Ÿæœ‰å¯èƒ½æ•°æ®æ ¡éªŒå‡ºé”™ã€‚æ‰€ä»¥ä¸Šå±‚è½¯ä»¶åœ¨è·å¾— CQE ä¹‹å‰ï¼Œè¿™æ®µç”¨äºå­˜æ”¾æ¥æ”¶æ•°æ®çš„å†…å­˜åŒºåŸŸä¸­çš„å†…å®¹æ˜¯ä¸å¯ä¿¡çš„ã€‚&lt;/p>
&lt;p>æ€»ä¹‹ï¼Œç”¨æˆ·å¿…é¡»è·å–åˆ° CQE å¹¶ç¡®è®¤å…¶å†…å®¹ä¹‹åæ‰èƒ½è®¤ä¸ºæ¶ˆæ¯æ”¶å‘ä»»åŠ¡å·²ç»å®Œæˆã€‚&lt;/p>
&lt;h3 id="ä½•æ—¶äº§ç”Ÿ">ä½•æ—¶äº§ç”Ÿ&lt;/h3>
&lt;p>æˆ‘ä»¬å°†æŒ‰ç…§æœåŠ¡ç±»å‹ï¼ˆæœ¬ç¯‡åªè®² RC å’Œ UDï¼‰å’Œæ“ä½œç±»å‹æ¥åˆ†åˆ«è¯´æ˜ï¼Œå› ä¸ºä¸åŒçš„æƒ…å†µäº§ç”Ÿ CQE çš„æ—¶æœºå’Œå«ä¹‰éƒ½ä¸åŒï¼Œå»ºè®®è¯»è€…å›é¡¾ç¬¬ 4 ç¯‡å’Œç¬¬ 5 ç¯‡ï¼š &lt;a class="link" href="https://cuterwrite.top/p/rdma-op/" >â€œ4. RDMA åŸºæœ¬æ“ä½œâ€
&lt;/a>
ã€&lt;a class="link" href="https://cuterwrite.top/p/rdma-service-types/" >â€œ5. RDMA åŸºæœ¬æœåŠ¡ç±»å‹â€
&lt;/a>
ã€‚&lt;/p>
&lt;ul>
&lt;li>å¯é æœåŠ¡ç±»å‹ï¼ˆRCï¼‰&lt;/li>
&lt;/ul>
&lt;p>å‰é¢çš„æ–‡ç« è¯´è¿‡ï¼Œ&lt;strong>å¯é æ„å‘³ç€æœ¬ç«¯å…³å¿ƒå‘å‡ºçš„æ¶ˆæ¯èƒ½å¤Ÿè¢«å¯¹ç«¯å‡†ç¡®çš„æ¥æ”¶&lt;/strong>ï¼Œè¿™æ˜¯é€šè¿‡ ACKã€æ ¡éªŒå’Œé‡ä¼ ç­‰æœºåˆ¶ä¿è¯çš„ã€‚&lt;/p>
&lt;ul>
&lt;li>SEND&lt;/li>
&lt;/ul>
&lt;p>SEND æ“ä½œéœ€è¦ç¡¬ä»¶ä»å†…å­˜ä¸­è·å–æ•°æ®ï¼Œç„¶åç»„è£…æˆæ•°æ®åŒ…é€šè¿‡ç‰©ç†é“¾è·¯å‘é€åˆ°å¯¹ç«¯ã€‚å¯¹ SEND æ¥è¯´ï¼ŒClient ç«¯äº§ç”Ÿ CQE è¡¨ç¤º&lt;strong>å¯¹ç«¯å·²å‡†ç¡®æ— è¯¯çš„æ”¶åˆ°æ•°æ®&lt;/strong>ï¼Œå¯¹ç«¯ç¡¬ä»¶æ”¶åˆ°æ•°æ®å¹¶æ ¡éªŒä¹‹åï¼Œä¼šå›å¤ ACK åŒ…ç»™å‘é€æ–¹ã€‚å‘é€æ–¹æ”¶åˆ°è¿™ ACK ä¹‹åæ‰ä¼šäº§ç”Ÿ CQEï¼Œä»è€Œå‘Šè¯‰ç”¨æˆ·è¿™ä¸ªä»»åŠ¡æˆåŠŸæ‰§è¡Œäº†ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œå·¦ä¾§ Client ç«¯åœ¨çº¢ç‚¹çš„ä½ç½®äº§ç”Ÿäº†æœ¬æ¬¡ä»»åŠ¡çš„ CQEã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_2.webp"
alt="2024-06-27_10_2" width="50%" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>RECV&lt;/li>
&lt;/ul>
&lt;p>RECV æ“ä½œéœ€è¦ç¡¬ä»¶å°†æ”¶åˆ°çš„æ•°æ®æ”¾åˆ°ç”¨æˆ· WQE ä¸­æŒ‡å®šçš„å†…å­˜åŒºåŸŸï¼Œå®Œæˆæ ¡éªŒå’Œæ•°æ®å­˜æ”¾åŠ¨ä½œåï¼Œç¡¬ä»¶å°±ä¼šäº§ç”Ÿ CQEã€‚å¦‚ä¸Šå›¾å³ä¾§ Server ç«¯æ‰€ç¤ºã€‚&lt;/p>
&lt;ul>
&lt;li>WRITE&lt;/li>
&lt;/ul>
&lt;p>å¯¹äº Client ç«¯æ¥è¯´ï¼ŒWRITE æ“ä½œå’Œ SEND æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œç¡¬ä»¶ä¼šä»å†…å­˜ä¸­å–å‡ºæ•°æ®ï¼Œå¹¶ç­‰å¾…å¯¹ç«¯å›å¤ ACK åï¼Œæ‰ä¼šäº§ç”Ÿ CQEã€‚å·®åˆ«åœ¨äºï¼Œå› ä¸º WRITE æ˜¯ RDMA æ“ä½œï¼Œå¯¹ç«¯ CPU ä¸æ„ŸçŸ¥ï¼Œè‡ªç„¶ç”¨æˆ·ä¹Ÿä¸æ„ŸçŸ¥ï¼Œæ‰€ä»¥ä¸Šé¢çš„å›¾å˜æˆäº†è¿™æ ·ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_3.webp"
alt="2024-06-27_10_3" width="50%" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>READ&lt;/li>
&lt;/ul>
&lt;p>READ å’Œ RECV æœ‰ç‚¹åƒï¼ŒClient ç«¯å‘èµ· READ æ“ä½œåï¼Œå¯¹ç«¯ä¼šå›å¤æˆ‘ä»¬æƒ³è¯»å–çš„æ•°æ®ï¼Œç„¶åæœ¬ç«¯æ ¡éªŒæ²¡é—®é¢˜åï¼Œä¼šæŠŠæ•°æ®æ”¾åˆ° WQE ä¸­æŒ‡å®šçš„ä½ç½®ã€‚å®Œæˆä¸Šè¿°åŠ¨ä½œåï¼Œæœ¬ç«¯ä¼šäº§ç”Ÿ CQEã€‚READ åŒæ ·æ˜¯ RDMA æ“ä½œï¼Œå¯¹ç«¯ç”¨æˆ·ä¸æ„ŸçŸ¥ï¼Œè‡ªç„¶ä¹Ÿæ²¡æœ‰ CQE äº§ç”Ÿã€‚è¿™ç§æƒ…å†µä¸Šå›¾å˜æˆäº†è¿™æ ·ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_4.webp"
alt="2024-06-27_10_4" width="50%" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>ä¸å¯é æœåŠ¡ç±»å‹ï¼ˆUDï¼‰&lt;/li>
&lt;/ul>
&lt;p>å› ä¸ºä¸å¯é çš„æœåŠ¡ç±»å‹æ²¡æœ‰é‡ä¼ å’Œç¡®è®¤æœºåˆ¶ï¼Œæ‰€ä»¥äº§ç”Ÿ CQE è¡¨ç¤ºç¡¬ä»¶&lt;strong>å·²ç»å°†å¯¹åº” WQE æŒ‡å®šçš„æ•°æ®å‘é€å‡ºå»äº†&lt;/strong>ã€‚ä»¥å‰è¯´è¿‡ UD åªæ”¯æŒ SEND-RECV æ“ä½œï¼Œä¸æ”¯æŒ RDMA æ“ä½œã€‚æ‰€ä»¥å¯¹äº UD æœåŠ¡çš„ä¸¤ç«¯ï¼ŒCQE äº§ç”Ÿæ—¶æœºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_5.webp"
alt="2024-06-27_10_5" width="50%" loading="lazy">
&lt;/figure>
&lt;h3 id="wq-å’Œ-cq-çš„å¯¹åº”å…³ç³»">WQ å’Œ CQ çš„å¯¹åº”å…³ç³»&lt;/h3>
&lt;p>&lt;strong>æ¯ä¸ª WQ éƒ½å¿…é¡»å…³è”ä¸€ä¸ª CQï¼Œè€Œæ¯ä¸ª CQ å¯ä»¥å…³è”å¤šä¸ª SQ å’Œ RQã€‚&lt;/strong>&lt;/p>
&lt;p>è¿™é‡Œçš„æ‰€è°“â€œå…³è”â€ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ª WQ çš„æ‰€æœ‰ WQE å¯¹åº”çš„ CQEï¼Œéƒ½ä¼šè¢«ç¡¬ä»¶æ”¾åˆ°ç»‘å®šçš„ CQ ä¸­ï¼Œéœ€è¦æ³¨æ„åŒå±äºä¸€ä¸ª QP çš„ SQ å’Œ RQ å¯ä»¥å„è‡ªå…³è”ä¸åŒçš„ CQã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒQP1 çš„ SQ å’Œ RQ éƒ½å…³è”äº† CQ1ï¼ŒQP2 çš„ RQ å…³è”åˆ°äº† CQ1ã€SQ å…³è”åˆ°äº† CQ2ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_6.webp"
alt="2024-06-27_10_6" width="auto" loading="lazy">
&lt;/figure>
&lt;p>å› ä¸ºæ¯ä¸ª WQ å¿…é¡»å…³è”ä¸€ä¸ª CQï¼Œæ‰€ä»¥ç”¨æˆ·åˆ›å»º QP å‰éœ€è¦æå‰åˆ›å»ºå¥½ CQï¼Œç„¶ååˆ†åˆ«æŒ‡å®š SQ å’Œ RQ å°†ä¼šä½¿ç”¨çš„ CQã€‚&lt;/p>
&lt;p>&lt;strong>åŒä¸€ä¸ª WQ ä¸­çš„ WQEï¼Œå…¶å¯¹åº”çš„ CQE é—´æ˜¯ä¿åºçš„&lt;/strong>&lt;/p>
&lt;p>ç¡¬ä»¶æ˜¯æŒ‰ç…§â€œå…ˆè¿›å…ˆå‡ºâ€çš„ FIFO é¡ºåºä»æŸä¸€ä¸ª WQï¼ˆSQ æˆ–è€… RQï¼‰ä¸­å–å‡º WQE å¹¶è¿›è¡Œå¤„ç†çš„ï¼Œè€Œå‘ WR å…³è”çš„ CQ ä¸­å­˜æ”¾ CQE æ—¶ï¼Œä¹Ÿæ˜¯éµä»è¿™äº› WQE è¢«æ”¾åˆ° WQ ä¸­çš„é¡ºåºçš„ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è°å…ˆè¢«æ”¾åˆ°é˜Ÿåˆ—é‡Œï¼Œè°å°±å…ˆè¢«å®Œæˆã€‚è¯¥è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_7.webp"
alt="2024-06-27_10_7" width="auto" loading="lazy">
&lt;/figure>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ SRQ çš„æƒ…å†µä»¥åŠ RD æœåŠ¡ç±»å‹çš„ RQ è¿™ä¸¤ç§æƒ…å†µæ˜¯ä¸ä¿åºçš„ï¼Œæœ¬æ–‡ä¸­ä¸å±•å¼€è®¨è®ºã€‚&lt;/p>
&lt;p>&lt;strong>ä¸åŒ WQ ä¸­çš„ WQEï¼Œå…¶å¯¹åº”çš„ CQE é—´æ˜¯ä¸ä¿åºçš„&lt;/strong>&lt;/p>
&lt;p>å‰æ–‡ä¸­æˆ‘ä»¬è¯´è¿‡ï¼Œä¸€ä¸ª CQ å¯èƒ½ä¼šè¢«å¤šä¸ª WQ å…±äº«ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯ä¸èƒ½ä¿è¯è¿™äº› WQE å¯¹åº”çš„ CQE çš„äº§ç”Ÿé¡ºåºçš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆWQE ç¼–å·è¡¨ç¤ºä¸‹å‘çš„æ¬¡åºï¼Œå³ 1 æœ€å…ˆè¢«ä¸‹å‘ï¼Œ6 æœ€åè¢«ä¸‹å‘ï¼‰ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_8.webp"
alt="2024-06-27_10_8" width="auto" loading="lazy">
&lt;/figure>
&lt;p>ä¸Šé¢çš„æè¿°å…¶å®è¿˜åŒ…å«äº†â€œåŒä¸€ä¸ª QP çš„ SQ å’Œ RQ ä¸­çš„ WQEï¼Œå…¶å¯¹åº”çš„ CQE é—´æ˜¯ä¸ä¿åºçš„â€çš„æƒ…å†µï¼Œè¿™ä¸€ç‚¹å…¶å®æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼ŒSQ å’Œ RQï¼Œä¸€ä¸ªè´Ÿè´£ä¸»åŠ¨å‘èµ·çš„ä»»åŠ¡ï¼Œä¸€ä¸ªè´Ÿè´£è¢«åŠ¨æ¥æ”¶çš„ä»»åŠ¡ï¼Œå®ƒä»¬æœ¬æ¥å°±å¯ä»¥æ˜¯è®¤ä¸ºæ˜¯ä¸¤æ¡ä¸åŒæ–¹å‘çš„é€šé“ï¼Œè‡ªç„¶ä¸åº”è¯¥ç›¸äº’å½±å“ã€‚å‡è®¾ç”¨æˆ·å¯¹åŒä¸€ä¸ª QP å…ˆä¸‹å‘äº†ä¸€ä¸ª Receive WQEï¼Œåˆä¸‹å‘ä¸€ä¸ª Send WQEï¼Œæ€»ä¸èƒ½å¯¹ç«¯ä¸ç»™æœ¬ç«¯å‘é€æ¶ˆæ¯ï¼Œæœ¬ç«¯å°±ä¸èƒ½å‘é€æ¶ˆæ¯ç»™å¯¹ç«¯äº†å§ï¼Ÿ&lt;/p>
&lt;p>æ—¢ç„¶è¿™ç§æƒ…å†µä¸‹ CQE äº§ç”Ÿçš„é¡ºåºå’Œè·å– WQE çš„é¡ºåºæ˜¯ä¸ç›¸å…³çš„ï¼Œé‚£ä¹ˆä¸Šå±‚åº”ç”¨å’Œé©±åŠ¨æ˜¯å¦‚ä½•çŸ¥é“æ”¶åˆ°çš„ CQE å…³è”çš„æ˜¯å“ªä¸ª WQE å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œ&lt;strong>CQE ä¸­æŒ‡æ˜å®ƒæ‰€å¯¹åº”çš„ WQE çš„ç¼–å·&lt;/strong>å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿åœ¨å¤šä¸ª WQ å…±ç”¨ä¸€ä¸ª CQ çš„æƒ…å†µä¸‹ï¼Œâ€œåŒä¸€ä¸ª WQ ä¸­çš„ WQEï¼Œå…¶å¯¹åº”çš„ CQE é—´æ˜¯ä¿åºçš„â€è¿™ä¸€ç‚¹ä¹Ÿæ˜¯ä¸€å®šèƒ½å¤Ÿä¿è¯çš„ï¼Œå³ä¸Šå›¾ä¸­çš„å±äº WQ1 çš„ WQE 1ã€3ã€4 å¯¹åº”çš„ CQE ä¸€å®šæ˜¯æŒ‰ç…§é¡ºåºäº§ç”Ÿçš„ï¼Œå¯¹äºå±äº WQ2 çš„ WQE 2ã€5ã€6 ä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/p>
&lt;h3 id="cqc">CQC&lt;/h3>
&lt;p>åŒ QP ä¸€æ ·ï¼ŒCQ åªæ˜¯ä¸€æ®µå­˜æ”¾ CQE çš„é˜Ÿåˆ—å†…å­˜ç©ºé—´ã€‚ç¡¬ä»¶é™¤äº†çŸ¥é“é¦–åœ°å€ä»¥å¤–ï¼Œå¯¹äºè¿™ç‰‡åŒºåŸŸå¯ä»¥è¯´æ˜¯ä¸€æ— æ‰€çŸ¥ã€‚æ‰€ä»¥éœ€è¦æå‰è·Ÿè½¯ä»¶çº¦å®šå¥½æ ¼å¼ï¼Œç„¶åé©±åŠ¨å°†ç”³è¯·å†…å­˜ï¼Œå¹¶æŒ‰ç…§æ ¼å¼æŠŠ CQ çš„åŸºæœ¬ä¿¡æ¯å¡«å†™åˆ°è¿™ç‰‡å†…å­˜ä¸­ä¾›ç¡¬ä»¶è¯»å–ï¼Œè¿™ç‰‡å†…å­˜å°±æ˜¯ CQCã€‚CQC ä¸­åŒ…å«äº† CQ çš„å®¹é‡å¤§å°ï¼Œå½“å‰å¤„ç†çš„ CQE çš„åºå·ç­‰ç­‰ä¿¡æ¯ã€‚æ‰€ä»¥æŠŠ QPC çš„å›¾ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼Œå°±èƒ½è¡¨ç¤ºå‡º CQC å’Œ CQ çš„å…³ç³»ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_9.webp"
alt="2024-06-27_10_9" width="auto" loading="lazy">
&lt;/figure>
&lt;h3 id="cqn">CQN&lt;/h3>
&lt;p>CQ Numberï¼Œå°±æ˜¯ CQ çš„ç¼–å·ï¼Œç”¨æ¥åŒºåˆ«ä¸åŒçš„ CQã€‚CQ æ²¡æœ‰åƒ QP0 å’Œ QP1 ä¸€æ ·çš„ç‰¹æ®Šä¿ç•™ç¼–å·ï¼Œæœ¬æ–‡ä¸­ä¸å†èµ˜è¿°äº†ã€‚&lt;/p>
&lt;h2 id="å®Œæˆé”™è¯¯">å®Œæˆé”™è¯¯&lt;/h2>
&lt;p>IB åè®®ä¸­æœ‰ä¸‰ç§é”™è¯¯ç±»å‹ï¼Œç«‹å³é”™è¯¯ï¼ˆimmediate errorï¼‰ã€å®Œæˆé”™è¯¯ï¼ˆCompletion Errorï¼‰ä»¥åŠå¼‚æ­¥é”™è¯¯ï¼ˆAsynchronous Errors)ã€‚&lt;/p>
&lt;p>ç«‹å³é”™è¯¯çš„æ˜¯â€œç«‹å³åœæ­¢å½“å‰æ“ä½œï¼Œå¹¶è¿”å›é”™è¯¯ç»™ä¸Šå±‚ç”¨æˆ·â€ï¼›å®Œæˆé”™è¯¯æŒ‡çš„æ˜¯â€œé€šè¿‡ CQE å°†é”™è¯¯ä¿¡æ¯è¿”å›ç»™ä¸Šå±‚ç”¨æˆ·â€ï¼›è€Œå¼‚æ­¥é”™è¯¯æŒ‡çš„æ˜¯â€œé€šè¿‡ä¸­æ–­äº‹ä»¶çš„æ–¹å¼ä¸ŠæŠ¥ç»™ä¸Šå±‚ç”¨æˆ·â€ã€‚å¯èƒ½è¿˜æ˜¯æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­è¯´æ˜è¿™ä¸¤ç§é”™è¯¯éƒ½ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹äº§ç”Ÿï¼š&lt;/p>
&lt;ul>
&lt;li>ç”¨æˆ·åœ¨ Post Send æ—¶ä¼ å…¥äº†éæ³•çš„æ“ä½œç ï¼Œæ¯”å¦‚æƒ³åœ¨ UD çš„æ—¶å€™ä½¿ç”¨ RDMA WRITE æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;p>ç»“æœï¼šäº§ç”Ÿç«‹å³é”™è¯¯ï¼ˆæœ‰çš„å‚å•†åœ¨è¿™ç§æƒ…å†µä¼šäº§ç”Ÿå®Œæˆé”™è¯¯ï¼‰&lt;/p>
&lt;p>ä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹ï¼Œé©±åŠ¨ç¨‹åºä¼šç›´æ¥é€€å‡º post send æµç¨‹ï¼Œå¹¶è¿”å›é”™è¯¯ç ç»™ä¸Šå±‚ç”¨æˆ·ã€‚æ³¨æ„æ­¤æ—¶ WQE è¿˜æ²¡æœ‰ä¸‹å‘åˆ°ç¡¬ä»¶å°±è¿”å›äº†ã€‚&lt;/p>
&lt;ul>
&lt;li>ç”¨æˆ·ä¸‹å‘äº†ä¸€ä¸ª WQEï¼Œæ“ä½œç±»å‹ä¸º SENDï¼Œä½†æ˜¯é•¿æ—¶é—´æ²¡æœ‰å—åˆ°å¯¹æ–¹çš„ ACKã€‚&lt;/li>
&lt;/ul>
&lt;p>ç»“æœï¼šäº§ç”Ÿå®Œæˆé”™è¯¯&lt;/p>
&lt;p>å› ä¸º WQE å·²ç»åˆ°è¾¾äº†ç¡¬ä»¶ï¼Œæ‰€ä»¥ç¡¬ä»¶ä¼šäº§ç”Ÿå¯¹åº”çš„ CQEï¼ŒCQE ä¸­åŒ…å«è¶…æ—¶æœªå“åº”çš„é”™è¯¯è¯¦æƒ…ã€‚&lt;/p>
&lt;ul>
&lt;li>ç”¨æˆ·æ€ä¸‹å‘äº†å¤šä¸ª WQEï¼Œæ‰€ä»¥ç¡¬ä»¶ä¼šäº§ç”Ÿå¤šä¸ª CQEï¼Œä½†æ˜¯è½¯ä»¶ä¸€ç›´æ²¡æœ‰ä» CQ ä¸­å–èµ° CQEï¼Œå¯¼è‡´ CQ æº¢å‡ºã€‚
ç»“æœï¼šäº§ç”Ÿå¼‚æ­¥é”™è¯¯&lt;/li>
&lt;/ul>
&lt;p>å› ä¸ºè½¯ä»¶ä¸€ç›´æ²¡å– CQEï¼Œæ‰€ä»¥è‡ªç„¶ä¸ä¼šä» CQE ä¸­å¾—åˆ°ä¿¡æ¯ã€‚æ­¤æ—¶ IB æ¡†æ¶ä¼šè°ƒç”¨è½¯ä»¶æ³¨å†Œçš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ¥é€šçŸ¥ç”¨æˆ·å¤„ç†å½“å‰çš„é”™è¯¯ã€‚&lt;/p>
&lt;p>ç”±æ­¤å¯è§ï¼Œå®ƒä»¬éƒ½æ˜¯åº•å±‚å‘ä¸Šå±‚ç”¨æˆ·æŠ¥å‘Šé”™è¯¯çš„æ–¹å¼ï¼Œåªæ˜¯äº§ç”Ÿçš„æ—¶æœºä¸ä¸€æ ·è€Œå·²ã€‚IB åè®®ä¸­å¯¹ä¸åŒæƒ…å†µçš„é”™è¯¯åº”è¯¥ä»¥å“ªç§æ–¹å¼ä¸ŠæŠ¥åšäº†è§„å®šï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œå¯¹äº Modify QP è¿‡ç¨‹ä¸­ä¿®æ”¹éæ³•çš„å‚æ•°ï¼Œåº”è¯¥è¿”å›ç«‹å³é”™è¯¯ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_10.webp"
alt="2024-06-27_10_10" width="auto" loading="lazy">
&lt;/figure>
&lt;p>æœ¬æ–‡çš„é‡ç‚¹åœ¨äº CQï¼Œæ‰€ä»¥ä»‹ç»å®Œé”™è¯¯ç±»å‹ä¹‹åï¼Œæˆ‘ä»¬ç€é‡æ¥çœ‹ä¸€ä¸‹å®Œæˆé”™è¯¯ã€‚å®Œæˆé”™è¯¯æ˜¯ç¡¬ä»¶é€šè¿‡åœ¨ CQE ä¸­å¡«å†™é”™è¯¯ç æ¥å®ç°ä¸ŠæŠ¥çš„ï¼Œä¸€æ¬¡é€šä¿¡è¿‡ç¨‹éœ€è¦å‘èµ·ç«¯ï¼ˆRequesterï¼‰å’Œå“åº”ç«¯ï¼ˆResponderï¼‰å‚ä¸ï¼Œå…·ä½“çš„é”™è¯¯åŸå› ä¹Ÿåˆ†ä¸ºæœ¬ç«¯å’Œå¯¹ç«¯ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹é”™è¯¯æ£€æµ‹æ˜¯åœ¨ä»€ä¹ˆé˜¶æ®µè¿›è¡Œçš„ï¼ˆä¸‹å›¾å¯¹ IB åè®®ä¸­ Figure 118 è¿›è¡Œäº†é‡ç”»ï¼‰ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-27_10_11.webp"
alt="2024-06-27_10_11" width="auto" loading="lazy">
&lt;/figure>
&lt;p>Requester çš„é”™è¯¯æ£€æµ‹ç‚¹æœ‰ä¸¤ä¸ªï¼š&lt;/p>
&lt;ol>
&lt;li>æœ¬åœ°é”™è¯¯æ£€æµ‹&lt;/li>
&lt;/ol>
&lt;p>å³å¯¹ SQ ä¸­çš„ WQE è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœæ£€æµ‹åˆ°é”™è¯¯ï¼Œå°±ä»æœ¬åœ°é”™è¯¯æ£€æŸ¥æ¨¡å—ç›´æ¥äº§ç”Ÿ CQE åˆ° CQï¼Œä¸ä¼šå‘é€æ•°æ®åˆ°å“åº”ç«¯äº†ï¼›å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™å‘é€æ•°æ®åˆ°å¯¹ç«¯ã€‚&lt;/p>
&lt;ol start="2">
&lt;li>è¿œç«¯é”™è¯¯æ£€æµ‹&lt;/li>
&lt;/ol>
&lt;p>å³æ£€æµ‹å“åº”ç«¯çš„ ACK æ˜¯å¦å¼‚å¸¸ï¼ŒACK/NAK æ˜¯ç”±å¯¹ç«¯çš„æœ¬åœ°é”™è¯¯æ£€æµ‹æ¨¡å—æ£€æµ‹åäº§ç”Ÿçš„ï¼Œé‡Œé¢åŒ…å«äº†å“åº”ç«¯æ˜¯å¦æœ‰é”™è¯¯ï¼Œä»¥åŠå…·ä½“çš„é”™è¯¯ç±»å‹ã€‚æ— è®ºè¿œç«¯é”™è¯¯æ£€æµ‹çš„ç»“æœæ˜¯å¦æœ‰é—®é¢˜ï¼Œéƒ½ä¼šäº§ç”Ÿ CQE åˆ° CQ ä¸­ã€‚&lt;/p>
&lt;p>Responder çš„é”™è¯¯æ£€æµ‹ç‚¹åªæœ‰ä¸€ä¸ªï¼š&lt;/p>
&lt;ol>
&lt;li>æœ¬åœ°é”™è¯¯æ£€æµ‹&lt;/li>
&lt;/ol>
&lt;p>å®é™…ä¸Šæ£€æµ‹çš„æ˜¯å¯¹ç«¯æŠ¥æ–‡æ˜¯å¦æœ‰é—®é¢˜ï¼ŒIB åè®®ä¹Ÿå°†å…¶ç§°ä¸ºâ€œæœ¬åœ°â€é”™è¯¯æ£€æµ‹ã€‚å¦‚æœæ£€æµ‹åˆ°é”™è¯¯ï¼Œåˆ™ä¼šä½“ç°åœ¨ ACK/NAK æŠ¥æ–‡ä¸­å›å¤ç»™å¯¹ç«¯ï¼Œä»¥åŠåœ¨æœ¬åœ°äº§ç”Ÿä¸€ä¸ª CQEã€‚&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°çš„äº§ç”Ÿ ACK å’Œè¿œç«¯é”™è¯¯æ£€æµ‹åªå¯¹é¢å‘è¿æ¥çš„æœåŠ¡ç±»å‹æœ‰æ•ˆï¼Œæ— è¿æ¥çš„æœåŠ¡ç±»å‹ã€‚æ¯”å¦‚ UD ç±»å‹å¹¶ä¸å…³å¿ƒå¯¹ç«¯æ˜¯å¦æ”¶åˆ°ï¼Œæ¥æ”¶ç«¯ä¹Ÿä¸ä¼šäº§ç”Ÿ ACKï¼Œæ‰€ä»¥åœ¨ Requester çš„æœ¬åœ°é”™è¯¯æ£€æµ‹ä¹‹åå°±ä¸€å®šä¼šäº§ç”Ÿ CQEï¼Œæ— è®ºæ˜¯å¦æœ‰è¿œç«¯é”™è¯¯ã€‚&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬ç®€å•ä»‹ç»ä¸‹å‡ ç§å¸¸è§çš„å®Œæˆé”™è¯¯ï¼š&lt;/p>
&lt;ul>
&lt;li>RC æœåŠ¡ç±»å‹çš„ SQ å®Œæˆé”™è¯¯&lt;/li>
&lt;li>Local Protection Error
&lt;ul>
&lt;li>æœ¬åœ°ä¿æŠ¤åŸŸé”™è¯¯ã€‚æœ¬åœ° WQE ä¸­æŒ‡å®šçš„æ•°æ®å†…å­˜åœ°å€çš„ MR ä¸åˆæ³•ï¼Œå³ç”¨æˆ·è¯•å›¾ä½¿ç”¨ä¸€ç‰‡æœªæ³¨å†Œçš„å†…å­˜ä¸­çš„æ•°æ®ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Remote Access Error
&lt;ul>
&lt;li>è¿œç«¯æƒé™é”™è¯¯ã€‚æœ¬ç«¯æ²¡æœ‰æƒé™è¯»/å†™æŒ‡å®šçš„å¯¹ç«¯å†…å­˜åœ°å€ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Transport Retry Counter Exceeded Error
&lt;ul>
&lt;li>é‡ä¼ è¶…æ¬¡é”™è¯¯ã€‚å¯¹ç«¯ä¸€ç›´æœªå›å¤æ­£ç¡®çš„ ACKï¼Œå¯¼è‡´æœ¬ç«¯å¤šæ¬¡é‡ä¼ ï¼Œè¶…è¿‡äº†é¢„è®¾çš„æ¬¡æ•°ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>RC æœåŠ¡ç±»å‹çš„ RQ å®Œæˆé”™è¯¯&lt;/li>
&lt;li>Local Access Error
&lt;ul>
&lt;li>æœ¬åœ°è®¿é—®é”™è¯¯ã€‚è¯´æ˜å¯¹ç«¯è¯•å›¾å†™å…¥å…¶æ²¡æœ‰æƒé™å†™å…¥çš„å†…å­˜åŒºåŸŸã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Local Length Error
&lt;ul>
&lt;li>æœ¬åœ°é•¿åº¦é”™è¯¯ã€‚æœ¬åœ° RQ æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥æ¥æ”¶å¯¹ç«¯å‘é€çš„æ•°æ®ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å®Œæ•´çš„å®Œæˆé”™è¯¯ç±»å‹åˆ—è¡¨è¯·å‚è€ƒ IB åè®®çš„ 10.10.3 èŠ‚ã€‚&lt;/p>
&lt;h2 id="ç”¨æˆ·æ¥å£">ç”¨æˆ·æ¥å£&lt;/h2>
&lt;p>åŒ QP ä¸€æ ·ï¼Œæˆ‘ä»¬ä¾ç„¶ä»é€šä¿¡å‡†å¤‡é˜¶æ®µï¼ˆæ§åˆ¶é¢ï¼‰å’Œé€šä¿¡è¿›è¡Œé˜¶æ®µï¼ˆæ•°æ®é¢ï¼‰æ¥ä»‹ç» IB åè®®å¯¹ä¸Šå±‚æä¾›çš„å…³äº CQ çš„æ¥å£ã€‚&lt;/p>
&lt;h3 id="æ§åˆ¶é¢">æ§åˆ¶é¢&lt;/h3>
&lt;p>åŒ QP ä¸€æ ·ï¼Œè¿˜æ˜¯â€œå¢åˆ æ”¹æŸ¥â€å››ç§ï¼Œä½†æ˜¯å¯èƒ½å› ä¸ºå¯¹äº CQ æ¥è¯´ï¼Œä¸Šå±‚ç”¨æˆ·æ˜¯èµ„æºä½¿ç”¨è€…è€Œä¸æ˜¯ç®¡ç†è€…ï¼Œåªèƒ½ä» CQ ä¸­è¯»æ•°æ®è€Œä¸èƒ½å†™æ•°æ®ï¼Œæ‰€ä»¥å¯¹ç”¨æˆ·å¼€æ”¾çš„å¯é…çš„å‚æ•°å°±åªæœ‰â€œCQ è§„æ ¼â€ä¸€ç§ã€‚&lt;/p>
&lt;ul>
&lt;li>åˆ›å»ºâ€”â€”Create CQ&lt;/li>
&lt;/ul>
&lt;p>åˆ›å»ºçš„æ—¶å€™ç”¨æˆ·å¿…é¡»æŒ‡å®š CQ çš„è§„æ ¼ï¼Œå³èƒ½å¤Ÿå‚¨å­˜å¤šå°‘ä¸ª CQEï¼Œå¦å¤–ç”¨æˆ·è¿˜å¯ä»¥å¡«å†™ä¸€ä¸ª CQE äº§ç”Ÿåçš„å›è°ƒå‡½æ•°æŒ‡é’ˆï¼ˆä¸‹æ–‡ä¼šæ¶‰åŠï¼‰ã€‚å†…æ ¸æ€é©±åŠ¨ä¼šå°†å…¶ä»–ç›¸å…³çš„å‚æ•°é…ç½®å¥½ï¼Œå¡«å†™åˆ°è·Ÿç¡¬ä»¶çº¦å®šå¥½çš„ CQC ä¸­å‘ŠçŸ¥ç¡¬ä»¶ã€‚&lt;/p>
&lt;ul>
&lt;li>é”€æ¯â€”â€”Destroy CQ&lt;/li>
&lt;/ul>
&lt;p>é‡Šæ”¾ä¸€ä¸ª CQ è½¯ç¡¬ä»¶èµ„æºï¼ŒåŒ…å« CQ æœ¬èº«åŠ CQCï¼Œå¦å¤– CQN è‡ªç„¶ä¹Ÿå°†å¤±æ•ˆã€‚&lt;/p>
&lt;ul>
&lt;li>ä¿®æ”¹â€”â€”Resize CQ&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œåå­—ç¨å¾®æœ‰ç‚¹åŒºåˆ«ï¼Œå› ä¸º CQ åªå…è®¸ç”¨æˆ·ä¿®æ”¹è§„æ ¼å¤§å°ï¼Œæ‰€ä»¥å°±ç”¨çš„ Resize è€Œä¸æ˜¯ Modifyã€‚&lt;/p>
&lt;ul>
&lt;li>æŸ¥è¯¢â€”â€”Query CQ&lt;/li>
&lt;/ul>
&lt;p>æŸ¥è¯¢ CQ çš„å½“å‰è§„æ ¼ï¼Œä»¥åŠç”¨äºé€šçŸ¥çš„å›è°ƒå‡½æ•°æŒ‡é’ˆã€‚&lt;/p>
&lt;blockquote>
&lt;p>é€šè¿‡å¯¹æ¯” RDMA è§„èŒƒå’Œè½¯ä»¶åè®®æ ˆï¼Œå¯ä»¥å‘ç°å¾ˆå¤š verbs æ¥å£å¹¶ä¸æ˜¯æŒ‰ç…§è§„èŒƒå®ç°çš„ã€‚æ‰€ä»¥è¯»è€…å¦‚æœå‘ç°è½¯ä»¶ API å’Œåè®®æœ‰å·®å¼‚æ—¶ä¹Ÿæ— é¡»æ„Ÿåˆ°ç–‘æƒ‘ï¼ŒRDMA æŠ€æœ¯æœ¬èº«ä¸€ç›´è¿˜åœ¨æ¼”è¿›ï¼Œè½¯ä»¶æ¡†æ¶ä¹Ÿå¤„äºæ´»è·ƒæ›´æ–°çš„çŠ¶æ€ã€‚å¦‚æœæ›´å…³å¿ƒç¼–ç¨‹å®ç°ï¼Œé‚£ä¹ˆè¯·ä»¥è½¯ä»¶åè®®æ ˆçš„ API æ–‡æ¡£ä¸ºå‡†ï¼›å¦‚æœæ›´å…³å¿ƒå­¦æœ¯ä¸Šçš„ç ”ç©¶ï¼Œé‚£ä¹ˆè¯·ä»¥ RDMA è§„èŒƒä¸ºå‡†ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="æ•°æ®é¢">æ•°æ®é¢&lt;/h3>
&lt;p>CQE æ˜¯ç¡¬ä»¶å°†ä¿¡æ¯ä¼ é€’ç»™è½¯ä»¶çš„åª’ä»‹ï¼Œè™½ç„¶è½¯ä»¶çŸ¥é“åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šäº§ç”Ÿ CQEï¼Œä½†æ˜¯è½¯ä»¶å¹¶ä¸çŸ¥é“å…·ä½“ä»€ä¹ˆæ—¶å€™ç¡¬ä»¶ä¼šæŠŠ CQE æ”¾åˆ° CQ ä¸­ã€‚åœ¨é€šä¿¡å’Œè®¡ç®—æœºé¢†åŸŸï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ¥æ”¶æ–¹ä¸çŸ¥é“å‘é€æ–¹ä»€ä¹ˆæ—¶å€™å‘é€çš„æ¨¡å¼ç§°ä¸ºâ€œå¼‚æ­¥â€ã€‚æˆ‘ä»¬å…ˆæ¥ä¸¾ä¸€ä¸ªç½‘å¡çš„ä¾‹å­ï¼Œå†æ¥è¯´æ˜ç”¨æˆ·å¦‚ä½•é€šè¿‡æ•°æ®é¢æ¥å£è·å– CQEï¼ˆWCï¼‰ã€‚&lt;/p>
&lt;p>ç½‘å¡æ”¶åˆ°æ•°æ®åŒ…åå¦‚ä½•è®© CPU çŸ¥é“è¿™ä»¶äº‹ï¼Œå¹¶è¿›è¡Œæ•°æ®åŒ…å¤„ç†ï¼Œæœ‰ä¸¤ç§å¸¸è§çš„æ¨¡å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸­æ–­æ¨¡å¼&lt;/li>
&lt;/ul>
&lt;p>å½“æ•°æ®é‡è¾ƒå°‘ï¼Œæˆ–è€…è¯´å¶å‘çš„æ•°æ®äº¤æ¢è¾ƒå¤šæ—¶ï¼Œé€‚åˆé‡‡ç”¨ä¸­æ–­æ¨¡å¼â€”â€”å³ CPU å¹³å¸¸åœ¨åšå…¶ä»–äº‹æƒ…ï¼Œå½“ç½‘å¡æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œä¼šä¸ŠæŠ¥ä¸­æ–­æ‰“æ–­ CPU å½“å‰çš„ä»»åŠ¡ï¼ŒCPU è½¬è€Œæ¥å¤„ç†æ•°æ®åŒ…ï¼ˆæ¯”å¦‚ TCP/IP åè®®æ ˆçš„å„å±‚è§£æï¼‰ã€‚å¤„ç†å®Œæ•°æ®ä¹‹åï¼ŒCPU è·³å›åˆ°ä¸­æ–­å‰çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>æ¯æ¬¡ä¸­æ–­éƒ½éœ€è¦ä¿æŠ¤ç°åœºï¼Œä¹Ÿå°±æ˜¯æŠŠå½“å‰å„ä¸ªå¯„å­˜å™¨çš„å€¼ã€å±€éƒ¨å˜é‡çš„å€¼ç­‰ç­‰ä¿å­˜åˆ°æ ˆä¸­ï¼Œå›æ¥ä¹‹åå†æ¢å¤ç°åœºï¼ˆå‡ºæ ˆï¼‰ï¼Œè¿™æœ¬èº«æ˜¯æœ‰å¼€é”€çš„ã€‚å¦‚æœä¸šåŠ¡è´Ÿè½½è¾ƒé‡ï¼Œç½‘å¡ä¸€ç›´éƒ½åœ¨æ¥æ”¶æ•°æ®åŒ…ï¼Œé‚£ä¹ˆ CPU å°±ä¼šä¸€ç›´æ”¶åˆ°ä¸­æ–­ï¼ŒCPU å°†ä¸€ç›´å¿™äºä¸­æ–­åˆ‡æ¢ï¼Œå¯¼è‡´å…¶ä»–ä»»åŠ¡å¾—ä¸åˆ°è°ƒåº¦ã€‚&lt;/p>
&lt;ul>
&lt;li>è½®è¯¢æ¨¡å¼&lt;/li>
&lt;/ul>
&lt;p>æ‰€ä»¥é™¤äº†ä¸­æ–­æ¨¡å¼ä¹‹å¤–ï¼Œç½‘å¡è¿˜æœ‰ä¸€ç§è½®è¯¢æ¨¡å¼ï¼Œå³æ”¶åˆ°æ•°æ®åŒ…åéƒ½å…ˆæ”¾åˆ°ç¼“å†²åŒºé‡Œï¼ŒCPU æ¯éš”ä¸€æ®µæ—¶é—´ä¼šå»æ£€æŸ¥ç½‘å¡æ˜¯å¦å—åˆ°æ•°æ®ã€‚å¦‚æœæœ‰æ•°æ®ï¼Œå°±æŠŠç¼“å†²åŒºé‡Œçš„æ•°æ®ä¸€æ³¢å¸¦èµ°è¿›è¡Œå¤„ç†ï¼Œæ²¡æœ‰çš„è¯å°±æ¥ç€å¤„ç†åˆ«çš„ä»»åŠ¡ã€‚&lt;/p>
&lt;p>é€šè¿‡å¯¹æ¯”ä¸­æ–­æ¨¡å¼æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè½®è¯¢æ¨¡å¼è™½ç„¶æ¯éš”ä¸€æ®µæ—¶é—´éœ€è¦ CPU æ£€æŸ¥ä¸€æ¬¡ï¼Œå¸¦æ¥äº†ä¸€å®šçš„å¼€é”€ï¼Œä½†æ˜¯å½“ä¸šåŠ¡ç¹å¿™çš„æ—¶å€™é‡‡ç”¨è½®è¯¢æ¨¡å¼èƒ½å¤Ÿæå¤§çš„å‡å°‘ä¸­æ–­ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æ¬¡æ•°ï¼Œåè€Œå‡è½»äº† CPU çš„è´Ÿæ‹…ã€‚&lt;/p>
&lt;p>ç°åœ¨çš„ç½‘å¡ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸­æ–­+è½®è¯¢çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®ä¸šåŠ¡è´Ÿè½½åŠ¨æ€åˆ‡æ¢ã€‚&lt;/p>
&lt;p>åœ¨ RDMA åè®®ä¸­ï¼ŒCQE å°±ç›¸å½“äºæ˜¯ç½‘å¡æ”¶åˆ°çš„æ•°æ®åŒ…ï¼ŒRDMA ç¡¬ä»¶æŠŠå®ƒä¼ é€’ç»™ CPU å»å¤„ç†ã€‚RDMA æ¡†æ¶å®šä¹‰äº†ä¸¤ç§å¯¹ä¸Šå±‚çš„æ¥å£ï¼Œåˆ†åˆ«æ˜¯ poll å’Œ notifyï¼Œå¯¹åº”ç€è½®è¯¢å’Œä¸­æ–­æ¨¡å¼ã€‚&lt;/p>
&lt;h3 id="poll-completion-queue">Poll completion queue&lt;/h3>
&lt;p>å¾ˆç›´ç™½ï¼Œpoll å°±æ˜¯è½®è¯¢çš„æ„æ€ã€‚ç”¨æˆ·è°ƒç”¨è¿™ä¸ªæ¥å£ä¹‹åï¼ŒCPU å°±ä¼šå®šæœŸå»æ£€æŸ¥ CQ é‡Œé¢æ˜¯å¦æœ‰æ–°é²œçš„ CQEï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±å–å‡ºè¿™ä¸ª CQEï¼ˆæ³¨æ„å–å‡ºä¹‹å CQE å°±è¢«â€œæ¶ˆè€—â€æ‰äº†ï¼‰ï¼Œè§£æå…¶ä¸­çš„ä¿¡æ¯å¹¶è¿”å›ç»™ä¸Šå±‚ç”¨æˆ·ã€‚&lt;/p>
&lt;h3 id="request-completion-notification">Request completion notification&lt;/h3>
&lt;p>ç›´è¯‘è¿‡æ¥æ˜¯è¯·æ±‚å®Œæˆé€šçŸ¥ï¼Œç”¨æˆ·è°ƒç”¨è¿™ä¸ªæ¥å£ä¹‹åï¼Œç›¸å½“äºå‘ç³»ç»Ÿæ³¨å†Œäº†ä¸€ä¸ªä¸­æ–­ã€‚è¿™æ ·å½“ç¡¬ä»¶å°† CQE æ”¾åˆ° CQ ä¸­åï¼Œä¼šç«‹å³è§¦å‘ä¸€ä¸ªä¸­æ–­ç»™ CPUï¼ŒCPU è¿›è€Œå°±ä¼šåœæ­¢æ‰‹ä¸Šçš„å·¥ä½œå–å‡º CQEï¼Œå¤„ç†åè¿”å›ç»™ç”¨æˆ·ã€‚&lt;/p>
&lt;p>åŒæ ·çš„ï¼Œè¿™ä¸¤ç§æ¥å£ä½¿ç”¨å“ªç§ï¼Œå–å†³äºç”¨æˆ·å¯¹äºå®æ—¶æ€§çš„è¦æ±‚ï¼Œä»¥åŠå®é™…ä¸šåŠ¡çš„ç¹å¿™ç¨‹åº¦ã€‚&lt;/p>
&lt;p>æ„Ÿè°¢é˜…è¯»ï¼ŒCQ å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œä¸‹ç¯‡æ‰“ç®—è¯¦ç»†è®²è®² SRQã€‚&lt;/p>
&lt;h2 id="åè®®ç›¸å…³ç« èŠ‚">åè®®ç›¸å…³ç« èŠ‚&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>9.9 CQ é”™è¯¯æ£€æµ‹å’Œæ¢å¤&lt;/p>
&lt;/li>
&lt;li>
&lt;p>10.2.6 CQ å’Œ WQ çš„å…³ç³»&lt;/p>
&lt;/li>
&lt;li>
&lt;p>10.10 é”™è¯¯ç±»å‹åŠå…¶å¤„ç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>11.2.8 CQ ç›¸å…³æ§åˆ¶é¢æ¥å£&lt;/p>
&lt;/li>
&lt;li>
&lt;p>11.4.2 CQ ç›¸å…³æ•°æ®é¢æ¥å£&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å…¶ä»–å‚è€ƒèµ„æ–™">å…¶ä»–å‚è€ƒèµ„æ–™&lt;/h2>
&lt;p>[1] Linux Kernel Networking - Implement and Theory. Chapter 13. Completion Queue&lt;/p></description></item><item><title>RDMA ä¹‹ Queue Pair</title><link>https://cuterwrite.top/p/rdma-queue-pair/</link><pubDate>Tue, 25 Jun 2024 02:21:00 +0000</pubDate><guid>https://cuterwrite.top/p/rdma-queue-pair/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116342820_p0_master1200.webp" alt="Featured image of post RDMA ä¹‹ Queue Pair" />&lt;h1 id="rdma-ä¹‹-queue-pair">RDMA ä¹‹ Queue Pair&lt;/h1>
&lt;p>&lt;strong>æœ¬æ–‡æ¬¢è¿éå•†ä¸šè½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>å£°æ˜ï¼šä»…ç”¨äºæ”¶è—ï¼Œä¾¿äºé˜…è¯»&lt;/p>&lt;span class="cite">&lt;span>â€• &lt;/span>&lt;span>Savir, &lt;/span>&lt;a href="https://zhuanlan.zhihu.com/p/195757767">&lt;cite>çŸ¥ä¹ä¸“æ ï¼š9. RDMA åŸºæœ¬æœåŠ¡ç±»å‹&lt;/cite>&lt;/a>&lt;/span>&lt;/blockquote>
&lt;h2 id="queue-pair">Queue Pair&lt;/h2>
&lt;p>æˆ‘ä»¬æ›¾ç»åœ¨ &lt;a class="link" href="https://cuterwrite.top/p/rdma-element/" >â€œ3. RDMA åŸºæœ¬å…ƒç´ â€
&lt;/a>
ä¸€æ–‡ä¸­ç®€å•çš„ä»‹ç»äº† QP çš„æ¦‚å¿µï¼Œæœ¬æ–‡å°†æ›´æ·±å…¥çš„è®²è§£ä¸€äº›å…³äº QP çš„ç»†èŠ‚ã€‚&lt;/p>
&lt;h2 id="åŸºæœ¬æ¦‚å¿µå›é¡¾">åŸºæœ¬æ¦‚å¿µå›é¡¾&lt;/h2>
&lt;p>é¦–å…ˆæˆ‘ä»¬æ¥ç®€å•å›é¡¾ä¸‹å…³äº QP çš„åŸºç¡€çŸ¥è¯†ï¼š&lt;/p>
&lt;p>æ ¹æ® IB åè®®ä¸­çš„æè¿°ï¼ŒQP æ˜¯ç¡¬ä»¶å’Œè½¯ä»¶ä¹‹é—´çš„ä¸€ä¸ªè™šæ‹Ÿæ¥å£ã€‚QP æ˜¯é˜Ÿåˆ—ç»“æ„ï¼ŒæŒ‰é¡ºåºå­˜å‚¨ç€è½¯ä»¶ç»™ç¡¬ä»¶ä¸‹å‘çš„ä»»åŠ¡ï¼ˆWQEï¼‰ï¼ŒWQE ä¸­åŒ…å«ä»å“ªé‡Œå–å‡ºå¤šé•¿çš„æ•°æ®ï¼Œå¹¶ä¸”å‘é€ç»™å“ªä¸ªç›®çš„åœ°ç­‰ç­‰ä¿¡æ¯ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-26_9_1.webp"
alt="2024-06-26_9_1" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>QP çš„æ¦‚å¿µ&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>æ¯ä¸ª QP é—´éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå½¼æ­¤é€šè¿‡ PD éš”ç¦»ï¼Œå› æ­¤ä¸€ä¸ª QP å¯ä»¥è¢«è§†ä¸ºæŸä¸ªç”¨æˆ·ç‹¬å çš„ä¸€ç§èµ„æºï¼Œä¸€ä¸ªç”¨æˆ·ä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ª QPã€‚&lt;/p>
&lt;p>QP æœ‰å¾ˆå¤šç§æœåŠ¡ç±»å‹ï¼ŒåŒ…æ‹¬ RCã€UDã€RD å’Œ UC ç­‰ï¼Œæ‰€æœ‰çš„æº QP å’Œç›®çš„ QP å¿…é¡»ä¸ºåŒä¸€ç§ç±»å‹æ‰èƒ½è¿›è¡Œæ•°æ®äº¤äº’ã€‚&lt;/p>
&lt;p>è™½ç„¶ IB åè®®å°† QP ç§°ä¸ºâ€œè™šæ‹Ÿæ¥å£â€ï¼Œä½†æ˜¯å®ƒæ˜¯æœ‰å®ä½“çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¡¬ä»¶ä¸Šï¼ŒQP æ˜¯ä¸€æ®µåŒ…å«ç€è‹¥å¹²ä¸ª WQE çš„å­˜å‚¨ç©ºé—´ï¼ŒIB ç½‘å¡ä¼šä»è¿™æ®µç©ºé—´ä¸­è¯»å– WQE çš„å†…å®¹ï¼Œå¹¶æŒ‰ç…§ç”¨æˆ·çš„æœŸæœ›å»å†…å­˜ä¸­å­˜å–æ•°æ®ã€‚è‡³äºè¿™ä¸ªå­˜å‚¨ç©ºé—´æ˜¯å†…å­˜ç©ºé—´è¿˜æ˜¯ IB ç½‘å¡çš„ç‰‡å†…å­˜å‚¨ç©ºé—´ï¼ŒIB åè®®å¹¶æœªåšå‡ºé™åˆ¶ï¼Œæ¯ä¸ªå‚å•†æœ‰å„è‡ªçš„å®ç°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è½¯ä»¶ä¸Šï¼ŒQP æ˜¯ä¸€ä¸ªç”± IB ç½‘å¡çš„é©±åŠ¨ç¨‹åºæ‰€ç»´æŠ¤çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­åŒ…å« QP çš„åœ°å€æŒ‡é’ˆä»¥åŠä¸€äº›ç›¸å…³çš„è½¯ä»¶å±æ€§ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="qpc">QPC&lt;/h3>
&lt;p>&lt;a class="link" href="https://cuterwrite.top/p/rdma-service-types/" >â€œ5. RDMA åŸºæœ¬æœåŠ¡ç±»å‹â€
&lt;/a>
ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬æ›¾ç»æåˆ°è¿‡ QPC å…¨ç§°æ˜¯ Queue Pair Contextï¼Œç”¨äºå­˜å‚¨ QP ç›¸å…³å±æ€§ã€‚é©±åŠ¨ç¨‹åºé‡Œé¢æ˜¯æœ‰å‚¨å­˜ QP çš„è½¯ä»¶å±æ€§çš„ï¼Œæ—¢ç„¶æˆ‘ä»¬å¯ä»¥åœ¨è½¯ä»¶é‡Œå‚¨å­˜ QP çš„å±æ€§ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨ä½¿ç”¨ QPC å‘¢ï¼Ÿ&lt;/p>
&lt;p>è¿™æ˜¯å› ä¸º&lt;strong>QPC ä¸»è¦æ˜¯ç»™ç¡¬ä»¶çœ‹çš„ï¼Œä¹Ÿä¼šç”¨æ¥åœ¨è½¯ç¡¬ä»¶ä¹‹é—´åŒæ­¥ QP çš„ä¿¡æ¯ã€‚&lt;/strong>&lt;/p>
&lt;p>æˆ‘ä»¬è¯´è¿‡ QP åœ¨ç¡¬ä»¶ä¸Šçš„å®ä½“åªæ˜¯ä¸€æ®µå­˜å‚¨ç©ºé—´è€Œå·²ï¼Œç¡¬ä»¶é™¤äº†çŸ¥é“è¿™æ®µç©ºé—´çš„èµ·å§‹åœ°å€å’Œå¤§å°ä¹‹å¤–ä¸€æ— æ‰€çŸ¥ï¼Œç”šè‡³è¿è¿™ä¸ª QP æœåŠ¡ç±»å‹éƒ½ä¸çŸ¥é“ã€‚è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚æŸä¸ª QP ä¸­åŒ…å«äº†è‹¥å¹²ä¸ª WQEï¼Œç¡¬ä»¶æ€ä¹ˆçŸ¥é“æœ‰å¤šå°‘ä¸ªï¼Œå½“å‰åº”è¯¥å¤„ç†ç¬¬å‡ ä¸ªå‘¢ï¼Ÿ&lt;/p>
&lt;p>æ‰€æœ‰ä¸Šè¿°çš„è¿™äº›ä¿¡æ¯ï¼Œè½¯ä»¶æ˜¯å¯ä»¥è®¾è®¡ä¸€å®šçš„æ•°æ®ç»“æ„å¹¶ä¸ºå…¶ç”³è¯·å†…å­˜ç©ºé—´çš„ï¼Œä½†æ˜¯è½¯ä»¶çœ‹åˆ°çš„éƒ½æ˜¯è™šæ‹Ÿåœ°å€ï¼Œè¿™äº›å†…å­˜ç©ºé—´åœ¨ç‰©ç†ä¸Šæ˜¯ç¦»æ•£çš„ï¼Œç¡¬ä»¶å¹¶ä¸çŸ¥é“è¿™äº›æ•°æ®å­˜æ”¾åˆ°äº†å“ªé‡Œã€‚æ‰€ä»¥å°±éœ€è¦è½¯ä»¶é€šè¿‡æ“ä½œç³»ç»Ÿæå‰ç”³è¯·å¥½ä¸€å¤§ç‰‡è¿ç»­çš„ç©ºé—´ï¼Œå³ QPC æ¥æ‰¿è½½è¿™äº›ä¿¡æ¯ç»™ç¡¬ä»¶çœ‹ã€‚ç½‘å¡åŠå…¶é…å¥—çš„é©±åŠ¨ç¨‹åºæå‰çº¦å®šå¥½äº† QPC ä¸­éƒ½æœ‰å“ªäº›å†…å®¹ï¼Œè¿™äº›å†…å®¹åˆ†åˆ«å æ®å¤šå°‘ç©ºé—´ï¼ŒæŒ‰ç…§ä»€ä¹ˆé¡ºåºå­˜æ”¾ã€‚è¿™æ ·é©±åŠ¨å’Œç¡¬ä»¶å°±å¯ä»¥é€šè¿‡é€šè¿‡ QPC è¿™æ®µç©ºé—´æ¥è¯»å†™ QP çš„çŠ¶æ€ç­‰ç­‰ä¿¡æ¯ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-26_9_2_QPC.webp"
alt="2024-06-26_9_2" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>QPC çš„æ¦‚å¿µ&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç¡¬ä»¶å…¶å®åªéœ€è¦çŸ¥é“ QPC çš„åœ°å€ 0x12350000 å°±å¯ä»¥äº†ï¼Œå› ä¸ºå®ƒå¯ä»¥è§£æ QPC çš„å†…å®¹ï¼Œä»è€Œå¾—çŸ¥ QP çš„ä½ç½®ï¼ŒQP åºå·ï¼ŒQP å¤§å°ç­‰ç­‰ä¿¡æ¯ã€‚è¿›è€Œå°±èƒ½æ‰¾åˆ° QPï¼ŒçŸ¥é“åº”è¯¥å–ç¬¬å‡ ä¸ª WQE å»å¤„ç†ã€‚ä¸åŒçš„å‚å•†å¯èƒ½å®ç°æœ‰äº›å·®å¼‚ï¼Œä½†æ˜¯å¤§è‡´çš„åŸç†å°±æ˜¯è¿™æ ·ã€‚&lt;/p>
&lt;p>IB è½¯ä»¶æ ˆä¸­è¿˜æœ‰å¾ˆå¤š Context çš„æ¦‚å¿µï¼Œé™¤äº† QPC ä¹‹å¤–ï¼Œè¿˜æœ‰ Device Contextï¼ŒSRQCï¼ŒCQCï¼ŒEQCï¼ˆEvent Queue Contextï¼Œäº‹ä»¶é˜Ÿåˆ—ä¸Šä¸‹æ–‡ï¼‰ç­‰ï¼Œå®ƒä»¬çš„ä½œç”¨ä¸ QPC ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥åœ¨è®°å½•å’ŒåŒæ­¥æŸç§èµ„æºçš„ç›¸å…³å±æ€§ã€‚&lt;/p>
&lt;h3 id="qp-number">QP Number&lt;/h3>
&lt;p>ç®€ç§°ä¸º QPNï¼Œå°±æ˜¯æ¯ä¸ª QP çš„ç¼–å·ã€‚IB åè®®ä¸­è§„å®šç”¨ $2^{24}$ ä¸ª bit æ¥è¡¨ç¤º QPNï¼Œå³æ¯ä¸ªèŠ‚ç‚¹æœ€å¤§å¯ä»¥åŒæ—¶ä½¿ç”¨ $2^{24}$ ä¸ª QPï¼Œè¿™å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°é‡äº†ï¼Œå‡ ä¹ä¸å¯èƒ½ç”¨å®Œã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å„è‡ªç»´æŠ¤ç€ QPN çš„é›†åˆï¼Œç›¸äº’ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œå³ä¸åŒçš„èŠ‚ç‚¹ä¸Šå¯ä»¥å­˜åœ¨ç¼–å·ç›¸åŒçš„ QPã€‚&lt;/p>
&lt;p>QPN çš„æ¦‚å¿µæœ¬èº«éå¸¸ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„ä¿ç•™ç¼–å·éœ€è¦é¢å¤–æ³¨æ„ä¸€ä¸‹ï¼š&lt;/p>
&lt;h4 id="qp0">QP0&lt;/h4>
&lt;p>ç¼–å·ä¸º 0 çš„ QP ç”¨äºå­ç½‘ç®¡ç†æ¥å£ SMIï¼ˆSubnet Management Interfaceï¼‰ï¼Œç”¨äºç®¡ç†å­ç½‘ä¸­çš„å…¨éƒ¨èŠ‚ç‚¹ï¼Œè¯´å®è¯æˆ‘ä¹Ÿè¿˜æ²¡ææ¸…æ¥šè¿™ä¸ªæ¥å£çš„ä½œç”¨ï¼Œæš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ã€‚&lt;/p>
&lt;h4 id="qp1">QP1&lt;/h4>
&lt;p>ç¼–å·ä¸º 1 çš„ QP ç”¨äºé€šç”¨æœåŠ¡æ¥å£ GSIï¼ˆGeneral Service Interfaceï¼‰ï¼ŒGSI æ˜¯ä¸€ç»„ç®¡ç†æœåŠ¡ï¼Œå…¶ä¸­æœ€å‡ºåçš„å°±æ˜¯ CMï¼ˆCommunication Managementï¼‰ï¼Œæ˜¯ä¸€ç§åœ¨é€šä¿¡åŒæ–¹èŠ‚ç‚¹æ­£å¼å»ºç«‹è¿æ¥ä¹‹å‰ç”¨æ¥äº¤æ¢å¿…é¡»ä¿¡æ¯çš„ä¸€ç§æ–¹å¼ã€‚å…¶ç»†èŠ‚å°†åœ¨åé¢çš„æ–‡ç« ä¸­ä¸“é—¨å±•å¼€ä»‹ç»ã€‚&lt;/p>
&lt;p>è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„æ–‡ç« ç”»çš„å…³äº QP çš„å›¾ä¸­ï¼Œæ²¡æœ‰å‡ºç°è¿‡ QP0 å’Œ QP1 çš„åŸå› äº†ã€‚è¿™ä¸¤ä¸ª QP ä¹‹å¤–çš„å…¶ä»– QP å°±éƒ½æ˜¯æ™®é€š QP äº†ã€‚ç”¨æˆ·åœ¨åˆ›å»º QP çš„æ—¶å€™ï¼Œé©±åŠ¨æˆ–è€…ç¡¬ä»¶ä¼šç»™è¿™ä¸ªæ–° QP åˆ†é…ä¸€ä¸ª QPNï¼Œä¸€èˆ¬çš„ QPN éƒ½æ˜¯ 2ã€3ã€4 è¿™æ ·æŒ‰é¡ºåºåˆ†é…çš„ã€‚å½“ QP è¢«é”€æ¯ä¹‹åï¼Œå®ƒçš„ QPN ä¹Ÿä¼šè¢«é‡æ–°å›æ”¶ï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶å€™åˆ†é…ç»™å…¶ä»–æ–°åˆ›å»ºçš„ QPã€‚&lt;/p>
&lt;h2 id="ç”¨æˆ·æ¥å£">ç”¨æˆ·æ¥å£&lt;/h2>
&lt;p>æˆ‘ä»¬ä»æ§åˆ¶å±‚é¢å’Œæ•°æ®å±‚é¢æ¥åˆ†ç±»ä»‹ç»ç”¨æˆ·æ¥å£ï¼Œæ§åˆ¶é¢å³ç”¨æˆ·å¯¹æŸç§èµ„æºè¿›è¡ŒæŸç§è®¾ç½®ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨æ­£å¼æ”¶å‘æ•°æ®ä¹‹å‰è¿›è¡Œï¼›è€Œæ•°æ®é¢è‡ªç„¶å°±æ˜¯çœŸæ­£çš„æ•°æ®æ”¶å‘è¿‡ç¨‹ä¸­è¿›è¡Œçš„æ“ä½œã€‚&lt;/p>
&lt;h3 id="æ§åˆ¶é¢">æ§åˆ¶é¢&lt;/h3>
&lt;p>æ¥è§¦è¿‡ç®—æ³•çš„è¯»è€…åº”è¯¥éƒ½äº†è§£ï¼Œé“¾è¡¨çš„èŠ‚ç‚¹æ¶‰åŠåˆ°â€œå¢ã€åˆ ã€æ”¹ã€æŸ¥â€å››ä¸ªæ“ä½œï¼Œé“¾è¡¨çš„èŠ‚ç‚¹æ˜¯ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼Œæ˜¯ä¸€ç§è½¯ä»¶èµ„æºã€‚&lt;/p>
&lt;p>â€œå¢â€å³å‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€ç‰‡å†…å­˜ç”¨æ¥å­˜æ”¾æ•°æ®ï¼Œç³»ç»Ÿå°†åœ¨å†…å­˜ä¸­åˆ’åˆ†ä¸€å—ç©ºé—´ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºâ€œå·²è¢«è¿›ç¨‹ XX ä½¿ç”¨â€ï¼Œå…¶ä»–æ²¡æœ‰æƒé™çš„è¿›ç¨‹å°†æ— æ³•è¦†ç›–ç”šè‡³è¯»å–è¿™ç‰‡å†…å­˜ç©ºé—´ã€‚&lt;/p>
&lt;p>â€œåˆ â€å³é€šçŸ¥æ“ä½œç³»ç»Ÿï¼Œè¿™ç‰‡ç©ºé—´æˆ‘ä¸ä½¿ç”¨äº†ï¼Œå¯ä»¥æ ‡è®°æˆâ€œæœªä½¿ç”¨â€å¹¶ç»™å…¶å®ƒè¿›ç¨‹ä½¿ç”¨äº†ã€‚&lt;/p>
&lt;p>â€œæ”¹â€å°±æ˜¯å†™ï¼Œå³ä¿®æ”¹è¿™ç‰‡å†…å­˜åŒºåŸŸçš„å†…å®¹ã€‚&lt;/p>
&lt;p>&amp;ldquo;æŸ¥&amp;quot;å°±æ˜¯è¯»ï¼Œå³è·å–è¿™ç‰‡å†…å­˜åŒºåŸŸçš„å†…å®¹ã€‚&lt;/p>
&lt;p>QP ä½œä¸º RDMA æŠ€æœ¯ä¸­æœ€é‡è¦çš„ä¸€ç§èµ„æºï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸä¸Šä¸é“¾è¡¨å¹¶æ— äºŒè‡´ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ“ä½œ&lt;/th>
&lt;th>é“¾è¡¨èŠ‚ç‚¹&lt;/th>
&lt;th>QP&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>å¢&lt;/td>
&lt;td>struct ListNode *node = malloc(sizeof(struct ListNode *));&lt;/td>
&lt;td>Create QP&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>åˆ &lt;/td>
&lt;td>free(node);&lt;/td>
&lt;td>Destroy QP&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ”¹&lt;/td>
&lt;td>node-&amp;gt;val = xxx;&lt;/td>
&lt;td>Modify QP&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æŸ¥&lt;/td>
&lt;td>xxx = node-&amp;gt;val;&lt;/td>
&lt;td>Query QP&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>è¿™å››ç§æ“ä½œï¼Œå…¶å®å°±æ˜¯ Verbsï¼ˆRDMA å¯¹ä¸Šå±‚åº”ç”¨çš„ APIï¼‰åœ¨æ§åˆ¶é¢ä¸Šå¯¹ä¸Šå±‚ç”¨æˆ·æä¾›ç»™ç”¨æˆ·çš„å‡ ä¸ªæ¥å£ï¼š&lt;/p>
&lt;h4 id="create-qp">Create QP&lt;/h4>
&lt;p>åˆ›å»ºä¸€ä¸ª QP çš„è½¯ç¡¬ä»¶èµ„æºï¼ŒåŒ…å« QP æœ¬èº«ä»¥åŠ QPCã€‚ç”¨æˆ·åˆ›å»ºæ—¶ä¼šå†™ä¼ å…¥ä¸€ç³»åˆ—çš„åˆå§‹åŒ–å±æ€§ï¼ŒåŒ…å«è¯¥ QP çš„æœåŠ¡ç±»å‹ï¼Œå¯ä»¥å‚¨å­˜çš„ WQE æ•°é‡ç­‰ä¿¡æ¯&lt;/p>
&lt;h4 id="destroy-qp">Destroy QP&lt;/h4>
&lt;p>é‡Šæ”¾ä¸€ä¸ª QP çš„å…¨éƒ¨è½¯ç¡¬ä»¶èµ„æºï¼ŒåŒ…å« QP æœ¬èº«åŠ QPCã€‚é”€æ¯ QP åï¼Œç”¨æˆ·å°†æ— æ³•é€šè¿‡ QPN ç´¢å¼•åˆ°è¿™ä¸ª QPã€‚&lt;/p>
&lt;h4 id="modify-qp">Modify QP&lt;/h4>
&lt;p>ä¿®æ”¹ä¸€ä¸ª QP çš„æŸäº›å±æ€§ï¼Œæ¯”å¦‚ QP çš„çŠ¶æ€ï¼Œè·¯å¾„çš„ MTU ç­‰ç­‰ã€‚è¿™ä¸ªä¿®æ”¹è¿‡ç¨‹æ—¢åŒ…æ‹¬è½¯ä»¶æ•°æ®ç»“æ„çš„ä¿®æ”¹ï¼Œä¹ŸåŒ…æ‹¬å¯¹ QPC çš„ä¿®æ”¹ã€‚&lt;/p>
&lt;h4 id="query-qp">Query QP&lt;/h4>
&lt;p>æŸ¥è¯¢ä¸€ä¸ª QP å½“å‰çš„çŠ¶æ€å’Œä¸€äº›å±æ€§ï¼ŒæŸ¥è¯¢åˆ°çš„æ•°æ®æ¥æºäºé©±åŠ¨ä»¥åŠ QPC çš„å†…å®¹ã€‚&lt;/p>
&lt;p>è¿™å››ç§æ“ä½œéƒ½æœ‰é…å¥—çš„ Verbs æ¥å£ï¼Œç±»ä¼¼äº &lt;code>ibv_create_qp()&lt;/code> è¿™ç§å½¢å¼ï¼Œæˆ‘ä»¬ç¼–å†™ APP æ—¶ç›´æ¥è°ƒç”¨å°±å¯ä»¥äº†ã€‚æ›´å¤šå…³äºå¯¹ä¸Šå±‚çš„ API çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬å°†åœ¨åé¢ä¸“é—¨è¿›è¡Œä»‹ç»ã€‚&lt;/p>
&lt;h2 id="æ•°æ®é¢">æ•°æ®é¢&lt;/h2>
&lt;p>æ•°æ®é¢ä¸Šï¼Œä¸€ä¸ª QP å¯¹ä¸Šå±‚çš„æ¥å£å…¶å®åªæœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ç”¨äºå‘ QP ä¸­å¡«å†™å‘é€å’Œæ¥æ”¶è¯·æ±‚ã€‚&lt;strong>è¿™é‡Œçš„â€œå‘é€â€å’Œâ€œæ¥æ”¶â€å¹¶ä¸æ˜¯æŒ‡çš„å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè€Œæ˜¯æŒ‡çš„æ˜¯ä¸€æ¬¡é€šä¿¡è¿‡ç¨‹çš„â€œå‘èµ·æ–¹â€ï¼ˆRequestorï¼‰å’Œâ€œæ¥æ”¶æ–¹â€ï¼ˆResponserï¼‰&lt;/strong>ã€‚&lt;/p>
&lt;p>åœ¨è¡Œä¸ºä¸Šéƒ½æ˜¯è½¯ä»¶å‘ QP ä¸­å¡«å†™ä¸€ä¸ª WQEï¼ˆå¯¹åº”ç”¨å±‚æ¥è¯´å« WRï¼‰ï¼Œè¯·æ±‚ç¡¬ä»¶æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œã€‚æ‰€ä»¥è¿™ä¸¤ç§è¡Œä¸ºéƒ½å«åšâ€œPost XXX Requestâ€çš„å½¢å¼ï¼Œå³ä¸‹å‘ XXX è¯·æ±‚ã€‚&lt;/p>
&lt;h3 id="post-send-request">Post Send Request&lt;/h3>
&lt;p>å†å¼ºè°ƒä¸€ä¸‹ï¼ŒPost Send æœ¬èº«ä¸æ˜¯æŒ‡è¿™ä¸ª WQE çš„æ“ä½œç±»å‹æ˜¯ Sendï¼Œè€Œæ˜¯è¡¨ç¤ºè¿™ä¸ª WQE å±äºé€šä¿¡å‘èµ·æ–¹ã€‚è¿™ä¸ªæµç¨‹ä¸­å¡«å†™åˆ° QP ä¸­çš„ WQE/WR å¯ä»¥æ˜¯ Send æ“ä½œï¼ŒRDMA Write æ“ä½œä»¥åŠ RDMA Read æ“ä½œç­‰ã€‚&lt;/p>
&lt;p>ç”¨æˆ·éœ€è¦æå‰å‡†å¤‡å¥½æ•°æ®ç¼“å†²åŒºã€ç›®çš„åœ°å€ç­‰ä¿¡æ¯ï¼Œç„¶åè°ƒç”¨æ¥å£å°† WR ä¼ ç»™é©±åŠ¨ï¼Œé©±åŠ¨å†æŠŠ WQE å¡«å†™åˆ° QP ä¸­ã€‚&lt;/p>
&lt;h3 id="post-receive-request">Post Receive Request&lt;/h3>
&lt;p>Post Recv çš„ä½¿ç”¨åœºæ™¯å°±ç›¸å¯¹æ¯”è¾ƒå°‘äº†ï¼Œä¸€èˆ¬åªåœ¨ Send-Recv æ“ä½œçš„æ¥æ”¶ç«¯æ‰§è¡Œï¼Œæ¥æ”¶ç«¯éœ€è¦æå‰å‡†å¤‡å¥½æ¥æ”¶æ•°æ®çš„ç¼“å†²åŒºï¼Œå¹¶å°†ç¼“å†²åŒºåœ°å€ç­‰ä¿¡æ¯ä»¥ WQE çš„å½¢å¼å‘ŠçŸ¥ç¡¬ä»¶ã€‚&lt;/p>
&lt;h2 id="qp-çŠ¶æ€æœº">QP çŠ¶æ€æœº&lt;/h2>
&lt;p>è¯´åˆ° QP çš„çŠ¶æ€ï¼Œå°±ä¸å¾—ä¸ç¥­å‡ºä¸‹é¢è¿™å¼ å›¾ï¼ˆå–è‡ª IB åè®® 10.3.1 èŠ‚ï¼‰ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-26_9_3.webp"
alt="2024-06-26_9_3" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>QP çŠ¶æ€æœº&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>æ‰€è°“çŠ¶æ€æœºï¼Œå°±æ˜¯æè¿°ä¸€ä¸ªå¯¹è±¡çš„ä¸åŒçŠ¶æ€ï¼Œä»¥åŠè§¦å‘çŠ¶æ€é—´è·³è½¬çš„æ¡ä»¶ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾è®¡çŠ¶æ€æœºå¯ä»¥ä½¿è¿™ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—éå¸¸æ˜ç¡®ï¼Œå®ç°ä¸Šä¹Ÿä¼šä½¿å¾—é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚&lt;/p>
&lt;p>å¯¹äº QP æ¥è¯´ï¼ŒIB è§„èŒƒä¹Ÿä¸ºå…¶è®¾è®¡äº†å‡ ç§çŠ¶æ€ï¼Œå¤„äºä¸åŒçŠ¶æ€çš„ QP çš„åŠŸèƒ½æ˜¯æœ‰å·®å¼‚çš„ï¼Œæ¯”å¦‚åªæœ‰è¿›å…¥åˆ° Ready to Send çŠ¶æ€ä¹‹åï¼ŒQP æ‰èƒ½å¤Ÿè¿›è¡Œ Post Send æ•°æ®æ“ä½œã€‚æ­£å¸¸çŠ¶æ€ï¼ˆç»¿è‰²çš„ï¼‰ä¹‹é—´çš„çŠ¶æ€è½¬æ¢éƒ½æ˜¯ç”±ç”¨æˆ·é€šè¿‡ä¸Šæ–‡ä»‹ç»çš„ Modify QP çš„ç”¨æˆ·æ¥å£æ¥ä¸»åŠ¨è§¦å‘çš„ï¼›è€Œé”™è¯¯çŠ¶æ€ï¼ˆçº¢è‰²çš„ï¼‰å¾€å¾€æ˜¯å‡ºé”™ä¹‹åè‡ªåŠ¨è·³è½¬çš„ï¼Œå½“ä¸€ä¸ª QP å¤„äºé”™è¯¯çŠ¶æ€ä¹‹åå°±æ— æ³•æ‰§è¡Œæ­£å¸¸çš„ä¸šåŠ¡äº†ï¼Œå°±éœ€è¦ä¸Šå±‚é€šè¿‡ Modify QP å°†å…¶é‡æ–°é…ç½®åˆ°æ­£å¸¸çŠ¶æ€ä¸Šã€‚&lt;/p>
&lt;p>ä¸Šå›¾ä¸­æˆ‘ä»¬åªå…³æ³¨ QP çš„éƒ¨åˆ†ï¼ŒEEï¼ˆEnd-to-End Contextï¼‰æ˜¯ä¸“é—¨ç»™ RD æœåŠ¡ç±»å‹ä½¿ç”¨çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬æš‚ä¸æ¶‰åŠã€‚æˆ‘ä»¬é€šè¿‡ Create QP æ¥å£æ¥è¿›å…¥è¿™ä¸ªçŠ¶æ€å›¾ï¼Œé€šè¿‡ Destroy QP æ¥å£æ¥ç¦»å¼€è¿™ä¸ªçŠ¶æ€å›¾ã€‚&lt;/p>
&lt;p>QP æœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼Œæˆ‘ä»¬ä»…ä»‹ç»ä¸€ä¸‹æ¯”è¾ƒé‡è¦çš„ç‚¹ï¼š&lt;/p>
&lt;h3 id="rstreset">RSTï¼ˆResetï¼‰&lt;/h3>
&lt;p>å¤ä½çŠ¶æ€ã€‚å½“ä¸€ä¸ª QP é€šè¿‡ Create QP åˆ›å»ºå¥½ä¹‹åå°±å¤„äºè¿™ä¸ªçŠ¶æ€ï¼Œç›¸å…³çš„èµ„æºéƒ½å·²ç»ç”³è¯·å¥½äº†ï¼Œä½†æ˜¯è¿™ä¸ª QP ç›®å‰ä»€ä¹ˆéƒ½åšä¸äº†ï¼Œå…¶æ— æ³•æ¥æ”¶ç”¨æˆ·ä¸‹å‘çš„ WQEï¼Œä¹Ÿæ— æ³•æ¥å—å¯¹ç«¯æŸä¸ª QP çš„æ¶ˆæ¯ã€‚&lt;/p>
&lt;h3 id="initinitialized">INITï¼ˆInitializedï¼‰&lt;/h3>
&lt;p>å·²åˆå§‹åŒ–çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ Post Receive ç»™è¿™ä¸ª QP ä¸‹å‘ Receive WRï¼Œä½†æ˜¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯å¹¶ä¸ä¼šè¢«å¤„ç†ï¼Œä¼šè¢«é™é»˜ä¸¢å¼ƒï¼›å¦‚æœç”¨æˆ·ä¸‹å‘äº†ä¸€ä¸ª Post Send çš„ WRï¼Œåˆ™ä¼šæŠ¥é”™ã€‚&lt;/p>
&lt;h3 id="rtrready-to-receive">RTRï¼ˆReady to Receiveï¼‰&lt;/h3>
&lt;p>å‡†å¤‡æ¥æ”¶çŠ¶æ€ã€‚åœ¨ INIT çŠ¶æ€çš„åŸºç¡€ä¸Šï¼ŒRQ å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå³å¯¹äºæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå¯ä»¥æŒ‰ç…§å…¶ä¸­ WQE çš„æŒ‡ç¤ºæ¬ç§»æ•°æ®åˆ°æŒ‡å®šå†…å­˜ä½ç½®ã€‚æ­¤çŠ¶æ€ä¸‹ SQ ä»ç„¶ä¸èƒ½å·¥ä½œã€‚&lt;/p>
&lt;h3 id="rtsready-to-send">RTSï¼ˆReady to Sendï¼‰&lt;/h3>
&lt;p>å‡†å¤‡å‘é€çŠ¶æ€ã€‚åœ¨ RTR åŸºç¡€ä¸Šï¼ŒSQ å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå³ç”¨æˆ·å¯ä»¥è¿›è¡Œ Post Sendï¼Œå¹¶ä¸”ç¡¬ä»¶ä¹Ÿä¼šæ ¹æ® SQ çš„å†…å®¹å°†æ•°æ®å‘é€å‡ºå»ã€‚è¿›å…¥è¯¥çŠ¶æ€å‰ï¼ŒQP å¿…é¡»å·²äºå¯¹ç«¯å»ºç«‹å¥½é“¾æ¥ã€‚&lt;/p>
&lt;h3 id="sqdsend-queue-drain">SQDï¼ˆSend Queue Drainï¼‰&lt;/h3>
&lt;p>SQ æ’ç©ºçŠ¶æ€ã€‚é¡¾åæ€ä¹‰ï¼Œè¯¥çŠ¶æ€ä¼šå°† SQ é˜Ÿåˆ—ä¸­ç°å­˜çš„æœªå¤„ç†çš„ WQE å…¨éƒ¨å¤„ç†æ‰ï¼Œè¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿˜å¯ä»¥ä¸‹å‘æ–°çš„ WQE ä¸‹æ¥ï¼Œä½†æ˜¯è¿™äº› WQE è¦ç­‰åˆ°æ—§çš„ WQE å…¨å¤„ç†ä¹‹åæ‰ä¼šè¢«å¤„ç†ã€‚&lt;/p>
&lt;h3 id="sqersend-queue-error">SQErï¼ˆSend Queue Errorï¼‰&lt;/h3>
&lt;p>SQ é”™è¯¯çŠ¶æ€ã€‚å½“æŸä¸ª Send WR å‘ç”Ÿå®Œæˆé”™è¯¯ï¼ˆå³ç¡¬ä»¶é€šè¿‡ CQE å‘ŠçŸ¥é©±åŠ¨å‘ç”Ÿçš„é”™è¯¯ï¼‰æ—¶ï¼Œä¼šå¯¼è‡´ QP è¿›å…¥æ­¤çŠ¶æ€ã€‚&lt;/p>
&lt;h3 id="errerror">ERRï¼ˆErrorï¼‰&lt;/h3>
&lt;p>å³é”™è¯¯çŠ¶æ€ã€‚å…¶ä»–çŠ¶æ€å¦‚æœå‘ç”Ÿäº†é”™è¯¯ï¼Œéƒ½å¯èƒ½è¿›å…¥è¯¥çŠ¶æ€ã€‚Error çŠ¶æ€æ—¶ï¼ŒQP ä¼šåœæ­¢å¤„ç† WQEï¼Œå·²ç»å¤„ç†åˆ°ä¸€åŠçš„ WQE ä¹Ÿä¼šåœæ­¢ã€‚ä¸Šå±‚éœ€è¦åœ¨ä¿®å¤é”™è¯¯åå†å°† QP é‡æ–°åˆ‡æ¢åˆ° RST çš„åˆå§‹çŠ¶æ€ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ¬æ–‡å…ˆå›é¡¾äº† QP çš„ä¸€äº›é‡è¦åŸºæœ¬æ¦‚å¿µï¼Œç„¶åè®²è§£äº† QPCã€QPN ç­‰ QP å¼ºç›¸å…³çš„æ¦‚å¿µï¼Œæœ€åä»‹ç»äº†ç”¨æˆ·æ“ä½œ QP å¸¸ç”¨çš„æ¥å£ä»¥åŠ QP çŠ¶æ€æœºï¼Œç›¸ä¿¡æœ¬æ–‡è¿‡åè¯»è€…ä¸€å®šå¯¹ QP æœ‰äº†æ›´æ·±çš„äº†è§£ã€‚&lt;/p>
&lt;p>å…¶å®ä½œä¸º RDMA çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒQP çš„å†…å®¹å¾ˆå¤šï¼Œæœ¬æ–‡éš¾ä»¥å…¨éƒ¨å›Šæ‹¬ã€‚æˆ‘å°†åœ¨åé¢çš„æ–‡ç« ä¸­é€æ¸æŠŠç›¸å…³çš„å†…å®¹è¡¥å…¨ï¼Œæ¯”å¦‚ QKey çš„æ¦‚å¿µå°†åœ¨åç»­ä¸“é—¨ä»‹ç»å„ç§ Key çš„æ–‡ç« ä¸­è®²è§£ã€‚&lt;/p>
&lt;p>å¥½äº†ï¼Œæœ¬æ–‡å°±åˆ°è¿™äº†ï¼Œæ„Ÿè°¢é˜…è¯»ã€‚é¢„å‘Šä¸‹ä¸€ç¯‡æ–‡ç« å°†è¯¦ç»†è®²è§£ CQã€‚&lt;/p>
&lt;h2 id="åè®®ç›¸å…³ç« èŠ‚">åè®®ç›¸å…³ç« èŠ‚&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>3.5.1 10.2.4 QP çš„åŸºæœ¬æ¦‚å¿µ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>10.3 QP çŠ¶æ€æœº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>10.2.5 QP ç›¸å…³çš„è½¯ä»¶æ¥å£&lt;/p>
&lt;/li>
&lt;li>
&lt;p>11.4 Post Send Post Recv&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>åŸºäº Workbox å®ç° Hugo æ¸è¿›å¼ Web åº”ç”¨</title><link>https://cuterwrite.top/p/hugo-pwa/</link><pubDate>Tue, 18 Jun 2024 22:28:00 +0000</pubDate><guid>https://cuterwrite.top/p/hugo-pwa/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116406967_p0_master1200.webp" alt="Featured image of post åŸºäº Workbox å®ç° Hugo æ¸è¿›å¼ Web åº”ç”¨" />&lt;h1 id="åŸºäº-workbox-å®ç°-hugo-pwa">åŸºäº Workbox å®ç° Hugo PWA&lt;/h1>
&lt;p>æœ€è¿‘ç»™åŸºäº &lt;a class="link" href="https://gohugo.io/" target="_blank" rel="noopener" >Hugo
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
æ­å»ºçš„åšå®¢æ·»åŠ äº† PWA åŠŸèƒ½ï¼Œæ˜¾è‘—æå‡äº†åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒï¼Œç”šè‡³å®ç°äº†ç¦»çº¿è®¿é—®ã€‚è‡³äºå¦‚ä½•å®ç°ï¼Œé‚£ä¹ˆä½ éœ€è¦äº†è§£ &lt;strong>Progressive Web Apps (PWA)&lt;/strong>ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-pwa">ä»€ä¹ˆæ˜¯ PWA&lt;/h2>
&lt;p>æ¸è¿›å¼ Web åº”ç”¨ï¼ˆProgressive Web Appsï¼Œç®€ç§° PWAï¼‰åˆ©ç”¨ç°ä»£ Web API å’Œä¼ ç»Ÿçš„æ¸è¿›å¼å¢å¼ºç­–ç•¥ï¼Œæ‰“é€ å‡ºè·¨å¹³å°çš„ Web åº”ç”¨ç¨‹åºã€‚è¿™äº›åº”ç”¨æ— å¤„ä¸åœ¨ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œä¸ºç”¨æˆ·å¸¦æ¥åª²ç¾åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚&lt;/p>
&lt;p>&lt;strong>PWA çš„ä¼˜åŠ¿ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>âš¡ï¸ &lt;strong>æ›´å¿«çš„åŠ è½½é€Ÿåº¦&lt;/strong>: PWA å¯ä»¥ç¼“å­˜é‡è¦èµ„æºï¼Œå³ä½¿ç½‘ç»œçŠ¶å†µä¸ä½³ä¹Ÿèƒ½å¿«é€ŸåŠ è½½ã€‚&lt;/li>
&lt;li>âœˆï¸ &lt;strong>ç¦»çº¿è®¿é—®&lt;/strong>: PWA å¯ä»¥ç¼“å­˜å†…å®¹ï¼Œè®©ç”¨æˆ·å³ä½¿ç¦»çº¿ä¹Ÿèƒ½è®¿é—®å†…å®¹ã€‚&lt;/li>
&lt;li>ğŸ”” &lt;strong>æ¨é€é€šçŸ¥&lt;/strong>: åƒåŸç”Ÿåº”ç”¨ä¸€æ ·ï¼ŒPWA å¯ä»¥å‘ç”¨æˆ·å‘é€æ¨é€é€šçŸ¥ï¼Œæé«˜ç”¨æˆ·å‚ä¸åº¦ã€‚&lt;/li>
&lt;li>ğŸ“± &lt;strong>å®‰è£…åˆ°ä¸»å±å¹•&lt;/strong>: ç”¨æˆ·å¯ä»¥å°†ä½ çš„åº”ç”¨æ·»åŠ åˆ°ç”µè„‘æˆ–æ‰‹æœºæ¡Œé¢ï¼ŒåƒåŸç”Ÿåº”ç”¨ä¸€æ ·æµè§ˆä½ çš„ Web åº”ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>PWA çš„å®ç°åŸç†æ˜¯ &lt;strong>Service Worker&lt;/strong>ã€‚&lt;strong>Service Worker æ˜¯ä¸€ç§ç‰¹æ®Šçš„ JavaScript èµ„æºï¼Œåœ¨æµè§ˆå™¨åå°ç‹¬ç«‹è¿è¡Œï¼Œå……å½“ç€ç½‘ç»œæµè§ˆå™¨å’Œ Web æœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†ã€‚å®ƒå¯ä»¥æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚ã€ç¼“å­˜èµ„æºä»¥åŠæ¨é€é€šçŸ¥&lt;/strong>ã€‚&lt;/p>
&lt;p>ä¸»æµçš„å‰ç«¯æ¡†æ¶ Vueã€Reactã€Angular éƒ½æä¾›äº†ç›¸åº”çš„ PWA æ’ä»¶ã€‚è€Œå¯¹äº Hugo è¿™æ ·çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ·»åŠ  &lt;a class="link" href="https://developer.chrome.com/docs/workbox" target="_blank" rel="noopener" >Workbox
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
æ¥å®ç° PWA åŠŸèƒ½ã€‚&lt;/p>
&lt;h2 id="workbox">Workbox&lt;/h2>
&lt;p>&lt;a class="link" href="https://developer.chrome.com/docs/workbox" target="_blank" rel="noopener" >Workbox
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
æ˜¯ç”± Google Chrome å›¢é˜Ÿå¼€å‘çš„ä¸€å¥—æ¨¡å—ï¼Œæ—¨åœ¨ç®€åŒ–å¸¸è§çš„ Service Worker è·¯ç”±å’Œç¼“å­˜æ“ä½œã€‚æ¯ä¸ªæ¨¡å—éƒ½é’ˆå¯¹ Service Worker å¼€å‘çš„ç‰¹å®šæ–¹é¢è¿›è¡Œäº†ä¼˜åŒ–ã€‚Workbox çš„ç›®æ ‡æ˜¯å°½å¯èƒ½ç®€åŒ– Service Worker çš„ä½¿ç”¨ï¼ŒåŒæ—¶åœ¨éœ€è¦æ—¶çµæ´»åœ°æ»¡è¶³å¤æ‚åº”ç”¨çš„éœ€æ±‚ã€‚&lt;/p>
&lt;p>å¦‚æœæ²¡æœ‰ Workboxï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç¼–å†™ Service Worker æ¥ç›‘å¬ fetch äº‹ä»¶ã€ç¼“å­˜èµ„æºå¹¶å®ç°ç¦»çº¿è®¿é—®ç­‰åŠŸèƒ½ã€‚è€Œ Workbox æä¾›äº†ä¸€å¥—å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ Service Workerï¼Œå¹¶ä¸”å†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„ç¼“å­˜ç­–ç•¥ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚&lt;/p>
&lt;h2 id="é…ç½®-pwa">é…ç½® PWA&lt;/h2>
&lt;p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº† PWA çš„æ¦‚å¿µå’Œä¼˜åŠ¿ï¼Œä»¥åŠ Workbox å¦‚ä½•ç®€åŒ– Service Worker çš„å¼€å‘ã€‚æ¥ä¸‹æ¥å°†ä¸€æ­¥æ­¥åœ°ç»™ Hugo åšå®¢é…ç½® PWA åŠŸèƒ½ã€‚&lt;/p>
&lt;h3 id="æ³¨å†Œ-service-worker">æ³¨å†Œ Service Worker&lt;/h3>
&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡µé¢ä¸­æ³¨å†Œ Service Workerã€‚å°†ä»¥ä¸‹ä»£ç æ®µæ·»åŠ åˆ°ä½ çš„ Hugo ä¸»é¢˜çš„ &lt;code>layouts/partials/footer/custom.html&lt;/code> æ–‡ä»¶ä¸­ï¼ˆå…¶ä»–ä¸»é¢˜å¯èƒ½éœ€è¦æ ¹æ®æ–‡ä»¶ç»“æ„è¿›è¡Œè°ƒæ•´ï¼‰ï¼š&lt;/p>
&lt;pre>&lt;code class="language-javascript">&amp;lt;script&amp;gt;
// Check that service workers are registered
if ('serviceWorker' in navigator) {
// Use the window load event to keep the page load performant
window.addEventListener('load', () =&amp;gt; {
navigator.serviceWorker.register('/sw.js').then(reg =&amp;gt; {
console.log('Service worker registered with scope: ', reg.scope);
}, err =&amp;gt; {
console.log('Service worker registration failed: ', err);
});
});
}
&amp;lt;/script&amp;gt;
&lt;/code>&lt;/pre>
&lt;div class="notice notice-tip" >
&lt;div class="notice-title">&lt;svg t="1705945832245" class="icon notice-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19409" width="200" height="200">&lt;path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m238.933333 349.866666l-2.133333 2.133334-277.333333 277.333333c-10.666667 10.666667-29.866667 12.8-42.666667 2.133333L426.666667 704l-149.333334-149.333333c-12.8-12.8-12.8-32 0-44.8 10.666667-10.666667 29.866667-12.8 42.666667-2.133334l2.133333 2.133334 125.866667 125.866666 253.866667-253.866666c10.666667-10.666667 29.866667-12.8 42.666666-2.133334l2.133334 2.133334c12.8 12.8 12.8 32 4.266666 42.666666z" fill="#ffffff" p-id="19410">&lt;/path>&lt;/svg>&lt;/div>&lt;p>æ³¨æ„ï¼š åœ¨æ³¨å†Œ Service Worker ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆåˆ›å»º &lt;code>sw.js&lt;/code> æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€å°èŠ‚ä¸­å®Œæˆè¿™ä¸€æ­¥éª¤ã€‚&lt;/p>&lt;/div>
&lt;p>å®Œæˆæ³¨å†Œåï¼Œä½ å¯ä»¥åœ¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…· (F12) ä¸­çš„ &lt;strong>&amp;ldquo;Application&amp;rdquo; -&amp;gt; &amp;ldquo;Service Workers&amp;rdquo;&lt;/strong> é¢æ¿ä¸­æŸ¥çœ‹ Service Worker çš„æ³¨å†ŒçŠ¶æ€ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-19_service-worker.webp"
alt="Service Worker" width="90%" loading="lazy">&lt;figcaption>
&lt;h4>Service Worker&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;h3 id="å¯¼å…¥-workbox">å¯¼å…¥ Workbox&lt;/h3>
&lt;p>åœ¨ä½ çš„ Hugo ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ &lt;code>static&lt;/code> æ–‡ä»¶å¤¹ä¸­åˆ›å»º &lt;code>sw.js&lt;/code> æ–‡ä»¶ã€‚ç„¶åï¼Œåœ¨ &lt;code>sw.js&lt;/code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œä½¿ç”¨ CDN å¯¼å…¥ Workboxï¼š&lt;/p>
&lt;pre>&lt;code class="language-javascript">importScripts('https://cdn.bootcdn.net/ajax/libs/workbox-sw/7.1.0/workbox-sw.js');
&lt;/code>&lt;/pre>
&lt;h3 id="ç¼“å­˜ç­–ç•¥">ç¼“å­˜ç­–ç•¥&lt;/h3>
&lt;p>Workbox æä¾›äº†ä¸€äº›å¸¸ç”¨çš„ç¼“å­˜ç­–ç•¥ï¼Œå¦‚ &lt;code>CacheFirst&lt;/code>ã€&lt;code>NetworkFirst&lt;/code>ã€&lt;code>StaleWhileRevalidate&lt;/code> ç­‰ã€‚è¿™é‡Œå…ˆä»‹ç»å‡ ç§å¸¸ç”¨çš„ç­–ç•¥ã€‚&lt;/p>
&lt;h4 id="cacheonly-ä»…ç¼“å­˜">CacheOnly ä»…ç¼“å­˜&lt;/h4>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-19_cache-6850d07d742bf_1440.webp"
alt="CacheOnly" width="90%" loading="lazy">&lt;figcaption>
&lt;h4>CacheOnly&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>å¼ºåˆ¶å“åº”æ¥è‡ªç¼“å­˜ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp(regex),
new workbox.strategies.CacheOnly()
);
&lt;/code>&lt;/pre>
&lt;h4 id="networkonly-ä»…ç½‘ç»œ">NetworkOnly ä»…ç½‘ç»œ&lt;/h4>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-19_network-48f46158a5575_1440.webp"
alt="NetworkOnly" width="90%" loading="lazy">&lt;figcaption>
&lt;h4>NetworkOnly&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>è¿™ç§ç¼“å­˜ç­–ç•¥å¼ºåˆ¶è¦æ±‚æ‰€æœ‰è¯·æ±‚éƒ½ä»ç½‘ç»œè·å–æœ€æ–°æ•°æ®ï¼Œå®Œå…¨ç»•è¿‡ç¼“å­˜ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp(regex),
new workbox.strategies.NetworkOnly()
);
&lt;/code>&lt;/pre>
&lt;h4 id="cachefirst-ä¼˜å…ˆç¼“å­˜">CacheFirst ä¼˜å…ˆç¼“å­˜&lt;/h4>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-19_cache-falling-to-networ-f4c1aa5570621_1440.webp"
alt="CacheFirst" width="90%" loading="lazy">&lt;figcaption>
&lt;h4>CacheFirst&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>è¿™ç§ç¼“å­˜ç­–ç•¥ä»¥é€Ÿåº¦ä¸ºä¼˜å…ˆï¼Œä¼šé¦–å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–å“åº”ï¼Œä»¥å°½å¿«å‘ç”¨æˆ·æ˜¾ç¤ºå†…å®¹ã€‚å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ‰€éœ€æ•°æ®ï¼Œå®ƒæ‰ä¼šå‘ç½‘ç»œå‘èµ·è¯·æ±‚è·å–æ•°æ®ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp(regex),
new workbox.strategies.CacheFirst()
);
&lt;/code>&lt;/pre>
&lt;h4 id="networkfirst-ä¼˜å…ˆç½‘ç»œ">NetworkFirst ä¼˜å…ˆç½‘ç»œ&lt;/h4>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-19_network-falling-to-cache-39d267a044b35_1440.webp"
alt="NetworkFirst" width="90%" loading="lazy">&lt;figcaption>
&lt;h4>NetworkFirst&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>è¿™ç§ç¼“å­˜ç­–ç•¥ä¼˜å…ˆä½¿ç”¨æœ€æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¦–å…ˆå°è¯•ä»ç½‘ç»œè·å–å“åº”ã€‚å¦‚æœç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œä¾‹å¦‚ç”¨æˆ·ç¦»çº¿æˆ–ç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼Œå®ƒä¼šå›é€€ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œç¡®ä¿ç”¨æˆ·ä»ç„¶å¯ä»¥è®¿é—®å†…å®¹ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp(regex),
new workbox.strategies.NetworkFirst()
);
&lt;/code>&lt;/pre>
&lt;h4 id="stalewhilerevalidate-è¯»å–ç¼“å­˜åŒæ—¶å‘èµ·ç½‘ç»œè¯·æ±‚">StaleWhileRevalidate è¯»å–ç¼“å­˜ï¼ŒåŒæ—¶å‘èµ·ç½‘ç»œè¯·æ±‚&lt;/h4>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-19_cache-network-873b1ec5f25cc_1440.webp"
alt="StaleWhileRevalidate" width="90%" loading="lazy">&lt;figcaption>
&lt;h4>StaleWhileRevalidate&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>è¿™ç§ç¼“å­˜ç­–ç•¥ä¼˜å…ˆè¿”å›ç¼“å­˜å†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚å³ä½¿ç¼“å­˜å†…å®¹æœ‰æ•ˆï¼Œå®ƒä¹Ÿä¼šåœ¨åå°å‘èµ·ç½‘ç»œè¯·æ±‚ä»¥è·å–æœ€æ–°æ•°æ®ï¼Œä¿è¯ç”¨æˆ·æœ€ç»ˆèƒ½çœ‹åˆ°æœ€æ–°å†…å®¹ã€‚è™½ç„¶è¿™ç§ç­–ç•¥èƒ½ç¡®ä¿ç”¨æˆ·å®šæœŸæ›´æ–°ç¼“å­˜ï¼Œä½†ä¹Ÿæ„å‘³ç€æ¯æ¬¡è¯·æ±‚éƒ½ä¼šäº§ç”Ÿç½‘ç»œæµé‡ï¼Œå³ä½¿æ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œä¹Ÿæ¯”è¾ƒæµªè´¹å¸¦å®½ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp(regex),
new workbox.strategies.StaleWhileRevalidate()
);
&lt;/code>&lt;/pre>
&lt;h4 id="ç­–ç•¥é…ç½®">ç­–ç•¥é…ç½®&lt;/h4>
&lt;p>Workbox ä¸ä»…æä¾›ä¸Šè¿°ç­–ç•¥ï¼Œè¿˜å…è®¸é€šè¿‡ cacheNameã€plugins å’Œ expiration ç­‰é…ç½®é¡¹è¿›è¡Œè‡ªå®šä¹‰ã€‚ä½ å¯ä»¥é€šè¿‡å®šä¹‰è¦ä½¿ç”¨çš„æ’ä»¶æ¥è‡ªå®šä¹‰è·¯ç”±è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é…ç½®ç¼“å­˜åç§°ã€ç¼“å­˜æœ‰æ•ˆæœŸä»¥åŠå¯ç¼“å­˜çš„å“åº”çŠ¶æ€ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp(regex),
new workbox.strategies.CacheFirst({
cacheName: 'my-cache',
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: 60,
maxAgeSeconds: 30 * 24 * 60 * 60, // 30 Days
}),
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
&lt;/code>&lt;/pre>
&lt;h3 id="æœ¬ç«™é…ç½®">æœ¬ç«™é…ç½®&lt;/h3>
&lt;h4 id="å…¨å±€é…ç½®">å…¨å±€é…ç½®&lt;/h4>
&lt;p>ä»¥ä¸‹æ˜¯å…¨å±€ç¼“å­˜é…ç½®ï¼š&lt;/p>
&lt;pre>&lt;code class="language-javascript">// ç¼“å­˜ç‰ˆæœ¬å·
let cacheVersion = '-240619';
// æœ€å¤§æ¡ç›®æ•°
const maxEntries = 100;
&lt;/code>&lt;/pre>
&lt;h4 id="twitto-é…ç½®">Twitto é…ç½®&lt;/h4>
&lt;p>ä¸ºäº†ç¡®ä¿ç”¨æˆ·å³ä½¿åœ¨ç¦»çº¿çŠ¶æ€ä¸‹ä¹Ÿèƒ½æŸ¥çœ‹è¯„è®ºï¼ŒTwitto è¯„è®º API é‡‡ç”¨äº† &lt;code>NetworkFirst&lt;/code> ç¼“å­˜ç­–ç•¥ã€‚è¿™æ„å‘³ç€æµè§ˆå™¨ä¼šä¼˜å…ˆå°è¯•ä»ç½‘ç»œè·å–æœ€æ–°æ•°æ®ï¼Œå¦‚æœç½‘ç»œä¸å¯ç”¨ï¼Œåˆ™ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp('^https://comment\.cuterwrite\.top'),
new workbox.strategies.NetworkFirst({
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: maxEntries,
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
&lt;/code>&lt;/pre>
&lt;h4 id="rss-ä¸-sitemap-é…ç½®">RSS ä¸ Sitemap é…ç½®&lt;/h4>
&lt;p>ä¸ºäº†ç¡®ä¿ç”¨æˆ·å§‹ç»ˆè·å–æœ€æ–°çš„ RSS å’Œ Sitemap æ•°æ®ï¼Œè¿™äº›é¡µé¢é…ç½®ä¸ºä»…ä½¿ç”¨ç½‘ç»œç­–ç•¥ (&lt;code>NetworkOnly&lt;/code>)ï¼Œä¸è¿›è¡Œç¼“å­˜ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp('^https://cuterwrite\.top/(index|sitemap)\.xml'),
new workbox.strategies.NetworkOnly()
);
&lt;/code>&lt;/pre>
&lt;h4 id="html-é…ç½®">HTML é…ç½®&lt;/h4>
&lt;p>ä¸ºäº†åœ¨ä¿è¯ç”¨æˆ·å¿«é€ŸåŠ è½½é¡µé¢çš„åŒæ—¶ï¼Œä¹Ÿèƒ½è·å–åˆ°æœ€æ–°å†…å®¹ï¼Œç½‘ç«™å¯¹ HTML é¡µé¢é‡‡ç”¨äº† &lt;code>StaleWhileRevalidate&lt;/code> ç¼“å­˜ç­–ç•¥ã€‚è¿™æ„å‘³ç€æµè§ˆå™¨ä¼šä¼˜å…ˆä½¿ç”¨ç¼“å­˜ä¸­çš„é¡µé¢è¿›è¡Œå±•ç¤ºï¼ŒåŒæ—¶åœ¨åå°å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè·å–æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶åœ¨ä¸‹æ¬¡è¯·æ±‚æ—¶ä½¿ç”¨ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp('.*\.html'),
new workbox.strategies.StaleWhileRevalidate({
cacheName: 'html-cache' + cacheVersion,
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: maxEntries,
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
&lt;/code>&lt;/pre>
&lt;h4 id="google-fonts-é…ç½®">Google Fonts é…ç½®&lt;/h4>
&lt;p>ä¸ºäº†åœ¨ä¿è¯å­—ä½“æ–‡ä»¶æ›´æ–°çš„åŒæ—¶ï¼Œä¹Ÿèƒ½åˆ©ç”¨ç¼“å­˜åŠ é€Ÿé¡µé¢åŠ è½½é€Ÿåº¦ï¼Œç½‘ç«™å¯¹ Google Fonts èµ„æºé‡‡ç”¨äº† &lt;code>CacheFirst&lt;/code> ç¼“å­˜ç­–ç•¥ï¼Œå¹¶è®¾ç½®äº†è¾ƒé•¿çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp('.*\.(?:woff|woff2|ttf|otf|eot)'),
new workbox.strategies.StaleWhileRevalidate({
cacheName: 'google-fonts' + cacheVersion,
plugins: [
// ä½¿ç”¨ expiration æ’ä»¶å®ç°ç¼“å­˜æ¡ç›®æ•°ç›®å’Œæ—¶é—´æ§åˆ¶
new workbox.expiration.ExpirationPlugin({
// æœ€å¤§ç¼“å­˜æ¡ç›®æ•°
maxEntries: maxEntries,
// æœ€é•¿ç¼“å­˜æ—¶é—´ 30 å¤©
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
// ä½¿ç”¨ cacheableResponse æ’ä»¶ç¼“å­˜çŠ¶æ€ç ä¸º 0 çš„è¯·æ±‚
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
&lt;/code>&lt;/pre>
&lt;h4 id="cdn-é…ç½®">CDN é…ç½®&lt;/h4>
&lt;p>ä¸ºäº†æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨ç¼“å­˜åŠ é€Ÿé¡µé¢åŠ è½½é€Ÿåº¦ï¼Œç½‘ç«™å¯¹æ¥è‡ªå¸¸ç”¨ CDN çš„èµ„æºé‡‡ç”¨äº† &lt;code>CacheFirst&lt;/code> ç¼“å­˜ç­–ç•¥ï¼Œå¹¶è®¾ç½®äº†è¾ƒé•¿çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp('^https://(?:cdn\.bootcdn\.net|unpkg\.com|cdn\.jsdelivr\.net)'),
new workbox.strategies.CacheFirst({
cacheName: 'cdn' + cacheVersion,
fetchOptions: {
mode: 'cors',
credentials: 'omit',
},
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: maxEntries,
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
],
})
);
&lt;/code>&lt;/pre>
&lt;h4 id="umani-ç½‘ç«™ç»Ÿè®¡é…ç½®">Umani ç½‘ç«™ç»Ÿè®¡é…ç½®&lt;/h4>
&lt;p>ä¸ºäº†ç¡®ä¿ç½‘ç«™ç»Ÿè®¡æ•°æ®çš„å‡†ç¡®æ€§ï¼Œç½‘ç«™å¯¹ Umani ç½‘ç«™ç»Ÿè®¡è¯·æ±‚é‡‡ç”¨äº† &lt;code>NetworkOnly&lt;/code> ç­–ç•¥ï¼Œå¹¶ä½¿ç”¨ &lt;code>BackgroundSyncPlugin&lt;/code> æ’ä»¶æ¥å®ç°å³ä½¿åœ¨ç½‘ç»œç¦»çº¿çš„æƒ…å†µä¸‹ä¹Ÿèƒ½ä¿è¯æ•°æ®æœ€ç»ˆå‘é€æˆåŠŸã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp('^https://analytics\.cuterwrite\.top/uma'),
new workbox.strategies.NetworkOnly({
plugins: [
// ä½¿ç”¨ background sync æ’ä»¶å®ç°åå°åŒæ­¥
new workbox.backgroundSync.BackgroundSyncPlugin('Optical_Collect', {
maxRetentionTime: 12 * 60,
}),
],
})
);
&lt;/code>&lt;/pre>
&lt;h4 id="å›¾ç‰‡é…ç½®">å›¾ç‰‡é…ç½®&lt;/h4>
&lt;p>ä¸ºäº†åŠ é€Ÿå›¾ç‰‡åŠ è½½é€Ÿåº¦ï¼Œå¹¶å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼Œç½‘ç«™å¯¹å›¾ç‰‡èµ„æºé‡‡ç”¨äº† &lt;code>CacheFirst&lt;/code> ç¼“å­˜ç­–ç•¥ï¼Œå¹¶è®¾ç½®äº†è¾ƒé•¿çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp('^(https://cuterwrite-1302252842\.file\.myqcloud\.com|https://s2\.loli\.net)'),
new workbox.strategies.CacheFirst({
cacheName: 'image-cache' + cacheVersion,
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: maxEntries,
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
&lt;/code>&lt;/pre>
&lt;h4 id="åç¼€åŒ¹é…é…ç½®">åç¼€åŒ¹é…é…ç½®&lt;/h4>
&lt;p>ä¸ºäº†å…¼é¡¾åŠ è½½é€Ÿåº¦å’Œå†…å®¹æ›´æ–°ï¼Œç½‘ç«™å¯¹æœªè¢«åŸŸååŒ¹é…åˆ°çš„é™æ€æ–‡ä»¶ï¼ˆä¾‹å¦‚å›¾ç‰‡ã€CSS å’Œ JavaScript æ–‡ä»¶ï¼‰é‡‡ç”¨äº† &lt;code>StaleWhileRevalidate&lt;/code> ç¼“å­˜ç­–ç•¥ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.registerRoute(
new RegExp('.*\.(?:png|jpg|jpeg|svg|gif|webp|ico)'),
new workbox.strategies.StaleWhileRevalidate()
);
workbox.routing.registerRoute(
new RegExp('.*\.(css|js)'),
new workbox.strategies.StaleWhileRevalidate()
);
&lt;/code>&lt;/pre>
&lt;h4 id="é»˜è®¤è¡Œä¸ºé…ç½®">é»˜è®¤è¡Œä¸ºé…ç½®&lt;/h4>
&lt;p>ä¸ºäº†å¤„ç†æœªè¢«ä»»ä½•è‡ªå®šä¹‰è·¯ç”±è§„åˆ™åŒ¹é…åˆ°çš„è¯·æ±‚ï¼Œç½‘ç«™é…ç½®äº†é»˜è®¤ç¼“å­˜è¡Œä¸ºï¼Œä½¿ç”¨ &lt;code>NetworkFirst&lt;/code> ç­–ç•¥å¹¶è®¾ç½®äº†ç½‘ç»œè¶…æ—¶æ—¶é—´ï¼Œä»¥å…¼é¡¾èµ„æºè·å–é€Ÿåº¦å’Œç¦»çº¿å¯ç”¨æ€§ã€‚&lt;/p>
&lt;pre>&lt;code class="language-javascript">workbox.routing.setDefaultHandler(
// ä¼˜å…ˆä½¿ç”¨ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰åˆ™ä½¿ç”¨ç½‘ç»œè¯·æ±‚
new workbox.strategies.NetworkFirst({
networkTimeoutSeconds: 3,
})
);
&lt;/code>&lt;/pre>
&lt;h3 id="å®Œæ•´é…ç½®">å®Œæ•´é…ç½®&lt;/h3>
&lt;details>
&lt;summary>sw.js&lt;/summary>
&lt;pre>&lt;code class="language-javascript">importScripts('https://cdn.bootcdn.net/ajax/libs/workbox-sw/7.1.0/workbox-sw.js');
// ç¼“å­˜ç‰ˆæœ¬å·
let cacheVersion = '-240619';
// æœ€å¤§æ¡ç›®æ•°
const maxEntries = 100;
if (workbox) {
console.log(`Yay! Workbox is loaded ğŸ‰`);
// è¯„è®ºç¼“å­˜
workbox.routing.registerRoute(
new RegExp('^https://comment\.cuterwrite\.top'),
new workbox.strategies.NetworkFirst({
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: maxEntries,
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
// rss ã€sitemap ä¸ç¼“å­˜
workbox.routing.registerRoute(
new RegExp('^https://cuterwrite\.top/(index|sitemap)\.xml'),
new workbox.strategies.NetworkOnly()
);
// ç¼“å­˜ HTML
workbox.routing.registerRoute(
new RegExp('.*\.html'),
new workbox.strategies.StaleWhileRevalidate({
cacheName: 'html-cache' + cacheVersion,
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: maxEntries,
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
// ç¼“å­˜ Google Fonts
workbox.routing.registerRoute(
new RegExp('.*\.(?:woff|woff2|ttf|otf|eot)'),
new workbox.strategies.StaleWhileRevalidate({
cacheName: 'google-fonts' + cacheVersion,
plugins: [
// ä½¿ç”¨ expiration æ’ä»¶å®ç°ç¼“å­˜æ¡ç›®æ•°ç›®å’Œæ—¶é—´æ§åˆ¶
new workbox.expiration.ExpirationPlugin({
// æœ€å¤§ç¼“å­˜æ¡ç›®æ•°
maxEntries: maxEntries,
// æœ€é•¿ç¼“å­˜æ—¶é—´ 30 å¤©
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
// ä½¿ç”¨ cacheableResponse æ’ä»¶ç¼“å­˜çŠ¶æ€ç ä¸º 0 çš„è¯·æ±‚
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
// ç¼“å­˜ bootcdnã€unpkgã€jsdelivr ç­‰å…¬å…±åº“ï¼Œç”¨æ­£åˆ™åŒ¹é…
workbox.routing.registerRoute(
new RegExp('^https://(?:cdn\.bootcdn\.net|unpkg\.com|cdn\.jsdelivr\.net)'),
new workbox.strategies.CacheFirst({
cacheName: 'cdn' + cacheVersion,
fetchOptions: {
mode: 'cors',
credentials: 'omit',
},
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: maxEntries,
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
],
})
);
// è‡ªå»º UMA ç»Ÿè®¡è„šæœ¬: https://analytics.cuterwrite.top/uma
workbox.routing.registerRoute(
new RegExp('^https://analytics\.cuterwrite\.top/uma'),
new workbox.strategies.NetworkOnly({
plugins: [
// ä½¿ç”¨ background sync æ’ä»¶å®ç°åå°åŒæ­¥
new workbox.backgroundSync.BackgroundSyncPlugin('Optical_Collect', {
maxRetentionTime: 12 * 60,
}),
],
})
);
// ç¼“å­˜å­˜å‚¨æ¡¶å›¾ç‰‡ https://cuterwrite-1302252842.file.myqcloud.com/
workbox.routing.registerRoute(
new RegExp('^(https://cuterwrite-1302252842\.file\.myqcloud\.com|https://s2\.loli\.net)'),
new workbox.strategies.CacheFirst({
cacheName: 'image-cache' + cacheVersion,
plugins: [
new workbox.expiration.ExpirationPlugin({
maxEntries: maxEntries,
maxAgeSeconds: 30 * 24 * 60 * 60,
}),
new workbox.cacheableResponse.CacheableResponsePlugin({
statuses: [0, 200],
}),
],
})
);
// åç¼€åŒ¹é…ï¼Œé’ˆå¯¹å…¶ä½™æ²¡æœ‰è¢«åŸŸååŒ¹é…åˆ°çš„é™æ€æ–‡ä»¶
workbox.routing.registerRoute(
new RegExp('.*\.(?:png|jpg|jpeg|svg|gif|webp|ico)'),
new workbox.strategies.StaleWhileRevalidate()
);
workbox.routing.registerRoute(
new RegExp('.*\.(css|js)'),
new workbox.strategies.StaleWhileRevalidate()
);
// é»˜è®¤åŒ¹é…å‰©ä¸‹çš„è¯·æ±‚
workbox.routing.setDefaultHandler(
// ä¼˜å…ˆä½¿ç”¨ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰åˆ™ä½¿ç”¨ç½‘ç»œè¯·æ±‚
new workbox.strategies.NetworkFirst({
networkTimeoutSeconds: 3,
})
);
} else {
console.log(`Boo! Workbox didn't load ğŸ˜¬`);
}
&lt;/code>&lt;/pre>
&lt;/details>
&lt;h3 id="manifestjson">manifest.json&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>åˆ›å»º manifest.json æ–‡ä»¶&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>åœ¨ä½ çš„ Hugo åšå®¢çš„æ ¹ç›®å½• &lt;code>static&lt;/code> æ–‡ä»¶å¤¹ä¸‹åˆ›å»º &lt;code>manifest.json&lt;/code> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†å…³äºä½ çš„åšå®¢çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚åç§°ã€å›¾æ ‡å’Œæ˜¾ç¤ºé€‰é¡¹ã€‚&lt;/p>
&lt;pre>&lt;code class="language-json">{
&amp;quot;name&amp;quot;: &amp;quot;ä½ çš„åšå®¢åç§°&amp;quot;,
&amp;quot;short_name&amp;quot;: &amp;quot;åšå®¢ç®€ç§°&amp;quot;,
&amp;quot;start_url&amp;quot;: &amp;quot;/&amp;quot;,
&amp;quot;display&amp;quot;: &amp;quot;standalone&amp;quot;,
&amp;quot;background_color&amp;quot;: &amp;quot;#ffffff&amp;quot;,
&amp;quot;theme_color&amp;quot;: &amp;quot;#000000&amp;quot;,
&amp;quot;icons&amp;quot;: [{
&amp;quot;src&amp;quot;: &amp;quot;/icon-192x192.png&amp;quot;,
&amp;quot;sizes&amp;quot;: &amp;quot;192x192&amp;quot;,
&amp;quot;type&amp;quot;: &amp;quot;image/png&amp;quot;
},
{
&amp;quot;src&amp;quot;: &amp;quot;/icon-512x512.png&amp;quot;,
&amp;quot;sizes&amp;quot;: &amp;quot;512x512&amp;quot;,
&amp;quot;type&amp;quot;: &amp;quot;image/png&amp;quot;
}
]
}
&lt;/code>&lt;/pre>
&lt;div class="notice notice-tip" >
&lt;div class="notice-title">&lt;svg t="1705945832245" class="icon notice-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19409" width="200" height="200">&lt;path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m238.933333 349.866666l-2.133333 2.133334-277.333333 277.333333c-10.666667 10.666667-29.866667 12.8-42.666667 2.133333L426.666667 704l-149.333334-149.333333c-12.8-12.8-12.8-32 0-44.8 10.666667-10.666667 29.866667-12.8 42.666667-2.133334l2.133333 2.133334 125.866667 125.866666 253.866667-253.866666c10.666667-10.666667 29.866667-12.8 42.666666-2.133334l2.133334 2.133334c12.8 12.8 12.8 32 4.266666 42.666666z" fill="#ffffff" p-id="19410">&lt;/path>&lt;/svg>&lt;/div>&lt;p>æ³¨æ„ï¼šå°† icon-192x192.png å’Œ icon-512x512.png æ›¿æ¢ä¸ºä½ è‡ªå·±çš„å›¾æ ‡æ–‡ä»¶åã€‚å¹¶ç¡®ä¿å°†è¿™ä¸¤ä¸ªå›¾æ ‡æ–‡ä»¶æ”¾ç½®åœ¨ Hugo åšå®¢çš„ &lt;code>static&lt;/code> æ–‡ä»¶å¤¹ä¸­ã€‚å¦‚æœä½ æƒ³ä¿®æ”¹ä¸»é¢˜é¢œè‰²å’ŒèƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥ä¿®æ”¹ theme_color å’Œ background_color å­—æ®µã€‚&lt;/p>&lt;/div>
&lt;ol start="2">
&lt;li>&lt;strong>é“¾æ¥ manifest.json æ–‡ä»¶&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>åœ¨ä½ çš„ Hugo åšå®¢çš„ &lt;code>layouts/partials/head/custom.html&lt;/code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œå°† &lt;code>manifest.json&lt;/code> æ–‡ä»¶é“¾æ¥åˆ°ä½ çš„ç½‘ç«™ï¼š&lt;/p>
&lt;pre>&lt;code class="language-html">&amp;lt;link rel=&amp;quot;manifest&amp;quot; href=&amp;quot;/manifest.json&amp;quot;&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œä½ çš„ Hugo åšå®¢å°±å…·å¤‡äº† PWA åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥åƒä½¿ç”¨åŸç”Ÿåº”ç”¨ç¨‹åºä¸€æ ·è®¿é—®ä½ çš„ç½‘ç«™ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://web.dev/articles/offline-cookbook?hl=zh-cn" target="_blank" rel="noopener" >ç¦»çº¿å®æˆ˜å®å…¸
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://developers.google.com/web/tools/workbox" target="_blank" rel="noopener" >Workbox
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/GoogleChrome/workbox" target="_blank" rel="noopener" >Workbox Github
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Ollamaï¼šä»å…¥é—¨åˆ°è¿›é˜¶</title><link>https://cuterwrite.top/p/ollama/</link><pubDate>Sat, 15 Jun 2024 23:10:00 +0000</pubDate><guid>https://cuterwrite.top/p/ollama/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116903387_p0_master1200.webp" alt="Featured image of post Ollamaï¼šä»å…¥é—¨åˆ°è¿›é˜¶" />&lt;p>è¿‘å¹´æ¥ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä»¥å…¶å¼ºå¤§çš„æ–‡æœ¬ç”Ÿæˆå’Œç†è§£èƒ½åŠ›ï¼Œæˆä¸ºäº†äººå·¥æ™ºèƒ½é¢†åŸŸçš„ä¸­åšåŠ›é‡ã€‚å•†ä¸š LLM çš„ä»·æ ¼é€šå¸¸é«˜æ˜‚ä¸”ä»£ç å°é—­ï¼Œé™åˆ¶äº†ç ”ç©¶è€…å’Œå¼€å‘è€…çš„æ¢ç´¢ç©ºé—´ã€‚å¹¸è¿çš„æ˜¯ï¼Œå¼€æºç¤¾åŒºæä¾›äº†åƒ Ollama è¿™æ ·ä¼˜ç§€çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè®©æ¯ä¸ªäººéƒ½èƒ½å¤Ÿè½»æ¾ä½“éªŒ LLM çš„é­…åŠ›ï¼Œå¹¶èƒ½ç»“åˆ HPC å’Œ IDE æ’ä»¶ï¼Œæ‰“é€ æ›´å¼ºå¤§çš„ä¸ªäººåŠ©æ‰‹ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-ollama">ä»€ä¹ˆæ˜¯ Ollamaï¼Ÿ&lt;/h2>
&lt;p>Ollama æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¤§å‹è¯­è¨€æ¨¡å‹åº”ç”¨çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€æ´æ˜“ç”¨çš„å‘½ä»¤è¡Œç•Œé¢å’ŒæœåŠ¡å™¨ï¼Œè®©ä½ èƒ½å¤Ÿè½»æ¾ä¸‹è½½ã€è¿è¡Œå’Œç®¡ç†å„ç§å¼€æº LLMã€‚ä¸éœ€è¦å¤æ‚é…ç½®å’Œå¼ºå¤§ç¡¬ä»¶çš„ä¼ ç»Ÿ LLM ä¸åŒï¼ŒOllama è®©ä½ èƒ½å¤Ÿæ–¹ä¾¿åœ°åƒä½¿ç”¨æ‰‹æœº App ä¸€æ ·ä½“éªŒ LLM çš„å¼ºå¤§åŠŸèƒ½ã€‚&lt;/p>
&lt;h2 id="ollama-çš„ä¼˜åŠ¿">Ollama çš„ä¼˜åŠ¿&lt;/h2>
&lt;p>Ollama æ‹¥æœ‰ä»¥ä¸‹æ˜¾è‘—ä¼˜åŠ¿ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>å¼€æºå…è´¹&lt;/strong>ï¼š Ollama åŠå…¶æ”¯æŒçš„æ¨¡å‹å®Œå…¨å¼€æºå…è´¹ï¼Œä»»ä½•äººéƒ½å¯ä»¥è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘ã€‚&lt;/li>
&lt;li>&lt;strong>ç®€å•æ˜“ç”¨&lt;/strong>ï¼š æ— éœ€å¤æ‚çš„é…ç½®å’Œå®‰è£…è¿‡ç¨‹ï¼Œåªéœ€å‡ æ¡å‘½ä»¤å³å¯å¯åŠ¨å’Œè¿è¡Œ Ollamaã€‚&lt;/li>
&lt;li>&lt;strong>æ¨¡å‹ä¸°å¯Œ&lt;/strong>ï¼š Ollama æ”¯æŒ Llama 3ã€Mistralã€Qwen2 ç­‰ä¼—å¤šçƒ­é—¨å¼€æº LLMï¼Œå¹¶æä¾›ä¸€é”®ä¸‹è½½å’Œåˆ‡æ¢åŠŸèƒ½ã€‚&lt;/li>
&lt;li>&lt;strong>èµ„æºå ç”¨ä½&lt;/strong>ï¼š ç›¸æ¯”äºå•†ä¸š LLMï¼ŒOllama å¯¹ç¡¬ä»¶è¦æ±‚æ›´ä½ï¼Œå³ä½¿åœ¨æ™®é€šç¬”è®°æœ¬ç”µè„‘ä¸Šä¹Ÿèƒ½æµç•…è¿è¡Œã€‚&lt;/li>
&lt;li>&lt;strong>ç¤¾åŒºæ´»è·ƒ&lt;/strong>ï¼š Ollama æ‹¥æœ‰åºå¤§ä¸”æ´»è·ƒçš„ç¤¾åŒºï¼Œç”¨æˆ·å¯ä»¥è½»æ¾è·å–å¸®åŠ©ã€åˆ†äº«ç»éªŒå’Œå‚ä¸æ¨¡å‹å¼€å‘ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¦‚ä½•ä½¿ç”¨-ollama">å¦‚ä½•ä½¿ç”¨ Ollamaï¼Ÿ&lt;/h2>
&lt;p>ä½¿ç”¨ Ollama éå¸¸ç®€å•ï¼Œåªéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>å®‰è£… Ollama&lt;/strong>ï¼š æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿï¼Œä» &lt;a class="link" href="https://ollama.com/" target="_blank" rel="noopener" >Ollama å®˜ç½‘
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
ä¸‹è½½å¹¶å®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/li>
&lt;li>&lt;strong>å¯åŠ¨ Ollama&lt;/strong>ï¼š æ‰“å¼€ç»ˆç«¯æˆ–å‘½ä»¤è¡Œï¼Œè¾“å…¥ &lt;code>ollama serve&lt;/code> å‘½ä»¤å¯åŠ¨ Ollama æœåŠ¡å™¨ã€‚&lt;/li>
&lt;li>&lt;strong>ä¸‹è½½æ¨¡å‹&lt;/strong>ï¼š åœ¨&lt;a class="link" href="https://ollama.com/library" target="_blank" rel="noopener" >æ¨¡å‹ä»“åº“
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
æ‰¾åˆ°æƒ³è¦çš„æ¨¡å‹ï¼Œç„¶åä½¿ç”¨ &lt;code>ollama pull&lt;/code> å‘½ä»¤ä¸‹è½½ï¼Œä¾‹å¦‚ &lt;code>ollama pull llama3:70b&lt;/code> ã€‚&lt;/li>
&lt;li>&lt;strong>è¿è¡Œæ¨¡å‹&lt;/strong>ï¼š ä½¿ç”¨ &lt;code>ollama run&lt;/code> å‘½ä»¤å¯åŠ¨æ¨¡å‹ï¼Œä¾‹å¦‚ &lt;code>ollama run llama3:70b&lt;/code> ã€‚&lt;/li>
&lt;li>&lt;strong>å¼€å§‹èŠå¤©&lt;/strong>ï¼š åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä½ çš„é—®é¢˜æˆ–æŒ‡ä»¤ï¼ŒOllama ä¼šæ ¹æ®æ¨¡å‹ç”Ÿæˆç›¸åº”çš„å›å¤ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="å®‰è£…-ollama">å®‰è£… Ollama&lt;/h3>
&lt;h4 id="macos">macOS&lt;/h4>
&lt;p>&lt;a class="link" href="https://ollama.com/download/Ollama-darwin.zip" target="_blank" rel="noopener" >ä¸‹è½½ Ollama for macOS
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/p>
&lt;h4 id="windows">Windows&lt;/h4>
&lt;p>&lt;a class="link" href="https://ollama.com/download/OllamaSetup.exe" target="_blank" rel="noopener" >ä¸‹è½½ Ollama for Windows
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/p>
&lt;h4 id="linux">Linux&lt;/h4>
&lt;pre>&lt;code class="language-bash">curl -fsSL https://ollama.com/install.sh | sh
&lt;/code>&lt;/pre>
&lt;h4 id="docker">Docker&lt;/h4>
&lt;h5 id="cpu-ç‰ˆæœ¬">CPU ç‰ˆæœ¬&lt;/h5>
&lt;pre>&lt;code class="language-bash">docker run -d -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama
&lt;/code>&lt;/pre>
&lt;h5 id="gpu-ç‰ˆæœ¬">GPU ç‰ˆæœ¬&lt;/h5>
&lt;ol>
&lt;li>å®‰è£… &lt;a class="link" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installation" target="_blank" rel="noopener" >Nvidia container toolkit
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/li>
&lt;li>åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ Ollama&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">docker run -d --gpus=all -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama
&lt;/code>&lt;/pre>
&lt;h3 id="å¯åŠ¨-ollama">å¯åŠ¨ Ollama&lt;/h3>
&lt;pre>&lt;code class="language-bash">ollama serve
&lt;/code>&lt;/pre>
&lt;p>è¾“å‡ºä»¥ä¸‹ä¿¡æ¯è¡¨ç¤º Ollama æœåŠ¡å™¨å·²æˆåŠŸå¯åŠ¨ï¼ˆV100 æœºå™¨ï¼‰ï¼š&lt;/p>
&lt;pre>&lt;code class="language-bash">$ ollama serve
### çœç•¥çš„æ—¥å¿—è¾“å‡º ###
Listening on [::]:11434 (version 0.1.42)
&lt;/code>&lt;/pre>
&lt;h3 id="ä¸‹è½½æ¨¡å‹">ä¸‹è½½æ¨¡å‹&lt;/h3>
&lt;pre>&lt;code class="language-bash">ollama pull qwen2:72b
&lt;/code>&lt;/pre>
&lt;h3 id="è¿è¡Œæ¨¡å‹">è¿è¡Œæ¨¡å‹&lt;/h3>
&lt;pre>&lt;code class="language-bash">ollama run qwen2:72b
&lt;/code>&lt;/pre>
&lt;p>ä¾‹å¦‚ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤åï¼š&lt;/p>
&lt;pre>&lt;code class="language-bash">$ ollama run qwen2:72b
&amp;gt;&amp;gt;&amp;gt; Who are you?
I am Qwen, a pre-trained language model developed by Alibaba Cloud. My purpose is to assist users in generating various types of text, such as articles, stories, poems, and answering
questions by using the natural language processing techniques. How may I assist you today?
&amp;gt;&amp;gt;&amp;gt; Send a message(/? for help)
&lt;/code>&lt;/pre>
&lt;h4 id="docker-å®¹å™¨ä¸­è¿è¡Œæ¨¡å‹">Docker å®¹å™¨ä¸­è¿è¡Œæ¨¡å‹&lt;/h4>
&lt;pre>&lt;code class="language-bash">docker exec -it ollama ollama run qwen2:72b
&lt;/code>&lt;/pre>
&lt;h3 id="é…ç½®-ollama">é…ç½® Ollama&lt;/h3>
&lt;p>Ollama æä¾›äº†å¤šç§ç¯å¢ƒå˜é‡ä»¥ä¾›é…ç½®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>OLLAMA_DEBUG&lt;/code>ï¼šæ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œé»˜è®¤ä¸º &lt;code>false&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_FLASH_ATTENTION&lt;/code>ï¼šæ˜¯å¦é—ªçƒæ³¨æ„åŠ›ï¼Œé»˜è®¤ä¸º &lt;code>true&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_HOST&lt;/code>ï¼šOllama æœåŠ¡å™¨çš„ä¸»æœºåœ°å€ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_KEEP_ALIVE&lt;/code>ï¼šä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º &lt;code>5m&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_LLM_LIBRARY&lt;/code>ï¼šLLM åº“ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_MAX_LOADED_MODELS&lt;/code>ï¼šæœ€å¤§åŠ è½½æ¨¡å‹æ•°ï¼Œé»˜è®¤ä¸º &lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_MAX_QUEUE&lt;/code>ï¼šæœ€å¤§é˜Ÿåˆ—æ•°ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_MAX_VRAM&lt;/code>ï¼šæœ€å¤§è™šæ‹Ÿå†…å­˜ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_MODELS&lt;/code>ï¼šæ¨¡å‹ç›®å½•ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_NOHISTORY&lt;/code>ï¼šæ˜¯å¦ä¿å­˜å†å²è®°å½•ï¼Œé»˜è®¤ä¸º &lt;code>false&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_NOPRUNE&lt;/code>ï¼šæ˜¯å¦å¯ç”¨å‰ªæï¼Œé»˜è®¤ä¸º &lt;code>false&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_NUM_PARALLEL&lt;/code>ï¼šå¹¶è¡Œæ•°ï¼Œé»˜è®¤ä¸º &lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_ORIGINS&lt;/code>ï¼šå…è®¸çš„æ¥æºï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_RUNNERS_DIR&lt;/code>ï¼šè¿è¡Œå™¨ç›®å½•ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_SCHED_SPREAD&lt;/code>ï¼šè°ƒåº¦åˆ†å¸ƒï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_TMPDIR&lt;/code>ï¼šä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œé»˜è®¤ä¸ºç©ºã€‚Here is the optimized list in the desired format:&lt;/li>
&lt;li>&lt;code>OLLAMA_DEBUG&lt;/code>ï¼šæ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œé»˜è®¤ä¸º &lt;code>false&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_FLASH_ATTENTION&lt;/code>ï¼šæ˜¯å¦é—ªçƒæ³¨æ„åŠ›ï¼Œé»˜è®¤ä¸º &lt;code>true&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_HOST&lt;/code>ï¼šOllama æœåŠ¡å™¨çš„ä¸»æœºåœ°å€ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_KEEP_ALIVE&lt;/code>ï¼šä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º &lt;code>5m&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_LLM_LIBRARY&lt;/code>ï¼šLLM åº“ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_MAX_LOADED_MODELS&lt;/code>ï¼šæœ€å¤§åŠ è½½æ¨¡å‹æ•°ï¼Œé»˜è®¤ä¸º &lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_MAX_QUEUE&lt;/code>ï¼šæœ€å¤§é˜Ÿåˆ—æ•°ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_MAX_VRAM&lt;/code>ï¼šæœ€å¤§è™šæ‹Ÿå†…å­˜ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_MODELS&lt;/code>ï¼šæ¨¡å‹ç›®å½•ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_NOHISTORY&lt;/code>ï¼šæ˜¯å¦ä¿å­˜å†å²è®°å½•ï¼Œé»˜è®¤ä¸º &lt;code>false&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_NOPRUNE&lt;/code>ï¼šæ˜¯å¦å¯ç”¨å‰ªæï¼Œé»˜è®¤ä¸º &lt;code>false&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_NUM_PARALLEL&lt;/code>ï¼šå¹¶è¡Œæ•°ï¼Œé»˜è®¤ä¸º &lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_ORIGINS&lt;/code>ï¼šå…è®¸çš„æ¥æºï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_RUNNERS_DIR&lt;/code>ï¼šè¿è¡Œå™¨ç›®å½•ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_SCHED_SPREAD&lt;/code>ï¼šè°ƒåº¦åˆ†å¸ƒï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;li>&lt;code>OLLAMA_TMPDIR&lt;/code>ï¼šä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œé»˜è®¤ä¸ºç©ºã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="è¿›é˜¶ç”¨æ³•hpc-é›†ç¾¤ä¸Šéƒ¨ç½²-ollama">è¿›é˜¶ç”¨æ³•ï¼šHPC é›†ç¾¤ä¸Šéƒ¨ç½² Ollama&lt;/h2>
&lt;p>å¯¹äºå¤§å‹æ¨¡å‹æˆ–éœ€è¦æ›´é«˜æ€§èƒ½çš„æƒ…å†µï¼Œå¯ä»¥åˆ©ç”¨ HPC é›†ç¾¤çš„å¼ºå¤§ç®—åŠ›æ¥è¿è¡Œ Ollamaã€‚ç»“åˆ Slurm è¿›è¡Œä»»åŠ¡ç®¡ç†ï¼Œå¹¶ä½¿ç”¨ç«¯å£æ˜ å°„å°†æœåŠ¡æš´éœ²åˆ°æœ¬åœ°ï¼Œå³å¯æ–¹ä¾¿åœ°è¿›è¡Œè¿œç¨‹è®¿é—®å’Œä½¿ç”¨ï¼š&lt;/p>
&lt;ol>
&lt;li>åœ¨ç™»å½•èŠ‚ç‚¹é…ç½® Ollama ç¯å¢ƒï¼š å®‰è£… Ollamaï¼Œå¹¶ä¸‹è½½éœ€è¦çš„æ¨¡å‹ã€‚&lt;/li>
&lt;li>&lt;strong>ç¼–å†™ slurm è„šæœ¬&lt;/strong>ï¼š æŒ‡å®šèµ„æºéœ€æ±‚ï¼ˆCPUã€å†…å­˜ã€GPU ç­‰ï¼‰ï¼Œå¹¶ä½¿ç”¨ &lt;code>ollama serve&lt;/code> å‘½ä»¤å¯åŠ¨æ¨¡å‹æœåŠ¡ï¼Œå¹¶ç»‘å®šåˆ°ç‰¹å®šç«¯å£ã€‚&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">#!/bin/bash
#SBATCH --job-name=ollama
#SBATCH -N 1
#SBATCH -p GPU
#SBATCH --gres=gpu:1
module load CUDA
ollama serve
&lt;/code>&lt;/pre>
&lt;ol start="3">
&lt;li>&lt;strong>æäº¤ slurm ä»»åŠ¡&lt;/strong>: ä½¿ç”¨ &lt;code>sbatch&lt;/code> å‘½ä»¤æäº¤è„šæœ¬ï¼ŒSlurm ä¼šå°†ä»»åŠ¡åˆ†é…åˆ°è®¡ç®—èŠ‚ç‚¹è¿è¡Œã€‚&lt;/li>
&lt;li>&lt;strong>æœ¬åœ°ç«¯å£æ˜ å°„&lt;/strong>ï¼š ä½¿ç”¨ ssh -L å‘½ä»¤å°†è®¡ç®—èŠ‚ç‚¹çš„ç«¯å£æ˜ å°„åˆ°æœ¬åœ°ï¼Œä¾‹å¦‚:&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">ssh -t -t ç”¨æˆ·å@ç™»å½•èŠ‚ç‚¹ ip -L 11434:localhost:11434 -i ç™»å½•èŠ‚ç‚¹ç§é’¥ ssh è®¡ç®—èŠ‚ç‚¹ IP -L 11434:127.0.0.1:11434
&lt;/code>&lt;/pre>
&lt;ol start="5">
&lt;li>&lt;strong>æœ¬åœ°è®¿é—®&lt;/strong>ï¼š åœ¨æµè§ˆå™¨æˆ–åº”ç”¨ç¨‹åºä¸­è®¿é—® http://localhost:11434 å³å¯ä½¿ç”¨ Ollama æœåŠ¡ã€‚&lt;/li>
&lt;/ol>
&lt;div class="notice notice-tip" >
&lt;div class="notice-title">&lt;svg t="1705945832245" class="icon notice-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19409" width="200" height="200">&lt;path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m238.933333 349.866666l-2.133333 2.133334-277.333333 277.333333c-10.666667 10.666667-29.866667 12.8-42.666667 2.133333L426.666667 704l-149.333334-149.333333c-12.8-12.8-12.8-32 0-44.8 10.666667-10.666667 29.866667-12.8 42.666667-2.133334l2.133333 2.133334 125.866667 125.866666 253.866667-253.866666c10.666667-10.666667 29.866667-12.8 42.666666-2.133334l2.133334 2.133334c12.8 12.8 12.8 32 4.266666 42.666666z" fill="#ffffff" p-id="19410">&lt;/path>&lt;/svg>&lt;/div>&lt;p>æ³¨æ„ï¼šç”±äºè®¡ç®—èŠ‚ç‚¹ä¸è”ç½‘ï¼Œéœ€è¦æå‰åœ¨ç™»å½•èŠ‚ç‚¹ä½¿ç”¨ &lt;code>ollama pull&lt;/code> ä¸‹è½½æ‰€éœ€æ¨¡å‹ã€‚æ­¤å¤–ï¼Œéœ€è¦è®¾ç½® &lt;code>OLLAMA_ORIGINS&lt;/code> ä¸º &lt;code>*&lt;/code>ï¼Œè®¾ç½® &lt;code>OLLAMA_HOST&lt;/code> ä¸º &lt;code>0.0.0.0&lt;/code>ï¼Œä»¥å…è®¸æ‰€æœ‰æ¥æºè®¿é—®æœåŠ¡ã€‚&lt;/p>&lt;/div>
&lt;h2 id="è¿›é˜¶ç”¨æ³•æœ¬åœ°ä»£ç è¡¥å…¨åŠ©æ‰‹">è¿›é˜¶ç”¨æ³•ï¼šæœ¬åœ°ä»£ç è¡¥å…¨åŠ©æ‰‹&lt;/h2>
&lt;p>Ollama ä¸ä»…å¯ä»¥ç”¨äºèŠå¤©å’Œæ–‡æœ¬åˆ›ä½œï¼Œè¿˜å¯ä»¥ç»“åˆä»£ç ç”Ÿæˆæ¨¡å‹å’Œ IDE æ’ä»¶ï¼Œæ‰“é€ å¼ºå¤§çš„ä»£ç è¡¥å…¨åŠ©æ‰‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Codeqwen 7B æ¨¡å‹å’Œ VS Code æ’ä»¶ &lt;a class="link" href="https://continue.dev/" target="_blank" rel="noopener" >Continue
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
ï¼Œå¯ä»¥å®ç°é«˜æ•ˆä¾¿æ·çš„ä»£ç è¡¥å…¨åŠŸèƒ½ã€‚&lt;/p>
&lt;p>é¦–å…ˆä»‹ç»ä¸€ä¸‹ Continue :
&lt;blockquote>
&lt;p>&lt;p>&lt;a class="link" href="https://continue.dev/" target="_blank" rel="noopener" >Continue
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
enables you to easily create your own coding assistant directly inside Visual Studio Code and JetBrains with open-source LLMs. All this can run entirely on your own laptop or have Ollama deployed on a server to remotely power code completion and chat experiences based on your needs.&lt;/p>
&lt;p>Continue ä½¿æ‚¨èƒ½å¤Ÿè½»æ¾åœ°åœ¨ Visual Studio Code å’Œ JetBrains ä¸­åˆ›å»ºè‡ªå·±çš„ä»£ç åŠ©æ‰‹ï¼Œåˆ©ç”¨å¼€æº LLMã€‚è¿™ä¸€åˆ‡éƒ½å¯ä»¥å®Œå…¨åœ¨æ‚¨çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šè¿è¡Œï¼Œæˆ–è€…åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½² Ollamaï¼Œè¿œç¨‹æ ¹æ®æ‚¨çš„éœ€æ±‚æä¾›ä»£ç è¡¥å…¨å’ŒèŠå¤©ä½“éªŒã€‚&lt;/p>
&lt;/p>&lt;span class="cite">&lt;span>â€• &lt;/span>&lt;span>Continue&lt;/span>&lt;cite>&lt;/cite>&lt;/span>&lt;/blockquote>&lt;/p>
&lt;p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦å®‰è£…å¦‚ä¸‹å·¥å…·ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://docs.continue.dev/quickstart" target="_blank" rel="noopener" >Continue
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
ï¼š&lt;a class="link" href="https://marketplace.visualstudio.com/items?itemName=Continue.continue" target="_blank" rel="noopener" >VS Code ç‰ˆæœ¬
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
æˆ– &lt;a class="link" href="https://plugins.jetbrains.com/plugin/22707-continue" target="_blank" rel="noopener" >JetBrains ç‰ˆæœ¬
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/li>
&lt;li>&lt;a class="link" href="https://ollama.com/" target="_blank" rel="noopener" >Ollama
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»¥ VS Code ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ Ollama + Continue å®ç°ä»£ç è¡¥å…¨åŠŸèƒ½ï¼š&lt;/p>
&lt;h3 id="codestral-22b-æ¨¡å‹">Codestral 22B æ¨¡å‹&lt;/h3>
&lt;p>Codestral æ—¢èƒ½å®Œæˆä»£ç è‡ªåŠ¨è¡¥å…¨ï¼Œä¹Ÿæ”¯æŒèŠå¤©åŠŸèƒ½ã€‚ä½†é‰´äºå…¶æ‹¥æœ‰ 220 äº¿å‚æ•°ä¸”ä¸å…·å¤‡ç”Ÿäº§è®¸å¯ï¼Œå®ƒå¯¹æ˜¾å­˜è¦æ±‚é¢‡é«˜ï¼Œä»…é™äºç ”ç©¶å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå› æ­¤å¯èƒ½å¹¶ä¸é€‚åˆæ—¥å¸¸æœ¬åœ°åº”ç”¨ã€‚&lt;/p>
&lt;h4 id="ä¸‹è½½å¹¶è¿è¡Œ-codestral-æ¨¡å‹">ä¸‹è½½å¹¶è¿è¡Œ Codestral æ¨¡å‹&lt;/h4>
&lt;pre>&lt;code class="language-bash">ollama run codestral
&lt;/code>&lt;/pre>
&lt;h4 id="é…ç½®-configjson">é…ç½® config.json&lt;/h4>
&lt;ul>
&lt;li>åœ¨ VS Code ä¾§è¾¹æ ç‚¹å‡» Continue æ’ä»¶å›¾æ ‡ï¼Œç„¶ååœ¨é¢æ¿å³ä¸‹è§’ç‚¹å‡» â€œé½¿è½®â€ å›¾æ ‡ï¼Œæ‰“å¼€ &lt;code>config.json&lt;/code> æ–‡ä»¶ã€‚ç„¶åå¤åˆ¶ä»¥ä¸‹é…ç½®åˆ° &lt;code>config.json&lt;/code> æ–‡ä»¶ä¸­ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code class="language-json">{
&amp;quot;models&amp;quot;: [
{
&amp;quot;title&amp;quot;: &amp;quot;Codestral&amp;quot;,
&amp;quot;provider&amp;quot;: &amp;quot;ollama&amp;quot;,
&amp;quot;model&amp;quot;: &amp;quot;codestral&amp;quot;
}
],
&amp;quot;tabAutocompleteModel&amp;quot;: {
&amp;quot;title&amp;quot;: &amp;quot;Codestral&amp;quot;,
&amp;quot;provider&amp;quot;: &amp;quot;ollama&amp;quot;,
&amp;quot;model&amp;quot;: &amp;quot;codestral&amp;quot;
}
}
&lt;/code>&lt;/pre>
&lt;h3 id="deepseek-coder-67b-æ¨¡å‹--llama-3-8b-æ¨¡å‹">DeepSeek Coder 6.7B æ¨¡å‹ + Llama 3 8B æ¨¡å‹&lt;/h3>
&lt;p>æ ¹æ®æœºå™¨çš„æ˜¾å­˜å¤§å°ï¼Œå¯ä»¥åˆ©ç”¨ Ollama åŒæ—¶è¿è¡Œå¤šä¸ªæ¨¡å‹å¹¶å¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚çš„èƒ½åŠ›ï¼Œä½¿ç”¨ &lt;code>DeepSeek Coder 6.7B&lt;/code> è¿›è¡Œè‡ªåŠ¨è¡¥å…¨ï¼Œ&lt;code>Llama 3 8B&lt;/code> è¿›è¡ŒèŠå¤©ã€‚å¦‚æœä½ çš„æœºå™¨æ— æ³•åŒæ—¶è¿è¡Œä¸¤è€…ï¼Œé‚£ä¹ˆå¯ä»¥åˆ†åˆ«å°è¯•ï¼Œå†³å®šä½ æ›´åå¥½æœ¬åœ°è‡ªåŠ¨è¡¥å…¨è¿˜æ˜¯æœ¬åœ°èŠå¤©ä½“éªŒã€‚&lt;/p>
&lt;h4 id="ä¸‹è½½å¹¶è¿è¡Œ-deepseek-coder-æ¨¡å‹">ä¸‹è½½å¹¶è¿è¡Œ DeepSeek Coder æ¨¡å‹&lt;/h4>
&lt;pre>&lt;code class="language-bash">ollama run deepseek-coder:6.7b-base
&lt;/code>&lt;/pre>
&lt;h4 id="ä¸‹è½½å¹¶è¿è¡Œ-llama-3-æ¨¡å‹">ä¸‹è½½å¹¶è¿è¡Œ Llama 3 æ¨¡å‹&lt;/h4>
&lt;pre>&lt;code class="language-bash">ollama run llama3:8b
&lt;/code>&lt;/pre>
&lt;h4 id="é…ç½®-configjson-1">é…ç½® config.json&lt;/h4>
&lt;pre>&lt;code class="language-json">{
&amp;quot;models&amp;quot;: [
{
&amp;quot;title&amp;quot;: &amp;quot;Llama 3 8B&amp;quot;,
&amp;quot;provider&amp;quot;: &amp;quot;ollama&amp;quot;,
&amp;quot;model&amp;quot;: &amp;quot;llama3:8b&amp;quot;,
&amp;quot;apiBase&amp;quot;: &amp;quot;http://127.0.0.1:11434&amp;quot;
}
],
&amp;quot;tabAutocompleteModel&amp;quot;: {
&amp;quot;title&amp;quot;: &amp;quot;DeepSeek Coder 6.7B&amp;quot;,
&amp;quot;provider&amp;quot;: &amp;quot;ollama&amp;quot;,
&amp;quot;model&amp;quot;: &amp;quot;deepseek-coder:6.7b-base&amp;quot;,
&amp;quot;apiBase&amp;quot;: &amp;quot;http://127.0.0.1:11434&amp;quot;
}
}
&lt;/code>&lt;/pre>
&lt;h3 id="codeqwen-7b-æ¨¡å‹--qwen2-7b-æ¨¡å‹">Codeqwen 7B æ¨¡å‹ + Qwen2 7B æ¨¡å‹&lt;/h3>
&lt;p>Codeqwen 7B æ¨¡å‹æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºä»£ç è¡¥å…¨çš„æ¨¡å‹ï¼Œè€Œ Qwen2 7B æ¨¡å‹åˆ™æ˜¯ä¸€ä¸ªé€šç”¨çš„èŠå¤©æ¨¡å‹ã€‚è¿™ä¸¤ä¸ªæ¨¡å‹å¯ä»¥å¾ˆå¥½åœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œå®ç°ä»£ç è¡¥å…¨å’ŒèŠå¤©åŠŸèƒ½ã€‚&lt;/p>
&lt;h4 id="ä¸‹è½½å¹¶è¿è¡Œ-codeqwen-æ¨¡å‹">ä¸‹è½½å¹¶è¿è¡Œ Codeqwen æ¨¡å‹&lt;/h4>
&lt;pre>&lt;code class="language-bash">ollama run codeqwen
&lt;/code>&lt;/pre>
&lt;h4 id="ä¸‹è½½å¹¶è¿è¡Œ-qwen2-æ¨¡å‹">ä¸‹è½½å¹¶è¿è¡Œ Qwen2 æ¨¡å‹&lt;/h4>
&lt;pre>&lt;code class="language-bash">ollama run qwen2:7b
&lt;/code>&lt;/pre>
&lt;h4 id="é…ç½®-configjson-2">é…ç½® config.json&lt;/h4>
&lt;pre>&lt;code class="language-json">{
&amp;quot;models&amp;quot;: [
{
&amp;quot;title&amp;quot;: &amp;quot;Codeqwen 7B&amp;quot;,
&amp;quot;provider&amp;quot;: &amp;quot;ollama&amp;quot;,
&amp;quot;model&amp;quot;: &amp;quot;codeqwen&amp;quot;,
&amp;quot;apiBase&amp;quot;: &amp;quot;http://127.0.0.1:11434&amp;quot;
}
],
&amp;quot;tabAutocompleteModel&amp;quot;: {
&amp;quot;title&amp;quot;: &amp;quot;Qwen2 7B&amp;quot;,
&amp;quot;provider&amp;quot;: &amp;quot;ollama&amp;quot;,
&amp;quot;model&amp;quot;: &amp;quot;qwen2:7b&amp;quot;,
&amp;quot;apiBase&amp;quot;: &amp;quot;http://127.0.0.1:11434&amp;quot;
}
}
&lt;/code>&lt;/pre>
&lt;h3 id="åˆ©ç”¨-rag-å‘é‡æ£€ç´¢ä¼˜åŒ–èŠå¤©">åˆ©ç”¨ RAG å‘é‡æ£€ç´¢ä¼˜åŒ–èŠå¤©&lt;/h3>
&lt;p>Continue å†…ç½®äº† &lt;a class="link" href="https://docs.continue.dev/customization/context-providers#codebase-retrieval" target="_blank" rel="noopener" >@codebase
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
ä¸Šä¸‹æ–‡æä¾›å™¨ï¼Œèƒ½è‡ªåŠ¨ä»ä»£ç åº“ä¸­æ£€ç´¢åˆ°æœ€ç›¸å…³çš„ä»£ç ç‰‡æ®µã€‚å‡å¦‚ä½ å·²ç»è®¾ç½®å¥½äº†èŠå¤©æ¨¡å‹ï¼ˆä¾‹å¦‚ Codestralã€Llama 3ï¼‰ï¼Œé‚£ä¹ˆå€ŸåŠ© Ollama å’Œ &lt;a class="link" href="https://blog.lancedb.com/lancedb-x-continue/" target="_blank" rel="noopener" >LanceDB
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
çš„å‘é‡åŒ–æŠ€æœ¯ï¼Œå¯ä»¥å®ç°æ›´é«˜æ•ˆçš„ä»£ç æ£€ç´¢å’ŒèŠå¤©ä½“éªŒã€‚&lt;/p>
&lt;p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>nomic-embed-text&lt;/code> æ¨¡å‹ä½œä¸ºå‘é‡æ£€ç´¢æ¨¡å‹ï¼š&lt;/p>
&lt;h4 id="ä¸‹è½½å¹¶è¿è¡Œ-nomic-embed-text-æ¨¡å‹">ä¸‹è½½å¹¶è¿è¡Œ Nomic Embed Text æ¨¡å‹&lt;/h4>
&lt;pre>&lt;code class="language-bash">ollama run nomic-embed-text
&lt;/code>&lt;/pre>
&lt;h4 id="é…ç½®-configjson-3">é…ç½® config.json&lt;/h4>
&lt;ul>
&lt;li>åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code class="language-json">{
&amp;quot;embeddingsProvider&amp;quot;: {
&amp;quot;provider&amp;quot;: &amp;quot;ollama&amp;quot;,
&amp;quot;model&amp;quot;: &amp;quot;nomic-embed-text&amp;quot;,
&amp;quot;apiBase&amp;quot;: &amp;quot;http://127.0.0.1:11434&amp;quot;
}
}
&lt;/code>&lt;/pre>
&lt;h3 id="ä»£ç è¡¥å…¨æ•ˆæœ">ä»£ç è¡¥å…¨æ•ˆæœ&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Ctrl + I&lt;/code>: æ ¹æ®æŒ‡ä»¤ç”Ÿæˆä»£ç ç‰‡æ®µã€‚&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/codeqwen_1-2024-06-17.png"
alt="codeqwen_1-2024-06-17" width="90%" loading="lazy">
&lt;/figure>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/codeqwen_2-2024-06-17.png"
alt="codeqwen_2-2024-06-17" width="90%" loading="lazy">
&lt;/figure>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/codeqwen_3-2024-06-17.png"
alt="codeqwen_3-2024-06-17" width="90%" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>å…‰æ ‡æ‚¬åœè‡ªåŠ¨è¡¥å…¨ä»£ç &lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/codeqwen_4-2024-06-17.png"
alt="codeqwen_4-2024-06-17" width="90%" loading="lazy">
&lt;/figure>
&lt;h3 id="ä¸-ollama-èŠå¤©">ä¸ Ollama èŠå¤©&lt;/h3>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/codeqwen_5-2024-06-17.png"
alt="codeqwen_5-2024-06-17" width="90%" loading="lazy">
&lt;/figure>
&lt;h3 id="ä»£ç è‡ªåŠ¨æ³¨é‡Š">ä»£ç è‡ªåŠ¨æ³¨é‡Š&lt;/h3>
&lt;ul>
&lt;li>é€‰ä¸­ä»£ç æ‰“å¼€å³é”®èœå•&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/codeqwen_6-2024-06-17.png"
alt="codeqwen_6-2024-06-17" width="90%" loading="lazy">
&lt;/figure>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/codeqwen_7-2024-06-17.png"
alt="codeqwen_7-2024-06-17" width="90%" loading="lazy">
&lt;/figure>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>Ollama ä¸ºæˆ‘ä»¬æ‰“å¼€äº†é€šå¾€å¼€æº LLM ä¸–ç•Œçš„å¤§é—¨ï¼Œè®©æ¯ä¸ªäººéƒ½èƒ½è½»æ¾ä½“éªŒ LLM çš„å¼ºå¤§åŠŸèƒ½ï¼Œå¹¶å¯ä»¥æ ¹æ®è‡ªèº«éœ€æ±‚è¿›è¡Œå®šåˆ¶åŒ–åº”ç”¨ã€‚æ— è®ºæ˜¯è¿›è¡Œç ”ç©¶ã€å¼€å‘ï¼Œè¿˜æ˜¯æ—¥å¸¸ä½¿ç”¨ï¼ŒOllama éƒ½èƒ½ä¸ºä½ æä¾›æ¢ç´¢ LLM æ— é™å¯èƒ½çš„å¹³å°ã€‚ç›¸ä¿¡éšç€ Ollama çš„ä¸æ–­å‘å±•ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬å¸¦æ¥æ›´å¤šæƒŠå–œï¼Œæ¨åŠ¨ LLM æŠ€æœ¯åœ¨å„ä¸ªé¢†åŸŸçš„åº”ç”¨å’Œå‘å±•ã€‚&lt;/p></description></item><item><title>RDMA ä¹‹ Address Handle</title><link>https://cuterwrite.top/p/rdma-address-handle/</link><pubDate>Sat, 15 Jun 2024 01:00:00 +0000</pubDate><guid>https://cuterwrite.top/p/rdma-address-handle/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_116373922_p9_master1200.webp" alt="Featured image of post RDMA ä¹‹ Address Handle" />&lt;h1 id="rdma-ä¹‹-address-handle">RDMA ä¹‹ Address Handle&lt;/h1>
&lt;p>&lt;strong>æœ¬æ–‡æ¬¢è¿éå•†ä¸šè½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>å£°æ˜ï¼šä»…ç”¨äºæ”¶è—ï¼Œä¾¿äºé˜…è¯»&lt;/p>&lt;span class="cite">&lt;span>â€• &lt;/span>&lt;span>Savir, &lt;/span>&lt;a href="https://zhuanlan.zhihu.com/p/163552044">&lt;cite>çŸ¥ä¹ä¸“æ ï¼š8. RDMA ä¹‹ Address Handle&lt;/cite>&lt;/a>&lt;/span>&lt;/blockquote>
&lt;p>å‰é¢å·²ç»ä»‹ç»è¿‡ï¼ŒRDMA é€šä¿¡çš„åŸºæœ¬å•å…ƒæ˜¯ QPã€‚æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾ A èŠ‚ç‚¹çš„æŸä¸ª QP è¦è·Ÿ B èŠ‚ç‚¹çš„æŸä¸ª QP äº¤æ¢ä¿¡æ¯ï¼Œé™¤äº†è¦çŸ¥é“ B èŠ‚ç‚¹çš„ QP åºå·â€”â€”QPN ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä»€ä¹ˆä¿¡æ¯ï¼Ÿè¦çŸ¥é“ï¼ŒQPN æ˜¯æ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹ç»´æŠ¤çš„åºå·ï¼Œä¸æ˜¯æ•´ä¸ªç½‘ç»œä¸­å”¯ä¸€çš„ã€‚æ¯”å¦‚ A çš„ QP 3 è¦è·Ÿ B çš„ QP 5 é€šä¿¡ï¼Œç½‘ç»œä¸­å¯ä¸æ­¢ä¸€ä¸ª QP5ï¼Œå¯èƒ½æœ‰å¾ˆå¤šä¸ªèŠ‚ç‚¹éƒ½æœ‰è‡ªå·±çš„ QP 5ã€‚æ‰€ä»¥æˆ‘ä»¬è‡ªç„¶å¯ä»¥æƒ³åˆ°ï¼Œè¿˜éœ€è¦æ‰¾åˆ°è®©æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ ‡è¯†ã€‚&lt;/p>
&lt;p>åœ¨ä¼ ç»Ÿ TCP-IP åè®®æ ˆä¸­ï¼Œä½¿ç”¨äº†å®¶å–»æˆ·æ™“çš„ IP åœ°å€æ¥æ ‡è¯†ç½‘ç»œå±‚çš„æ¯ä¸ªèŠ‚ç‚¹ã€‚è€Œ IB åè®®ä¸­çš„è¿™ä¸ªæ ‡è¯†è¢«ç§°ä¸º&lt;strong>GIDï¼ˆGlobal Identifierï¼Œå…¨å±€ IDï¼‰&lt;/strong>ï¼Œæ˜¯ä¸€ä¸ª 128 bits çš„åºåˆ—ã€‚å…³äº GID æœ¬ç¯‡ä¸å±•å¼€è®¨è®ºï¼Œå°†åœ¨åé¢ä»‹ç»ã€‚&lt;/p>
&lt;h2 id="ah-æ˜¯ä»€ä¹ˆ">AH æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;p>AH å…¨ç§°ä¸º Address Handleï¼Œæ²¡æœ‰æƒ³åˆ°ç‰¹åˆ«åˆé€‚çš„ä¸­æ–‡ç¿»è¯‘ï¼Œå°±å…ˆç›´è¯‘ä¸ºâ€œåœ°å€å¥æŸ„â€å§ã€‚è¿™é‡Œçš„åœ°å€ï¼ŒæŒ‡çš„æ˜¯ä¸€ç»„ç”¨äºæ‰¾åˆ°æŸä¸ªè¿œç«¯èŠ‚ç‚¹çš„ä¿¡æ¯çš„é›†åˆï¼Œåœ¨ IB åè®®ä¸­ï¼Œåœ°å€æŒ‡çš„æ˜¯ GIDã€ç«¯å£å·ç­‰ç­‰ä¿¡æ¯ï¼›è€Œæ‰€è°“å¥æŸ„ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŒ‡å‘æŸä¸ªå¯¹è±¡çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;p>å¤§å®¶æ˜¯å¦è¿˜è®°å¾— IB åè®®ä¸­æœ‰å››ç§åŸºæœ¬æœåŠ¡ç±»å‹â€”â€”RCã€UDã€RD å’Œ UCï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ RC å’Œ UDã€‚RC çš„ç‰¹ç‚¹æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹çš„ QP ä¹‹é—´ä¼šå»ºç«‹å¯é çš„è¿æ¥ï¼Œä¸€æ—¦å»ºç«‹è¿æ¥å…³ç³»ä¾¿ä¸å®¹æ˜“æ”¹å˜ï¼Œå¯¹ç«¯çš„ä¿¡æ¯æ˜¯åˆ›å»º QP çš„æ—¶å€™å‚¨å­˜åœ¨ QP Context ä¸­çš„ï¼›&lt;/p>
&lt;p>è€Œå¯¹äº UD æ¥è¯´ï¼ŒQP é—´æ²¡æœ‰è¿æ¥å…³ç³»ï¼Œç”¨æˆ·æƒ³å‘ç»™è°ï¼Œå°±åœ¨ WQE ä¸­å¡«å¥½å¯¹ç«¯çš„åœ°å€ä¿¡æ¯å°±å¯ä»¥äº†ã€‚&lt;strong>ç”¨æˆ·ä¸æ˜¯ç›´æ¥æŠŠå¯¹ç«¯çš„åœ°å€ä¿¡æ¯å¡«åˆ° WQE ä¸­çš„ï¼Œè€Œæ˜¯æå‰å‡†å¤‡äº†ä¸€ä¸ªâ€œåœ°å€è–„â€ï¼Œæ¯æ¬¡é€šè¿‡ä¸€ä¸ªç´¢å¼•æ¥æŒ‡å®šå¯¹ç«¯èŠ‚ç‚¹çš„åœ°å€ä¿¡æ¯ï¼Œè€Œè¿™ä¸ªç´¢å¼•å°±æ˜¯ AHã€‚&lt;/strong>&lt;/p>
&lt;p>AH çš„æ¦‚å¿µå¤§è‡´å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_8_1.webp"
alt="2024-06-16_8_1" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>Address Handle åŠŸèƒ½ç¤ºæ„å›¾&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>å¯¹äºæ¯ä¸€ä¸ªç›®çš„èŠ‚ç‚¹ï¼Œæœ¬ç«¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ AHï¼Œè€ŒåŒä¸€ä¸ª AH å¯ä»¥è¢«å¤šä¸ª QP å…±åŒä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="ah-çš„ä½œç”¨">AH çš„ä½œç”¨&lt;/h2>
&lt;p>æ¯æ¬¡è¿›è¡Œ UD æœåŠ¡ç±»å‹çš„é€šä¿¡ä¹‹å‰ï¼Œç”¨æˆ·éƒ½éœ€è¦å…ˆé€šè¿‡ IB æ¡†æ¶æä¾›çš„æ¥å£ï¼Œæ¥&lt;strong>ä¸ºæ¯ä¸€ä¸ªå¯èƒ½çš„å¯¹ç«¯èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª AH&lt;/strong>ï¼Œç„¶åè¿™äº› AH ä¼šè¢«é©±åŠ¨æ”¾åˆ°ä¸€ä¸ªâ€œå®‰å…¨â€çš„åŒºåŸŸï¼Œå¹¶è¿”å›ä¸€ä¸ªç´¢å¼•ï¼ˆæŒ‡é’ˆ/å¥æŸ„ï¼‰ç»™ç”¨æˆ·ã€‚ç”¨æˆ·çœŸæ­£ä¸‹å‘ WRï¼ˆWork Requestï¼‰æ—¶ï¼Œå°±æŠŠè¿™ä¸ªç´¢å¼•ä¼ é€’è¿›æ¥å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>ä¸Šè¿°è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒA èŠ‚ç‚¹æ”¶åˆ°ç”¨æˆ·çš„è¿™æ ·ä¸€ä¸ªä»»åŠ¡â€”â€”ä½¿ç”¨æœ¬ç«¯çš„ QP4 ä¸ B èŠ‚ç‚¹ï¼ˆé€šè¿‡ AH æŒ‡å®šï¼‰çš„ QP3 è¿›è¡Œæ•°æ®äº¤æ¢ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_8_2.webp"
alt="2024-06-16_8_2" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>UD æœåŠ¡ç±»å‹ä½¿ç”¨ AH æŒ‡å®šå¯¹ç«¯èŠ‚ç‚¹&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>IB åè®®ä¸­å¹¶æ²¡æœ‰å¯¹ä¸ºä»€ä¹ˆä½¿ç”¨ AH åšå‡ºè§£é‡Šï¼Œæˆ‘è®¤ä¸ºå®šä¹‰ AH çš„æ¦‚å¿µçš„åŸå› æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¿è¯ç›®çš„åœ°å€å¯ç”¨ï¼Œæé«˜æ•ˆç‡&lt;/li>
&lt;/ol>
&lt;p>å› ä¸º UD æ— è¿æ¥çš„ç‰¹ç‚¹ï¼Œç”¨æˆ·å¯ä»¥åœ¨ç”¨æˆ·æ€ç›´æ¥é€šè¿‡ WR æ¥æŒ‡å®šç›®çš„åœ°ã€‚è€Œå¦‚æœè®©ç”¨æˆ·éšæ„å¡«å†™åœ°å€ä¿¡æ¯ï¼Œç„¶åç¡¬ä»¶å°±æ ¹æ®è¿™äº›ä¿¡æ¯è¿›è¡Œç»„åŒ…çš„è¯ï¼Œæ˜¯ä¼šå¸¦æ¥é—®é¢˜çš„ã€‚æ¯”å¦‚æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼šç”¨æˆ·é€šè¿‡ WR å‘Šè¯‰ç¡¬ä»¶è¯·ç»™ GID ä¸º Xï¼ŒMAC åœ°å€ä¸º Y çš„èŠ‚ç‚¹çš„ç«¯å£ Z å‘é€æ•°æ®ã€‚ç„¶è€Œ Xï¼ŒYï¼ŒZ å¯èƒ½ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç»„åˆï¼Œæˆ–è€… GID ä¸º X çš„èŠ‚ç‚¹å‹æ ¹éƒ½ä¸å­˜åœ¨äºç½‘ç»œä¸­ï¼Œè€Œç¡¬ä»¶æ˜¯æ— åŠ›æ ¡éªŒè¿™äº›å†…å®¹çš„ï¼Œåªèƒ½ä¹–ä¹–çš„ç»„åŒ…ã€å‘é€æ•°æ®ï¼Œè¿™ä¸ªç›®çš„åœ°æ— æ•ˆçš„æ•°æ®åŒ…å°±ç™½ç™½å‘é€å‡ºå»äº†ã€‚&lt;/p>
&lt;p>è€Œæå‰å‡†å¤‡å¥½åœ°å€ä¿¡æ¯ï¼Œåˆ™å¯ä»¥é¿å…ä¸Šè¿°æƒ…å†µã€‚ç”¨æˆ·åœ¨åˆ›å»º AH æ—¶ä¼šé™·å…¥å†…æ ¸æ€ï¼Œå¦‚æœç”¨æˆ·ä¼ é€’çš„å‚æ•°æœ‰æ•ˆï¼Œå†…æ ¸ä¼šæŠŠè¿™äº›ç›®çš„èŠ‚ç‚¹ä¿¡æ¯å‚¨å­˜èµ·æ¥ï¼Œç”Ÿæˆä¸€ä¸ªæŒ‡é’ˆè¿”å›ç»™ç”¨æˆ·ï¼›å¦‚æœç”¨æˆ·ä¼ é€’çš„å‚æ•°æ— æ•ˆï¼ŒAH å°†åˆ›å»ºå¤±è´¥ã€‚è¿™ä¸€è¿‡ç¨‹å¯ä»¥ä¿è¯åœ°å€ä¿¡æ¯æ˜¯æœ‰æ•ˆçš„ã€‚ç”¨æˆ·é€šè¿‡æŒ‡é’ˆå°±å¯ä»¥å¿«é€ŸæŒ‡å®šç›®çš„èŠ‚ç‚¹ï¼ŒåŠ å¿«æ•°æ®äº¤äº’æµç¨‹ã€‚&lt;/p>
&lt;p>å¯èƒ½æœ‰äººä¼šé—®ï¼Œæ—¢ç„¶å†…æ ¸æ˜¯å¯ä¿¡çš„ï¼Œä¸ºä»€ä¹ˆä¸èƒ½åœ¨å‘é€æ•°æ®æ—¶é™·å…¥å†…æ ¸æ€å»æ ¡éªŒç”¨æˆ·ä¼ é€’çš„åœ°å€ä¿¡æ¯å‘¢ï¼Ÿè¯·åˆ«å¿˜äº† RDMA æŠ€æœ¯çš„ä¸€å¤§ä¼˜åŠ¿åœ¨å“ªé‡Œâ€”â€”æ•°æ®æµç¨‹å¯ä»¥ç›´æ¥ä»ç”¨æˆ·ç©ºé—´åˆ°ç¡¬ä»¶ï¼Œå®Œå…¨ç»•è¿‡å†…æ ¸ï¼Œè¿™æ ·å¯ä»¥é¿å…ç³»ç»Ÿè°ƒç”¨å’Œæ‹·è´çš„å¼€é”€ã€‚å¦‚æœæ¯æ¬¡å‘é€éƒ½è¦æ£€éªŒåœ°å€åˆæ³•æ€§çš„è¯ï¼Œå¿…ç„¶ä¼šé™ä½é€šä¿¡é€Ÿç‡ã€‚&lt;/p>
&lt;ol start="2">
&lt;li>å‘ç”¨æˆ·éšè—åº•å±‚åœ°å€ç»†èŠ‚&lt;/li>
&lt;/ol>
&lt;p>ç”¨æˆ·åˆ›å»º AH æ—¶ï¼Œåªéœ€è¦ä¼ é€’ gidã€ç«¯å£å·ã€é™æ€é€Ÿç‡ç­‰ä¿¡æ¯ï¼Œè€Œå…¶ä»–é€šä¿¡æ‰€éœ€çš„åœ°å€ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯ MAC åœ°å€ï¼‰æ˜¯å†…æ ¸é©±åŠ¨é€šè¿‡æŸ¥è¯¢ç³»ç»Ÿé‚»å±…è¡¨ç­‰æ–¹å¼è§£æåˆ°çš„ï¼Œåº•å±‚æ²¡æœ‰å¿…è¦æš´éœ²è¿™äº›é¢å¤–çš„ä¿¡æ¯ç»™ç”¨æˆ·å±‚ã€‚&lt;/p>
&lt;ol start="3">
&lt;li>å¯ä»¥ä½¿ç”¨ PD å¯¹ç›®çš„åœ°å€è¿›è¡Œç®¡ç†&lt;/li>
&lt;/ol>
&lt;p>å‰æ–‡æˆ‘ä»¬ä»‹ç»ä¿æŠ¤åŸŸæ—¶æ›¾ç»æè¿‡ï¼Œé™¤äº† QPã€MR ä¹‹å¤–ï¼ŒAH ä¹Ÿç”± PD æ¥è¿›è¡Œèµ„æºåˆ’åˆ†ã€‚å½“å®šä¹‰äº† AH è¿™ä¸ªè½¯ä»¶å®ä½“ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ‰€æœ‰çš„ QP å¯è¾¾çš„ç›®çš„åœ°è¿›è¡Œç›¸äº’éš”ç¦»å’Œç®¡ç†ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-16_8_3.webp"
alt="2024-06-16_8_3" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>ä½¿ç”¨ PD éš”ç¦» AH&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>â€‹æ¯”å¦‚ä¸Šå›¾ä¸­ï¼ŒAH1~3 åªèƒ½è¢«åŒä¸€ä¸ª PD ä¸‹çš„ QP3 å’Œ QP9 ä½¿ç”¨ï¼Œè€Œ AH4 åªèƒ½è¢« QP5 ä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="åè®®ç›¸å…³ç« èŠ‚">åè®®ç›¸å…³ç« èŠ‚&lt;/h2>
&lt;p>åè®®ä¸­å…³äº AH çš„ç¯‡å¹…å¹¶ä¸å¤šï¼Œç”šè‡³æ²¡æœ‰ç‹¬ç«‹ä»‹ç»å…¶æ¦‚å¿µçš„ç« èŠ‚ï¼š&lt;/p>
&lt;p>[1] 9.8.3 UD æœåŠ¡ç±»å‹ä¸­çš„ç›®çš„åœ°å€ç”±å“ªäº›éƒ¨åˆ†ç»„æˆï¼šåŒ…æ‹¬ AHã€ QPN å’Œ Q_key&lt;/p>
&lt;p>[2] 10.2.2.2 ç›®çš„åœ°å€çš„ç›¸å…³æ³¨æ„äº‹é¡¹&lt;/p>
&lt;p>[3] 11.2.2.1 AH ç›¸å…³çš„ Verbs æ¥å£&lt;/p>
&lt;p>AH å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæ„Ÿè°¢é˜…è¯»ã€‚ä¸‹ä¸€ç¯‡æ‰“ç®—å‘å¤§å®¶æè¿°æ›´å¤šå…³äº QP çš„ç»†èŠ‚ã€‚&lt;/p></description></item><item><title>Docker Hub é•œåƒä¸‹æ¶è§£å†³æ–¹æ¡ˆ</title><link>https://cuterwrite.top/p/dockerhub-takedown/</link><pubDate>Wed, 12 Jun 2024 19:00:00 +0000</pubDate><guid>https://cuterwrite.top/p/dockerhub-takedown/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-05-28_crop_68935d3d33a3abc75c797b67ad25160f195413.webp" alt="Featured image of post Docker Hub é•œåƒä¸‹æ¶è§£å†³æ–¹æ¡ˆ" />&lt;h1 id="docker-hub-é•œåƒä¸‹æ¶è§£å†³æ–¹æ¡ˆ">Docker Hub é•œåƒä¸‹æ¶è§£å†³æ–¹æ¡ˆ&lt;/h1>
&lt;p>Docker Hub ä½œä¸º Docker å®˜æ–¹çš„é•œåƒä»“åº“ï¼Œæ‹¥æœ‰ç€ä¸°å¯Œçš„é•œåƒèµ„æºï¼Œ æå¤§åœ°æ–¹ä¾¿äº†å¼€å‘è€…è·å–å’Œä½¿ç”¨å„ç§è½¯ä»¶å’ŒæœåŠ¡ã€‚ç„¶è€Œï¼Œä» 2024 å¹´ 6 æœˆ 6 æ—¥å¼€å§‹ï¼Œå›½å†…å„å¤§é•œåƒç«™ç‚¹é™†ç»­å‡ºç°äº† Docker Hub é•œåƒä¸‹æ¶çš„æƒ…å†µï¼ŒåŒ…æ‹¬é˜¿é‡Œäº‘ã€ç§‘å¤§ã€å—å¤§ã€ä¸Šäº¤ç­‰å…¨éƒ¨æŒ‚æ‰ï¼Œå¯¼è‡´å¾ˆå¤šå¼€å‘è€…æ— æ³•æ­£å¸¸æ‹‰å–é•œåƒã€‚åœ¨æ‰§è¡Œ &lt;code>docker pull&lt;/code> å‘½ä»¤æ‹‰å–é•œåƒ docker é•œåƒæ—¶æ— ååº”ï¼Œä¼šä¸€ç›´å¾ªç¯å°è¯•ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-13_takedown-dockerhub.webp"
alt="2024-06-13_takedown-dockerhub" width="auto" loading="lazy">
&lt;/figure>
&lt;p>Docker Hub é•œåƒä¸‹æ¶çš„å¯èƒ½åŸå› ä¸»è¦ä¸ºä¸€äº›é•œåƒåŒ…å«è¿è§„å†…å®¹ï¼Œå¯¼è‡´ä¸Šé¢ä¿¡æ¯ç›‘ç®¡éƒ¨é—¨å‡ºäº†æœ€æ–°è¦æ±‚ï¼Œè¦æ±‚å„å¤§é•œåƒç«™ç‚¹ä¸‹æ¶ç›¸å…³é•œåƒã€‚&lt;/p>
&lt;h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ&lt;/h2>
&lt;p>é¢å¯¹ Docker Hub é•œåƒä¸‹æ¶é—®é¢˜ï¼Œç›®å‰æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼è§£å†³ï¼š&lt;/p>
&lt;h3 id="1-ä½¿ç”¨-atomhub-é•œåƒç«™ç‚¹">1. ä½¿ç”¨ AtomHub é•œåƒç«™ç‚¹&lt;/h3>
&lt;p>AtomHub æ˜¯ç”±å¼€æ”¾åŸå­å¼€æºåŸºé‡‘ä¼šå‘èµ·ï¼Œéµå¾ª OCI æ ‡å‡†ï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›å¼€æ”¾ä¸­ç«‹ã€å®‰å…¨å¯ä¿¡ã€é«˜æ•ˆä¾¿æ·çš„æ–°ä¸€ä»£å¼€æºå®¹å™¨é•œåƒä¸­å¿ƒã€‚å…¶å…·æœ‰å®˜æ–¹èƒŒä¹¦ï¼Œæ˜¯å½“å‰å”¯ä¸€æ­£å¸¸çš„ Docker Hub é•œåƒç«™ç‚¹ã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼ŒAtomHub çš„é—®é¢˜æ˜¯é•œåƒæ•°é‡è¾ƒå°‘ï¼Œç›®å‰åªæœ‰å‡ ç™¾ä¸ªé•œåƒæ–‡ä»¶ï¼›ä»¥åŠï¼Œéƒ¨åˆ†è½¯ä»¶çš„ç‰ˆæœ¬è¾ƒæ—§ã€‚&lt;/p>
&lt;h4 id="é…ç½®-atomhub-é•œåƒç«™ç‚¹">é…ç½® AtomHub é•œåƒç«™ç‚¹&lt;/h4>
&lt;ul>
&lt;li>ä¿®æ”¹ /etc/docker/daemon.json æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code class="language-json">{
&amp;quot;registry-mirrors&amp;quot;: [&amp;quot;https://atomhub.openatom.cn&amp;quot;]
}
&lt;/code>&lt;/pre>
&lt;h4 id="é‡å¯-docker-æœåŠ¡">é‡å¯ Docker æœåŠ¡ï¼š&lt;/h4>
&lt;pre>&lt;code class="language-bash">sudo systemctl daemon-reload
sudo systemctl restart docker
&lt;/code>&lt;/pre>
&lt;p>ç„¶åå°±å¯ä»¥æ­£å¸¸æ‹‰å–ä¸€äº›å¸¸ç”¨é•œåƒäº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦çš„é•œåƒä¸åœ¨ AtomHub ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¸é€‚ç”¨äº†ã€‚&lt;/p>
&lt;h3 id="2-é…ç½®-vpn-ä»£ç†">2. é…ç½® VPN ä»£ç†&lt;/h3>
&lt;p>é€šè¿‡é…ç½® VPN ä»£ç†ï¼Œå¯ä»¥è®¿é—®è¢«å±è”½çš„ Docker Hub æºç«™ç‚¹ï¼Œä»è€Œæ‹‰å–é•œåƒã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•éœ€è¦è‡ªå¤‡ VPN æœåŠ¡ï¼Œä¸”é€Ÿåº¦å¯èƒ½è¾ƒæ…¢ä¸”ä¸ç¨³å®šã€‚&lt;/p>
&lt;h4 id="é…ç½®æ–¹æ³•">é…ç½®æ–¹æ³•&lt;/h4>
&lt;ul>
&lt;li>åˆ›å»º &lt;code>/etc/systemd/system/docker.service.d/http-proxy.conf&lt;/code> æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code class="language-bash">[Service]
Environment=&amp;quot;HTTP_PROXY=http://your_proxy_server:port&amp;quot;
Environment=&amp;quot;HTTPS_PROXY=http://your_proxy_server:port&amp;quot;
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>é‡å¯ Docker æœåŠ¡ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code class="language-bash">sudo systemctl daemon-reload
sudo systemctl restart docker
&lt;/code>&lt;/pre>
&lt;h3 id="3-ä½¿ç”¨-skopeo-æ‹·è´é•œåƒåˆ°ç§æœ‰é•œåƒä»“åº“">3. ä½¿ç”¨ Skopeo æ‹·è´é•œåƒåˆ°ç§æœ‰é•œåƒä»“åº“&lt;/h3>
&lt;p>Skopeo æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨äºåœ¨ä¸åŒçš„é•œåƒä»“åº“ä¹‹é—´å¤åˆ¶ã€æ£€æŸ¥å’Œç­¾åé•œåƒã€‚è¯¥æ–¹æ³•éœ€è¦ä¸€å°æµ·å¤–äº‘ä¸»æœºï¼Œä¸”éœ€è¦æ²¡æœ‰è¢«å¢™ã€‚&lt;/p>
&lt;h4 id="å…·ä½“æ­¥éª¤">å…·ä½“æ­¥éª¤&lt;/h4>
&lt;p>è¿™é‡Œä»¥é˜¿é‡Œäº‘ç§æœ‰é•œåƒä»“åº“ä¸ºä¾‹ï¼Œå°† Docker Hub ä¸Šçš„é•œåƒå¤åˆ¶åˆ°é˜¿é‡Œäº‘ç§æœ‰é•œåƒä»“åº“ã€‚&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆï¼Œä½ éœ€è¦å¯ç”¨&lt;a class="link" href="https://cr.console.aliyun.com/" target="_blank" rel="noopener" >é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
ï¼Œåˆ›å»ºä¸€ä¸ªä¸ªäººå®ä¾‹ï¼š&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-13_aliyun-container.webp"
alt="2024-06-13_aliyun-container" width="90%" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>è¿›å…¥ä¸ªäººå®ä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼š&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-13_create-namespace.webp"
alt="2024-06-13_create-namespace" width="90%" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>åˆ›å»ºä¸€ä¸ªé•œåƒä»“åº“ï¼ˆå¯¹åº”ä½ æƒ³è¦å¤åˆ¶çš„é•œåƒï¼‰ï¼š&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-13_create-repository.webp"
alt="2024-06-13_create-repository" width="90%" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>è®¾ç½®è®¿é—®å‡­è¯ï¼š&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/2024-06-13_set-pass.webp"
alt="2024-06-13_set-pass" width="90%" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>ç„¶åï¼Œç™»å½•åˆ°ä½ çš„æµ·å¤–äº‘ä¸»æœºï¼Œå…ˆå®‰è£… Skopeoï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code class="language-bash">sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y skopeo
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>ä½¿ç”¨ Skopeo æ‹·è´é•œåƒï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code class="language-bash">docker login --username=yourusername registry.cn-hangzhou.aliyuncs.com
skopeo copy docker://docker.io/library/image:tag docker://registry.cn-hangzhou.aliyuncs.com/yournamespace/yourimage:tag
&lt;/code>&lt;/pre>
&lt;h3 id="4-éƒ¨ç½²ç§æœ‰é•œåƒä»“åº“">4. éƒ¨ç½²ç§æœ‰é•œåƒä»“åº“&lt;/h3>
&lt;p>é™¤äº†ä»¥ä¸Šæ–¹æ³•ï¼Œè¿˜å¯ä»¥é€šè¿‡æœ€è¿‘ä¸€å¤§ä½¬å¼€æºçš„ &lt;a class="link" href="https://github.com/dqzboy/Docker-Proxy" target="_blank" rel="noopener" >Docker-Proxy
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
é¡¹ç›®æ­å»ºè‡ªå·±çš„ç§æœ‰é•œåƒä»“åº“ã€‚&lt;/p>
&lt;a href="https://github.com/dqzboy/Docker-Proxy" target="_blank" class="card-github fetch-waiting no-styling"
repo="dqzboy/Docker-Proxy" id="repo-NzPyKIPCLsDw3fIr-card">
&lt;div class="gc-titlebar">
&lt;div class="gc-titlebar-left">
&lt;div class="gc-owner">
&lt;div id="repo-NzPyKIPCLsDw3fIr-avatar" class="gc-avatar">&lt;/div>
&lt;div class="gc-user">dqzboy&lt;/div>
&lt;/div>
&lt;div class="gc-divider">/&lt;/div>
&lt;div class="gc-repo">Docker-Proxy&lt;/div>
&lt;/div>
&lt;div class="github-logo">&lt;/div>
&lt;/div>
&lt;div id="repo-NzPyKIPCLsDw3fIr-description" class="gc-description">Waiting for api.github.com...&lt;/div>
&lt;div class="gc-infobar">
&lt;div id="repo-NzPyKIPCLsDw3fIr-stars" class="gc-stars">0&lt;/div>
&lt;div id="repo-NzPyKIPCLsDw3fIr-forks" class="gc-forks">0&lt;/div>
&lt;div id="repo-NzPyKIPCLsDw3fIr-license" class="gc-license">unkown&lt;/div>
&lt;div id="repo-NzPyKIPCLsDw3fIr-language" class="gc-language">Waiting...&lt;/div>
&lt;/div>
&lt;/a>
&lt;script id="repo-NzPyKIPCLsDw3fIr-script" type="text/javascript" defer>
fetch('https://api.cuterwrite.top/api/repos/dqzboy\/Docker-Proxy', {
referrerPolicy: "no-referrer"
})
.then(response => response.json())
.then(data => {
document.getElementById('repo-NzPyKIPCLsDw3fIr-description').innerText = data.description.replace(
/:[a-zA-Z0-9_]+:/g, '');
document.getElementById('repo-NzPyKIPCLsDw3fIr-language').innerText = data.language;
document.getElementById('repo-NzPyKIPCLsDw3fIr-forks').innerText = Intl.NumberFormat('en-us', {
notation: "compact",
maximumFractionDigits: 1
}).format(data.forks).replaceAll("\u202f", '');
document.getElementById('repo-NzPyKIPCLsDw3fIr-stars').innerText = Intl.NumberFormat('en-us', {
notation: "compact",
maximumFractionDigits: 1
}).format(data.stargazers_count).replaceAll("\u202f", '');
const avatarEl = document.getElementById('repo-NzPyKIPCLsDw3fIr-avatar');
avatarEl.style.backgroundImage = 'url(' + data.owner.avatar_url + ')';
avatarEl.style.backgroundColor = 'transparent';
if (data.license?.spdx_id) {
document.getElementById('repo-NzPyKIPCLsDw3fIr-license').innerText = data.license.spdx_id
} else {
document.getElementById('repo-NzPyKIPCLsDw3fIr-license').classList.add = "no-license"
};
document.getElementById('repo-NzPyKIPCLsDw3fIr-card').classList.remove("fetch-waiting");
console.log("[GITHUB-CARD] Loaded card for dqzboy\/Docker-Proxy.")
}).catch(err => {
const c = document.getElementById('repo-NzPyKIPCLsDw3fIr-card');
c.classList.add("fetch-error");
console.warn("[GITHUB-CARD] (Error) Loading card for dqzboy\/Docker-Proxy.")
})
&lt;/script>
&lt;p>è¯¥æ–¹æ³•ä¹Ÿéœ€è¦ä¸€å°æµ·å¤–äº‘ä¸»æœºï¼Œä¸”éœ€è¦æ²¡æœ‰è¢«å¢™ï¼›ä»¥åŠä¸€ä¸ªåŸŸåï¼ˆä¸éœ€è¦å¤‡æ¡ˆï¼‰ã€‚&lt;/p>
&lt;h4 id="éƒ¨ç½²">éƒ¨ç½²&lt;/h4>
&lt;p>ç›®å‰é¡¹ç›®æä¾›äº†ä¸‰ç§éƒ¨ç½²æ–¹å¼ï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨é¡¹ç›®è„šæœ¬ä¸€é”®éƒ¨ç½²ã€‚&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨é¡¹ç›®è„šæœ¬ä¸€é”®éƒ¨ç½²ï¼š&lt;/li>
&lt;/ul>
&lt;pre>&lt;code class="language-bash"># CentOS
yum -y install wget curl
# ubuntu
apt -y install wget curl
bash -c &amp;quot;$(curl -fsSL https://raw.githubusercontent.com/dqzboy/Docker-Proxy/main/install/DockerProxy_Install.sh)&amp;quot;
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>
&lt;p>éƒ¨ç½²åˆ° Render&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/dqzboy/Docker-Proxy/blob/main/Render/README.md" target="_blank" rel="noopener" >ä½¿ç”¨ Render å¿«é€Ÿéƒ¨ç½²
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Docker Compose éƒ¨ç½²&lt;/p>
&lt;ol>
&lt;li>ä¸‹è½½ config ç›®å½•ä¸‹å¯¹åº”çš„ yml æ–‡ä»¶åˆ°ä½ æœ¬åœ°æœºå™¨ä¸Š&lt;/li>
&lt;li>ä¸‹è½½ &lt;a class="link" href="https://github.com/dqzboy/Docker-Proxy/blob/main/docker-compose.yaml" target="_blank" rel="noopener" >docker-compose.yaml
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
æ–‡ä»¶åˆ°ä½ æœ¬åœ°æœºå™¨ä¸Šï¼Œå¹¶ä¸”ä¸é…ç½®æ–‡ä»¶åŒçº§ç›®å½•ä¸‹&lt;/li>
&lt;li>æ‰§è¡Œ &lt;code>docker compose&lt;/code> å‘½ä»¤å¯åŠ¨å®¹å™¨æœåŠ¡&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">docker compose up -d
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs -f [å®¹å™¨ ID æˆ–åç§°]
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;p>æœ€åï¼Œéœ€è¦ç™»å½•åŸŸåè§£ææ–¹ï¼Œå°† &lt;code>hub&lt;/code>ã€&lt;code>gcr&lt;/code>ã€&lt;code>ghcr&lt;/code>ã€&lt;code>k8s-gcr&lt;/code>ã€&lt;code>ui&lt;/code>ã€&lt;code>quay&lt;/code> ç­‰ A è®°å½•è§£æåˆ°ä½ çš„æµ·å¤–äº‘ä¸»æœº IPv4 åœ°å€ï¼Œç„¶åå°±å¯ä»¥å°† &lt;code>/etc/docker/daemon.json&lt;/code> ä¸­çš„ &lt;strong>registry-mirrors&lt;/strong> è®¾ç½®ä¸º &lt;code>https://hub.yourdomain&lt;/code> è¿›è¡Œé•œåƒåŠ é€Ÿäº†ã€‚&lt;/p></description></item><item><title>RDMA ä¹‹ Protection Domain</title><link>https://cuterwrite.top/p/rdma-protection-domain/</link><pubDate>Thu, 18 Apr 2024 21:42:00 +0000</pubDate><guid>https://cuterwrite.top/p/rdma-protection-domain/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/d31a474af07682028ca085f871bc5d07195413-2024-04-19.webp" alt="Featured image of post RDMA ä¹‹ Protection Domain" />&lt;h1 id="rdma-ä¹‹-protection-domain">RDMA ä¹‹ Protection Domain&lt;/h1>
&lt;p>&lt;strong>æœ¬æ–‡æ¬¢è¿éå•†ä¸šè½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>å£°æ˜ï¼šä»…ç”¨äºæ”¶è—ï¼Œä¾¿äºé˜…è¯»&lt;/p>&lt;span class="cite">&lt;span>â€• &lt;/span>&lt;span>Savir, &lt;/span>&lt;a href="https://zhuanlan.zhihu.com/p/159493100">&lt;cite>çŸ¥ä¹ä¸“æ ï¼š7. RDMA ä¹‹ Protection Domain&lt;/cite>&lt;/a>&lt;/span>&lt;/blockquote>
&lt;p>å‰æ–‡æˆ‘ä»¬ç®€å•ä»‹ç»äº† RDMA ä¸­æœ€å¸¸è§çš„ä¸€äº›èµ„æºï¼ŒåŒ…æ‹¬å„ç§ Queueï¼Œä»¥åŠ MR çš„æ¦‚å¿µç­‰ç­‰ã€‚MR ç”¨äºæ§åˆ¶å’Œç®¡ç† HCA å¯¹äºæœ¬ç«¯å’Œè¿œç«¯å†…å­˜çš„è®¿é—®æƒé™ï¼Œç¡®ä¿ HCA åªæœ‰æ‹¿åˆ°æ­£ç¡® Key ä¹‹åæ‰èƒ½è¯»å†™ç”¨æˆ·å·²ç»æ³¨å†Œäº†çš„å†…å­˜åŒºåŸŸã€‚ä¸ºäº†æ›´å¥½çš„ä¿éšœå®‰å…¨æ€§ï¼ŒIB åè®®åˆæå‡ºäº† Protection Domainï¼ˆPDï¼‰çš„æ¦‚å¿µï¼Œç”¨äºä¿è¯ RDMA èµ„æºé—´çš„ç›¸äº’éš”ç¦»ï¼Œæœ¬æ–‡å°±ä»‹ç»ä¸€ä¸‹ PD çš„æ¦‚å¿µã€‚&lt;/p>
&lt;h2 id="pd-æ˜¯ä»€ä¹ˆ">PD æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;p>PD å…¨ç§°æ˜¯ Protection Domainï¼Œæ„ä¸º&amp;quot;ä¿æŠ¤åŸŸ&amp;quot;ã€‚åŸŸçš„æ¦‚å¿µæˆ‘ä»¬ç»å¸¸è§åˆ°ï¼Œä»æ•°å­¦ä¸Šçš„â€œå®æ•°åŸŸâ€ã€â€œå¤æ•°åŸŸâ€ï¼Œåˆ°åœ°ç†ä¸Šçš„â€œç©ºåŸŸâ€ã€â€œæµ·åŸŸâ€ç­‰ç­‰ï¼Œè¡¨ç¤ºä¸€ä¸ªç©ºé—´/èŒƒå›´ã€‚åœ¨ RDMA ä¸­ï¼ŒPD åƒæ˜¯ä¸€ä¸ªå®¹çº³äº†å„ç§èµ„æºï¼ˆQPã€MR ç­‰ï¼‰çš„â€œå®¹å™¨â€ï¼Œå°†è¿™äº›èµ„æºçº³å…¥è‡ªå·±çš„ä¿æŠ¤èŒƒå›´å†…ï¼Œé¿å…ä»–ä»¬è¢«æœªç»æˆæƒçš„è®¿é—®ã€‚ä¸€ä¸ªèŠ‚ç‚¹ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªä¿æŠ¤åŸŸï¼Œå„ä¸ª PD æ‰€å®¹çº³çš„èµ„æºå½¼æ­¤éš”ç¦»ï¼Œæ— æ³•ä¸€èµ·ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æ¦‚å¿µè¿˜æ˜¯æœ‰äº›æŠ½è±¡ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ PD æœ‰ä»€ä¹ˆä½œç”¨ï¼Œå…·ä½“è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚&lt;/p>
&lt;h2 id="pd-çš„ä½œç”¨">PD çš„ä½œç”¨&lt;/h2>
&lt;p>ä¸€ä¸ªç”¨æˆ·å¯èƒ½åˆ›å»ºå¤šä¸ª QP å’Œå¤šä¸ª MRï¼Œæ¯ä¸ª QP å¯èƒ½å’Œä¸åŒçš„è¿œç«¯ QP å»ºç«‹äº†è¿æ¥ï¼Œæ¯”å¦‚ä¸‹å›¾è¿™æ ·ï¼ˆç°è‰²ç®­å¤´è¡¨ç¤º QP é—´çš„è¿æ¥å…³ç³»ï¼‰ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/7_1-2024-04-19.webp"
alt="7_1-2024-04-19" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>å›¾ 1ï¼šæ²¡æœ‰ PD æ¦‚å¿µæ—¶çš„ RDMA èµ„æº&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>ç”±äº MR å’Œ QP ä¹‹é—´å¹¶æ²¡æœ‰ç»‘å®šå…³ç³»ï¼Œè¿™å°±æ„å‘³ç€ä¸€æ—¦æŸä¸ªè¿œç«¯çš„ QP ä¸æœ¬ç«¯çš„ä¸€ä¸ª QP å»ºç«‹äº†è¿æ¥ï¼Œå…·å¤‡äº†é€šä¿¡çš„æ¡ä»¶ï¼Œé‚£ä¹ˆç†è®ºä¸Šè¿œç«¯èŠ‚ç‚¹åªè¦çŸ¥é“ VA å’Œ R_keyï¼ˆç”šè‡³å¯ä»¥é ä¸æ–­çš„çŒœæµ‹ç›´åˆ°å¾—åˆ°ä¸€å¯¹æœ‰æ•ˆçš„å€¼ï¼‰ï¼Œå°±å¯ä»¥è®¿é—®æœ¬ç«¯èŠ‚ç‚¹æŸä¸ª MR çš„å†…å®¹ã€‚&lt;/p>
&lt;p>å…¶å®ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMR çš„è™šæ‹Ÿåœ°å€ VA å’Œç§˜é’¥ R_Key æ˜¯å¾ˆéš¾çŒœåˆ°çš„ï¼Œå·²ç»å¯ä»¥ä¿è¯ä¸€å®šçš„å®‰å…¨æ€§äº†ã€‚ä½†æ˜¯ä¸ºäº†æ›´å¥½çš„ä¿æŠ¤å†…å­˜ä¸­çš„æ•°æ®ï¼ŒæŠŠå„ç§èµ„æºçš„æƒé™åšè¿›ä¸€æ­¥çš„éš”ç¦»å’Œåˆ’åˆ†ï¼Œæˆ‘ä»¬åœ¨åˆåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­å®šä¹‰äº† PDï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/7_2-2024-04-19.webp"
alt="7_2-2024-04-19" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>å›¾ 2ï¼šåŠ å…¥ PD æ¦‚å¿µæ—¶çš„ RDMA èµ„æº&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>å›¾ä¸­ Node 0 ä¸Šæœ‰ä¸¤ä¸ª PDï¼Œå°† 3 ä¸ª QP å’Œ 2 ä¸ª MR åˆ†ä¸ºäº†ä¸¤ç»„ï¼Œæ­¤å¤– Node 1 å’Œ Node 2 ä¸­å„æœ‰ä¸€ä¸ª PD åŒ…å«äº†æ‰€æœ‰ QP å’Œ MRã€‚Node 0 ä¸Šçš„ä¸¤ä¸ª PD ä¸­çš„èµ„æºä¸å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ QP3 å’Œ QP9 ä¸èƒ½è®¿é—® MR1 çš„æ•°æ®ï¼ŒQP6 ä¹Ÿä¸å¯ä»¥è®¿é—® MR0 çš„æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬åœ¨æ•°æ®æ”¶å‘æ—¶ï¼ŒæŒ‡å®šç¡¬ä»¶ä½¿ç”¨ QP3 å’Œ MR1ï¼Œé‚£ä¹ˆç¡¬ä»¶æ ¡éªŒä»–ä»¬ä¸å±äºåŒä¸€ä¸ª PD åï¼Œä¼šè¿”å›é”™è¯¯ã€‚&lt;/p>
&lt;p>å¯¹äºè¿œç«¯èŠ‚ç‚¹æ¥è¯´ï¼ŒNode1 åªèƒ½é€šè¿‡ QP8 ç›¸è¿çš„ QP3 æ¥è®¿é—® Node0 çš„å†…å­˜ï¼Œä½†æ˜¯å› ä¸º Node 0 çš„ QP3 è¢«â€œåœˆâ€åˆ°äº† PD0 è¿™ä¸ªä¿æŠ¤åŸŸä¸­ï¼Œæ‰€ä»¥ Node 1 çš„ QP8 ä¹Ÿåªèƒ½è®¿é—® MR0 å¯¹åº”çš„å†…å­˜ï¼Œ&lt;strong>æ— è®ºå¦‚ä½•éƒ½æ— æ³•è®¿é—® MR1 ä¸­çš„æ•°æ®&lt;/strong>ï¼Œè¿™æ˜¯ä»ä¸¤ä¸ªæ–¹é¢é™åˆ¶çš„ï¼š&lt;/p>
&lt;ol>
&lt;li>Node 1 çš„ QP8 åªè·Ÿ Node 0 çš„ QP3 æœ‰è¿æ¥å…³ç³»ï¼Œæ— æ³•é€šè¿‡ Node 0 çš„ QP6 è¿›è¡Œå†…å­˜è®¿é—®ã€‚&lt;/li>
&lt;li>Node 0 çš„ MR1 å’Œ QP3 å±äºä¸åŒçš„ PDï¼Œå°±ç®— Node 1 çš„ QP8 æ‹¿åˆ°äº† MR1 çš„ VA å’Œ R_keyï¼Œç¡¬ä»¶ä¹Ÿä¼šå› ä¸º PD ä¸åŒè€Œæ‹’ç»æä¾›æœåŠ¡ã€‚&lt;/li>
&lt;/ol>
&lt;p>æ‰€ä»¥å°±å¦‚æœ¬æ–‡ä¸€å¼€å§‹æ‰€è¯´çš„ï¼ŒPD å°±åƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå°†ä¸€äº› RDMA èµ„æºä¿æŠ¤èµ·æ¥ï¼Œå½¼æ­¤éš”ç¦»ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚å…¶å® RDMA ä¸­ä¸æ­¢æœ‰ QPã€MR è¿™äº›èµ„æºï¼Œåæ–‡å³å°†ä»‹ç»çš„ Address Handleï¼ŒMemory Window ç­‰ä¹Ÿæ˜¯ç”± PD è¿›è¡Œéš”ç¦»ä¿æŠ¤çš„ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•ä½¿ç”¨-pd">å¦‚ä½•ä½¿ç”¨ PD&lt;/h2>
&lt;p>è¿˜æ˜¯çœ‹ä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬æ³¨æ„åˆ° Node 0 ä¸ºäº†éš”ç¦»èµ„æºï¼Œå­˜åœ¨ä¸¤ä¸ª PDï¼›è€Œ Node 1 å’Œ Node 2 åªæœ‰ä¸€ä¸ª PD åŒ…å«äº†æ‰€æœ‰èµ„æºã€‚&lt;/p>
&lt;p>æˆ‘ä¹‹æ‰€ä»¥è¿™æ ·ç”»ï¼Œæ˜¯ä¸ºäº†è¯´æ˜ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ’åˆ†å¤šå°‘ä¸ª PD å®Œå…¨æ˜¯ç”±ç”¨æˆ·å†³å®šçš„ï¼Œ&lt;strong>å¦‚æœæƒ³æé«˜å®‰å…¨æ€§ï¼Œé‚£ä¹ˆå¯¹æ¯ä¸ªè¿æ¥åˆ°è¿œç«¯èŠ‚ç‚¹çš„ QP å’Œä¾›è¿œç«¯è®¿é—®çš„ MR éƒ½åº”è¯¥å°½é‡é€šè¿‡åˆ’åˆ† PD åšåˆ°éš”ç¦»ï¼›å¦‚æœä¸è¿½æ±‚æ›´é«˜çš„å®‰å…¨æ€§ï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ª PDï¼Œå›Šæ‹¬æ‰€æœ‰çš„èµ„æºä¹Ÿæ˜¯å¯ä»¥çš„&lt;/strong>ã€‚&lt;/p>
&lt;p>IB åè®®ä¸­è§„å®šï¼š&lt;strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½è‡³å°‘è¦æœ‰ä¸€ä¸ª PDï¼Œæ¯ä¸ª QP éƒ½å¿…é¡»å±äºä¸€ä¸ª PDï¼Œæ¯ä¸ª MR ä¹Ÿå¿…é¡»å±äºä¸€ä¸ª PD&lt;/strong>ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆ PD çš„åŒ…å«å…³ç³»åœ¨è½¯ä»¶ä¸Šæ˜¯å¦‚ä½•ä½“ç°çš„å‘¢ï¼Ÿå®ƒæœ¬èº«æ˜¯æœ‰ä¸€ä¸ªè½¯ä»¶å®ä½“çš„ï¼ˆç»“æ„ä½“ï¼‰ï¼Œè®°å½•äº†è¿™ä¸ªä¿æŠ¤åŸŸçš„ä¸€äº›ä¿¡æ¯ã€‚ç”¨æˆ·åœ¨åˆ›å»º QP å’Œ MR ç­‰èµ„æºä¹‹å‰ï¼Œå¿…é¡»å…ˆé€šè¿‡ IB æ¡†æ¶çš„æ¥å£åˆ›å»ºä¸€ä¸ª PDï¼Œæ‹¿åˆ°å®ƒçš„æŒ‡é’ˆ/å¥æŸ„ã€‚æ¥ä¸‹æ¥åœ¨åˆ›å»º QP å’Œ MR çš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥è¿™ä¸ª PD çš„æŒ‡é’ˆ/å¥æŸ„ï¼ŒPD ä¿¡æ¯å°±ä¼šåŒ…å«åœ¨ QP å’Œ MR ä¸­ã€‚ç¡¬ä»¶æ”¶å‘åŒ…æ—¶ï¼Œä¼šå¯¹ QP å’Œ MR çš„ PD è¿›è¡Œæ ¡éªŒã€‚æ›´å¤šçš„è½¯ä»¶åè®®æ ˆçš„å†…å®¹ï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­ä»‹ç»ã€‚&lt;/p>
&lt;p>å¦å¤–éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œ&lt;strong>PD æ˜¯æœ¬åœ°æ¦‚å¿µï¼Œä»…å­˜åœ¨äºèŠ‚ç‚¹å†…éƒ¨&lt;/strong>ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ˜¯ä¸å¯è§çš„ï¼›è€Œ MR æ˜¯å¯¹æœ¬ç«¯å’Œå¯¹ç«¯éƒ½å¯è§çš„ã€‚&lt;/p>
&lt;p>ä¸ºäº†æ–¹ä¾¿å¤§å®¶æŸ¥é˜…å’Œå­¦ä¹ ï¼Œä»¥åæˆ‘ä¼šåˆ—å‡ºæ–‡ç« æ¶‰åŠçš„åè®®ç« èŠ‚ï¼Œå‰é¢çš„å†…å®¹æœ‰æ—¶é—´çš„æ—¶å€™æˆ‘ä¹Ÿä¼šè¡¥å……ä¸€ä¸‹ã€‚&lt;/p>
&lt;h2 id="pd-ç›¸å…³åè®®ç« èŠ‚">PD ç›¸å…³åè®®ç« èŠ‚&lt;/h2>
&lt;ul>
&lt;li>3.5.5 PD çš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨&lt;/li>
&lt;li>10.2.3 ä»‹ç»äº† PD å’Œå…¶ä»–ä¸€äº› RDMA èµ„æºçš„å…³ç³»ï¼Œä»¥åŠ PD ç›¸å…³çš„è½¯ä»¶æ¥å£ã€‚&lt;/li>
&lt;li>10.6.3.5 å†æ¬¡å¼ºè°ƒ PD å’Œ MR åŠ QP çš„å…³ç³»ã€‚&lt;/li>
&lt;li>11.2.1.5 è¯¦ç»†ä»‹ç» PD çš„ Verbs æ¥å£ï¼ŒåŒ…æ‹¬ä½œç”¨ã€å…¥å‚ã€å‡ºå‚å’Œè¿”å›å€¼ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¥½äº†ï¼Œå…³äº PD çš„ä»‹ç»å°±åˆ°è¿™é‡Œã€‚ä¸‹æ–‡æˆ‘ä¼šä»‹ç»ç”¨äº UD æœåŠ¡ç±»å‹çš„ Address Handle çš„æ¦‚å¿µã€‚&lt;/p></description></item><item><title>RDMA ä¹‹ Memory Region</title><link>https://cuterwrite.top/p/rdma-mr/</link><pubDate>Wed, 03 Apr 2024 16:17:00 +0000</pubDate><guid>https://cuterwrite.top/p/rdma-mr/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/8fa232626b76940fddc8cc52a49c49e9195413-2024-04-04.webp" alt="Featured image of post RDMA ä¹‹ Memory Region" />&lt;h1 id="rdma-ä¹‹-memory-region">RDMA ä¹‹ Memory Region&lt;/h1>
&lt;p>&lt;strong>æœ¬æ–‡æ¬¢è¿éå•†ä¸šè½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>å£°æ˜ï¼šä»…ç”¨äºæ”¶è—ï¼Œä¾¿äºé˜…è¯»&lt;/p>&lt;span class="cite">&lt;span>â€• &lt;/span>&lt;span>Savir, &lt;/span>&lt;a href="https://zhuanlan.zhihu.com/p/156975042">&lt;cite>çŸ¥ä¹ä¸“æ ï¼š6. RDMA ä¹‹ Memory Region&lt;/cite>&lt;/a>&lt;/span>&lt;/blockquote>
&lt;p>æˆ‘ä»¬å‡è®¾ä¸€ç§åœºæ™¯ï¼ŒåŒæ—¶ä¹Ÿé¡ºä¾¿æ¸©ä¹ ä¸€ä¸‹ RDMA WRITE æ“ä½œçš„æµç¨‹ï¼š&lt;/p>
&lt;p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒA èŠ‚ç‚¹æƒ³è¦é€šè¿‡ IB åè®®å‘ B èŠ‚ç‚¹çš„å†…å­˜ä¸­å†™å…¥ä¸€æ®µæ•°æ®ï¼Œä¸Šå±‚åº”ç”¨ç»™æœ¬èŠ‚ç‚¹çš„ RDMA ç½‘å¡ä¸‹å‘äº†ä¸€ä¸ª WQEï¼ŒWQE ä¸­åŒ…å«äº†æºå†…å­˜åœ°å€ã€ç›®çš„å†…å­˜åœ°å€ã€æ•°æ®é•¿åº¦å’Œç§˜é’¥ç­‰ä¿¡æ¯ï¼Œç„¶åç¡¬ä»¶ä¼šä»å†…å­˜ä¸­å–å‡ºæ•°æ®ï¼Œç»„åŒ…å‘é€åˆ°å¯¹ç«¯ç½‘å¡ã€‚B èŠ‚ç‚¹çš„ç½‘å¡æ”¶åˆ°æ•°æ®åï¼Œè§£æåˆ°å…¶ä¸­çš„ç›®çš„å†…å­˜åœ°å€ï¼ŒæŠŠæ•°æ®å†™å…¥åˆ°æœ¬èŠ‚ç‚¹çš„å†…å­˜ä¸­ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/6_1-2024-04-04.webp"
alt="6_1-2024-04-04" width="auto" loading="lazy">
&lt;/figure>
&lt;p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒAPP æä¾›çš„åœ°å€éƒ½æ˜¯è™šæ‹Ÿåœ°å€ï¼ˆVirtual Addressï¼Œä¸‹æ–‡ç§° VAï¼‰ï¼Œç»è¿‡ MMU çš„è½¬æ¢æ‰èƒ½å¾—åˆ°çœŸå®çš„ç‰©ç†åœ°å€ï¼ˆPhysical Addressï¼Œä¸‹æ–‡ç§° PAï¼‰ï¼Œæˆ‘ä»¬çš„&lt;strong>RDMA ç½‘å¡æ˜¯å¦‚ä½•å¾—åˆ° PA ä»è€Œå»å†…å­˜ä¸­æ‹¿åˆ°æ•°æ®çš„å‘¢&lt;/strong>ï¼Ÿå°±ç®—ç½‘å¡çŸ¥é“ä¸Šå“ªå»å–æ•°æ®ï¼Œ&lt;strong>å¦‚æœç”¨æˆ·æ¶æ„æŒ‡å®šäº†ä¸€ä¸ªéæ³•çš„ VAï¼Œé‚£ç½‘å¡å²‚ä¸æ˜¯æœ‰å¯èƒ½è¢«â€œæŒ‡ä½¿â€å»è¯»å†™å…³é”®å†…å­˜&lt;/strong>ï¼Ÿ&lt;/p>
&lt;p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼ŒIB åè®®æå‡ºäº† MR çš„æ¦‚å¿µã€‚&lt;/p>
&lt;h2 id="mr-æ˜¯ä»€ä¹ˆ">MR æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;p>MR å…¨ç§°ä¸º Memory Regionï¼ŒæŒ‡çš„æ˜¯ç”± RDMA è½¯ä»¶å±‚åœ¨å†…å­˜ä¸­è§„åˆ’å‡ºçš„ä¸€ç‰‡åŒºåŸŸï¼Œç”¨äºå­˜æ”¾æ”¶å‘çš„æ•°æ®ã€‚IB åè®®ä¸­ï¼Œç”¨æˆ·åœ¨ç”³è¯·å®Œç”¨äºå­˜æ”¾æ•°æ®çš„å†…å­˜åŒºåŸŸä¹‹åï¼Œéƒ½éœ€è¦é€šè¿‡è°ƒç”¨ IB æ¡†æ¶æä¾›çš„ API æ³¨å†Œ MRï¼Œæ‰èƒ½è®© RDMA ç½‘å¡è®¿é—®è¿™ç‰‡å†…å­˜åŒºåŸŸã€‚ç”±ä¸‹å›¾å¯ä»¥çœ‹åˆ°ï¼ŒMR å°±æ˜¯ä¸€ç‰‡ç‰¹æ®Šçš„å†…å­˜è€Œå·²ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/6_2-2024-04-04.webp"
alt="6_2-2024-04-04" width="auto" loading="lazy">
&lt;/figure>
&lt;p>åœ¨å¯¹ IB åè®®è¿›è¡Œç›¸å…³æè¿°æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ç§° RDMA ç¡¬ä»¶ä¸º&lt;strong>HCAï¼ˆHost Channel Adapterï¼Œ å®¿ä¸»é€šé“é€‚é…å™¨ï¼‰&lt;/strong>ï¼ŒIB åè®®ä¸­å¯¹å…¶çš„å®šä¹‰æ˜¯â€œå¤„ç†å™¨å’Œ I/O å•å…ƒä¸­èƒ½å¤Ÿäº§ç”Ÿå’Œæ¶ˆè€—æ•°æ®åŒ…çš„ IB è®¾å¤‡â€ï¼Œä¸ºäº†ä¸åè®®ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬åœ¨åŒ…æ‹¬æœ¬æ–‡åŠä¹‹åçš„æ–‡ç« ä¸­éƒ½ç§°ç¡¬ä»¶éƒ¨åˆ†ä¸º HCAã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆè¦æ³¨å†Œ-mr">ä¸ºä»€ä¹ˆè¦æ³¨å†Œ MR&lt;/h2>
&lt;p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ MR æ˜¯å¦‚ä½•è§£å†³æœ¬æ–‡å¼€ç¯‡æå‡ºçš„ä¸¤ä¸ªé—®é¢˜çš„ï¼š&lt;/p>
&lt;h3 id="1-æ³¨å†Œ-mr-ä»¥å®ç°è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€è½¬æ¢">1. æ³¨å†Œ MR ä»¥å®ç°è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€è½¬æ¢&lt;/h3>
&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“ APP åªèƒ½çœ‹åˆ°è™šæ‹Ÿåœ°å€ï¼Œè€Œä¸”ä¼šåœ¨ WQE ä¸­ç›´æ¥æŠŠ VA ä¼ é€’ç»™ HCAï¼ˆæ—¢åŒ…æ‹¬æœ¬ç«¯çš„æº VAï¼Œä¹ŸåŒ…æ‹¬å¯¹ç«¯çš„ç›®çš„ VAï¼‰ã€‚ç°åœ¨çš„ CPU éƒ½æœ‰ MMU å’Œé¡µè¡¨è¿™ä¸€â€œåˆ©å™¨â€æ¥è¿›è¡Œ VA å’Œ PA ä¹‹é—´çš„è½¬æ¢ï¼Œè€Œ HCA è¦ä¹ˆç›´æ¥è¿æ¥åˆ°æ€»çº¿ä¸Šï¼Œè¦ä¹ˆé€šè¿‡ IOMMU/SMMU åšåœ°å€è½¬æ¢åè¿æ¥åˆ°æ€»çº¿ä¸Šï¼Œå®ƒæ˜¯â€œçœ‹ä¸æ‡‚â€APP æä¾›çš„ VA æ‰€å¯¹åº”çš„çœŸå®ç‰©ç†å†…å­˜åœ°å€çš„ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æ³¨å†Œ MR çš„è¿‡ç¨‹ä¸­ï¼Œç¡¬ä»¶ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºå¹¶å¡«å†™ä¸€ä¸ª VA to PA çš„æ˜ å°„è¡¨ï¼Œè¿™æ ·éœ€è¦çš„æ—¶å€™å°±èƒ½é€šè¿‡æŸ¥è¡¨æŠŠ VA è½¬æ¢æˆ PA äº†ã€‚æˆ‘ä»¬è¿˜æ˜¯æä¾›ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è®²ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/6_3-2024-04-04.webp"
alt="6_3-2024-04-04" width="auto" loading="lazy">
&lt;/figure>
&lt;p>ç°åœ¨å‡è®¾å·¦è¾¹çš„èŠ‚ç‚¹å‘å³è¾¹çš„èŠ‚ç‚¹å‘èµ·äº† RDMA WRITE æ“ä½œï¼Œå³ç›´æ¥å‘å³èŠ‚ç‚¹çš„å†…å­˜åŒºåŸŸä¸­å†™å…¥æ•°æ®ã€‚å‡è®¾å›¾ä¸­ä¸¤ç«¯éƒ½å·²ç»å®Œæˆäº†æ³¨å†Œ MR çš„åŠ¨ä½œï¼ŒMR å³å¯¹åº”å›¾ä¸­çš„â€œæ•°æ® Bufferâ€ï¼ŒåŒæ—¶ä¹Ÿåˆ›å»ºå¥½äº† VA-&amp;gt;PA çš„æ˜ å°„è¡¨ã€‚&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆæœ¬ç«¯ APP ä¼šä¸‹å‘ä¸€ä¸ª WQE ç»™ HCAï¼Œå‘ŠçŸ¥ HCAï¼Œç”¨äºå­˜æ”¾å¾…å‘é€æ•°æ®çš„æœ¬åœ° Buffer çš„è™šæ‹Ÿåœ°å€ï¼Œä»¥åŠå³å°†å†™å…¥çš„å¯¹ç«¯æ•°æ® Buffer çš„è™šæ‹Ÿåœ°å€ã€‚&lt;/li>
&lt;li>æœ¬ç«¯ HCA æŸ¥è¯¢ VA-&amp;gt;PA æ˜ å°„è¡¨ï¼Œå¾—çŸ¥å¾…å‘æ•°æ®çš„ç‰©ç†åœ°å€ï¼Œç„¶åä»å†…å­˜ä¸­æ‹¿åˆ°æ•°æ®ï¼Œç»„è£…æ•°æ®åŒ…å¹¶å‘é€å‡ºå»ã€‚&lt;/li>
&lt;li>å¯¹ç«¯ HCA æ”¶åˆ°äº†æ•°æ®åŒ…ï¼Œä»ä¸­è§£æå‡ºäº†ç›®çš„ VAã€‚&lt;/li>
&lt;li>å¯¹ç«¯ HCA é€šè¿‡å­˜å‚¨åœ¨æœ¬åœ°å†…å­˜ä¸­çš„ VA-&amp;gt;PA æ˜ å°„è¡¨ï¼ŒæŸ¥åˆ°çœŸå®çš„ç‰©ç†åœ°å€ï¼Œæ ¸å¯¹æƒé™æ— è¯¯åï¼Œå°†æ•°æ®å­˜æ”¾åˆ°å†…å­˜ä¸­ã€‚&lt;/li>
&lt;/ul>
&lt;p>å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œå¯¹äºå³ä¾§èŠ‚ç‚¹æ¥è¯´ï¼Œ&lt;strong>æ— è®ºæ˜¯åœ°å€è½¬æ¢è¿˜æ˜¯å†™å…¥å†…å­˜ï¼Œå®Œå…¨ä¸ç”¨å…¶ CPU çš„å‚ä¸&lt;/strong>ã€‚&lt;/p>
&lt;h3 id="2-mr-å¯ä»¥æ§åˆ¶-hca-è®¿é—®å†…å­˜çš„æƒé™">2. MR å¯ä»¥æ§åˆ¶ HCA è®¿é—®å†…å­˜çš„æƒé™&lt;/h3>
&lt;p>å› ä¸º HCA è®¿é—®çš„å†…å­˜åœ°å€æ¥è‡ªäºç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·ä¼ å…¥äº†ä¸€ä¸ªéæ³•çš„åœ°å€ï¼ˆæ¯”å¦‚ç³»ç»Ÿå†…å­˜æˆ–è€…å…¶ä»–è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ï¼‰ï¼ŒHCA å¯¹å…¶è¿›è¡Œè¯»å†™å¯èƒ½é€ æˆä¿¡æ¯æ³„éœ²æˆ–è€…å†…å­˜è¦†ç›–ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶æ¥ç¡®ä¿ HCA åªèƒ½è®¿é—®å·²è¢«æˆæƒçš„ã€å®‰å…¨çš„å†…å­˜åœ°å€ã€‚IB åè®®ä¸­ï¼ŒAPP åœ¨ä¸ºæ•°æ®äº¤äº’åšå‡†å¤‡çš„é˜¶æ®µï¼Œéœ€è¦æ‰§è¡Œæ³¨å†Œ MR çš„åŠ¨ä½œã€‚&lt;/p>
&lt;p>è€Œç”¨æˆ·æ³¨å†Œ MR çš„åŠ¨ä½œä¼šäº§ç”Ÿä¸¤æŠŠé’¥åŒ™â€”â€”L_KEYï¼ˆLocal Keyï¼‰å’Œ R_KEYï¼ˆRemote Keyï¼‰ï¼Œè¯´æ˜¯é’¥åŒ™ï¼Œå®ƒä»¬çš„å®ä½“å…¶å®å°±æ˜¯ä¸€ä¸²åºåˆ—è€Œå·²ã€‚å®ƒä»¬å°†åˆ†åˆ«ç”¨äºä¿éšœå¯¹äºæœ¬ç«¯å’Œè¿œç«¯å†…å­˜åŒºåŸŸçš„è®¿é—®æƒé™ã€‚ä¸‹é¢ä¸¤å¼ å›¾åˆ†åˆ«æ˜¯æè¿° L_Key å’Œ R_Key çš„ä½œç”¨çš„ç¤ºæ„å›¾ï¼š&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/6_4-2024-04-04.webp"
alt="6_4-2024-04-04" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>L_Key&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/6_5-2024-04-04.webp"
alt="6_5-2024-04-04" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>R_Key&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>è¿™é‡Œå¤§å®¶å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œæœ¬ç«¯æ˜¯å¦‚ä½•çŸ¥é“å¯¹ç«¯èŠ‚ç‚¹çš„å¯ç”¨ VA å’Œå¯¹åº”çš„ R_Key çš„ï¼Ÿå…¶å®ä¸¤ç«¯çš„èŠ‚ç‚¹åœ¨çœŸæ­£çš„ RDMA é€šä¿¡ä¹‹å‰ï¼Œéƒ½ä¼šé€šè¿‡æŸäº›æ–¹å¼å…ˆå»ºç«‹ä¸€æ¡é“¾è·¯ï¼ˆå¯èƒ½æ˜¯ Socket è¿æ¥ï¼Œä¹Ÿå¯èƒ½æ˜¯ CM è¿æ¥ï¼‰å¹¶é€šè¿‡è¿™æ¡é“¾è·¯äº¤æ¢ä¸€äº› RDMA é€šä¿¡æ‰€å¿…é¡»çš„ä¿¡æ¯ï¼ˆVAï¼ŒKeyï¼ŒQPN ç­‰ï¼‰ï¼Œæˆ‘ä»¬ç§°è¿™ä¸€è¿‡ç¨‹å«åšâ€œå»ºé“¾â€å’Œâ€œæ¡æ‰‹â€ã€‚æˆ‘å°†åœ¨åé¢çš„æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»ã€‚&lt;/p>
&lt;p>é™¤äº†ä¸Šé¢ä¸¤ä¸ªç‚¹ä¹‹å¤–ï¼Œæ³¨å†Œ MR è¿˜æœ‰ä¸ªé‡è¦çš„ä½œç”¨ï¼š&lt;/p>
&lt;h3 id="3-mr-å¯ä»¥é¿å…æ¢é¡µ">3. MR å¯ä»¥é¿å…æ¢é¡µ&lt;/h3>
&lt;p>å› ä¸ºç‰©ç†å†…å­˜æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿé€šè¿‡æ¢é¡µæœºåˆ¶æ¥æš‚æ—¶æŠŠæŸä¸ªè¿›ç¨‹ä¸ç”¨çš„å†…å­˜å†…å®¹ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ã€‚å½“è¯¥è¿›ç¨‹éœ€è¦ä½¿ç”¨æ—¶ï¼Œå†é€šè¿‡ç¼ºé¡µä¸­æ–­æŠŠç¡¬ç›˜ä¸­çš„å†…å®¹æ¬ç§»å›å†…å­˜ï¼Œè¿™ä¸€è¿‡ç¨‹å‡ ä¹å¿…ç„¶å¯¼è‡´ VA-PA çš„æ˜ å°„å…³ç³»å‘ç”Ÿæ”¹å˜ã€‚&lt;/p>
&lt;p>ç”±äº HCA ç»å¸¸ä¼šç»•è¿‡ CPU å¯¹ç”¨æˆ·æä¾›çš„ VA æ‰€æŒ‡å‘çš„ç‰©ç†å†…å­˜åŒºåŸŸè¿›è¡Œè¯»å†™ï¼Œå¦‚æœå‰åçš„ VA-PA æ˜ å°„å…³ç³»å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å‰æ–‡æåˆ°çš„ VA-&amp;gt;PA æ˜ å°„è¡¨å°†å¤±å»æ„ä¹‰ï¼ŒHCA å°†æ— æ³•æ‰¾åˆ°æ­£ç¡®çš„ç‰©ç†åœ°å€ã€‚&lt;/p>
&lt;p>ä¸ºäº†é˜²æ­¢æ¢é¡µæ‰€å¯¼è‡´çš„ VA-PA æ˜ å°„å…³ç³»å‘ç”Ÿæ”¹å˜ï¼Œæ³¨å†Œ MR æ—¶ä¼š &amp;ldquo;Pin&amp;rdquo; ä½è¿™å—å†…å­˜ï¼ˆäº¦ç§°â€œé”é¡µâ€ï¼‰ï¼Œå³é”å®š VA-PA çš„æ˜ å°„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒMR è¿™å—å†…å­˜åŒºåŸŸä¼šé•¿æœŸå­˜åœ¨äºç‰©ç†å†…å­˜ä¸­ä¸è¢«æ¢é¡µï¼Œç›´åˆ°å®Œæˆé€šä¿¡ä¹‹åï¼Œç”¨æˆ·ä¸»åŠ¨æ³¨é”€è¿™ç‰‡ MRã€‚&lt;/p>
&lt;p>å¥½äº†ï¼Œè‡³æ­¤æˆ‘ä»¬ä»‹ç»å®Œäº† MR çš„æ¦‚å¿µå’Œä½œç”¨ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘å°†ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ PDï¼ˆProtection Domainï¼Œä¿æŠ¤åŸŸï¼‰çš„æ¦‚å¿µã€‚&lt;/p>
&lt;h2 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹&lt;/h2>
&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ RDMA ç¨‹åºï¼Œå±•ç¤ºäº†å¦‚ä½•æ³¨å†Œ MRï¼š&lt;/p>
&lt;pre>&lt;code class="language-c">#include &amp;lt;infiniband/verbs.h&amp;gt;
int main() {
// çœç•¥åˆå§‹åŒ–è¿‡ç¨‹...
struct ibv_mr *mr;
mr = ibv_reg_mr(pd, buf, 1024, IBV_ACCESS_LOCAL_WRITE |
IBV_ACCESS_REMOTE_WRITE);
// è·å– L_Key å’Œ R_Key
uint32_t lkey = mr-&amp;gt;lkey;
uint32_t rkey = mr-&amp;gt;rkey;
// çœç•¥å…¶å®ƒä»£ç ...
}
&lt;/code>&lt;/pre></description></item><item><title>è®°å½•ï¼šå®‰è£… IntelÂ® OneAPI-2024.0</title><link>https://cuterwrite.top/p/intel-oneapi/</link><pubDate>Fri, 08 Mar 2024 14:39:00 +0000</pubDate><guid>https://cuterwrite.top/p/intel-oneapi/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/crop_62cf8bae89f60c3522eb45af53a53f4b195413-2024-03-09.webp" alt="Featured image of post è®°å½•ï¼šå®‰è£… IntelÂ® OneAPI-2024.0" />&lt;h1 id="è®°å½•å®‰è£…-intel-oneapi-20240">è®°å½•ï¼šå®‰è£… IntelÂ® OneAPI-2024.0&lt;/h1>
&lt;p>Intel one API ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå‰è€…ä¸ºåŸºç¡€ Base Toolkit ï¼Œåè€…å¿…é¡»ä¾èµ–å‰è€…ï¼ŒIntel one API HPC Toolkitï¼Œä¹Ÿå°±æ˜¯è¦å‰åä¾æ¬¡å®‰è£…ã€‚&lt;/p>
&lt;h2 id="base-toolkit">Base Toolkit&lt;/h2>
&lt;p>Base Toolkit æ˜¯ Intel çš„ä¸€ä¸ª API åŸºç¡€å·¥å…·åŒ…åŒ…æ‹¬ä»¥ä¸‹åº“å’Œå…¶ä»–åº“&lt;/p>
&lt;pre>&lt;code class="language-text">IntelÂ® oneAPI DPC++/C++ Compiler
IntelÂ® DPC++ Compatibility Tool
IntelÂ® oneAPI DPC++ Library
IntelÂ® oneAPI Math Kernel Library
IntelÂ® oneAPI Threading Building Blocks
IntelÂ® oneAPI Collective Communications Library
IntelÂ® oneAPI Data Analytics Library
IntelÂ® oneAPI Deep Neural Networks Library
IntelÂ® Integrated Performance Primitives
IntelÂ® VTuneâ„¢ Profiler
IntelÂ® Advisor
IntelÂ® Distribution for GDB*
IntelÂ® Distribution for Python* (separate download required)
IntelÂ® FPGA Add-on for oneAPI Base Toolkit (separate download required)
&lt;/code>&lt;/pre>
&lt;h3 id="base-toolkit-å®‰è£…">Base Toolkit å®‰è£…&lt;/h3>
&lt;ol>
&lt;li>ä¸‹è½½å®‰è£…åŒ…&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">$ wget https://registrationcenter-download.intel.com/akdlm/IRC_NAS/163da6e4-56eb-4948-aba3-debcec61c064/l_BaseKit_p_2024.0.1.46_offline.sh
&lt;/code>&lt;/pre>
&lt;ol start="2">
&lt;li>å®‰è£…&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">$ chmod +x l_BaseKit_p_2024.0.1.46_offline.sh
$ sudo ./l_BaseKit_p_2024.0.1.46_offline.sh
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>å¦‚æœè‡ªå®šä¹‰å®‰è£…åœ¨ç”¨æˆ·ç›®å½•ï¼Œå°±ä¸éœ€è¦ root æƒé™&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>./l_BaseKit_p_2024.0.1.46_offline.sh
&lt;/code>&lt;/pre>
&lt;p>ç„¶åå°†å¯åŠ¨ä¸€ä¸ªå›¾å½¢å®‰è£…ç•Œé¢ï¼Œç»§ç»­æ“ä½œï¼š&lt;/p>
&lt;p>&lt;strong>ï¼ˆ1ï¼‰é€‰æ‹© Accept &amp;amp; customize&lt;/strong>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/OneAPI-Accepet-2024-03-09.png"
alt="OneAPI-Accepet-2024-03-09" width="auto" loading="lazy">
&lt;/figure>
&lt;/p>
&lt;p>&lt;strong>ï¼ˆ2ï¼‰é€‰æ‹©å®‰è£…çš„ç»„ä»¶&lt;/strong>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/OneAPI-Select-2-2024-03-09.png"
alt="OneAPI-Select-2-2024-03-09" width="auto" loading="lazy">
&lt;/figure>
&lt;/p>
&lt;p>&lt;strong>ï¼ˆ3ï¼‰é€‰æ‹©å®‰è£…çš„è·¯å¾„&lt;/strong>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/OneAPI-Select-3-2024-03-09.png"
alt="OneAPI-Select-3-2024-03-09" width="auto" loading="lazy">
&lt;/figure>
&lt;/p>
&lt;p>&lt;strong>ï¼ˆ4ï¼‰é€‰æ‹© Next&lt;/strong>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/OneAPI-Select-4-2024-03-09.png"
alt="OneAPI-Select-4-2024-03-09" width="auto" loading="lazy">
&lt;/figure>
&lt;/p>
&lt;p>&lt;strong>ï¼ˆ5ï¼‰é€‰æ‹© 2 ç„¶åå¼€å§‹å®‰è£…&lt;/strong>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/OneAPI-Select-5-2024-03-09.png"
alt="OneAPI-Select-5-2024-03-09" width="auto" loading="lazy">
&lt;/figure>
&lt;/p>
&lt;p>æ¥ä¸‹æ¥ç­‰å¾…å®‰è£…å®Œæˆå³å¯ã€‚&lt;/p>
&lt;h2 id="hpc-toolkit">HPC Toolkit&lt;/h2>
&lt;p>è¿è¡ŒåŸºäº Base Toolkit ï¼Œè¿™ä¸ªå¿…é¡»ä½œä¸ºåè€…å®‰è£…&lt;/p>
&lt;pre>&lt;code class="language-text">IntelÂ® Fortran Compiler
IntelÂ® Fortran Compiler Classic
IntelÂ® Inspector
IntelÂ® MPI Library
IntelÂ® Trace Analyzer and Collector
&lt;/code>&lt;/pre>
&lt;h3 id="hpc-toolkit-å®‰è£…">HPC Toolkit å®‰è£…&lt;/h3>
&lt;ol>
&lt;li>ä¸‹è½½å®‰è£…åŒ…&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">$ wget https://registrationcenter-download.intel.com/akdlm/IRC_NAS/67c08c98-f311-4068-8b85-15d79c4f277a/l_HPCKit_p_2024.0.1.38_offline.sh
&lt;/code>&lt;/pre>
&lt;ol start="2">
&lt;li>å®‰è£…&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">$ chmod +x l_HPCKit_p_2024.0.1.38_offline.sh
$ sudo ./l_HPCKit_p_2024.0.1.38_offline.sh
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>å¦‚æœè‡ªå®šä¹‰å®‰è£…åœ¨ç”¨æˆ·ç›®å½•ï¼Œå°±ä¸éœ€è¦ root æƒé™&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>./l_HPCKit_p_2024.0.1.38_offline.sh
&lt;/code>&lt;/pre>
&lt;p>å¿…é¡»å®‰è£…çš„åº“æ–‡ä»¶ï¼š IntelÂ® MPI Library IntelÂ® Fortran Compiler (Beta) &amp;amp; IntelÂ® Fortran Compiler Classic IntelÂ® oneAPI DPC++/C++ Compiler &amp;amp; IntelÂ® C++ Compiler Classic&lt;/p>
&lt;p>å®‰è£…è¿‡ç¨‹ä¸ Base Toolkit ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®&lt;/h2>
&lt;p>å®‰è£…å®Œæˆåï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ IntelÂ® oneAPI å·¥å…·ã€‚&lt;/p>
&lt;p>åœ¨ HPC ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ &lt;code>modulefile&lt;/code> æ¥ç®¡ç†ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>module&lt;/code> å‘½ä»¤æ¥åŠ è½½ç¯å¢ƒå˜é‡ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯å‚è€ƒçš„ &lt;code>modulefile&lt;/code> æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å®‰è£…è·¯å¾„è¿›è¡Œä¿®æ”¹ã€‚&lt;/p>
&lt;pre>&lt;code class="language-modulefile">#%Module1.0#####################################################################
##
## modules modulefile
##
proc ModulesHelp { } {
global version prefix
puts stderr &amp;quot;\tmodules - loads the modules software &amp;amp; application environment&amp;quot;
puts stderr &amp;quot;\n\tThis adds $prefix/* to several of the&amp;quot;
puts stderr &amp;quot;\tenvironment variables.&amp;quot;
puts stderr &amp;quot;\n\tVersion $version\n&amp;quot;
}
module-whatis &amp;quot;loads intel/oneapi2024.0&amp;quot;
# for Tcl script use only
set version oneapi2024.0
set prefix /opt/software/intel/oneapi2024.0
conflict intel
prepend-path TBBROOT ${prefix}/tbb/2021.11/env/..
prepend-path DAALROOT ${prefix}/cdal/2024.0
prepend-path DPCT_BUNDLE_ROOT ${prefix}/dpcpp-ct/2024.0
prepend-path INSPECTOR_2023_DIR ${prefix}/inspector/2024.0
prepend-path ONEAPI_ROOT ${prefix}
prepend-path PKG_CONFIG_PATH ${prefix}/vtune/2024.0/include/pkgconfig/lib64:${prefix}/tbb/2021.11/env/../lib/pkgconfig:${prefix}/mpi/2021.11/lib/pkgconfig:${prefix}/mkl/2024.0/lib/pkgconfig:${prefix}/ippcp/2021.9/lib/pkgconfig:${prefix}/inspector/2024.0/include/pkgconfig/lib64:${prefix}/dpl/2022.3/lib/pkgconfig:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/../lib/pkgconfig:${prefix}/cdal/2024.0/lib/pkgconfig:${prefix}/compiler/2024.0/lib/pkgconfig:${prefix}/ccl/2021.11/lib/pkgconfig:${prefix}/advisor/2024.0/include/pkgconfig/lib64:
#prepend-path PKG_CONFIG_PATH ${prefix}/vtune/2024.0/include/pkgconfig/lib64:${prefix}/tbb/2021.11/env/../lib/pkgconfig:${prefix}/mkl/2024.0/lib/pkgconfig:${prefix}/ippcp/2021.9/lib/pkgconfig:${prefix}/inspector/2024.0/include/pkgconfig/lib64:${prefix}/dpl/2022.3/lib/pkgconfig:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/../lib/pkgconfig:${prefix}/cdal/2024.0/lib/pkgconfig:${prefix}/compiler/2024.0/lib/pkgconfig:${prefix}/ccl/2021.11/lib/pkgconfig:${prefix}/advisor/2024.0/include/pkgconfig/lib64:
prepend-path VT_MPI impi4
prepend-path ACL_BOARD_VENDOR_PATH /opt/Intel/OpenCLFPGA/oneAPI/Boards
prepend-path FPGA_VARS_DIR ${prefix}/compiler/2024.0/lib/oclfpga
prepend-path CCL_ROOT ${prefix}/ccl/2021.11
prepend-path VT_ADD_LIBS &amp;quot;-ldwarf -lelf -lvtunwind -lm -lpthread&amp;quot;
prepend-path I_MPI_ROOT ${prefix}/mpi/2021.11
prepend-path FI_PROVIDER_PATH ${prefix}/mpi/2021.11//libfabric/lib/prov:/usr/lib/x86_64-linux-gnu/libfabric
prepend-path DNNLROOT ${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp
prepend-path DIAGUTIL_PATH ${prefix}/vtune/2024.0/sys_check/vtune_sys_check.py:${prefix}/dpcpp-ct/2024.0/sys_check/sys_check.sh:${prefix}/debugger/2024.0/sys_check/debugger_sys_check.py:${prefix}/compiler/2024.0/sys_check/sys_check.sh:${prefix}/advisor/2024.0/sys_check/advisor_sys_check.py:
prepend-path CCL_CONFIGURATION cpu_gpu_dpcpp
prepend-path DPL_ROOT ${prefix}/dpl/2022.3
prepend-path MANPATH ${prefix}/mpi/2021.11/man:${prefix}/itac/2022.0/man:${prefix}/debugger/2024.0/documentation/man:${prefix}/compiler/2024.0/documentation/en/man/common:::
#prepend-path MANPATH ${prefix}/itac/2022.0/man:${prefix}/debugger/2024.0/documentation/man:${prefix}/compiler/2024.0/documentation/en/man/common:::
prepend-path GDB_INFO ${prefix}/debugger/2024.0/documentation/info/
prepend-path SETVARS_COMPLETED 1
prepend-path APM ${prefix}/advisor/2024.0/perfmodels
prepend-path CMAKE_PREFIX_PATH ${prefix}/tbb/2021.11/env/..:${prefix}/ipp/2021.10/lib/cmake/ipp:${prefix}/ipp/2021.10/lib/cmake/ipp:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/../lib/cmake:${prefix}/cdal/2024.0:${prefix}/compiler/2024.0/IntelDPCPP:${prefix}/ccl/2021.11/lib/cmake/oneCCL
prepend-path VTUNE_PROFILER_2023_DIR ${prefix}/vtune/2024.0
prepend-path CMPLR_ROOT ${prefix}/compiler/2024.0
prepend-path ADVISOR_2023_DIR ${prefix}/advisor/2024.0
prepend-path FPGA_VARS_ARGS &amp;quot;&amp;quot;
prepend-path INFOPATH ${prefix}/debugger/2024.0/gdb/intel64/lib
prepend-path IPPROOT ${prefix}/ipp/2021.10
prepend-path IPP_TARGET_ARCH intel64
prepend-path PYTHONPATH ${prefix}/advisor/2024.0/pythonapi
prepend-path VT_ROOT ${prefix}/itac/2022.0
prepend-path DALROOT ${prefix}/cdal/2024.0
prepend-path LIBRARY_PATH ${prefix}/tbb/2021.11/env/../lib/intel64/gcc4.8:${prefix}/mpi/2021.11//libfabric/lib:${prefix}/mpi/2021.11//lib/release:${prefix}/mpi/2021.11//lib:${prefix}/mkl/2024.0/lib/intel64:${prefix}/ipp/2021.10/lib/intel64:${prefix}/ippcp/2021.9/lib/intel64:${prefix}/ipp/2021.10/lib/intel64:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/lib:${prefix}/cdal/2024.0/lib/intel64:${prefix}/compiler/2024.0/compiler/lib/intel64_lin:${prefix}/compiler/2024.0/lib:${prefix}/ccl/2021.11/lib/cpu_gpu_dpcpp
#prepend-path LIBRARY_PATH ${prefix}/tbb/2021.11/env/../lib/intel64/gcc4.8:${prefix}/mkl/2024.0/lib/intel64:${prefix}/ipp/2021.10/lib/intel64:${prefix}/ippcp/2021.9/lib/intel64:${prefix}/ipp/2021.10/lib/intel64:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/lib:${prefix}/cdal/2024.0/lib/intel64:${prefix}/compiler/2024.0/compiler/lib/intel64_lin:${prefix}/compiler/2024.0/lib:${prefix}/ccl/2021.11/lib/cpu_gpu_dpcpp
prepend-path DAL_MAJOR_BINARY 1
prepend-path IPPCRYPTOROOT ${prefix}/ippcp/2021.9
prepend-path IPPCP_TARGET_ARCH intel64
prepend-path OCL_ICD_FILENAMES libintelocl_emu.so:libalteracl.so:${prefix}/compiler/2024.0/lib/x64/libintelocl.so
prepend-path CLASSPATH ${prefix}/mpi/2021.11//lib/mpi.jar:${prefix}/cdal/2024.0/lib/onedal.jar
#prepend-path CLASSPATH ${prefix}/cdal/2024.0/lib/onedal.jar
prepend-path INTELFPGAOCLSDKROOT ${prefix}/compiler/2024.0/lib/oclfpga
prepend-path LD_LIBRARY_PATH ${prefix}/tbb/2021.11/env/../lib/intel64/gcc4.8:${prefix}/mpi/2021.11//libfabric/lib:${prefix}/mpi/2021.11//lib/release:${prefix}/mpi/2021.11//lib:${prefix}/mkl/2024.0/lib/intel64:${prefix}/itac/2022.0/slib:${prefix}/ipp/2021.10/lib/intel64:${prefix}/ippcp/2021.9/lib/intel64:${prefix}/ipp/2021.10/lib/intel64:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/lib:${prefix}/debugger/2024.0/gdb/intel64/lib:${prefix}/debugger/2024.0/libipt/intel64/lib:${prefix}/debugger/2024.0/dep/lib:${prefix}/cdal/2024.0/lib/intel64:${prefix}/compiler/2024.0/lib:${prefix}/compiler/2024.0/lib/x64:${prefix}/compiler/2024.0/lib/oclfpga/host/linux64/lib:${prefix}/compiler/2024.0/compiler/lib/intel64_lin:${prefix}/ccl/2021.11/lib/cpu_gpu_dpcpp:${prefix}/compiler/2024.0/compiler/lib/intel64_lin:${prefix}/ccl/2021.11/lib/cpu_gpu_dpcpp
#prepend-path LD_LIBRARY_PATH ${prefix}/tbb/2021.11/env/../lib/intel64/gcc4.8:${prefix}/mkl/2024.0/lib/intel64:${prefix}/itac/2022.0/slib:${prefix}/ipp/2021.10/lib/intel64:${prefix}/ippcp/2021.9/lib/intel64:${prefix}/ipp/2021.10/lib/intel64:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/lib:${prefix}/debugger/2024.0/gdb/intel64/lib:${prefix}/debugger/2024.0/libipt/intel64/lib:${prefix}/debugger/2024.0/dep/lib:${prefix}/cdal/2024.0/lib/intel64:${prefix}/compiler/2024.0/lib:${prefix}/compiler/2024.0/lib/x64:${prefix}/compiler/2024.0/lib/oclfpga/host/linux64/lib:${prefix}/compiler/2024.0/compiler/lib/intel64_lin:${prefix}/ccl/2021.11/lib/cpu_gpu_dpcpp:${prefix}/compiler/2024.0/compiler/lib/intel64_lin:${prefix}/ccl/2021.11/lib/cpu_gpu_dpcpp
prepend-path VT_LIB_DIR ${prefix}/itac/2022.0/lib
prepend-path VTUNE_PROFILER_DIR ${prefix}/vtune/2024.0
prepend-path VT_SLIB_DIR ${prefix}/itac/2022.0/slib
prepend-path MKLROOT ${prefix}/mkl/2024.0
prepend-path DAL_MINOR_BINARY 1
prepend-path NLSPATH ${prefix}/mkl/2024.0/lib/intel64/locale/%l_%t/%N:${prefix}/compiler/2024.0/compiler/lib/intel64_lin/locale/%l_%t/%N
prepend-path PATH ${prefix}/vtune/2024.0/bin64:${prefix}/mpi/2021.11//libfabric/bin:${prefix}/mpi/2021.11//bin:${prefix}/mkl/2024.0/bin/intel64:${prefix}/itac/2022.0/bin:${prefix}/inspector/2024.0/bin64:${prefix}/dpcpp-ct/2024.0/bin:${prefix}/dev-utilities/2024.0/bin:${prefix}/debugger/2024.0/gdb/intel64/bin:${prefix}/compiler/2024.0/lib/oclfpga/bin:${prefix}/compiler/2024.0/bin/intel64:${prefix}/compiler/2024.0/bin:${prefix}/advisor/2024.0/bin64
#prepend-path PATH ${prefix}/vtune/2024.0/bin64:${prefix}/mkl/2024.0/bin/intel64:${prefix}/itac/2022.0/bin:${prefix}/inspector/2024.0/bin64:${prefix}/dpcpp-ct/2024.0/bin:${prefix}/dev-utilities/2024.0/bin:${prefix}/debugger/2024.0/gdb/intel64/bin:${prefix}/compiler/2024.0/lib/oclfpga/bin:${prefix}/compiler/2024.0/bin/intel64:${prefix}/compiler/2024.0/bin:${prefix}/advisor/2024.0/bin64
prepend-path INTEL_PYTHONHOME ${prefix}/debugger/2024.0/dep
prepend-path INTEL_LICENSE_FILE /opt/intel/licenses:/root/intel/licenses
prepend-path CPATH ${prefix}/tbb/2021.11/env/../include:${prefix}/mpi/2021.11//include:${prefix}/mkl/2024.0/include:${prefix}/ipp/2021.10/include:${prefix}/ippcp/2021.9/include:${prefix}/ipp/2021.10/include:${prefix}/dpl/2022.3/linux/include:${prefix}/dpcpp-ct/2024.0/include:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/include:${prefix}/dev-utilities/2024.0/include:${prefix}/cdal/2024.0/include:${prefix}/compiler/2024.0/lib/oclfpga/include:${prefix}/ccl/2021.11/include/cpu_gpu_dpcpp
#prepend-path CPATH ${prefix}/tbb/2021.11/env/../include:${prefix}/mkl/2024.0/include:${prefix}/ipp/2021.10/include:${prefix}/ippcp/2021.9/include:${prefix}/ipp/2021.10/include:${prefix}/dpl/2022.3/linux/include:${prefix}/dpcpp-ct/2024.0/include:${prefix}/dnnl/2024.0/cpu_dpcpp_gpu_dpcpp/include:${prefix}/dev-utilities/2024.0/include:${prefix}/cdal/2024.0/include:${prefix}/compiler/2024.0/lib/oclfpga/include:${prefix}/ccl/2021.11/include/cpu_gpu_dpcpp
&lt;/code>&lt;/pre>
&lt;h2 id="è¿è¡Œæµ‹è¯•">è¿è¡Œæµ‹è¯•&lt;/h2>
&lt;p>é€šè¿‡ &lt;code>module load&lt;/code> å‘½ä»¤åŠ è½½ç¯å¢ƒå˜é‡&lt;/p>
&lt;pre>&lt;code class="language-bash">$ module load intel/oneapi2024.0
&lt;/code>&lt;/pre>
&lt;p>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ&lt;/p>
&lt;pre>&lt;code class="language-bash">$ icx -v
&lt;/code>&lt;/pre>
&lt;p>å¦‚æœè¾“å‡ºç‰ˆæœ¬ä¿¡æ¯ï¼Œåˆ™å®‰è£…æˆåŠŸã€‚&lt;/p>
&lt;pre>&lt;code class="language-bash">Intel(R) oneAPI DPC++/C++ Compiler 2024.0.2 (2024.0.2.20231213)
Target: x86_64-unknown-linux-gnu
Thread model: posix
InstalledDir: /opt/software/intel/oneapi2024.0/compiler/2024.0/bin/compiler
Configuration file: /opt/software/intel/oneapi2024.0/compiler/2024.0/bin/compiler/../icx.cfg
Found candidate GCC installation: /opt/rh/devtoolset-11/root/usr/lib/gcc/x86_64-redhat-linux/11
Selected GCC installation: /opt/rh/devtoolset-11/root/usr/lib/gcc/x86_64-redhat-linux/11
Candidate multilib: .;@m64
Candidate multilib: 32;@m32
Selected multilib: .;@m64
&lt;/code>&lt;/pre>
&lt;p>ç»§ç»­æµ‹è¯• MPI&lt;/p>
&lt;pre>&lt;code class="language-bash">$ mpirun --version
&lt;/code>&lt;/pre>
&lt;p>å¦‚æœè¾“å‡ºç‰ˆæœ¬ä¿¡æ¯ï¼Œåˆ™å®‰è£…æˆåŠŸã€‚&lt;/p>
&lt;pre>&lt;code class="language-bash">Intel(R) MPI Library for Linux* OS, Version 2021.11 Build 20231005 (id: 74c4a23)
Copyright 2003-2023, Intel Corporation.
&lt;/code>&lt;/pre>
&lt;h2 id="icx-è¯´æ˜">icx è¯´æ˜&lt;/h2>
&lt;blockquote>
&lt;p>&lt;strong>IntelÂ® oneAPI DPC++/C++ Compiler (icx)&lt;/strong> is Intel nextgen compiler based on Clang /LLVM technology plus Intel proprietary optimizations and code generation.&lt;/p>&lt;span class="cite">&lt;span>â€• &lt;/span>&lt;span>IntelÂ®, &lt;/span>&lt;a href="https://www.intel.cn/content/www/cn/zh/developer/articles/technical/adoption-of-llvm-complete-icx.html">&lt;cite>IntelÂ® C/C&amp;#43;&amp;#43; Compilers Complete Adoption of LLVM&lt;/cite>&lt;/a>&lt;/span>&lt;/blockquote>
&lt;p>icx æ˜¯åŸºäº Clang /LLVM æŠ€æœ¯çš„ Intel ä¸‹ä¸€ä»£ç¼–è¯‘å™¨ï¼ŒåŠ ä¸Š Intel ä¸“æœ‰çš„ä¼˜åŒ–å’Œä»£ç ç”Ÿæˆã€‚&lt;/p>
&lt;p>LLVM å¸®åŠ©å®ç°äº†ä¸ºè‹±ç‰¹å°”æ¶æ„æä¾›æ›´åŠ ä¼˜ç§€çš„ C/C++ç¼–è¯‘å™¨è¿™ä¸€ç›®æ ‡ã€‚æœ€æ–°çš„è‹±ç‰¹å°” C/C++ç¼–è¯‘å™¨ä½¿ç”¨ LLVM æ¶æ„ï¼Œå¯æä¾›æ›´å¿«çš„ç¼–è¯‘æ—¶é—´ã€æ›´å¥½çš„ä¼˜åŒ–ã€å¢å¼ºçš„æ ‡å‡†æ”¯æŒä»¥åŠå¯¹ GPU å’Œ FPGA è´Ÿè½½è½¬ç§»ï¼ˆoffloadingï¼‰çš„æ”¯æŒã€‚&lt;/p>
&lt;h3 id="é‡‡ç”¨-llvm-çš„å¥½å¤„">é‡‡ç”¨ LLVM çš„å¥½å¤„&lt;/h3>
&lt;p>LLVM å¼€æºé¡¹ç›®æ˜¯æ¨¡å—åŒ–å’Œå¯é‡ç”¨çš„ç¼–è¯‘å™¨å’Œä¸€ç³»åˆ—å·¥å…·é“¾æŠ€æœ¯çš„é›†åˆï¼Œæ•´ä¸ªé¡¹ç›®æ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„å’Œç¼–ç¨‹è¯­è¨€ã€‚Clang å¼€æºé¡¹ç›®æä¾›äº†ä¸€ä¸ª C/C++å‰ç«¯ï¼Œä¸º LLVM é¡¹ç›®æ”¯æŒäº†æœ€æ–°çš„è¯­è¨€æ ‡å‡†ã€‚åŒ…æ‹¬ Clang åœ¨å†…ï¼ŒLLVM æ˜¯ç”±ä¸€ä¸ªåºå¤§ä¸”éå¸¸æ´»è·ƒçš„å¼€å‘ç¤¾åŒºç»´æŠ¤çš„ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/v2-7ac93f64b283ba0b5c5371b7cd524210_1440w-2024-03-09.webp"
alt="v2-7ac93f64b283ba0b5c5371b7cd524210_1440w-2024-03-09" width="auto" loading="lazy">
&lt;/figure>
&lt;p>é‡‡ç”¨ LLVM çš„å¥½å¤„æœ‰å¾ˆå¤šï¼Œç¬¬ä¸€æ¡è¦è¯´çš„æ˜¯æ›´å¿«çš„æ„å»ºæ—¶é—´ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒClang æ˜¯å¾ˆå¿«çš„ï¼æˆ‘ä»¬ä½¿ç”¨è‹±ç‰¹å°” oneAPI 2021.3 å·¥å…·åŒ…ä¸­çš„è‹±ç‰¹å°” C/C++ç¼–è¯‘å™¨æ—¶ï¼Œæµ‹å¾—æ„å»ºæ—¶é—´å‡å°‘äº† 14ï¼…ã€‚é™¤äº†å‡å°‘æ„å»ºæ—¶é—´å¤–ï¼Œé‡‡ç”¨ Clang ä½¿æˆ‘ä»¬å¯ä»¥ä»ç¤¾åŒºæ”¯æŒæœ€æ–° C++è¯­è¨€æ ‡å‡†çš„ä¸€ç³»åˆ—æˆæœä¸­å—ç›Šï¼Œå¹¶è´¡çŒ®æˆæœæ¥åå“ºç¤¾åŒºã€‚&lt;/p>
&lt;p>è‹±ç‰¹å°”ä¸ºå¼€æºé¡¹ç›®æä¾›è´¡çŒ®å’Œæ”¯æŒçš„å†å²é¢‡ä¸ºæ‚ ä¹…ï¼Œå…¶ä¸­å‘ LLVM åšå‡ºè´¡çŒ®å°±æœ‰åå¹´æ—¶é—´äº†ã€‚æˆ‘ä»¬ä»Šå¤©çš„ä¸»åŠ¨åˆä½œè¡Œä¸ºåŒ…æ‹¬äº†ä¼˜åŒ–æŠ¥å‘Šè¡¥å……ã€æ‰©å¤§çš„æµ®ç‚¹æ¨¡å‹æ”¯æŒï¼Œä»¥åŠå‘é‡å¢å¼ºã€‚è‹±ç‰¹å°”ç›´æ¥å¯¹ LLVM é¡¹ç›®åšå‡ºè´¡çŒ®ï¼Œä¹Ÿæœ‰ä¸€ä¸ªä¸´æ—¶åŒºåŸŸï¼ˆè‹±ç‰¹å°” LLVM æŠ€æœ¯é¡¹ç›®ï¼‰ï¼Œé’ˆå¯¹ SYCL æ”¯æŒã€‚&lt;/p>
&lt;p>åœ¨è‹±ç‰¹å°”æ¶æ„ä¸Šï¼Œè‹±ç‰¹å°” C/C++ç¼–è¯‘å™¨é¢„æœŸèƒ½æä¾›æ¯”åŸºç¡€ Clang+LLVM ç¼–è¯‘å™¨æ›´é«˜çš„æ€§èƒ½ã€‚æ¥ä¸‹æ¥è‹±ç‰¹å°” C/C++ç¼–è¯‘å™¨éƒ½ä¼šæ˜¯é‡‡ç”¨äº† LLVM å¼€æºåŸºç¡€æ¶æ„çš„ç‰ˆæœ¬ï¼ˆicxï¼‰ã€‚æˆ‘ä»¬ä¼šç»§ç»­ä¹‹å‰çš„é•¿æœŸåŠªåŠ›ï¼ŒæŒç»­ä¸º Clang å’Œ LLVM é¡¹ç›®åšå‡ºè´¡çŒ®ï¼ŒåŒ…æ‹¬ä¸ºå®ƒä»¬æä¾›ä¼˜åŒ–ã€‚å¹¶éæ‰€æœ‰çš„ä¼˜åŒ–æŠ€æœ¯éƒ½ä¼šè¢«ä¸Šæ¸¸é‡‡çº³ï¼Œæœ‰æ—¶æ˜¯å› ä¸ºå®ƒä»¬å¤ªæ–°äº†ï¼Œæœ‰æ—¶å› ä¸ºå®ƒä»¬è¿‡äºé’ˆå¯¹è‹±ç‰¹å°”æ¶æ„ã€‚è¿™æ˜¯å¯ä»¥é¢„æ–™çš„ï¼Œå¹¶ä¸”ä¸å…¶ä»–å·²ç»é‡‡ç”¨ LLVM çš„ç¼–è¯‘å™¨æ˜¯åŒæ ·çš„æƒ…å†µã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/v2-1a1672571e4a8a60c335e5abe38ee86b_1440w-2024-03-09.webp"
alt="v2-1a1672571e4a8a60c335e5abe38ee86b_1440w-2024-03-09" width="auto" loading="lazy">
&lt;/figure>
&lt;p>è‹±ç‰¹å°” C/C++ç¼–è¯‘å™¨ä¸€ç›´éƒ½åœ¨æä¾›æœ€ä¼˜ç§€çš„æ€§èƒ½ã€‚ç»å…¸ç‰ˆæœ¬çš„è‹±ç‰¹å°” C/C++ç¼–è¯‘å™¨å–å¾—äº†å¯¹ GCC 18ï¼…çš„ä¼˜åŠ¿ï¼Œè€ŒåŸºäº LLVM çš„è‹±ç‰¹å°” C/C++ç¼–è¯‘å™¨å–å¾—äº† 41ï¼…çš„ä¼˜åŠ¿ã€‚&lt;/p></description></item><item><title>ç¬”è®°ï¼šPure - æ”¹è¿›æ¶ˆæ¯ä¼ é€’ä»¥æ›´å¥½åœ°åˆ©ç”¨èŠ‚ç‚¹å†…çš„å…±äº«å†…å­˜</title><link>https://cuterwrite.top/p/pure/</link><pubDate>Sun, 03 Mar 2024 01:16:00 +0000</pubDate><guid>https://cuterwrite.top/p/pure/</guid><description>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/crop_e9af4c445d695be5002248c7c814c67d195413-2024-03-04.webp" alt="Featured image of post ç¬”è®°ï¼šPure - æ”¹è¿›æ¶ˆæ¯ä¼ é€’ä»¥æ›´å¥½åœ°åˆ©ç”¨èŠ‚ç‚¹å†…çš„å…±äº«å†…å­˜" />&lt;h1 id="ç¬”è®°pure-æ”¹è¿›æ¶ˆæ¯ä¼ é€’ä»¥æ›´å¥½åœ°åˆ©ç”¨èŠ‚ç‚¹å†…çš„å…±äº«å†…å­˜">ç¬”è®°ï¼šPure: æ”¹è¿›æ¶ˆæ¯ä¼ é€’ä»¥æ›´å¥½åœ°åˆ©ç”¨èŠ‚ç‚¹å†…çš„å…±äº«å†…å­˜&lt;/h1>
&lt;h2 id="å¼•ç”¨å‡ºå¤„">å¼•ç”¨å‡ºå¤„&lt;/h2>
&lt;p>James Psota and Armando Solar-Lezama. 2024. Pure: Evolving Message Passing To Better Leverage Shared Memory Within Nodes. In Proceedings of the 29th ACM SIGPLAN Annual Symposium on Principles and Practice of Parallel Programming (&lt;strong>PPoPP &amp;lsquo;24&lt;/strong>). Association for Computing Machinery, New York, NY, USA, 133â€“146. &lt;a class="link" href="https://doi.org/10.1145/3627535.3638503" target="_blank" rel="noopener" >https://doi.org/10.1145/3627535.3638503
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
&lt;/p>
&lt;h2 id="å…³é”®è¯">å…³é”®è¯&lt;/h2>
&lt;ul>
&lt;li>å¹¶è¡Œç¼–ç¨‹æ¨¡å‹&lt;/li>
&lt;li>åˆ†å¸ƒå¼è¿è¡Œæ—¶ç³»ç»Ÿ&lt;/li>
&lt;li>åŸºäºä»»åŠ¡çš„å¹¶è¡Œæ¨¡å‹&lt;/li>
&lt;li>å¹¶å‘æ•°æ®ç»“æ„&lt;/li>
&lt;li>æ— é”æ•°æ®ç»“æ„&lt;/li>
&lt;/ul>
&lt;h2 id="æ‘˜è¦">æ‘˜è¦&lt;/h2>
&lt;p>Pure æ˜¯ä¸€ç§æ–°çš„ç¼–ç¨‹æ¨¡å‹å’Œè¿è¡Œæ—¶ç³»ç»Ÿï¼Œæ—¨åœ¨åœ¨åŸºäºæ¶ˆæ¯ä¼ é€’æ¥å£ï¼ˆå¢å¼ºä½¿ç”¨ä»»åŠ¡åˆ©ç”¨ç©ºé—²æ ¸å¿ƒèƒ½åŠ›ï¼‰çš„ç¯å¢ƒä¸­å……åˆ†åˆ©ç”¨èŠ‚ç‚¹å†…éƒ¨çš„å…±äº«å†…å­˜ã€‚Pure é€šè¿‡ä¸¤ç§æ–¹å¼åˆ©ç”¨å…±äº«å†…å­˜ï¼š(1) å…è®¸ rank åœ¨ç­‰å¾…æ¶ˆæ¯åˆ°è¾¾æ—¶ä»å½¼æ­¤é‚£é‡Œçªƒå–å·¥ä½œï¼›(2) åˆ©ç”¨é«˜æ•ˆæ— é”çš„æ•°æ®ç»“æ„å®ç°èŠ‚ç‚¹å†…å„è¿›ç¨‹é—´é«˜æ€§èƒ½çš„æ¶ˆæ¯ä¼ é€’å’Œé›†åˆæ“ä½œã€‚ç ”ç©¶è€…é€šè¿‡ micro benchmark æµ‹è¯•è¯„ä¼°äº† Pure çš„å…³é”®æ¶ˆæ¯ä¼ é€’å’Œé›†åˆç‰¹æ€§ï¼Œå¹¶å±•ç¤ºäº†åœ¨ CoMD åˆ†å­åŠ¨åŠ›å­¦å’Œ miniAMR è‡ªé€‚åº”ç½‘æ ¼ç»†åŒ–åº”ç”¨ä¸­ï¼Œå½“æ‰©å±•åˆ° 4096 ä¸ª rank æ—¶ï¼ŒPure å¯å®ç°é«˜è¾¾ &lt;strong>2.1x&lt;/strong> çš„åº”ç”¨åŠ é€Ÿã€‚&lt;/p>
&lt;h2 id="1-å¼•è¨€">1. å¼•è¨€&lt;/h2>
&lt;p>åœ¨è¿‡å»çš„å‡ åå¹´é‡Œï¼Œé«˜æ€§èƒ½è®¡ç®—é¢†åŸŸç»å†äº†ä»å¤§å‹å‘é‡è®¡ç®—æœºåˆ°ç”±å•å¤„ç†å™¨æ„æˆçš„é›†ç¾¤çš„è½¬å˜ï¼Œè¿™äº›é›†ç¾¤é€šè¿‡ç½‘ç»œäº’è¿ã€‚MPI æˆä¸ºäº†åˆ†å¸ƒå¼å†…å­˜ç³»ç»Ÿä¸Šå¹¶è¡Œç¼–ç¨‹çš„äº‹å®æ ‡å‡†ã€‚éšç€ç¡¬ä»¶çš„è¿›æ­¥ï¼Œå¤šæ ¸é›†ç¾¤çš„å‡ºç°ä½¿å¾—èŠ‚ç‚¹å†…çš„æ ¸å¿ƒèƒ½å¤Ÿå…±äº«å†…å­˜å¹¶é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œè¿™ä¿ƒä½¿ç¤¾åŒºä¸æ–­å¯»æ±‚æ–°çš„èŒƒå¼ï¼Œä»¥æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç°ä»£é›†ç¾¤èµ„æºã€‚ç›®å‰ä¸»è¦çš„ç­–ç•¥æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ç»´æŒç»Ÿä¸€çš„ MPI ç¼–ç¨‹æ–¹æ³•ï¼Œé€šè¿‡æ”¹è¿› MPI è¿è¡Œæ—¶ç³»ç»Ÿæ¥æ›´å¥½åœ°åˆ©ç”¨å…±äº«å†…å­˜ï¼›å¦ä¸€ç§æ˜¯é‡‡ç”¨ MPI+X ç­‰æ··åˆç¼–ç¨‹æ¨¡å¼ï¼Œåœ¨èŠ‚ç‚¹å†…éƒ¨é‡‡ç”¨å…±äº«å†…å­˜å¹¶è¡Œæ€§ï¼Œè€Œåœ¨èŠ‚ç‚¹ä¹‹é—´ç»§ç»­ä½¿ç”¨ MPIã€‚&lt;strong>ç„¶è€Œï¼Œè¿™äº›æ–¹æ³•è¦ä¹ˆå¯èƒ½å—åˆ° MPI æ ‡å‡†å¯¹æ¥å£è¡Œä¸ºè§„å®šçš„é™åˆ¶ï¼Œæ— æ³•æœ€å¤§åŒ–æ€§èƒ½ï¼›è¦ä¹ˆç»™ç¨‹åºå‘˜å¸¦æ¥äº†ç®¡ç†ä¸¤ç§ç¼–ç¨‹æ¨¡å‹çš„æŒ‘æˆ˜&lt;/strong>ã€‚&lt;/p>
&lt;p>ç¤¾åŒºå·²ç»å°è¯•äº†è®¸å¤šå…¶ä»–æ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬ &lt;strong>PGAS&lt;/strong> æ¨¡å‹ï¼Œå®ƒæä¾›äº†ä¸€ç§é›†ç¾¤èŒƒå›´å†…çš„å…±äº«å†…å­˜æŠ½è±¡ï¼Œä»¥åŠ &lt;strong>Legion ã€Chapel&lt;/strong> å’Œ &lt;strong>X10&lt;/strong> ç­‰éšå¼å¹¶è¡Œç¼–ç¨‹è¯­è¨€ï¼Œè¿™äº›è¯­è¨€æä¾›äº†é«˜çº§æŠ½è±¡ï¼Œå¹¶å°è¯•è‡ªåŠ¨é«˜æ•ˆåœ°åè°ƒåº”ç”¨ç¨‹åºã€‚å°½ç®¡å–å¾—äº†ä¸€å®šçš„è¿›å±•ï¼Œè®¸å¤šç°ä»£ HPC åº”ç”¨ä»ç„¶ä¾èµ–äº MPIã€‚&lt;strong>MPC&lt;/strong> å’Œ &lt;strong>AMPI&lt;/strong> ä¹Ÿå°è¯•é€šè¿‡å°†çº¿ç¨‹ä½œä¸º MPI Rank æ¥åˆ©ç”¨å†…éƒ¨çš„å…±äº«å†…å­˜ï¼Œä»¥æé«˜æ€§èƒ½ã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼Œä»…ä½¿ç”¨ MPI çš„æ–¹æ³•å¾€å¾€æ¯”æ··åˆç¼–ç¨‹æ–¹æ³•è¡¨ç°æ›´ä½³ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºæ¥å£çš„å±€é™æ€§å’Œæ— æ³•å……åˆ†åˆ©ç”¨èŠ‚ç‚¹å†…çš„å…±äº«å†…å­˜ï¼Œå¯¼è‡´ MPI æœªèƒ½å……åˆ†å‘æŒ¥å…¶æ½œåœ¨æ€§èƒ½ã€‚å› æ­¤ï¼Œæœ¬æ–‡æå‡ºçš„ Pure ç³»ç»ŸåŸºäº MPI-everywhere æ–¹æ³•æ„å»ºï¼Œæ‰“ç ´äº†ä¸€äº› MPI çš„ä¼ ç»Ÿå‡è®¾ï¼Œæ›´æœ‰æ•ˆåœ°åˆ©ç”¨äº†å…±äº«å†…å­˜ï¼ŒåŒæ—¶é¿å…äº†å¯¹ç°æœ‰ç¨‹åºè¿›è¡Œé‡å¤§é‡æ„çš„éœ€æ±‚ã€‚Pure é‡‡ç”¨äº†ä¸ MPI ç±»ä¼¼çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä»è€Œèƒ½å¤Ÿåˆ©ç”¨ HPC ç¤¾åŒºç°æœ‰çš„ MPI çŸ¥è¯†å’Œåº”ç”¨ç¨‹åºåŸºç¡€ã€‚&lt;/p>
&lt;p>Pure çš„è®¾è®¡çµæ„Ÿæºè‡ª MPIï¼Œå…¶æ ¸å¿ƒç¼–ç¨‹æ¨¡å‹æ˜¯åŸºäºæ¶ˆæ¯ä¼ é€’çš„ï¼Œå¹¶å¯é€‰æ‹©æ€§åœ°æ•´åˆä»»åŠ¡å¹¶è¡Œæ€§ã€‚ä¸ MPI ä¸åŒï¼ŒPure æ‘’å¼ƒäº†ä½¿ç”¨è¿›ç¨‹çº§åˆ«çš„ rank å’Œå¯¹æ—§ç‰ˆè¯­è¨€çš„æ”¯æŒé™åˆ¶ï¼Œè½¬è€Œé‡‡ç”¨çº¿ç¨‹ä½œä¸º rank çš„å®ç°ï¼Œè€Œéä¼ ç»Ÿçš„è¿›ç¨‹ã€‚è¿™ç§è½¬å˜ä½¿å¾— Pure èƒ½å¤Ÿé«˜æ•ˆåœ°é‡‡ç”¨è½»é‡çº§çš„æ— é”åŒæ­¥æœºåˆ¶ï¼Œå®ç°åŒä¸€èŠ‚ç‚¹å†…å„çº¿ç¨‹é—´çš„åè°ƒã€‚åˆ©ç”¨è¿™ç§çº¿ç¨‹åŒ–çš„ rank æ¶æ„ï¼ŒPure æ„å»ºäº†é«˜æ•ˆçš„èŠ‚ç‚¹å†…é›†ä½“æ“ä½œåŠŸèƒ½ï¼Œå¹¶é€šè¿‡æ— é”ç®—æ³•æ¥ä¼˜åŒ–è¿™äº›æ“ä½œçš„æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒPure æ”¯æŒå°†åº”ç”¨ç¨‹åºä¸­çš„ä¸€éƒ¨åˆ†å¹¶è¡Œä»£ç å—ä»¥æ ‡å‡†çš„ C++ lambda è¡¨è¾¾å¼çš„å½¢å¼è¿è¡Œï¼Œè¿™äº›è¡¨è¾¾å¼èƒ½å¤Ÿè¢«å½“å‰æ‹¥æœ‰ rank çš„çº¿ç¨‹ä»¥åŠå…¶ä»–ç©ºé—²çš„ rank è‡ªåŠ¨ä¸”å¹¶å‘åœ°æ‰§è¡Œï¼Œè€Œè¿™ä¸€åˆ‡çš„æ“ä½œéƒ½ç”± Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿè‡ªåŠ¨è¿›è¡Œè°ƒåº¦ã€‚&lt;/p>
&lt;p>è®ºæ–‡æå‡ºçš„ä¼˜åŒ–ç­–ç•¥æ¶µç›–äº†ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸€ç§æ— é”æ¶ˆæ¯ä¼ é€’æ–¹æ³•ï¼Œé€‚ç”¨äºå°æ¶ˆæ¯å’Œå¤§æ•°æ®æ¶ˆæ¯çš„ä¼ è¾“ã€‚&lt;/li>
&lt;li>æ— é”æ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆå®ç°é›†åˆé€šä¿¡ç®—æ³•ã€‚&lt;/li>
&lt;li>ä¸€ä¸ªæ— é”ä»»åŠ¡è°ƒåº¦å™¨ï¼Œå…è®¸ç©ºé—²çº¿ç¨‹é«˜æ•ˆåœ°ä»å…¶ä»–çº¿ç¨‹ä¸­â€œçªƒå–â€å·¥ä½œè´Ÿè½½ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä½œè€…é‡‡ç”¨äº†æ ‡å‡†çš„ C++ åº“æ¥ç¡®ä¿ Pure çš„å¹¿æ³›å…¼å®¹æ€§ï¼Œå¹¶è¯æ˜äº† Pure ç›¸è¾ƒäºç»è¿‡é«˜åº¦ä¼˜åŒ–çš„ MPI åŸºå‡†æµ‹è¯•ï¼Œåœ¨æ€§èƒ½ä¸Šæœ‰æ˜¾è‘—æå‡ã€‚æ­¤å¤–ï¼Œä½œè€…è¿˜å±•ç¤ºäº† Pure ç¼–ç¨‹æ¨¡å‹åœ¨è¯­ä¹‰ä¸Šä¸ MPI éå¸¸ç›¸ä¼¼ï¼Œè¿™æ„å‘³ç€ä»ç°æœ‰åº”ç”¨ç¨‹åºè¿ç§»åˆ° Pure æ˜¯ç›´æ¥ä¸”ç®€ä¾¿çš„ï¼Œè¿™ä¸€ç‚¹é€šè¿‡æºç åˆ°æºç çš„è½¬æ¢å·¥å…· mpi2pure å¾—åˆ°äº†è¿›ä¸€æ­¥çš„è¯æ˜ã€‚æ€»ä½“è€Œè¨€ï¼Œè®ºæ–‡çš„ä¸»è¦è´¡çŒ®å¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>æå‡ºäº†ä¸€ç§æ–°çš„ç¼–ç¨‹æ¨¡å‹å’Œè¿è¡Œæ—¶ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿæœ‰æ•ˆåœ°ç»“åˆäº†æ¶ˆæ¯ä¼ é€’å’Œä»»åŠ¡å¹¶è¡Œæ€§ï¼Œå¹¶ä¸”åˆ©ç”¨äº†æ ‡å‡† C++ çš„ç‰¹æ€§æ¥å®ç°ã€‚&lt;/li>
&lt;li>å±•ç¤ºäº†ç°ä»£ C++ å¦‚ä½•æ”¯æŒæ›´åŠ çµæ´»çš„å¹¶è¡Œè¿è¡Œæ—¶ç³»ç»Ÿæ¥å£ã€‚&lt;/li>
&lt;li>æè¿°äº†ä¸€ä¸ªè®¾è®¡ç²¾è‰¯çš„æ— é”ã€å¤šçº¿ç¨‹å’Œåˆ†å¸ƒå¼è¿è¡Œæ—¶ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿåœ¨èŠ‚ç‚¹å†…éƒ¨ç›¸æ¯” MPI æ˜¾ç¤ºå‡ºäº†æ˜¾è‘—çš„é€Ÿåº¦æå‡ã€‚&lt;/li>
&lt;li>è¯æ˜äº†é€šè¿‡ä»…å¯¹ç°æœ‰çš„ MPI åº”ç”¨ç¨‹åºè¿›è¡Œæœ€å°çš„æºä»£ç ä¿®æ”¹ï¼Œå°±èƒ½åœ¨ micro benchmark æµ‹è¯•å’Œä¸‰ä¸ªå®é™…åº”ç”¨ä¸­å®ç°ä¸æœ€å…ˆè¿›çš„ MPI å®ç°ç›¸æ¯”çš„æ˜¾è‘—æ€§èƒ½æå‡ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="2-pure-ä½¿ç”¨ç¤ºä¾‹">2. Pure ä½¿ç”¨ç¤ºä¾‹&lt;/h2>
&lt;p>æœ¬èŠ‚é€šè¿‡ä¸€ä¸ªç®€å•çš„ 1-D Stencil ç®—æ³•ç¤ºä¾‹æ¥é˜é‡Š Pure çš„ä½¿ç”¨æ–¹æ³•ã€‚è¯¥ç¤ºä¾‹è™½ç„¶ç®€å•ï¼Œä½†èƒ½å¤Ÿæ¸…æ™°å±•ç¤º Pure çš„æ ¸å¿ƒæ¦‚å¿µåŠå…¶ä¸ MPI çš„ç›¸ä¼¼ä¹‹å¤„ï¼Œä¸ºå¼€å‘è€…ç¼–å†™æ›´å¤æ‚çš„åº”ç”¨ç¨‹åºå¥ å®šäº†åŸºç¡€ã€‚&lt;/p>
&lt;p>åœ¨ MPI ç‰ˆæœ¬çš„å®ç°ä»£ç  &lt;code>rand_stencil_mpi&lt;/code> ä¸­ï¼Œè®¡ç®—å·¥ä½œä¸»è¦é›†ä¸­åœ¨å‡½æ•° &lt;code>random_work&lt;/code> ä¸­æ‰§è¡Œã€‚ç®€å•æ¥è¯´ï¼Œ&lt;code>rand_stencil_mpi&lt;/code> å‡½æ•°é¦–å…ˆä¼šè¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œè¿­ä»£æ¬¡æ•°ä¸º &lt;code>iters&lt;/code> ï¼Œåœ¨æ•°ç»„ &lt;code>a&lt;/code> çš„æ¯ä¸ªå…ƒç´ ä¸Šè®¡ç®— &lt;code>random_work&lt;/code> ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ&lt;code>random_work&lt;/code> æ‰§è¡Œçš„æ—¶é—´é•¿åº¦æ˜¯å¯å˜ä¸”æœªçŸ¥çš„ï¼Œå› æ­¤ä¼šå¼•å…¥è´Ÿè½½ä¸å¹³è¡¡ã€‚æ­¤å¤–ï¼Œ&lt;code>random_work&lt;/code> ä¸ä¼šä¿®æ”¹æ•°ç»„ &lt;code>a&lt;/code> çš„å†…å®¹ï¼Œè€Œæ˜¯æ¥ç€é€šè¿‡å¯¹ç›¸é‚»å…ƒç´ æ±‚å¹³å‡å€¼æ›´æ–°æ•°ç»„ &lt;code>a&lt;/code> ã€‚æœ€åï¼Œç¨‹åºåˆ©ç”¨ &lt;code>MPI_Send&lt;/code> å’Œ &lt;code>MPI_Recv&lt;/code> äº¤æ¢ &lt;code>temp&lt;/code> æ•°ç»„çš„é¦–å°¾å…ƒç´ ï¼Œä»¥ä¾¿è®¡ç®—æ•°ç»„ &lt;code>a&lt;/code> çš„é¦–å°¾å…ƒç´ ã€‚ç”±äº &lt;code>random_work&lt;/code> æ‰€éœ€æ—¶é—´é•¿çŸ­ä¸ä¸€ï¼ŒæŸäº›å¤„ç†å•å…ƒä¼šæå‰å®Œæˆä»»åŠ¡ï¼Œæœ‰æ—¶ä¼šåœ¨ç­‰å¾…å‘é€æ–¹è¾ƒæ…¢çš„ &lt;code>MPI_Recv&lt;/code> è°ƒç”¨æ—¶é™·å…¥é˜»å¡çŠ¶æ€ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/1D_stencil-2024-03-14.webp"
alt="1D_stencil-2024-03-14" width="auto" loading="lazy">
&lt;/figure>
&lt;div class="notice notice-info" >
&lt;div class="notice-title">&lt;svg t="1705940100069" class="icon notice-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6252" width="200" height="200">&lt;path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272z m-32-344c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z" p-id="6253" fill="#ffffff">&lt;/path>&lt;/svg>&lt;/div>&lt;p>ç¤ºä¾‹ 1ï¼š1-D Stencil with Random Work, MPI Version&lt;/p>&lt;/div>
&lt;pre>&lt;code class="language-cpp">void rand_stencil_mpi(double* const a, size_t arr_sz, size_t iters, int my_rank,
int n_ranks) {
double temp[arr_sz];
for (auto it = 0; it &amp;lt; iters; ++it) {
for (auto i = 0; i &amp;lt; arr_sz; ++i) {
temp[i] = random_work(a[i]);
}
for (auto i = 1; i &amp;lt; arr_sz - 1; ++i) {
a[i] = (temp[i - 1] + temp[i] + temp[i + 1]) / 3.0;
}
if (my_rank &amp;gt; 0) {
MPI_Send(&amp;amp;temp[0], 1, MPI_DOUBLE, my_rank - 1, 0, MPI_COMM_WORLD);
double neighbor_hi_val;
MPI_Recv(&amp;amp;neighbor_hi_val, 1, MPI_DOUBLE, my_rank - 1, 0, MPI_COMM_WORLD,
MPI_STATUS_IGNORE);
a[0] = (neighbor_hi_val + temp[0] + temp[1]) / 3.0;
} // ends if not first rank
if (my_rank &amp;lt; n_ranks - 1) {
MPI_Send(&amp;amp;temp[arr_sz - 1], 1, MPI_DOUBLE, my_rank + 1, 0,
MPI_COMM_WORLD);
double neighbor_lo_val;
MPI_Recv(&amp;amp;neighbor_lo_val, 1, MPI_DOUBLE, my_rank + 1, 0, MPI_COMM_WORLD,
MPI_STATUS_IGNORE);
a[arr_sz - 1] =
(temp[arr_sz - 2] + temp[arr_sz - 1] + neighbor_lo_val) / 3.0;
} // ends if not last rank
} // ends for all iterations
}
&lt;/code>&lt;/pre>
&lt;p>ç¤ºä¾‹ 2 åˆ™å±•ç¤ºäº†å®ç°åŒæ ·åŠŸèƒ½çš„ Pure ç‰ˆæœ¬ã€‚å…¶ä¸­å­˜åœ¨ä¸€äº›å…³é”®å·®å¼‚ã€‚é¦–å…ˆï¼Œæ¶ˆæ¯è°ƒç”¨å‡½æ•°æ¥å£ä¸åŒï¼Œä½¿ç”¨çš„æ˜¯ç›¸åº”çš„ Pure æ¶ˆæ¯ä¼ é€’å‡½æ•° &lt;code>pure_send_msg&lt;/code> å’Œ &lt;code>pure_recv_msg&lt;/code> ï¼Œè€Œé MPI è°ƒç”¨ï¼Œä½†å‚æ•°å®è´¨ä¸Šä¸ MPI å¯¹åº”å‡½æ•°åŸºæœ¬ç›¸åŒã€‚Pure çš„æ¶ˆæ¯ä¼ é€’è¯­ä¹‰ç±»ä¼¼äº MPIï¼šå‘é€ç«¯ç¼“å†²åŒºè¢«å¤åˆ¶åˆ°æ¥æ”¶ç«¯ç¼“å†²åŒºã€‚å®ç°åŒºåˆ«ä¸»è¦åœ¨äºï¼šPure åœ¨&lt;strong>èŠ‚ç‚¹å†…éƒ¨é‡‡ç”¨äº†è½»é‡çº§çš„æ¶ˆæ¯ä¼ é€’æ–¹æ³•&lt;/strong>ï¼Œä»è€Œåœ¨èŠ‚ç‚¹å†…çš„æ¶ˆæ¯ä¼ é€’æ¯” MPI çš„å»¶è¿Ÿæ›´ä½ã€‚&lt;/p>
&lt;div class="notice notice-info" >
&lt;div class="notice-title">&lt;svg t="1705940100069" class="icon notice-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6252" width="200" height="200">&lt;path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272z m-32-344c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z" p-id="6253" fill="#ffffff">&lt;/path>&lt;/svg>&lt;/div>&lt;p>ç¤ºä¾‹ 2ï¼šPure ç‰ˆæœ¬&lt;/p>&lt;/div>
&lt;pre>&lt;code class="language-cpp">void rand_stencil_pure(double* a, const int arr_sz, const int n_iter,
const int my_rank, const int n_ranks) {
double temp[arr_sz];
PureTask rand_work_task = [a, temp, arr_sz, my_rank](
chunk_id_t start_chunk, chunk_id_t end_chunk,
std::optinal&amp;lt;void&amp;gt; cont_params) {
auto [min_idx, max_idx] =
pure_aligned_idx_range&amp;lt;double&amp;gt;(arr_sz, start_chunk, end_chunk);
for (auto i = min_idx; i &amp;lt; max_idx; i++) {
temp[i] = random_work(a[i]);
}
}; // ends definding the Pure Task for rand_work_task
for (auto it = 0; it &amp;lt; n_iter; it++) {
rand_work_task.execute(); // execute all chunks of rank_work_task
for (auto i = 1; i &amp;lt; arr_sz - 1; ++i) {
a[i] = (temp[i - 1] + temp[i] + temp[i + 1]) / 3.0;
}
if (my_rank &amp;gt; 0) {
pure_send_msg(&amp;amp;temp[0], 1, MPI_DOUBLE, my_rank - 1, 0, PURE_COMM_WORLD);
double neighbor_hi_val;
pure_recv_msg(&amp;amp;neighbor_hi_val, 1, MPI_DOUBLE, my_rank - 1, 0,
PURE_COMM_WORLD);
a[0] = (neighbor_hi_val + temp[0] + temp[1]) / 3.0;
} // ends if not first rank
if (my_rank &amp;lt; n_ranks - 1) {
pure_send_msg(&amp;amp;temp[arr_sz - 1], 1, MPI_DOUBLE, my_rank + 1, 0,
PURE_COMM_WORLD);
double neighbor_lo_val;
pure_recv_msg(&amp;amp;neighbor_lo_val, 1, MPI_DOUBLE, my_rank + 1, 0,
PURE_COMM_WORLD);
a[arr_sz - 1] =
(temp[arr_sz - 2] + temp[arr_sz - 1] + neighbor_lo_val) / 3.0;
} // ends if not last rank
} // ends definding the Pure Task for rand_work_task
}
&lt;/code>&lt;/pre>
&lt;p>æ›´é‡è¦çš„å·®å¼‚åœ¨äº Pure ä¸­å¢åŠ çš„ &lt;strong>Pure Task&lt;/strong> ï¼Œç”¨å¸¦æœ‰ä¸€ç»„ç‰¹å®šå‚æ•°å®šä¹‰çš„ lambda è¡¨è¾¾å¼ï¼Œå…¶åˆ©ç”¨ lambda çš„æ•è·å‚æ•°ç‰¹æ€§ï¼Œå…è®¸å¤–éƒ¨äº lambda ä½“å†…çš„å˜é‡ä»¥å€¼æˆ–å¼•ç”¨å½¢å¼è¢«æ•è·å¹¶åœ¨ lambda æ‰§è¡Œæ—¶ä½¿ç”¨ã€‚Pure Task å¯ä»¥è¢«è§†ä¸ºç”± Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿè´Ÿè´£æ‰§è¡Œåº”ç”¨ç¨‹åºä»£ç ç‰‡æ®µï¼Œå¯ä»¥é€šè¿‡å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚å› æ­¤ï¼ŒPure ä»»åŠ¡åº”ç»“æ„åŒ–ä¸ºç±»ä¼¼æ•°æ®å¹¶è¡Œçš„å½¢å¼ã€‚æ­¤å¤–ï¼ŒPure Task éœ€è¦ç”±ç¨‹åºå‘˜ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚&lt;/p>
&lt;p>åœ¨ä»¥ä¸Š Pure å®ç°ä¸­ï¼Œç¨‹åºå‘˜å¯ä»¥åˆ©ç”¨ chunk ranges æ¥æè¿°å¹¶å‘æ€§ã€‚è¿™äº›å­èŒƒå›´æˆ– chunk æ˜¯é€šè¿‡ &lt;code>start_chunk&lt;/code> å’Œ &lt;code>end_chunk&lt;/code> å‚æ•°ä¼ é€’ç»™ Pure Task çš„ï¼Œè€Œå®ƒä»¬æ˜¯ç”± Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿæä¾›ã€‚Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿè´Ÿè´£ç¡®ä¿æ‰€æœ‰å·¥ä½œé¡ºåˆ©å®Œæˆã€‚ç”±äºå¯èƒ½æ¶‰åŠåˆ°ä¸åŒçš„å¤šä¸ªçº¿ç¨‹ï¼ŒPure Runtime è¿è¡Œæ—¶ç³»ç»Ÿä¼šé€šè¿‡è¿½è¸ªå“ªäº› chunk å·²åˆ†é…å’Œå®Œæˆæ¥å®ç°è¿™ä¸€ç‚¹ã€‚&lt;/p>
&lt;p>å…¶æ¬¡ï¼Œç¨‹åºå‘˜éœ€è¦å°† Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿæä¾›çš„ &lt;code>start_chunk&lt;/code> å’Œ &lt;code>end_chunk&lt;/code> å‚æ•°æ˜ å°„åˆ°ä¸åº”ç”¨è®¡ç®—ç›¸å…³çš„å…·ä½“å†…å®¹ä¸Šã€‚åœ¨è¿™é‡Œï¼Œä»£ç ä½¿ç”¨äº† &lt;code>pure_aligned_idx_range&lt;/code> è¾…åŠ©å‡½æ•°å°†å…¶è½¬åŒ–ä¸ºå¾ªç¯ç´¢å¼•å­èŒƒå›´ã€‚è¿™ä¸ªè¾…åŠ©å‡½æ•°è€ƒè™‘åˆ°äº†ç¼“å­˜è¡Œï¼Œæ‰€ä»¥æœ‰åˆ©äºé¿å…ä¼ªå…±äº«é—®é¢˜ã€‚&lt;/p>
&lt;p>ç”±äº random_work å¯èƒ½å¯¼è‡´è´Ÿè½½åˆ†å¸ƒä¸å‡ï¼ŒæŸäº› rank å¯èƒ½ä¼šåœ¨ç­‰å¾…æ¶ˆæ¯æ—¶å¤„äºç©ºé—²çŠ¶æ€ã€‚Pure çš„ä»»åŠ¡è°ƒåº¦å™¨ä¼šè‡ªåŠ¨åˆ©ç”¨è¿™äº›ç©ºé—²çš„ rankï¼Œä»¥æ‰§è¡ŒåŒä¸€èŠ‚ç‚¹å†…å…¶ä»–å¾…å¤„ç†çš„ Pure ä»»åŠ¡å—ã€‚ä»¥ä¸‹å›¾ä¸­åœ¨åŒä¸€èŠ‚ç‚¹å†…çš„ä¸‰ä¸ª rank ä¸ºä¾‹ï¼š&lt;strong>rank 0&lt;/strong> æ­£åœ¨æ‰§è¡Œä¸€ä¸ªè¢«åˆ’åˆ†ä¸º 6 ä¸ª chunks çš„ Pure Taskï¼Œè€Œ &lt;strong>rank 1&lt;/strong> å’Œ &lt;strong>rank 2&lt;/strong> å› ä¸ºæ¥æ”¶æ¶ˆæ¯è€Œé˜»å¡ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/timeline-2024-03-14.png"
alt="timeline-2024-03-14" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>ç¤ºä¾‹ Pure ä»£ç çš„æ—¶é—´çº¿ç¤ºæ„å›¾&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>ä»å›¾ä¸­å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ä»¥ä¸‹æ‰§è¡Œæµç¨‹ï¼š&lt;/p>
&lt;ul>
&lt;li>rank 0 å¼€å§‹å¤„ç†ç¬¬ä¸€ä¸ª chunkï¼ˆchunk 0ï¼‰ ã€‚&lt;/li>
&lt;li>åŒæ—¶ï¼Œrank 1 çªƒå–å¹¶è¡Œæ‰§è¡Œç¬¬äºŒä¸ª chunkï¼ˆchunk 1ï¼‰ã€‚&lt;/li>
&lt;li>ä»»åŠ¡è°ƒåº¦å™¨éšåä¸º rank 0 åˆ†é…ç¬¬ä¸‰ä¸ª chunkï¼ˆchunk 2ï¼‰ï¼Œä¸º rank 1 åˆ†é…ç¬¬å››ä¸ª chunkï¼ˆchunk 3ï¼‰ã€‚&lt;/li>
&lt;li>rank 2 å°è¯•çªƒå–ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æˆåŠŸæ‰§è¡Œç¬¬äº”ä¸ª chunkï¼ˆchunk 4ï¼‰ã€‚ç”±äº &lt;code>random_work&lt;/code> çš„æ‰§è¡Œéšæœºæ€§ï¼Œchunk 2 å’Œ chunk 4 å¯èƒ½æ˜¯è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ã€‚&lt;/li>
&lt;li>rank 0 å®Œæˆ chunk 5 çš„å¤„ç†ï¼Œè¿™æ˜¯ä¸€ä¸ªè¾ƒå°çš„ä»»åŠ¡å—ï¼Œå®ƒåœ¨ rank 2 å®Œæˆ chunk 4 ä¹‹å‰å°±å·²ç»ç»“æŸäº†ã€‚&lt;/li>
&lt;li>ä»»åŠ¡è°ƒåº¦å™¨ç¡®ä¿åœ¨æ‰€æœ‰ chunks å®Œæˆä¹‹å‰ï¼Œrank 0 ä¸ä¼šç»“æŸæ‰§è¡Œã€‚å®é™…ä¸Šï¼Œrank 0 è¦ç­‰åˆ° chunk 4 å®Œæˆåæ‰èƒ½ç»§ç»­ã€‚&lt;/li>
&lt;li>åœ¨ rank 1 å’Œ rank 2 ç­‰å¾…æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒä»¬ä¼šå°è¯•ä»å…¶ä»–ä»»ä½•å¯ç”¨çš„ rank ä¸­çªƒå–æ›´å¤šçš„ chunksã€‚&lt;/li>
&lt;li>å¾—ç›Šäº lambda è¡¨è¾¾å¼çš„å˜é‡æ•è·åŠŸèƒ½ï¼Œä¸åŒ rank ä¹‹é—´å¯ä»¥é«˜æ•ˆåœ°å…±äº«ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚&lt;/li>
&lt;/ul>
&lt;p>å®éªŒç»“æœæ˜¾ç¤ºï¼Œåœ¨å•èŠ‚ç‚¹ä¸Šé…ç½® 32 ä¸ª rank çš„ Pure ç‰ˆæœ¬å› ä¸ºæ›´å¿«çš„æ¶ˆæ¯ä¼ é€’å’Œ Pure Task çš„å¹¶è¡Œæ‰§è¡Œï¼Œç›¸æ¯”äº MPI ç‰ˆæœ¬ï¼ŒPure ç‰ˆæœ¬å®ç°äº† 10% çš„æ€§èƒ½æå‡ã€‚åœ¨è´Ÿè½½åˆ†å¸ƒä¸å‡çš„æƒ…å¢ƒä¸‹ï¼ŒPure çš„åŠ é€Ÿæ¯”ç”šè‡³è¶…è¿‡äº† 200%ã€‚è¿™äº›æ€§èƒ½æå‡çš„ç¨‹åº¦è™½ç„¶å—åˆ°è´Ÿè½½ä¸å¹³è¡¡çš„å½±å“ï¼Œä½†åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼ŒPure ä»å±•ç°å‡ºäº†æ˜¾è‘—çš„æ€§èƒ½æ”¹è¿›ã€‚è¿™å½’åŠŸäº Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿçš„èƒ½åŠ›ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å¹¶é«˜æ•ˆåˆ©ç”¨æœªè¢«å……åˆ†åˆ©ç”¨çš„è®¡ç®—èµ„æºã€‚&lt;/p>
&lt;h2 id="3-ç¼–ç¨‹æ¨¡å‹">3. ç¼–ç¨‹æ¨¡å‹&lt;/h2>
&lt;p>Pure çš„ç¼–ç¨‹æ¨¡å‹æ ¸å¿ƒæ˜¯â€œæ¶ˆæ¯ä¼ é€’ç»“åˆå¯é€‰çš„ä»»åŠ¡å¹¶è¡Œæ€§â€ã€‚åœ¨è¯­ä¹‰ä¸Šï¼ŒPure çš„æ¶ˆæ¯ä¼ é€’å’Œé›†åˆé€šä¿¡æ“ä½œä¸ MPI ç­‰åŒï¼Œå·®å¼‚ä¸»è¦ä½“ç°åœ¨è¯­æ³•ä¸Šçš„ä¸€äº›ç»†èŠ‚ã€‚&lt;/p>
&lt;p>å°½ç®¡ Pure åœ¨èŠ‚ç‚¹å†…éƒ¨é‡‡ç”¨çº¿ç¨‹ï¼Œä½†å…¶ rank å‘½åç©ºé—´åœ¨æ•´ä¸ªé›†ç¾¤ä¸­ä¿æŒéå±‚çº§ç»“æ„ã€‚åœ¨ Pure ç¨‹åºçš„æ‰§è¡Œå‘¨æœŸå†…ï¼Œrank çš„æ•°é‡ä¿æŒä¸å˜ã€‚&lt;/p>
&lt;p>Pure åº”ç”¨ç¨‹åºé‡‡ç”¨ C++ ç¼–å†™ï¼Œå¹¶é€šè¿‡ SPMDï¼ˆå•ç¨‹åºå¤šæ•°æ®ï¼‰æ¨¡å¼è¿è¡Œï¼Œå®ç°äº†å†…éƒ¨çš„å¤šçº¿ç¨‹åŒ–ã€‚åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰çš„ rank éƒ½æ˜¯é€šè¿‡å†…æ ¸çº¿ç¨‹å®ç°çš„ã€‚&lt;/p>
&lt;p>&lt;strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPure åº”ç”¨ç¨‹åºå¹¶ä¸æ”¯æŒå…¨å±€å˜é‡&lt;/strong>ã€‚å› æ­¤ï¼Œå¼€å‘è€…åº”å½“ç§»é™¤å…¨å±€å˜é‡æˆ–è€…ä½¿ç”¨ &lt;code>thread_local&lt;/code> å…³é”®å­—æ¥é™åˆ¶å˜é‡çš„ä½œç”¨åŸŸï¼Œç¡®ä¿çº¿ç¨‹ä¹‹é—´çš„å®‰å…¨æ€§ã€‚&lt;/p>
&lt;p>å¯¹äºå­˜åœ¨è´Ÿè½½ä¸å‡è¡¡é—®é¢˜çš„åº”ç”¨ç¨‹åºï¼Œå¼€å‘è€…å¯ä»¥åœ¨æ»¡è¶³ä»¥ä¸‹ç‰¹å®šæ¡ä»¶çš„ç¨‹åºéƒ¨åˆ†ä½¿ç”¨ Pure Taskï¼š&lt;/p>
&lt;ol>
&lt;li>è®¡ç®—å¯†é›†å‹çš„çƒ­ç‚¹åŒºåŸŸã€‚&lt;/li>
&lt;li>å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="æ¶ˆæ¯ä¼ é€’å’Œé›†åˆé€šä¿¡æ“ä½œ">æ¶ˆæ¯ä¼ é€’å’Œé›†åˆé€šä¿¡æ“ä½œ&lt;/h3>
&lt;p>åœ¨ Pure ä¸­ï¼Œ&lt;code>pure_send_msg&lt;/code> å’Œ &lt;code>pure_recv_msg&lt;/code> å‡½æ•°åœ¨åŠŸèƒ½ä¸Šä¸ MPI çš„ &lt;code>MPI_Send&lt;/code> å’Œ &lt;code>MPI_Recv&lt;/code> ç›¸å¯¹åº”ï¼ŒåŒæ—¶ Pure ä¹Ÿæä¾›äº†ç›¸åº”çš„éé˜»å¡ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿç¡®ä¿æ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šè¢«é€è¾¾ï¼Œå¹¶ä¸”æŒ‰ç…§å‘é€çš„é¡ºåºè¿›è¡Œäº¤ä»˜ã€‚Pure è¿˜å®ç°äº†ä¸€ç³»åˆ—çš„é›†åˆé€šä¿¡æ“ä½œï¼ŒåŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>Reduce&lt;/li>
&lt;li>All-Reduce&lt;/li>
&lt;li>Barrier&lt;/li>
&lt;li>Broadcast&lt;/li>
&lt;/ul>
&lt;p>æ­¤å¤–ï¼ŒPure å¼•å…¥äº†é€šä¿¡å­ï¼ˆcommunication subgroupï¼‰çš„æ¦‚å¿µï¼Œå…è®¸å¼€å‘è€…é€šè¿‡ &lt;code>pure_comm_split&lt;/code> å‡½æ•°å°†ä¸€ä¸ªé€šä¿¡å­é›†è¿›ä¸€æ­¥ç»†åˆ†ä¸ºæ›´å°çš„å­é›†ã€‚&lt;/p>
&lt;p>ä¸ºäº†ä½¿ç”¨ Pureï¼Œåº”ç”¨ç¨‹åºéœ€è¦é‡‡ç”¨ç°ä»£ C++ æ ‡å‡†è¿›è¡Œç¼–å†™ï¼Œæ¨èä½¿ç”¨ &lt;code>std=c++11&lt;/code> æˆ–æ›´é«˜ç‰ˆæœ¬è¿›è¡Œç¼–è¯‘ã€‚Pure æä¾›äº†ä¸€ä¸ªåŸºäº Make çš„æ„å»ºç³»ç»Ÿï¼Œå®ƒä¼šè‡ªåŠ¨é…ç½®åˆé€‚çš„ç¼–è¯‘å™¨é€‰é¡¹ï¼Œå¹¶é“¾æ¥åˆ° Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿï¼ˆlibpureï¼‰ï¼ŒåŒæ—¶å®šä¹‰äº†ä¸€ç³»åˆ—ç”¨äºè°ƒè¯•å’Œæ€§èƒ½åˆ†æçš„ targetã€‚&lt;/p>
&lt;h3 id="pure-task">Pure Task&lt;/h3>
&lt;p>Pure Task å…è®¸å¼€å‘è€…å®šä¹‰åº”ç”¨ç¨‹åºä¸­çš„è®¡ç®—éƒ¨åˆ†ï¼Œå¹¶å°†å…¶åˆ†è§£ä¸ºå¯å¹¶è¡Œæ‰§è¡Œçš„ chunksã€‚è¿™äº› chunks å¯ä»¥ç”± Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿè‡ªåŠ¨å¹¶å‘æ‰§è¡Œã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼ŒPure Task ä¸æ˜¯å¿…éœ€çš„ï¼Œåªæœ‰åœ¨ä»»åŠ¡å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªå°å—ï¼Œå¹¶ä¸”è¿™æ ·åšæœ‰åŠ©äºç¼“è§£è´Ÿè½½ä¸å‡è¡¡é—®é¢˜æ—¶ï¼Œæ‰æ¨èä½¿ç”¨ Pure Taskã€‚&lt;/p>
&lt;p>Pure Task é€šè¿‡ C++ Lambda è¡¨è¾¾å¼å®ç°ï¼Œå¹¶åœ¨æ‹¥æœ‰è¯¥ä»»åŠ¡çš„ rank è°ƒç”¨ &lt;code>execute&lt;/code> æ–¹æ³•æ—¶åŒæ­¥æ‰§è¡Œã€‚æ¯ä¸ª rank åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ª Pure Taskã€‚Lambda è¡¨è¾¾å¼çš„å˜é‡æ•è·åŠŸèƒ½ä½¿å¾—ä¸åŒ rank åœ¨æ‰§è¡Œä¸åŒ chunks æ—¶èƒ½å¤Ÿé«˜æ•ˆå…±äº«ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚é€šå¸¸ï¼Œä¸€ä¸ª Pure Task åœ¨åº”ç”¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè¢«å®šä¹‰ä¸€æ¬¡ï¼Œç„¶ååœ¨æ¯ä¸ªæ—¶é—´æ­¥æˆ–å…¶ä»–è¿­ä»£ä¸­å¤šæ¬¡æ‰§è¡Œã€‚&lt;/p>
&lt;p>å®šä¹‰ Pure Task æ—¶ï¼Œéœ€è¦æŒ‡å®š chunk çš„æ•°é‡å’Œé¢å¤–çš„åº”ç”¨ç¨‹åºå‚æ•°ã€‚ä»»åŠ¡ä¹‹é—´åº”é¿å…ç›¸äº’ä¾èµ–ï¼Œä¸è¿‡å› ä¸ºå®ƒä»¬ä¼šåœ¨ &lt;code>execute&lt;/code> è°ƒç”¨æœŸé—´å®Œå…¨æ‰§è¡Œï¼Œæ‰€ä»¥å®ƒä»¬ä¸ä¼šä¸ä»»åŠ¡å¤–éƒ¨çš„ä»£ç å‘ç”Ÿå†²çªã€‚&lt;/p>
&lt;p>Pure Task åŒ…å«ä¸€ä¸ª &lt;code>execute&lt;/code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª &lt;code>optional&amp;lt;void*&amp;gt;&lt;/code> ç±»å‹çš„å‚æ•° &lt;code>per_exe_args&lt;/code> ï¼Œç”¨äºæ¯æ¬¡æ‰§è¡Œä»»åŠ¡æ—¶ä¼ é€’é¢å¤–çš„å‚æ•°ã€‚è¿™åœ¨ä»»åŠ¡ä¸»ä½“çš„è¾“å…¥å€¼åœ¨è¿ç»­æ‰§è¡Œä¸­å‘ç”Ÿå˜åŒ–æ—¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ä»¥å°†æŒ‡å‘å±€éƒ¨ç»“æ„ä½“çš„æŒ‡é’ˆä¼ é€’ç»™ &lt;code>execute&lt;/code> æ–¹æ³•ã€‚&lt;/p>
&lt;p>Pure Task çš„å‰ä¸¤ä¸ªå‚æ•° &lt;code>start_chunk&lt;/code> å’Œ &lt;code>end_chunk&lt;/code> æ˜¯æ— ç¬¦å·æ•´æ•°ï¼Œç”¨äºæŒ‡å®šè¦æ‰§è¡Œçš„ chunk èŒƒå›´ã€‚è¿™äº› chunk ç”± Pure Runtime è¿è¡Œæ—¶ç³»ç»Ÿåˆ†é…ï¼Œç¡®ä¿æ¯ä¸ª chunk åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿å®ƒä»¬å¯èƒ½å¹¶å‘æ‰§è¡Œã€‚&lt;/p>
&lt;p>Pure Task ä½¿ç”¨ chunk èŒƒå›´ä¸ºè°ƒåº¦å™¨æä¾›äº†çµæ´»æ€§ï¼Œå…è®¸ä¸€æ¬¡æ€§åˆ†é…å¤šä¸ª chunksã€‚chunks çš„æ•°é‡ç”± Pure ä»»åŠ¡è°ƒåº¦å™¨å†³å®šï¼Œä½†ä¸ä¼šè¶…è¿‡åœ¨ Makefile æ–‡ä»¶ä¸­é¢„å®šä¹‰çš„ &lt;code>PURE_MAX_TASK_CHUNKS&lt;/code> ã€‚&lt;/p>
&lt;p>ç›®å‰ï¼ŒPure Task çš„æ¥å£éœ€è¦æ‰‹åŠ¨å°† chunk ç¼–å·æ˜ å°„åˆ°æ•°ç»„ç´¢å¼•ï¼Œè¿™åœ¨å¤„ç†å¤šç»´æ•°ç»„æ—¶å¯èƒ½æ¯”è¾ƒç¹çã€‚å› æ­¤ï¼Œæœªæ¥çš„å·¥ä½œç›®æ ‡æ˜¯æ‰©å±•æ¥å£ï¼Œæä¾›ç±»ä¼¼äº TBB çš„ &lt;code>parallel_for&lt;/code> é‚£æ ·æ›´ç®€æ´ã€æ›´é«˜çº§çš„æ¥å£ã€‚&lt;/p>
&lt;p>æœ€åï¼Œå¼€å‘è€…éœ€è¦ç¡®ä¿ Pure Task å†…éƒ¨çš„å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»¥é¿å…åŒä¸€ä»»åŠ¡çš„å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„ chunks ä¹‹é—´çš„ç›¸äº’ç«äº‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ CoMD åˆ†å­åŠ¨åŠ›å­¦ Benchmark ä¸­ï¼Œéœ€è¦å¤„ç†å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥åŒä¸€å†…å­˜ä½ç½®çš„é—®é¢˜ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ &lt;code>std::atomic&lt;/code> æ•°ç»„æ¥æ›¿ä»£æ™®é€š &lt;code>int&lt;/code> æ•°ç»„ã€‚&lt;/p>
&lt;h2 id="4-è¿è¡Œæ—¶ç³»ç»Ÿ">4. è¿è¡Œæ—¶ç³»ç»Ÿ&lt;/h2>
&lt;p>Pure è¿è¡Œæ—¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹å’Œåˆ†å¸ƒå¼è¿è¡Œæ—¶çš„åŠ¨æ€åº“ï¼Œç”¨äºæ”¯æŒ Pure åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚å¼€å‘è€…åœ¨ä½¿ç”¨æ—¶éœ€è¦åŒ…å« &lt;code>pure.h&lt;/code> å¤´æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ C++17 æ ‡å‡†è¿›è¡Œç¼–è¯‘ï¼ŒåŒæ—¶é“¾æ¥åˆ° &lt;code>libpure&lt;/code> åº“ã€‚Pure è¿è¡Œæ—¶ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨åœ°åœ¨è®¡ç®—å’Œé€šä¿¡æ“ä½œä¹‹é—´å¯»æ‰¾å¹¶åˆ©ç”¨é‡å æ‰§è¡Œçš„æœºä¼šï¼Œå°¤å…¶æ˜¯åœ¨é€šä¿¡å»¶è¿Ÿè¾ƒé«˜çš„æƒ…å†µä¸‹ã€‚&lt;/p>
&lt;p>Pure è¿è¡Œæ—¶ç³»ç»Ÿçš„ä¸»è¦èŒèƒ½åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>åˆå§‹åŒ–å¹¶é…ç½®å¿…è¦çš„è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œå¯åŠ¨åº”ç”¨ç¨‹åºã€‚&lt;/li>
&lt;li>ç®¡ç†èŠ‚ç‚¹å†…éƒ¨çš„ rank é—´é€šä¿¡å’Œé›†åˆæ“ä½œã€‚&lt;/li>
&lt;li>ç®¡ç†å†…éƒ¨çš„å†…å­˜ç¼“å†²åŒºå’Œæ•°æ®ç»“æ„ã€‚&lt;/li>
&lt;li>å¦‚æœåº”ç”¨ç¨‹åºä¸­å®šä¹‰äº† Pure Taskï¼Œè¿è¡Œæ—¶ç³»ç»Ÿè¿˜éœ€è´Ÿè´£è¿™äº›ä»»åŠ¡çš„è°ƒåº¦å’Œæ‰§è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="rank-åˆå§‹åŒ–ä¸æ˜ å°„">Rank åˆå§‹åŒ–ä¸æ˜ å°„&lt;/h3>
&lt;p>Pure ä¸­çš„ rank å®ç°ä¸º MPI è¿›ç¨‹çš„å†…æ ¸çº¿ç¨‹ã€‚åœ¨å¤šèŠ‚ç‚¹åº”ç”¨ä¸­ï¼ŒPure è¿è¡Œ MPI æ¥å¤„ç†è·¨èŠ‚ç‚¹é€šä¿¡ï¼Œè€Œåœ¨å•èŠ‚ç‚¹åº”ç”¨ä¸­åˆ™ä¸ä½¿ç”¨ MPIï¼Œå°½ç®¡å¦‚æ­¤ï¼ŒPure åº”ç”¨ç¨‹åºå¹¶ä¸ç›´æ¥è°ƒç”¨ MPI å‡½æ•°ã€‚é€šè¿‡ Makefile é…ç½®ï¼ŒPure ç¨‹åºå¯ä»¥åœ¨ä¸€ä¸ªèŠ‚ç‚¹æˆ– NUMA èŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ª MPI è¿›ç¨‹ï¼Œå¹¶æ ¹æ®æ¯ä¸ªèŠ‚ç‚¹æˆ– NUMA èŠ‚ç‚¹çš„æ ¸å¿ƒæ•°æ¥åˆ›å»ºç›¸åº”æ•°é‡çš„çº¿ç¨‹ã€‚å¯¹äºåº”ç”¨ç¨‹åºå¼€å‘è€…è€Œè¨€ï¼Œä»–ä»¬åªéœ€äº†è§£éå±‚æ¬¡åŒ–çš„ rank å‘½åç©ºé—´ï¼Œè€ŒèŠ‚ç‚¹ã€çº¿ç¨‹ã€MPI è¿›ç¨‹å’Œé€šä¿¡å»¶è¿Ÿç­‰åº•å±‚æ¦‚å¿µéƒ½è¢«æŠ½è±¡åŒ–ï¼Œå¯¹å¼€å‘è€…é€æ˜ã€‚&lt;/p>
&lt;p>Pure æ”¯æŒçµæ´»çš„ rank åˆ°èŠ‚ç‚¹çš„æ˜ å°„ç­–ç•¥ï¼Œå¹¶ä¸”é»˜è®¤é‡‡ç”¨ SMP é£æ ¼çš„åˆ†é…ç­–ç•¥ã€‚åŒæ—¶ï¼ŒPure ä¹Ÿæ”¯æŒè‡ªå®šä¹‰çš„ rank æ˜ å°„ï¼ŒåŒ…æ‹¬ä½¿ç”¨ CrayPAT çš„ rank é‡æ’æ–‡ä»¶ã€‚è™½ç„¶è¿™äº›ç¡¬ä»¶ç›¸å…³çš„ç»†èŠ‚å¯¹å¼€å‘è€…æ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œä½† Pure å†…éƒ¨ä¼šåˆ©ç”¨è¿™äº›ä¿¡æ¯æ¥ä¼˜åŒ–å…³é”®åŠŸèƒ½ã€‚&lt;/p>
&lt;p>åœ¨ Pure åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¸ä¼šç›´æ¥æ‰§è¡Œåº”ç”¨ç¨‹åºçš„åŸå§‹ &lt;code>main&lt;/code> å‡½æ•°ã€‚ç›¸åï¼Œåº•å±‚çš„ MPI ç¨‹åºä¼šè°ƒç”¨ Pure è¿è¡Œæ—¶ç³»ç»Ÿä¸­å®šä¹‰çš„ &lt;code>main&lt;/code> å‡½æ•°ï¼Œè¯¥å‡½æ•°è´Ÿè´£åˆå§‹åŒ– Pure çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œç„¶ååˆ›å»ºå¹¶ç»‘å®šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ª &lt;code>original_main&lt;/code> å‡½æ•°ï¼Œè¿™æ˜¯ä»åº”ç”¨ç¨‹åºä»£ç ä¸­çš„åŸå§‹ &lt;code>main&lt;/code> å‡½æ•°é‡å‘½åè€Œæ¥çš„ç‰ˆæœ¬ã€‚åº”ç”¨ç¨‹åºæ‰§è¡Œå®Œæ¯•åï¼Œ&lt;code>original_main&lt;/code> å‡½æ•°è¿”å›åˆ° Pure è¿è¡Œæ—¶ç³»ç»Ÿï¼Œåè€…è´Ÿè´£å®Œæˆ MPI çš„æ¸…ç†å’Œç»ˆæ­¢è¿‡ç¨‹ã€‚&lt;/p>
&lt;h3 id="spin-steal-waiting-loop-ssw-loop">Spin-Steal Waiting Loop (SSW-Loop)&lt;/h3>
&lt;p>å½“ Pure çš„ rank é‡åˆ°é˜»å¡äº‹ä»¶ï¼Œå¦‚ç­‰å¾…æ¶ˆæ¯åˆ°è¾¾ï¼Œå®ƒå°†æ‰§è¡Œä¸€ä¸ªç§°ä¸º &lt;strong>è‡ªæ—‹ã€çªƒå–ç­‰å¾…å¾ªç¯ï¼ˆSSW-Loopï¼‰&lt;/strong> çš„æœºåˆ¶ï¼Œè€Œä¸æ˜¯ç®€å•åœ°è¿›å…¥ç©ºé—²çŠ¶æ€ã€‚åœ¨æ­¤å¾ªç¯ä¸­ï¼Œrank ä¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³é˜»å¡æ¡ä»¶ï¼Œä¾‹å¦‚æ˜¯å¦æœ‰æ¶ˆæ¯åˆ°è¾¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå®ƒä¼šå°è¯•ä»å…¶ä»– rank çªƒå–ä»»åŠ¡ã€‚å¦‚æœä¸€ä¸ªé˜»å¡çš„ rank èƒ½å¤ŸååŠ©å…¶è¿›ç¨‹ä¸­æ­£åœ¨å¹¶å‘æ‰§è¡Œçš„å…¶ä»–çº¿ç¨‹å®Œæˆä»»åŠ¡ï¼Œå®ƒå°±ä¼šå‚ä¸è¿™ç§ååŠ©å·¥ä½œã€‚&lt;/p>
&lt;p>ç”±äºçº¿ç¨‹æ˜¯ç»‘å®šåˆ°ç‰¹å®šçš„ CPU çš„ï¼Œå¹¶ä¸”æ¯ä¸ª rank åªè¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ŒPure é€‰æ‹©è®© rank ä¸»åŠ¨è‡ªæ—‹ç­‰å¾…ï¼Œè€Œä¸æ˜¯æ”¾å¼ƒ CPUã€‚SSW-Loop è®©è®¡ç®—ä¸­çš„ rank å…·æœ‰â€œå¤šæ€æ€§â€ï¼šå®ƒæ—¢å¯ä»¥ä½œä¸ºä¸»ç¨‹åºçš„è®¡ç®—èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ååŠ©å…¶ä»– rank æ‰§è¡Œçªƒå–åˆ°çš„ä»»åŠ¡å—ï¼Œç„¶åå†è¿”å›æ£€æŸ¥è‡ªèº«çš„é˜»å¡äº‹ä»¶ã€‚&lt;/p>
&lt;p>Pure éµå¾ªä¼˜å…ˆå¤„ç†å½“å‰ rank æ‹¥æœ‰çš„çªƒå–ä»»åŠ¡è´Ÿè½½çš„ç­–ç•¥ï¼ŒåšæŒä»»åŠ¡è´Ÿè½½ä¼˜å…ˆçš„è°ƒåº¦åŸåˆ™ã€‚&lt;/p>
&lt;p>ä¸é‚£äº›ä½¿ç”¨è¾…åŠ©çº¿ç¨‹æ¥å®ç°å·¥ä½œè´Ÿè½½çªƒå–æˆ–é€šä¿¡çš„ç³»ç»Ÿä¸åŒï¼ŒPure çš„ç‰¹ç‚¹æ˜¯å…è®¸åº”ç”¨çº§åˆ«çš„è®¡ç®—èŠ‚ç‚¹ç›´æ¥è¿›è¡Œä»»åŠ¡çªƒå–æ“ä½œã€‚&lt;/p>
&lt;h3 id="å®ç°è¯´æ˜">å®ç°è¯´æ˜&lt;/h3>
&lt;p>Pure æ˜¯ä½¿ç”¨ C++17 æ ‡å‡†åº“ç¼–å†™çš„ã€‚Pure è¿è¡Œæ—¶ç³»ç»Ÿç”±å¤§çº¦ 21,000 è¡Œæºä»£ç æ„æˆï¼Œè€Œ Pure å·¥å…·åˆ™åŒ…å«äº†çº¦ 14,000 è¡Œæºä»£ç ã€‚Pure å·²åœ¨å¤šç§ç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼ŒåŒ…æ‹¬ç¬”è®°æœ¬ç”µè„‘å’Œé›†ç¾¤ï¼Œå…¶è¿è¡Œä»…éœ€è¦ä¸€ä¸ªæ”¯æŒ C++17 çš„ç¼–è¯‘å™¨ã€ç±» Unix æ“ä½œç³»ç»Ÿä»¥åŠ MPI ç¯å¢ƒã€‚Pure çš„æºä»£ç å¯ä»¥åœ¨ GitHub ä¸Šå…¬å¼€è·å–ï¼Œé“¾æ¥ä¸ºï¼š &lt;a class="link" href="https://github.com/psota/pure" target="_blank" rel="noopener" >https://github.com/psota/pure
&lt;span style="white-space: nowrap;">&lt;svg width=".8em" height=".8em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>
ã€‚&lt;/p>
&lt;h3 id="ç‚¹å¯¹ç‚¹é€šä¿¡">ç‚¹å¯¹ç‚¹é€šä¿¡&lt;/h3>
&lt;p>Pure æä¾›äº†é˜»å¡å’Œéé˜»å¡çš„ç‚¹å¯¹ç‚¹æ¶ˆæ¯ä¼ é€’åŠŸèƒ½ï¼Œå…¶è¯­ä¹‰ä¸ MPI çš„æ¶ˆæ¯ä¼ é€’ç›¸ä¸€è‡´ã€‚&lt;/p>
&lt;p>Pure å†…éƒ¨é‡‡ç”¨ä¸‰ç§ä¸åŒçš„ç­–ç•¥æ¥è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œé€‰æ‹©å“ªç§ç­–ç•¥å–å†³äºæ¶ˆæ¯çš„å¤§å°ä»¥åŠå‘é€æ–¹å’Œæ¥æ”¶æ–¹æ˜¯å¦ä½äºåŒä¸€èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>Pure åœ¨æ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­åˆ†é…å¹¶å¤ç”¨ä¸€ä¸ªæŒä¹…çš„ Channel å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å­˜å‚¨äºè¿è¡Œæ—¶ç³»ç»Ÿä¸­ã€‚å†…éƒ¨çš„ Channel Manager è´Ÿè´£å°†æ¶ˆæ¯å‚æ•°æ˜ å°„åˆ°åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œå¹¶æ ¹æ®éœ€è¦åˆ›å»ºè¿™äº›ç»“æ„ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/strategy-2024-03-15.webp"
alt="strategy-2024-03-15" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>Pure æ¶ˆæ¯ä¼ é€’ç­–ç•¥&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;ul>
&lt;li>&lt;strong>çŸ­æ¶ˆæ¯ï¼ˆå°äº 8KBï¼‰&lt;/strong>ï¼š
&lt;ul>
&lt;li>é‡‡ç”¨æ— é”å¾ªç¯é˜Ÿåˆ—ï¼ˆPureBufferQueueï¼ŒPBQï¼‰ï¼Œå…·æœ‰ acquire-release å†…å­˜è¯­ä¹‰ã€‚å‘é€çº¿ç¨‹åœ¨æœ‰å¯ç”¨ç©ºé—´æ—¶å°†æ¶ˆæ¯å¤åˆ¶åˆ° PBQï¼Œæ¥æ”¶çº¿ç¨‹åˆ™åœ¨æ¶ˆæ¯å‡†å¤‡å¥½æ—¶å°†å…¶å–å‡ºã€‚
&lt;ul>
&lt;li>åœ¨çŸ­æ¶ˆæ¯ä¼ é€’ä¸­ï¼Œæ‹·è´çš„å¼€é”€ç›¸å¯¹è¾ƒå°ï¼Œè¿™æ ·å¯ä»¥è®©å‘é€æ–¹è°ƒç”¨è¿”å›åç«‹å³æ‰§è¡Œæ‰§è¡Œå…¶å®ƒæœ‰ç”¨çš„å·¥ä½œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å‘é€å’Œæ¥æ”¶çº¿ç¨‹éƒ½ä½¿ç”¨ SSW-Loop è¿›è¡Œç­‰å¾…ï¼Œä»¥å°½å¯èƒ½åœ°å®ç°è®¡ç®—ä¸é€šä¿¡çš„é‡å æ‰§è¡Œã€‚&lt;/li>
&lt;li>æ‰€æœ‰æ¶ˆæ¯çš„ slot å­˜å‚¨åœ¨ä¸€ä¸ªè¿ç»­çš„ç¼“å†²åŒºä¸­ï¼Œé€šè¿‡æŒ‡é’ˆç®—æœ¯ç¡®ä¿æ¯ä¸ª slot ä¸ç¼“å­˜è¡Œè¾¹ç•Œå¯¹é½ï¼Œé¿å…å‘é€å’Œæ¥æ”¶çº¿ç¨‹ä¹‹é—´çš„ä¼ªå…±äº«ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>å¤§æ¶ˆæ¯ï¼ˆå¤§äºç­‰äº 8KBï¼‰&lt;/strong>ï¼š
&lt;ul>
&lt;li>ç±»ä¼¼äº PBQ çš„ç­–ç•¥ï¼Œä½†ä½¿ç”¨ç›´æ¥ä»å‘é€æ–¹åˆ°æ¥æ”¶æ–¹çš„å•æ¬¡å†…å­˜æ‹·è´ï¼Œçµæ„Ÿæ¥è‡ª MPI çš„ rendezvous æ¨¡å¼ã€‚&lt;/li>
&lt;li>ä½¿ç”¨æ— é”çš„å›ºå®šå¤§å°å¾ªç¯ç¼“å†²åŒºæ¥å­˜å‚¨æ¥æ”¶æ–¹çš„æ¥æ”¶è°ƒç”¨å‚æ•°ã€‚&lt;/li>
&lt;li>å‘é€æ–¹é€šè¿‡ SSW-Loop ç­‰å¾…å…ƒæ•°æ®é˜Ÿåˆ—é¡¹ï¼Œç„¶åå°†æ¶ˆæ¯å†…å®¹ç›´æ¥å¤åˆ¶åˆ°æ¥æ”¶æ–¹çš„ç¼“å†²åŒºã€‚å‘é€æ–¹é€šè¿‡åœ¨æ— é”é˜Ÿåˆ—ä¸­æ’å…¥ä¼ è¾“çš„å­—èŠ‚æ•°æ¥é€šçŸ¥æ¥æ”¶æ–¹ä¼ è¾“å·²å®Œæˆã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>è·¨èŠ‚ç‚¹æ¶ˆæ¯&lt;/strong>
&lt;ul>
&lt;li>é€æ˜åœ°ä½¿ç”¨ MPI æ¥å£è¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚&lt;/li>
&lt;li>åœ¨ Pure åˆå§‹åŒ–æœŸé—´ï¼Œä½¿ç”¨åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•åˆ›å»º &lt;code>thread-rank-process-node&lt;/code> æ˜ å°„æ•°æ®ç»“æ„ï¼Œå°† Pure rank æ˜ å°„åˆ° MPI rankã€‚&lt;/li>
&lt;li>ä¸ºäº†ç¡®ä¿åœ¨æ¥æ”¶èŠ‚ç‚¹ä¸Šæ­£ç¡®çš„æ¥æ”¶çº¿ç¨‹èƒ½å¤Ÿæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œåœ¨ &lt;code>MPI_TAG&lt;/code> ä¸­ç¼–ç å‘é€å’Œæ¥æ”¶çº¿ç¨‹çš„ IDï¼Œè§£å†³å¤šçº¿ç¨‹è·¯ç”±é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="é›†åˆé€šä¿¡">é›†åˆé€šä¿¡&lt;/h3>
&lt;p>Pure çš„é›†ä½“é€šä¿¡æ“ä½œåœ¨è¯­ä¹‰ä¸Šä¸ MPI ç›¸åŒï¼Œä½†åœ¨èŠ‚ç‚¹å†…éƒ¨é€šè¿‡è‡ªä¸‹è€Œä¸Šæ„å»ºçš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œè¿™åœ¨å•èŠ‚ç‚¹å’Œå¤šèŠ‚ç‚¹åŸºå‡†æµ‹è¯•ä¸­éƒ½æ˜¾ç¤ºå‡ºäº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼Œå³ä½¿åœ¨è·¨èŠ‚ç‚¹é€šä¿¡æ—¶ä»ç„¶ä¾èµ–äº MPI çš„é›†åˆæ“ä½œã€‚&lt;/p>
&lt;p>Pure é‡‡ç”¨ä¸€ä¸ªé¢†å¯¼è€…çº¿ç¨‹æ¥åè°ƒé›†ä½“é€šä¿¡è¿‡ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ååŠ©è¿›è¡Œè®¡ç®—å¹¶æŒ‰éœ€è°ƒç”¨ MPI é›†åˆå‡½æ•°ã€‚&lt;/p>
&lt;ul>
&lt;li>Pure ä½¿ç”¨é™æ€é¢†å¯¼è€…é€‰ä¸¾æ–¹æ³•ï¼Œè¿™æ¯”åŸºäºæ¯”è¾ƒå’Œäº¤æ¢çš„â€œé¦–å…ˆè¿›å…¥â€æ–¹æ³•æ›´ä¸ºé«˜æ•ˆã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸‹ä»…ä»¥ All-Reduce ä¸ºä¾‹å­ï¼Œå…¶å®ƒé›†åˆé€šä¿¡æ“ä½œæ€æƒ³ç±»ä¼¼ã€‚&lt;/p>
&lt;p>å¯¹äºå°æ•°æ®çš„ All-Reduce æ“ä½œï¼ŒPure è®¾è®¡äº†åä¸º Sequenced Per-Thread Dropbox (SPTD) çš„å¹¶å‘æ•°æ®ç»“æ„ï¼Œæä¾›äº†ä¸€ç§é«˜æ•ˆçš„æ— é”æœºåˆ¶ï¼Œç”¨äºåœ¨é¢†å¯¼çº¿ç¨‹å’Œå…¶ä»–éé¢†å¯¼çº¿ç¨‹ä¹‹é—´å¯¹å¶åŒæ­¥å’Œå¯é€‰å…±äº«æ•°æ®ã€‚&lt;/p>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/SPTD-2024-03-15.webp"
alt="SPTD-2024-03-15" width="auto" loading="lazy">&lt;figcaption>
&lt;h4>Sequenced Per-Thread Dropbox (SPTD)&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>è¯¥æ–¹æ³•å€Ÿé‰´äº† flat-combinding æŠ€æœ¯ï¼Œå°†é€šä¿¡å™¨ä¸­çš„çº¿ç¨‹ 0 ä½œä¸ºé¢†å¯¼è€…çº¿ç¨‹ã€‚&lt;/p>
&lt;ul>
&lt;li>å¯¹äºå¤§å°ä¸è¶…è¿‡ 2KB çš„å°æ•°ç»„ï¼š
&lt;ul>
&lt;li>éé¢†å¯¼è€…çº¿ç¨‹é¦–å…ˆå°†æ•°æ®å¤åˆ¶åˆ° SPTDï¼Œç„¶åä¸é¢†å¯¼è€…çº¿ç¨‹åŒæ­¥ï¼Œè¡¨æ˜è¾“å…¥æ•°æ®å·²å°±ç»ªï¼ˆä½¿ç”¨åŸå­åºåˆ—å·è€Œéå…±äº«åŸå­è®¡æ•°å™¨ï¼‰ã€‚&lt;/li>
&lt;li>é¢†å¯¼è€…çº¿ç¨‹æ‰§è¡Œæ‰€æœ‰è¾“å…¥æ•°ç»„çš„é€å…ƒç´  Reduce æ“ä½œã€‚&lt;/li>
&lt;li>æ¯ä¸ªèŠ‚ç‚¹çš„é¢†å¯¼è€…çº¿ç¨‹ä½¿ç”¨ &lt;code>MPI_Allreduce&lt;/code> å¯¹å±€éƒ¨ Reduce ç»“æœè¿›è¡Œå…¨å±€ Reduceã€‚&lt;/li>
&lt;li>é¢†å¯¼è€…çº¿ç¨‹åŒæ­¥ï¼Œéé¢†å¯¼è€…çº¿ç¨‹å°†æœ€ç»ˆçš„ Reduce ç»“æœå¤åˆ¶åˆ°ç§æœ‰ç¼“å†²åŒºã€‚&lt;/li>
&lt;li>æ‰€æœ‰çº¿ç¨‹åœ¨ç­‰å¾…æ—¶æ‰§è¡Œ SSW-Loopã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¯¹äºè¶…è¿‡ 2KB çš„å¤§æ•°ç»„ï¼ŒReduce è®¡ç®—å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå› æ­¤éœ€è¦æ‰€æœ‰çº¿ç¨‹å¹¶å‘æ‰§è¡Œ Reduce è®¡ç®—ï¼Œå¹¶é€šè¿‡å…±äº«å†…å­˜ç›´æ¥ä»æ¯ä¸ªçº¿ç¨‹çš„ç¼“å†²åŒºä¸­è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚
&lt;ul>
&lt;li>Reduce å·¥ä½œè¢«åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„å—ï¼Œé¿å…ä¼ªå…±äº«å¹¶å®ç°å‘é‡åŒ–è®¡ç®—ã€‚&lt;/li>
&lt;li>çº¿ç¨‹ä½¿ç”¨ SPTD æŠ¥å‘Šå‡†å¤‡çŠ¶æ€ï¼Œå¹¶é€šè¿‡åŸå­åºåˆ—å·æ ‡è®°è®¡ç®—å®Œæˆã€‚&lt;/li>
&lt;li>é¢†å¯¼è€…çº¿ç¨‹è°ƒç”¨ &lt;code>MPI_Allreduce&lt;/code> æ‰§è¡Œè·¨èŠ‚ç‚¹çš„ All-Reduce æ“ä½œï¼Œå¹¶é€šè¿‡å¦ä¸€ä¸ªåŸå­åºåˆ—å·ä¼ æ’­æœ€ç»ˆç»“æœã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä»»åŠ¡è°ƒåº¦å™¨">ä»»åŠ¡è°ƒåº¦å™¨&lt;/h3>
&lt;p>Pure è¿è¡Œæ—¶ç³»ç»Ÿç²¾å¿ƒè®¾è®¡äº†ä¸€ä¸ªä»»åŠ¡è°ƒåº¦å™¨ï¼Œå®ƒåœ¨å…±äº«å†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä¸ªåä¸º &lt;code>active_tasks&lt;/code> çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„å­˜å‚¨äº†ä¸€ç³»åˆ—åŸå­æŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆå¯¹åº”äºä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸ºç³»ç»Ÿä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å’Œæ¯ä¸ª rank åˆ†é…äº†ä¸€ä¸ªæ¡ç›®ã€‚è¿™äº›æ¡ç›®æœ€åˆè¢«è®¾ç½®ä¸º &lt;code>nullptr&lt;/code>ï¼Œè¡¨ç¤ºä»»åŠ¡å°šæœªåˆ†é…ã€‚&lt;/p>
&lt;p>å½“ä¸€ä¸ªä»»åŠ¡è¢«åˆ›å»ºå¹¶å‡†å¤‡æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šä¸ºå…¶åˆå§‹åŒ–çŠ¶æ€ï¼Œå¹¶é€šè¿‡åŸå­æ“ä½œæ›´æ–° &lt;code>active_tasks&lt;/code> æ•°ç»„ä¸­ç›¸åº”çš„æ¡ç›®ï¼Œä»¥åæ˜ è¯¥ä»»åŠ¡å·²è¢«åˆ†é…ã€‚è¿™ä¸ªæ›´æ–°è¿‡ç¨‹ç¡®ä¿äº†ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€å¯¹ç³»ç»Ÿä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å¯è§çš„ï¼Œä»è€Œä½¿å¾—ä»»åŠ¡å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹â€œçªƒå–â€ã€‚&lt;/p>
&lt;p>åœ¨ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‹¥æœ‰ä»»åŠ¡çš„ rank ä¼šå¼€å§‹æ‰§è¡Œä¸€ç³»åˆ—çš„ chunkï¼Œè¿™äº›æ˜¯ä»»åŠ¡çš„ç»†åˆ†å·¥ä½œå•å…ƒã€‚åŒæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¼šåœ¨å®ƒä»¬çš„ SSL-Loop æœŸé—´ä¸æ–­æ£€æŸ¥ &lt;code>active_tasks&lt;/code> æ•°ç»„ï¼Œé€šè¿‡åŸå­åŠ è½½æ“ä½œæ¥å¯»æ‰¾å¯æ‰§è¡Œçš„éç©ºä»»åŠ¡ã€‚&lt;/p>
&lt;p>ä»»åŠ¡çš„æ‰§è¡Œæ˜¯ç”±ä¸¤ä¸ªåŸå­æ•´æ•° &lt;code>curr_chunk&lt;/code> å’Œ &lt;code>chunks_done&lt;/code> æ¥åè°ƒçš„ã€‚æ‹¥æœ‰ä»»åŠ¡çš„ rankï¼ˆowner rankï¼‰å’Œå¯èƒ½çš„çªƒå–è€… rankï¼ˆthief ranksï¼‰éƒ½ä¼šè¿è¡Œç›¸åŒçš„å¹¶å‘æ‰§è¡Œå‡½æ•°ã€‚çªƒå–è€…çº¿ç¨‹ä¼šæ‰§è¡Œä¸€ä¸ª chunk åè¿”å›ï¼Œè€Œæ‹¥æœ‰è€…çº¿ç¨‹åˆ™æŒç»­æ‰§è¡Œç›´åˆ°æ‰€æœ‰ chunk å®Œæˆã€‚é€šè¿‡ä½¿ç”¨ &lt;code>fetch_add&lt;/code> æ“ä½œï¼Œçº¿ç¨‹å¯ä»¥ç¡®å®šè‡ªå·±åº”è¯¥æ‰§è¡Œå“ªä¸ª chunkï¼Œå¦‚æœ &lt;code>curr_chunk&lt;/code> çš„å€¼å·²ç»è¶…è¿‡äº†æ€»çš„ chunk æ•°é‡ï¼Œçº¿ç¨‹åˆ™ä¼šåœæ­¢æ‰§è¡Œã€‚&lt;/p>
&lt;p>æ¯å½“ä¸€ä¸ª chunk è¢«æˆåŠŸå®Œæˆåï¼Œçº¿ç¨‹ä¼šåŸå­æ€§åœ°å¢åŠ  &lt;code>chunks_done&lt;/code> çš„å€¼ã€‚æ‹¥æœ‰è€…çº¿ç¨‹ä¼šæ›´æ–°å…¶æœ¬åœ°å­˜å‚¨ï¼Œä»¥é¿å…ç¼“å­˜æœªå‘½ä¸­ã€‚æœ€ç»ˆï¼Œæ‹¥æœ‰è€… rank ä¼šç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„ chunk éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œç¡®ä¿ä»»åŠ¡çš„å®Œæ•´æ‰§è¡Œã€‚&lt;/p>
&lt;p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»»åŠ¡çš„ chunk ä¸åº”ç”¨ç¨‹åºçš„ rank æ˜¯åœ¨åŒä¸€ç¡¬ä»¶çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ã€‚åœ¨ Pure åº”ç”¨ä¸­ï¼Œæ¯ä¸ªç¡¬ä»¶çº¿ç¨‹éƒ½è¢«åˆ†é…ç»™ä¸€ä¸ªç‰¹å®šçš„ rankã€‚å°½ç®¡ç›®å‰ Pure è¿˜æ²¡æœ‰åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿå™¨ï¼ˆå¦‚ GPUï¼‰æ¥åŠ é€Ÿä»»åŠ¡æ‰§è¡Œï¼Œä½†è®¾è®¡è€…ç›¸ä¿¡ Pure çš„æ¶æ„å®Œå…¨æœ‰èƒ½åŠ›æ”¯æŒè¿™ç§åŠ é€Ÿã€‚&lt;/p>
&lt;p>Pure çš„ä»»åŠ¡è°ƒåº¦å™¨æä¾›äº†å¤šç§æ‰§è¡Œæ¨¡å¼å’Œçªƒå–ç®—æ³•ï¼Œä»¥é€‚åº”ä¸åŒçš„æ‰§è¡Œéœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œä½œè€…å®ç°äº†å• chunk æ‰§è¡Œæ¨¡å¼å’Œä¸€ç§å¼•å¯¼å¼è‡ªè°ƒåº¦æ¨¡å¼ï¼Œåè€…æ˜¯ä¸€ç§å·¥ä½œåˆ’åˆ†ç®—æ³•ï¼Œå®ƒä¼˜å…ˆåˆ†é…è¾ƒå¤§çš„å·¥ä½œå—ï¼Œç„¶åæ˜¯è¾ƒå°çš„å·¥ä½œå—ã€‚æ­¤å¤–ï¼Œè°ƒåº¦å™¨è¿˜åŒ…æ‹¬ NUMA æ„ŸçŸ¥çªƒå–æ¨¡å¼ï¼Œå®ƒä¼˜å…ˆä»åŒä¸€ NUMA èŠ‚ç‚¹ä¸Šçš„çº¿ç¨‹çªƒå–ä»»åŠ¡ï¼Œä»¥åŠä¸€ç§â€œé»æ€§â€çªƒå–æ¨¡å¼ï¼Œå…è®¸çªƒå–è€…çº¿ç¨‹è¿”å›å®ƒä»¬æœ€è¿‘çªƒå–ä¸”ä»åœ¨æ´»è·ƒçŠ¶æ€çš„ä»»åŠ¡ã€‚è¿™äº›ç‰¹æ€§å…±åŒç¡®ä¿äº†ä»»åŠ¡è°ƒåº¦çš„é«˜æ•ˆæ€§å’Œçµæ´»æ€§ã€‚&lt;/p>
&lt;h2 id="è¯„ä¼°">è¯„ä¼°&lt;/h2>
&lt;p>åœ¨ä¼¯å…‹åˆ© NERSC çš„ Cori HPC é›†ç¾¤ä¸Šè¿›è¡Œäº† Pure çš„æ€§èƒ½è¯„ä¼°ã€‚è¯¥é›†ç¾¤åŒ…å« 2388 ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹é…ç½®æœ‰ 2 ä¸ªæ’æ§½ã€16 ä¸ªæ ¸å¿ƒå’Œ 128GB å†…å­˜ï¼Œé€šè¿‡ Cray Aires è¿›è¡ŒèŠ‚ç‚¹é—´äº’è”ã€‚å®éªŒé…ç½®å¯ç”¨äº†è¶…çº¿ç¨‹ï¼Œå¹¶é‡‡ç”¨ 256 ä½å‘é‡å®½åº¦ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ 2 ä¸ªè¿›ç¨‹ï¼Œå…± 32 ä¸ªçº¿ç¨‹ã€‚è¯„ä¼°ä½¿ç”¨ Intel ç¼–è¯‘å™¨ï¼Œå¹¶å°† Cray MPICH ä½œä¸ºæ€§èƒ½åŸºçº¿ã€‚&lt;/p>
&lt;h3 id="nas-dt-åŸºå‡†æµ‹è¯•ç»“æœ">NAS DT åŸºå‡†æµ‹è¯•ç»“æœ&lt;/h3>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/nasdt-2024-03-15.webp"
alt="nasdt-2024-03-15" width="auto" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>ä»…é€šè¿‡ä¼˜åŒ–æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼ŒPure å–å¾—äº† 11% è‡³ 25% çš„æ€§èƒ½åŠ é€Ÿã€‚&lt;/li>
&lt;li>å¼•å…¥ Pure Tasks åï¼Œæ€§èƒ½åŠ é€Ÿæ¯”æå‡è‡³ 1.7 å€è‡³ 2.6 å€ã€‚&lt;/li>
&lt;li>è¾…åŠ©çº¿ç¨‹èƒ½å°å¹…æé«˜æ€§èƒ½ï¼Œä¸è¿‡ä»…é™äºå‰©ä½™æœªä½¿ç”¨çš„ CPU æ ¸å¿ƒæ‰èƒ½ä½¿ç”¨ã€‚åœ¨è¿™é‡Œï¼Œé™¤äº† 80 ä¸ª rank çš„æƒ…å†µä¸‹ç©ºé—²äº† 24 ä¸ªæ ¸å¿ƒï¼Œå…¶å®ƒæƒ…å†µä¸‹éƒ½å……åˆ†åˆ©ç”¨äº† CPU æ ¸å¿ƒã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="comd-å’Œ-miniamr-åŸºå‡†æµ‹è¯•">CoMD å’Œ miniAMR åŸºå‡†æµ‹è¯•&lt;/h3>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/benchmark-pure-2024-03-15.webp"
alt="benchmark-pure-2024-03-15" width="auto" loading="lazy">
&lt;/figure>
&lt;p>-åœ¨ CoMD åˆ†å­åŠ¨åŠ›å­¦åº”ç”¨ä¸­ï¼ŒPure åœ¨æ‰€æœ‰ rank æ•°ä¸‹çš„æ€§èƒ½å‡ä¼˜äºä»…ä½¿ç”¨ MPI åŠ MPI+OpenMP çš„æ€§èƒ½ï¼Œåˆ†åˆ«å®ç°äº† 7% è‡³ 25% ä»¥åŠ 35% è‡³ 50% çš„åŠ é€Ÿæ¯”ï¼Œå³ä½¿åœ¨æ²¡æœ‰è´Ÿè½½ä¸å‡è¡¡çš„æƒ…å†µä¸‹ã€‚&lt;/p>
&lt;ul>
&lt;li>åœ¨ miniAMR è‡ªé€‚åº”ç½‘æ ¼ç»†åŒ–åº”ç”¨ä¸­ï¼ŒPure è‡³å°‘å®ç°äº† 20%ï¼Œæœ€å¤š 50% çš„æ€§èƒ½åŠ é€Ÿã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="é›†åˆé€šä¿¡æ€§èƒ½">é›†åˆé€šä¿¡æ€§èƒ½&lt;/h3>
&lt;figure>&lt;img src="https://cuterwrite-1302252842.file.myqcloud.com/img/benchmark-pure-msg-2024-03-15.webp"
alt="benchmark-pure-msg-2024-03-15" width="auto" loading="lazy">
&lt;/figure>
&lt;ul>
&lt;li>Pure åœ¨é›†åˆé€šä¿¡æ“ä½œä¸­çš„æ€§èƒ½è¡¨ç°çªå‡ºï¼Œè¿™äº›æ“ä½œçš„å†…éƒ¨ä¼˜åŒ–æœºåˆ¶å’Œæ•°æ®ç»“æ„è®¾è®¡ä½¿å¾— Pure åœ¨å¤„ç†å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—ä»»åŠ¡æ—¶å±•ç°å‡ºæ˜¾è‘—çš„æ•ˆç‡å’Œä¼˜åŠ¿ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="ç›¸å…³å·¥ä½œ">ç›¸å…³å·¥ä½œ&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">ç±»åˆ«&lt;/th>
&lt;th style="text-align:left">ç›¸å…³å·¥ä½œ&lt;/th>
&lt;th style="text-align:left">Pure çš„ä¼˜åŠ¿&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">MPI&lt;/td>
&lt;td style="text-align:left">1. åˆ©ç”¨å¤šæ ¸èŠ‚ç‚¹å†…çš„å…±äº«å†…å­˜æå‡æ€§èƒ½ï¼›2. XPMEM æ˜¾è‘—å¢å¼ºèŠ‚ç‚¹å†…é€šä¿¡æ•ˆç‡ï¼›3. ch4 ç½‘ç»œåº“ä¼˜åŒ–äº† MPI çš„å…±äº«å†…å­˜é€šä¿¡ï¼›4. æ”¹è¿›äº† MPI çš„é›†åˆé€šä¿¡ç®—æ³•ï¼›5. DMAPP åº“é’ˆå¯¹ç‰¹å®šé›†åˆé€šä¿¡è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½†é™åˆ¶è¾ƒå¤šï¼›6. è§£å†³äº†å¤§è§„æ¨¡å…¨å¯¹å…¨é›†åˆé€šä¿¡çš„æŒ‘æˆ˜ï¼›7. å•è¾¹æ¶ˆæ¯ API å®ç°äº†è§£è€¦ï¼›8. ä¼˜åŒ–äº†æ•°æ®ç§»åŠ¨ä¸è¿›ç¨‹åŒæ­¥&lt;/td>
&lt;td style="text-align:left">1. Pure åœ¨æ‰€æœ‰é›†åˆé€šä¿¡å’Œè´Ÿè½½å¤§å°ä¸Šå‡å±•ç°å‡ºå“è¶Šçš„æ€§èƒ½ï¼›2. æä¾›äº†é«˜çº§çš„é€šä¿¡è®¡ç®—é‡å æœºåˆ¶ï¼Œè¶…è¶Šäº†ä¼ ç»Ÿçš„å•è¾¹æ¶ˆæ¯ API&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">MPI å¤šçº¿ç¨‹&lt;/td>
&lt;td style="text-align:left">1. æ”¯æŒ MPI_THREAD_MULTIPLE æ¨¡å¼ä¸‹çš„ rank å†…å¤šçº¿ç¨‹ï¼› 2. å¤šæ•° MPI å®ç°é€šè¿‡å…¨å±€é”å®ç°çº¿ç¨‹å®‰å…¨ï¼Œå¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼›3. MPI 4.0 å¼•å…¥ MPI+X æ–¹æ³•å¢å¼ºå¤šçº¿ç¨‹æ”¯æŒï¼›4. å¼•å…¥äº† MPI Fine-points å’Œ Endpoints æ¦‚å¿µä»¥æ”¯æŒçº¿ç¨‹&lt;/td>
&lt;td style="text-align:left">1. Pure é‡è§†å¤šçº¿ç¨‹ä»£ç ä¸­çš„ MPI è°ƒç”¨ï¼Œå¼ºè°ƒå…¶é‡è¦æ€§ï¼›2. æä¾›äº†ä¸€ç§ç»Ÿä¸€çš„ç¼–ç¨‹æ¨¡å‹ï¼Œç®€åŒ–äº†å¹¶è¡Œä»»åŠ¡çš„å¼•å…¥&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">AMPI&lt;/td>
&lt;td style="text-align:left">1. åŸºäº Charm++ çš„ MPI å…¼å®¹åº“ï¼›2. æä¾›é«˜çº§å¹¶è¡Œç¼–ç¨‹æŠ½è±¡ï¼›3. é€šè¿‡æœ€å°åŒ–ä»£ç æ›´æ”¹å®ç°æ€§èƒ½æå‡&lt;/td>
&lt;td style="text-align:left">1. Pure åœ¨å®é™…æµ‹è¯•ä¸­è¡¨ç°ä¼˜äº AMIPï¼Œå¾—ç›Šäºå…¶ä¼˜åŒ–çš„æ¶ˆæ¯ä¼ é€’å’Œé›†åˆé€šä¿¡ï¼Œä»¥åŠæ›´ç²¾ç»†å’Œä½å¼€é”€çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼›2. ç›¸è¾ƒäº AMIP SMP åŸºäºçº¿ç¨‹çš„æ¨¡å‹ï¼ŒPure æä¾›äº†æ›´é«˜æ•ˆçš„å¹¶è¡Œå¤„ç†&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">PGAS è¯­è¨€å’Œå¹¶è¡Œæ¡†æ¶&lt;/td>
&lt;td style="text-align:left">1. PGAS è¯­è¨€æä¾›äº†å…¨å±€å†…å­˜åœ°å€ç©ºé—´çš„æŠ½è±¡ï¼›2. Chapel å’Œ X10 æ‰©å±•äº† PGAS æ–¹æ³•ï¼Œæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹å¼‚æ­¥ä»»åŠ¡ï¼›3. HPX ä¸ºç°ä»£ C++æ ‡å‡†å¢åŠ äº†åˆ†å¸ƒå¼æ“ä½œæ”¯æŒï¼›4. Legion ä½œä¸ºæ•°æ®ä¸­å¿ƒå¹¶è¡Œç¼–ç¨‹ç³»ç»Ÿï¼›5. Kokkos, STAPL, BCL ç­‰æ¡†æ¶æä¾›äº†åº”ç”¨ç¨‹åºä¸ç¡¬ä»¶é—´çš„æŠ½è±¡å±‚&lt;/td>
&lt;td style="text-align:left">1. ç±»ä¼¼äº Pureï¼ŒPGAS æ¨¡å‹é‡‡ç”¨ SPMD é£æ ¼ï¼Œé€šè¿‡å±€éƒ¨æ€§å¼•ç”¨æé«˜æ€§èƒ½ï¼›2. è¿™äº›æ¡†æ¶è™½ç„¶åˆ©ç”¨äº†ç°ä»£ C++ç‰¹æ€§ï¼Œä½†é€šå¸¸éœ€è¦å¯¹ç°æœ‰åº”ç”¨ç¨‹åºè¿›è¡Œå¤§é‡é‡å†™ï¼Œè€Œ Pure åˆ™æä¾›äº†æ›´ä¸ºç›´æ¥çš„ä¼˜åŒ–è·¯å¾„&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æ•°åå¹´æ¥ï¼Œç”±äºå…¶ç›¸å¯¹çš„ç®€å•æ€§å’Œæ€§èƒ½ä¼˜åŠ¿ï¼Œæ¶ˆæ¯ä¼ é€’ä¸€ç›´è¢«è§†ä¸ºå¹¶è¡Œç¼–ç¨‹çš„æ ‡å‡†æ¨¡å‹ã€‚ç„¶è€Œï¼Œæœ¬æ–‡è¡¨æ˜ï¼Œæ¶ˆæ¯ä¼ é€’ä¸å…±äº«å†…å­˜å¹¶éä¸å¯å…¼å®¹ã€‚å®é™…ä¸Šï¼Œé€šè¿‡è®¾è®¡åˆé€‚çš„åº“ï¼Œå¯ä»¥åœ¨ä¸ç‰ºç‰²å¤§å¤šæ•°æ¶ˆæ¯ä¼ é€’ä¼˜ç‚¹çš„å‰æä¸‹å……åˆ†åˆ©ç”¨å…±äº«å†…å­˜ã€‚&lt;/p></description></item></channel></rss>